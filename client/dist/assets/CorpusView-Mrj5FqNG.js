import{n as d,S as g,_ as p}from"../build.js";import{S as C}from"./SingleKeyword-CwdZpRcD.js";import S from"./AdminLumaSettings-CLkPOEKM.js";import{S as z}from"./StackDisplay-DW5elpAC.js";import"./KeywordsField-BbeEipvy.js";var P=Object.defineProperty,x=Object.defineProperties,M=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,m=(s,e,t)=>e in s?P(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,F=(s,e)=>{for(var t in e||(e={}))y.call(e,t)&&m(s,t,e[t]);if(h)for(var t of h(e))$.call(e,t)&&m(s,t,e[t]);return s},L=(s,e)=>x(s,M(e)),R=(s,e)=>{var t={};for(var i in s)y.call(s,i)&&e.indexOf(i)<0&&(t[i]=s[i]);if(s!=null&&h)for(var i of h(s))e.indexOf(i)<0&&$.call(s,i)&&(t[i]=s[i]);return t};function k(s,e,t,i,a,n,o,l){var r=typeof s=="function"?s.options:s;e&&(r.render=e,r.staticRenderFns=t,r._compiled=!0);var c;if(a&&(c=a),c)if(r.functional){r._injectStyles=c;var u=r.render;r.render=function(b,f){return c.call(f),u(b,f)}}else{var _=r.beforeCreate;r.beforeCreate=_?[].concat(_,c):[c]}return{exports:s,options:r}}const D={name:"splitpanes",props:{horizontal:{type:Boolean},pushOtherPanes:{type:Boolean,default:!0},dblClickSplitter:{type:Boolean,default:!0},rtl:{type:Boolean,default:!1},firstSplitter:{type:Boolean}},provide(){return{requestUpdate:this.requestUpdate,onPaneAdd:this.onPaneAdd,onPaneRemove:this.onPaneRemove,onPaneClick:this.onPaneClick}},data:()=>({container:null,ready:!1,panes:[],touch:{mouseDown:!1,dragging:!1,activeSplitter:null},splitterTaps:{splitter:null,timeoutId:null}}),computed:{panesCount(){return this.panes.length},indexedPanes(){return this.panes.reduce((s,e)=>(s[e.id]=e)&&s,{})}},methods:{updatePaneComponents(){this.panes.forEach(s=>{s.update&&s.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[s.id].size}%`})})},bindEvents(){document.addEventListener("mousemove",this.onMouseMove,{passive:!1}),document.addEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.addEventListener("touchmove",this.onMouseMove,{passive:!1}),document.addEventListener("touchend",this.onMouseUp))},unbindEvents(){document.removeEventListener("mousemove",this.onMouseMove,{passive:!1}),document.removeEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.removeEventListener("touchmove",this.onMouseMove,{passive:!1}),document.removeEventListener("touchend",this.onMouseUp))},onMouseDown(s,e){this.bindEvents(),this.touch.mouseDown=!0,this.touch.activeSplitter=e},onMouseMove(s){this.touch.mouseDown&&(s.preventDefault(),this.touch.dragging=!0,this.calculatePanesSize(this.getCurrentMouseDrag(s)),this.$emit("resize",this.panes.map(e=>({min:e.min,max:e.max,size:e.size}))))},onMouseUp(){this.touch.dragging&&this.$emit("resized",this.panes.map(s=>({min:s.min,max:s.max,size:s.size}))),this.touch.mouseDown=!1,setTimeout(()=>{this.touch.dragging=!1,this.unbindEvents()},100)},onSplitterClick(s,e){"ontouchstart"in window&&(s.preventDefault(),this.dblClickSplitter&&(this.splitterTaps.splitter===e?(clearTimeout(this.splitterTaps.timeoutId),this.splitterTaps.timeoutId=null,this.onSplitterDblClick(s,e),this.splitterTaps.splitter=null):(this.splitterTaps.splitter=e,this.splitterTaps.timeoutId=setTimeout(()=>{this.splitterTaps.splitter=null},500)))),this.touch.dragging||this.$emit("splitter-click",this.panes[e])},onSplitterDblClick(s,e){let t=0;this.panes=this.panes.map((i,a)=>(i.size=a===e?i.max:i.min,a!==e&&(t+=i.min),i)),this.panes[e].size-=t,this.$emit("pane-maximize",this.panes[e])},onPaneClick(s,e){this.$emit("pane-click",this.indexedPanes[e])},getCurrentMouseDrag(s){const e=this.container.getBoundingClientRect(),{clientX:t,clientY:i}="ontouchstart"in window&&s.touches?s.touches[0]:s;return{x:t-e.left,y:i-e.top}},getCurrentDragPercentage(s){s=s[this.horizontal?"y":"x"];const e=this.container[this.horizontal?"clientHeight":"clientWidth"];return this.rtl&&!this.horizontal&&(s=e-s),s*100/e},calculatePanesSize(s){const e=this.touch.activeSplitter;let t={prevPanesSize:this.sumPrevPanesSize(e),nextPanesSize:this.sumNextPanesSize(e),prevReachedMinPanes:0,nextReachedMinPanes:0};const i=0+(this.pushOtherPanes?0:t.prevPanesSize),a=100-(this.pushOtherPanes?0:t.nextPanesSize),n=Math.max(Math.min(this.getCurrentDragPercentage(s),a),i);let o=[e,e+1],l=this.panes[o[0]]||null,r=this.panes[o[1]]||null;const c=l.max<100&&n>=l.max+t.prevPanesSize,u=r.max<100&&n<=100-(r.max+this.sumNextPanesSize(e+1));if(c||u){c?(l.size=l.max,r.size=Math.max(100-l.max-t.prevPanesSize-t.nextPanesSize,0)):(l.size=Math.max(100-r.max-t.prevPanesSize-this.sumNextPanesSize(e+1),0),r.size=r.max);return}if(this.pushOtherPanes){const _=this.doPushOtherPanes(t,n);if(!_)return;({sums:t,panesToResize:o}=_),l=this.panes[o[0]]||null,r=this.panes[o[1]]||null}l!==null&&(l.size=Math.min(Math.max(n-t.prevPanesSize-t.prevReachedMinPanes,l.min),l.max)),r!==null&&(r.size=Math.min(Math.max(100-n-t.nextPanesSize-t.nextReachedMinPanes,r.min),r.max))},doPushOtherPanes(s,e){const t=this.touch.activeSplitter,i=[t,t+1];return e<s.prevPanesSize+this.panes[i[0]].min&&(i[0]=this.findPrevExpandedPane(t).index,s.prevReachedMinPanes=0,i[0]<t&&this.panes.forEach((a,n)=>{n>i[0]&&n<=t&&(a.size=a.min,s.prevReachedMinPanes+=a.min)}),s.prevPanesSize=this.sumPrevPanesSize(i[0]),i[0]===void 0)?(s.prevReachedMinPanes=0,this.panes[0].size=this.panes[0].min,this.panes.forEach((a,n)=>{n>0&&n<=t&&(a.size=a.min,s.prevReachedMinPanes+=a.min)}),this.panes[i[1]].size=100-s.prevReachedMinPanes-this.panes[0].min-s.prevPanesSize-s.nextPanesSize,null):e>100-s.nextPanesSize-this.panes[i[1]].min&&(i[1]=this.findNextExpandedPane(t).index,s.nextReachedMinPanes=0,i[1]>t+1&&this.panes.forEach((a,n)=>{n>t&&n<i[1]&&(a.size=a.min,s.nextReachedMinPanes+=a.min)}),s.nextPanesSize=this.sumNextPanesSize(i[1]-1),i[1]===void 0)?(s.nextReachedMinPanes=0,this.panes[this.panesCount-1].size=this.panes[this.panesCount-1].min,this.panes.forEach((a,n)=>{n<this.panesCount-1&&n>=t+1&&(a.size=a.min,s.nextReachedMinPanes+=a.min)}),this.panes[i[0]].size=100-s.prevPanesSize-s.nextReachedMinPanes-this.panes[this.panesCount-1].min-s.nextPanesSize,null):{sums:s,panesToResize:i}},sumPrevPanesSize(s){return this.panes.reduce((e,t,i)=>e+(i<s?t.size:0),0)},sumNextPanesSize(s){return this.panes.reduce((e,t,i)=>e+(i>s+1?t.size:0),0)},findPrevExpandedPane(s){return[...this.panes].reverse().find(t=>t.index<s&&t.size>t.min)||{}},findNextExpandedPane(s){return this.panes.find(t=>t.index>s+1&&t.size>t.min)||{}},checkSplitpanesNodes(){Array.from(this.container.children).forEach(e=>{const t=e.classList.contains("splitpanes__pane"),i=e.classList.contains("splitpanes__splitter");if(!t&&!i){e.parentNode.removeChild(e),console.warn("Splitpanes: Only <pane> elements are allowed at the root of <splitpanes>. One of your DOM nodes was removed.");return}})},addSplitter(s,e,t=!1){const i=s-1,a=document.createElement("div");a.classList.add("splitpanes__splitter"),t||(a.onmousedown=n=>this.onMouseDown(n,i),typeof window<"u"&&"ontouchstart"in window&&(a.ontouchstart=n=>this.onMouseDown(n,i)),a.onclick=n=>this.onSplitterClick(n,i+1)),this.dblClickSplitter&&(a.ondblclick=n=>this.onSplitterDblClick(n,i+1)),e.parentNode.insertBefore(a,e)},removeSplitter(s){s.onmousedown=void 0,s.onclick=void 0,s.ondblclick=void 0,s.parentNode.removeChild(s)},redoSplitters(){const s=Array.from(this.container.children);s.forEach(t=>{t.className.includes("splitpanes__splitter")&&this.removeSplitter(t)});let e=0;s.forEach(t=>{t.className.includes("splitpanes__pane")&&(!e&&this.firstSplitter?this.addSplitter(e,t,!0):e&&this.addSplitter(e,t),e++)})},requestUpdate(s){var e=s,{target:t}=e,i=R(e,["target"]);const a=this.indexedPanes[t._uid];Object.entries(i).forEach(([n,o])=>a[n]=o)},onPaneAdd(s){let e=-1;Array.from(s.$el.parentNode.children).some(a=>(a.className.includes("splitpanes__pane")&&e++,a===s.$el));const t=parseFloat(s.minSize),i=parseFloat(s.maxSize);this.panes.splice(e,0,{id:s._uid,index:e,min:isNaN(t)?0:t,max:isNaN(i)?100:i,size:s.size===null?null:parseFloat(s.size),givenSize:s.size,update:s.update}),this.panes.forEach((a,n)=>a.index=n),this.ready&&this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({addedPane:this.panes[e]}),this.$emit("pane-add",{index:e,panes:this.panes.map(a=>({min:a.min,max:a.max,size:a.size}))})})},onPaneRemove(s){const e=this.panes.findIndex(i=>i.id===s._uid),t=this.panes.splice(e,1)[0];this.panes.forEach((i,a)=>i.index=a),this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({removedPane:L(F({},t),{index:e})}),this.$emit("pane-remove",{removed:t,panes:this.panes.map(i=>({min:i.min,max:i.max,size:i.size}))})})},resetPaneSizes(s={}){!s.addedPane&&!s.removedPane?this.initialPanesSizing():this.panes.some(e=>e.givenSize!==null||e.min||e.max<100)?this.equalizeAfterAddOrRemove(s):this.equalize(),this.ready&&this.$emit("resized",this.panes.map(e=>({min:e.min,max:e.max,size:e.size})))},equalize(){const s=100/this.panesCount;let e=0,t=[],i=[];this.panes.forEach(a=>{a.size=Math.max(Math.min(s,a.max),a.min),e-=a.size,a.size>=a.max&&t.push(a.id),a.size<=a.min&&i.push(a.id)}),e>.1&&this.readjustSizes(e,t,i)},initialPanesSizing(){100/this.panesCount;let s=100,e=[],t=[],i=0;this.panes.forEach(n=>{s-=n.size,n.size!==null&&i++,n.size>=n.max&&e.push(n.id),n.size<=n.min&&t.push(n.id)});let a=100;s>.1&&(this.panes.forEach(n=>{n.size===null&&(n.size=Math.max(Math.min(s/(this.panesCount-i),n.max),n.min)),a-=n.size}),a>.1&&this.readjustSizes(s,e,t))},equalizeAfterAddOrRemove({addedPane:s,removedPane:e}={}){let t=100/this.panesCount,i=0,a=[],n=[];s&&s.givenSize!==null&&(t=(100-s.givenSize)/(this.panesCount-1)),this.panes.forEach(o=>{i-=o.size,o.size>=o.max&&a.push(o.id),o.size<=o.min&&n.push(o.id)}),!(Math.abs(i)<.1)&&(this.panes.forEach(o=>{s&&s.givenSize!==null&&s.id===o.id||(o.size=Math.max(Math.min(t,o.max),o.min)),i-=o.size,o.size>=o.max&&a.push(o.id),o.size<=o.min&&n.push(o.id)}),i>.1&&this.readjustSizes(i,a,n))},readjustSizes(s,e,t){let i;s>0?i=s/(this.panesCount-e.length):i=s/(this.panesCount-t.length),this.panes.forEach((a,n)=>{if(s>0&&!e.includes(a.id)){const o=Math.max(Math.min(a.size+i,a.max),a.min),l=o-a.size;s-=l,a.size=o}else if(!t.includes(a.id)){const o=Math.max(Math.min(a.size+i,a.max),a.min),l=o-a.size;s-=l,a.size=o}a.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[a.id].size}%`})}),Math.abs(s)>.1&&this.$nextTick(()=>{this.ready&&console.warn("Splitpanes: Could not resize panes correctly due to their constraints.")})}},watch:{panes:{deep:!0,immediate:!1,handler(){this.updatePaneComponents()}},horizontal(){this.updatePaneComponents()},firstSplitter(){this.redoSplitters()},dblClickSplitter(s){[...this.container.querySelectorAll(".splitpanes__splitter")].forEach((t,i)=>{t.ondblclick=s?a=>this.onSplitterDblClick(a,i):void 0})}},beforeDestroy(){this.ready=!1},mounted(){this.container=this.$refs.container,this.checkSplitpanesNodes(),this.redoSplitters(),this.resetPaneSizes(),this.$emit("ready"),this.ready=!0},render(s){return s("div",{ref:"container",class:["splitpanes",`splitpanes--${this.horizontal?"horizontal":"vertical"}`,{"splitpanes--dragging":this.touch.dragging}]},this.$slots.default)}};let E,T;const v={};var O=k(D,E,T,!1,N);function N(s){for(let e in v)this[e]=v[e]}var q=function(){return O.exports}(),A=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"splitpanes__pane",style:s.style,on:{click:function(i){return s.onPaneClick(i,s._uid)}}},[s._t("default")],2)},B=[];const I={name:"pane",inject:["requestUpdate","onPaneAdd","onPaneRemove","onPaneClick"],props:{size:{type:[Number,String],default:null},minSize:{type:[Number,String],default:0},maxSize:{type:[Number,String],default:100}},data:()=>({style:{}}),mounted(){this.onPaneAdd(this)},beforeDestroy(){this.onPaneRemove(this)},methods:{update(s){this.style=s}},computed:{sizeNumber(){return this.size||this.size===0?parseFloat(this.size):null},minSizeNumber(){return parseFloat(this.minSize)},maxSizeNumber(){return parseFloat(this.maxSize)}},watch:{sizeNumber(s){this.requestUpdate({target:this,size:s})},minSizeNumber(s){this.requestUpdate({target:this,min:s})},maxSizeNumber(s){this.requestUpdate({target:this,max:s})}}},w={};var j=k(I,A,B,!1,H);function H(s){for(let e in w)this[e]=w[e]}var V=function(){return j.exports}();const Z={props:{shared_files:Array,group_mode:String,sort_order:String,search_str:String,filetype_filter:String,author_path_filter:String,available_keywords:Array,keywords_filter:Array,fav_filter:Boolean,view_mode:String},components:{SingleKeyword:C,SearchInput2:g},data(){return{show_filter_sort_pane:!1,all_authors:[],show_all_keywords:!1,kw_search:"",group_options:[{key:"day",label:this.$t("day")},{key:"month",label:this.$t("month")},{key:"year",label:this.$t("year")}],type_of_media_to_display:"all",types_of_medias:[{key:"all",label:this.$t("all_medias_types")},{key:"image",label:this.$t("image")},{key:"video",label:this.$t("video")},{key:"audio",label:this.$t("audio")},{key:"text",label:this.$t("text")},{key:"pdf",label:this.$t("pdf")},{key:"stl",label:this.$t("stl")},{key:"other",label:this.$t("other")}]}},i18n:{messages:{fr:{search_fields:"Rechercher dans les champs titre et description des documents."},en:{search_fields:"Search in titles or descriptions of documents."}}},async created(){this.all_authors=await this.$api.getFolders({path:"authors"})},async mounted(){},beforeDestroy(){},watch:{},computed:{available_keywords_except_active(){return this.available_keywords.filter(e=>this.keywords_filter.includes(e.title)?!1:this.kw_search?this.twoStringsSearch(e.title,this.kw_search):!0)},collapsable_keywords(){return this.show_all_keywords?this.available_keywords_except_active:this.available_keywords_except_active.slice(0,10)},can_be_reset(){return this.group_mode!=="year"||this.sort_order!=="date_modified"||this.search_str!==""||this.author_path_filter!==""||this.filetype_filter!=="all"||this.keywords_filter.length>0}},methods:{resetFilters(){this.$emit("update:group_mode","year"),this.$emit("update:sort_order","date_modified"),this.$emit("update:search_str",""),this.$emit("update:author_path_filter",""),this.$emit("update:filetype_filter","all"),this.$emit("update:keywords_filter",[])},filterByKeyword(s){let e=this.keywords_filter.slice();this.keywords_filter.includes(s)?e=e.filter(t=>t!==s):e.push(s),this.$emit("update:keywords_filter",e)},removeFilter(s){this.$nextTick(()=>{this.filterByKeyword(s)})},addFilter(s){this.$nextTick(()=>{this.kw_search="",this.filterByKeyword(s)})}}};var U=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_filterBar"},[t("div",{staticClass:"_topBtn"},[t("div",{},[t("button",{staticClass:"u-buttonLink",class:{"is--active":e.show_filter_sort_pane},attrs:{type:"button"},on:{click:function(i){e.show_filter_sort_pane=!e.show_filter_sort_pane}}},[t("b-icon",{attrs:{icon:"filter"}}),e._v(" "+e._s(e.$t("filters"))+" ")],1)]),t("div",{staticClass:"_searchField"},[t("SearchInput2",{attrs:{value:e.search_str,search_placeholder:e.$t("search_fields")},on:{input:function(i){return e.$emit("update:search_str",i)}}})],1),t("div",{staticClass:"u-sameRow"},[t("div",[t("button",{staticClass:"u-button u-button_icon u-button_transparent",class:{"is--active":e.fav_filter===!0},attrs:{type:"button"},on:{click:function(i){return e.$emit("update:fav_filter",!e.fav_filter)}}},[t("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),t("button",{staticClass:"u-button u-button_icon",class:{"is--active":e.view_mode==="list"},attrs:{type:"button"},on:{click:function(i){return e.$emit("update:view_mode","list")}}},[t("b-icon",{attrs:{icon:"grid3x3"}})],1),t("button",{staticClass:"u-button u-button_icon",class:{"is--active":e.view_mode==="map"},attrs:{type:"button"},on:{click:function(i){return e.$emit("update:view_mode","map")}}},[t("b-icon",{attrs:{icon:"map-fill"}})],1)])]),t("transition",{attrs:{name:"pagechange"}},[e.show_filter_sort_pane?t("div",{staticClass:"_filterPane"},[t("div",{staticClass:"_filterPane--row"},[t("select",{staticClass:"_selectField",domProps:{value:e.sort_order},on:{change:function(i){return e.$emit("update:sort_order",i.target.value)}}},[t("option",{attrs:{value:"date_modified"},domProps:{textContent:e._s(e.$t("date_modified"))}}),t("option",{attrs:{value:"date_created"},domProps:{textContent:e._s(e.$t("date_created"))}})]),t("select",{staticClass:"_selectField",domProps:{value:e.group_mode},on:{change:function(i){return e.$emit("update:group_mode",i.target.value)}}},e._l(e.group_options,function(i){return t("option",{key:i.key,domProps:{value:i.key,textContent:e._s(i.label)}})}),0),t("select",{staticClass:"_selectField",domProps:{value:e.author_path_filter},on:{change:function(i){return e.$emit("update:author_path_filter",i.target.value)}}},[t("option",{attrs:{value:""},domProps:{textContent:e._s(e.$t("none"))}}),e._l(e.all_authors,function(i){return t("option",{key:i.$path,domProps:{value:i.$path,textContent:e._s(i.name)}})})],2),t("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[e.can_be_reset?t("button",{staticClass:"u-buttonLink _resetFilters",attrs:{type:"button"},on:{click:e.resetFilters}},[e._v(" "+e._s(e.$t("reset"))+" ")]):e._e()])],1),t("div",{staticClass:"_filterPane--row"},[t("div",{staticClass:"_tag"},[t("DLabel",{attrs:{str:e.$t("filter_by_keyword")}}),t("div",{staticClass:"_searchKW"},[t("SearchInput2",{attrs:{search_placeholder:e.$t("search")},model:{value:e.kw_search,callback:function(i){e.kw_search=i},expression:"kw_search"}})],1),e.keywords_filter.length>0?t("div",{staticClass:"u-keywords _usedKw"},e._l(e.keywords_filter,function(i){return t("SingleKeyword",{key:i,attrs:{keyword:i,can_remove:!0},on:{remove:function(a){return e.removeFilter(i)}}})}),1):e._e(),t("div",{staticClass:"u-keywords"},[e._l(e.collapsable_keywords,function(i){return t("SingleKeyword",{key:i.title,attrs:{keyword:i.title,count:i.count,can_add:!0},on:{add:function(a){return e.addFilter(i.title)}}})}),e.available_keywords_except_active.length>10?t("button",{staticClass:"u-buttonLink",class:{"is--active":e.show_all_keywords},attrs:{type:"button"},on:{click:function(i){e.show_all_keywords=!e.show_all_keywords}}},[e._v(" "+e._s(e.$t("show_all_keywords"))+" ")]):e._e()],2)],1)])]):e._e()])],1)},W=[],K=d(Z,U,W,!1,null,"2e40d8e3");const Q=K.exports,J={props:{stack:Object,is_selected:Boolean,is_favorite:Boolean,can_be_added_to_fav:Boolean},components:{},data(){return{start_slide:!1,stack_files:void 0,index_of_slide_file_to_show:void 0}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{number_of_medias_in_stack(){var s;return((s=this.stack.stack_files_metas)==null?void 0:s.length)||0},slide_file_to_show(){return this.stack_files&&this.index_of_slide_file_to_show!==void 0?this.stack_files[this.index_of_slide_file_to_show]:!1}},methods:{openStack(){const s=this.getFilename(this.stack.$path);this.$emit("openStack",s)},async startSlide(s){this.start_slide=!0,setTimeout(async()=>{if(this.start_slide){const e=await this.loadFiles();this.stack_files=e,this.updateMousePos(s)}},200)},updateMousePos(s){if(!this.stack_files)return;const{pageX:e}=s,{x:t,width:i}=this.$el.getBoundingClientRect(),a=(e-t)/i;this.index_of_slide_file_to_show=Math.floor(a*this.number_of_medias_in_stack)},endSlide(){this.start_slide=!1,this.stack_files=void 0,this.index_of_slide_file_to_show=void 0},async loadFiles(){const s=await this.$api.getFolder({path:this.stack.$path});return this.getStackFilesInOrder({stack:s})}}};var X=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_stackPreview",on:{mouseenter:e.startSlide,mousemove:e.updateMousePos,mouseleave:e.endSlide}},[t("button",{staticClass:"_stackPreview--content",class:{"is--slider":e.start_slide,"is--selected":e.is_selected},attrs:{type:"button"},on:{click:e.openStack}},[t("div",{staticClass:"_preview"},[t("div",{key:"preview",staticClass:"_mainPreview",class:{"is--showingSlides":e.slide_file_to_show}},[e.stack.$preview?t("MediaContent",{staticClass:"_mediaPreview",attrs:{file:e.stack.$preview}}):t("b-icon",{attrs:{icon:"eye-slash"}})],1),e._l(e.stack_files,function(i){var a;return t("div",{key:i.$path,staticClass:"_slide",class:{"is--shown":i.$path===((a=e.slide_file_to_show)==null?void 0:a.$path)}},[t("MediaContent",{staticClass:"_mediaPreview",attrs:{file:i}})],1)}),t("transition-group",{staticClass:"_count",attrs:{name:"projectsList"}},[e.index_of_slide_file_to_show!==void 0?[t("div",{key:"slide"},[e._v(" "+e._s(e.index_of_slide_file_to_show+1)+" ")]),t("div",{key:"slash"},[e._v("/")])]:e._e(),t("div",{key:"preview"},[e._v(" "+e._s(e.number_of_medias_in_stack)+" ")])],2)],2),t("div",{staticClass:"_title"},[e._v(" "+e._s(e.stack.title)+" ")])]),t("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[e.can_be_added_to_fav&&(e.is_favorite||e.start_slide)?t("div",[t("button",{staticClass:"u-button u-button_icon u-button_transparent _addToFav",attrs:{type:"button","data-isfav":e.is_favorite},on:{click:function(i){return i.stopPropagation(),e.$emit("toggleFav")}}},[t("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):e._e()])],1)},G=[],Y=d(J,X,G,!1,null,"0785e8a6");const ee=Y.exports,te={props:{shared_folder_path:String},components:{FilterBar:Q,StackPreview:ee,AdminLumaSettings:S,StackDisplay:z,MediaMap:()=>p(()=>import("./MediaMap-AaL8issn.js"),[])},data(){return{all_stacks:[],is_loading_folder:!0,show_admin_settings:!1,last_selected_stack_path:void 0,view_mode:"list",sort_order:localStorage.getItem("archive.sort_order")||"date_modified",search_str:"",filetype_filter:"all",author_path_filter:"",keywords_filter:[],group_mode:"year",fav_filter:!1}},i18n:{messages:{fr:{only_my_fav:"Que les favoris"},en:{only_my_fav:"Favourites"}}},async created(){},async mounted(){this.all_stacks=await this.$api.getFolders({path:this.stack_shared_folder_path}),this.$api.join({room:this.stack_shared_folder_path}),this.is_loading_folder=!1},beforeDestroy(){this.$api.leave({room:this.stack_shared_folder_path})},watch:{opened_stack(){this.opened_stack&&(this.last_selected_stack_path=this.opened_stack.$path)},sort_order(){localStorage.setItem("archive.sort_order",this.sort_order)}},computed:{stack_shared_folder_path(){return this.shared_folder_path+"/stacks"},can_be_added_to_fav(){var s;return this.connected_as&&((s=this.connected_as)==null?void 0:s.$path)!==void 0},sorted_stacks(){return this.all_stacks.slice().sort((s,e)=>+new Date(e.$date_modified)-+new Date(s.$date_modified))},filtered_stacks(){return this.sorted_stacks.filter(s=>{var e;return this.fav_filter&&!this.isFavorite(s.$path)||this.author_path_filter&&!((e=s.$authors)!=null&&e.includes(this.author_path_filter))||this.keywords_filter.length>0&&(!s.keywords||!Array.isArray(s.keywords)||this.keywords_filter.some(t=>!s.keywords.includes(t)))?!1:this.search_str?!!(s.title&&s.title.toLowerCase().includes(this.search_str.toLowerCase())||s.description&&s.description.toLowerCase().includes(this.search_str.toLowerCase())):!0})},grouped_stacks(){let s=["$date_modified"];return this.sort_order==="date_created"?s=["date_created_corrected","$date_created","$date_uploaded"]:this.sort_order==="date_modified"&&(s=["$date_modified"]),this.groupFilesBy(this.filtered_stacks,s,this.group_mode)},available_keywords(){return this.filtered_stacks.reduce((e,t)=>(t.keywords&&Array.isArray(t.keywords)&&t.keywords.map(i=>{const a=e.find(n=>n.title===i);a?a.count+=1:e.push({title:i,count:1})}),e),[]).sort((e,t)=>t.count-e.count)},opened_stack(){var s;return(s=this.$route.query)!=null&&s.stack?this.all_stacks.find(e=>this.getFilename(e.$path)===this.$route.query.stack):!1}},methods:{toggleMediaFocus(s){const e=this.getFilename(s);this.openStack(e)},openStack(s){let e=Object.assign({},this.$route.query)||{};e.stack=s,this.$router.push({query:e})},isFavorite(s){var e;return!((e=this.connected_as)!=null&&e.favorites)||this.connected_as.favorites.length===0?!1:this.connected_as.favorites.some(t=>t.stack_path===s)},async toggleFav(s){var t;let e=(t=this.connected_as)!=null&&t.favorites?this.connected_as.favorites.slice():[];this.isFavorite(s)?e=e.filter(i=>i.stack_path!==s):e.push({stack_path:s,added:+new Date}),await this.$api.updateMeta({path:this.connected_as.$path,new_meta:{favorites:e}})},closeStack(){let s=Object.assign({},this.$route.query)||{};delete s.stack,this.$router.push({query:s})}}};var se=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_sharedFolder"},[t("transition",{attrs:{name:"slideup",mode:"out-in"}},[e.opened_stack?t("StackDisplay",{key:e.opened_stack.$path,staticClass:"_stackModal",attrs:{stack_path:e.opened_stack.$path,context:"archive",can_be_added_to_fav:e.can_be_added_to_fav,is_favorite:e.isFavorite(e.opened_stack.$path)},on:{toggleFav:function(i){return e.toggleFav(e.opened_stack.$path)},prevMedia:function(i){return e.navMedia(-1)},nextMedia:function(i){return e.navMedia(1)},close:e.closeStack}}):e._e()],1),t("div",{staticClass:"_sharedFolder--content"},[t("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[e.is_loading_folder?t("div",{staticClass:"_loader"},[t("LoaderSpinner")],1):t("div",[t("FilterBar",{attrs:{group_mode:e.group_mode,sort_order:e.sort_order,search_str:e.search_str,filetype_filter:e.filetype_filter,author_path_filter:e.author_path_filter,available_keywords:e.available_keywords,keywords_filter:e.keywords_filter,fav_filter:e.fav_filter,view_mode:e.view_mode},on:{"update:group_mode":function(i){e.group_mode=i},"update:sort_order":function(i){e.sort_order=i},"update:search_str":function(i){e.search_str=i},"update:filetype_filter":function(i){e.filetype_filter=i},"update:author_path_filter":function(i){e.author_path_filter=i},"update:keywords_filter":function(i){e.keywords_filter=i},"update:fav_filter":function(i){e.fav_filter=i},"update:view_mode":function(i){e.view_mode=i}}}),t("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t("transition-group",{key:e.sort_order+"-"+e.group_mode,attrs:{tag:"div",name:"projectsList",appear:""}},[e.grouped_stacks.length===0?t("div",{key:"nocontent",staticClass:"u-instructions _noContent"},[e._v(" "+e._s(e.$t("no_content"))+" ")]):[e.view_mode==="list"?e._l(e.grouped_stacks,function({label:i,files:a}){return t("div",{key:i,staticClass:"_dayFileSection"},[t("div",{staticClass:"_label"},[e._v(" "+e._s(i)+" ")]),t("transition-group",{staticClass:"_itemGrid",attrs:{tag:"div",name:"listComplete",appear:""}},e._l(a,function(n){return t("StackPreview",{key:n.$path,attrs:{stack:n,is_selected:n.$path===e.last_selected_stack_path,can_be_added_to_fav:e.can_be_added_to_fav,is_favorite:e.isFavorite(n.$path)},on:{toggleFav:function(o){return e.toggleFav(n.$path)},openStack:e.openStack}})}),1)],1)}):e.view_mode==="map"?t("div",{key:"mediaMap",staticClass:"_mediamapContainer"},[t("MediaMap",{attrs:{medias:e.filtered_stacks},on:{toggleMediaFocus:e.toggleMediaFocus}})],1):e._e()]],2)],1)],1)]),t("footer",{staticClass:"_footer"},[t("small",[t("a",{attrs:{href:"mailto:"+e.$root.app_infos.instance_meta.contactmail,target:"_blank"}},[e._v(" "+e._s(e.$t("help_contact"))+" ")]),t("br"),e._v(" "+e._s(e.$t("version"))+" "+e._s(e.$root.app_infos.version)+" "),e.is_instance_admin?t("button",{staticClass:"u-buttonLink _adminBtn",attrs:{type:"button"},on:{click:function(i){e.show_admin_settings=!0}}},[e._v(" "+e._s(e.$t("admin_settings"))+" ")]):e._e(),e.show_admin_settings?t("AdminLumaSettings",{on:{close:function(i){e.show_admin_settings=!1}}}):e._e()],1)])],1)],1)},ie=[],ae=d(te,se,ie,!1,null,"c2df2ba7");const ne=ae.exports,oe={props:{modal_name:String,path:String,default_folder_status:{type:String,default:"public"}},components:{},data(){return{new_folder_title:"",new_folder_is_private:!1,new_folder_template:"story_with_sections",available_templates:[{value:"story_with_sections",label:this.$t("story_with_sections")},{value:"agora",label:this.$t("agora")}],is_creating_folder:!1,allow_save:!1,error_msg:""}},created(){},mounted(){},i18n:{messages:{fr:{agora:"Agora"},en:{agora:"Agora"}}},beforeDestroy(){},watch:{},computed:{},methods:{async createFolder(){this.is_creating_folder=!0;const s=this.setDefaultContentAdmins();this.new_folder_title=this.cleanUpString(this.new_folder_title);let e={title:this.new_folder_title,template:this.new_folder_template,requested_slug:this.new_folder_title,$status:this.new_folder_is_private===!0?"private":this.default_folder_status,$admins:s};this.new_folder_template==="agora"&&(e.autoscroll=!0);try{const t=await this.$api.createFolder({path:this.path,additional_meta:e});setTimeout(()=>{this.$emit("openNew",t)},50)}catch({code:t}){t==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):t==="token_not_allowed_must_be_contributors"?this.$alertify.delay(4e3).error(this.$t("action_not_allowed")):this.$alertify.delay(4e3).error(t),this.is_creating_folder=!1}}}};var re=function(){var e=this,t=e._self._c;return t("BaseModal2",{attrs:{title:e.modal_name},on:{close:function(i){return e.$emit("close")}}},[t("form",{staticClass:"input-validation-required",on:{submit:function(i){return i.preventDefault(),e.createFolder.apply(null,arguments)}}},[t("DLabel",{attrs:{str:e.$t("title")}}),t("TextInput",{ref:"titleInput",attrs:{content:e.new_folder_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(i){e.new_folder_title=i},toggleValidity:i=>e.allow_save=i,onEnter:e.createFolder}}),t("br"),t("div",{},[t("ToggleInput",{attrs:{content:e.new_folder_is_private,label:e.$t("private"),options:{true:e.$t("private_status_explanations"),false:e.$t("public_status_explanations")}},on:{"update:content":function(i){e.new_folder_is_private=i}}})],1),t("br"),t("div",{},[t("DLabel",{attrs:{str:e.$t("template")}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.new_folder_template,expression:"new_folder_template"}],on:{change:function(i){var a=Array.prototype.filter.call(i.target.options,function(n){return n.selected}).map(function(n){var o="_value"in n?n._value:n.value;return o});e.new_folder_template=i.target.multiple?a:a[0]}}},e._l(e.available_templates,function(i){return t("option",{key:i.value,domProps:{value:i.value}},[e._v(" "+e._s(i.label)+" ")])}),0)],1),t("br"),t("div",{staticClass:"u-sameRow",attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return e.$emit("close")}}},[e._v(" "+e._s(e.$t("cancel"))+" ")]),t("button",{staticClass:"u-button u-button_bleuvert",attrs:{slot:"footer",type:"submit",loading:e.is_creating_folder},slot:"footer"},[e._v(" "+e._s(e.$t("create_and_open"))+" ")])]),e.error_msg?[t("br"),t("br"),t("div",{staticClass:"u-errorMsg",domProps:{textContent:e._s(e.error_msg)}})]:e._e()],2)])},le=[],ce=d(oe,re,le,!1,null,"61e6051c");const de=ce.exports,_e={props:{},components:{SearchInput2:g,CreateCollection:de},data(){return{show_create_collection:!1,collections:[],path:"collections",search_coll_name:""}},i18n:{messages:{fr:{collections:"Collections",create_a_collection:"Créer une collection",search_in_titles:"Rechercher dans les titres",collection_instr:"Les collections regroupent des médias dans l’espace partagé pour les partager."},en:{collections:"Collections",create_a_collection:"Create a collection",search_in_titles:"Search in titles",collection_instr:"Collections group multiple medias"}}},async created(){this.collections=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.stack})},sorted_collections(){return this.collections.slice().filter(s=>this.canLoggedinSeeFolder({folder:s})).sort((s,e)=>s.title.localeCompare(e.title))},filtered_collections(){return this.sorted_collections.filter(s=>this.search_coll_name?this.twoStringsSearch(s.title,this.search_coll_name):!0)}},methods:{openNewCollection(s){this.show_create_collection=!1,this.$emit("open",s)}}};var he=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_collectionsList"},[t("div",{staticClass:"u-spacingBottom u-instructions"},[e._v(" "+e._s(e.$t("collection_instr"))+" ")]),t("div",{staticClass:"u-spacingBottom"},[t("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(i){e.show_create_collection=!0}}},[t("b-icon",{attrs:{icon:"plus-circle"}}),e._v("  "+e._s(e.$t("create_a_collection"))+" ")],1),e.show_create_collection?t("CreateCollection",{attrs:{modal_name:e.$t("create_a_collection"),path:"collections",default_folder_status:"private"},on:{close:function(i){e.show_create_collection=!1},openNew:e.openNewCollection}}):e._e()],1),t("div",{staticClass:"u-spacingBottom"},[t("SearchInput2",{attrs:{search_placeholder:e.$t("search_in_titles")},model:{value:e.search_coll_name,callback:function(i){e.search_coll_name=i},expression:"search_coll_name"}})],1),t("table",{staticClass:"u-spacingBottom _list"},[t("transition-group",{attrs:{tag:"tbody",name:"projectsList",appear:""}},e._l(e.filtered_collections,function(i){return t("tr",{key:i.$path,on:{click:function(a){e.$emit("open",e.getFilename(i.$path))}}},[t("td",[t("strong",[e._v(e._s(i.title))]),e._v(" – "),t("i",[e._v(e._s(e.$t(i.template||"story_with_sections").toLowerCase()))])]),t("td",[t("div",{staticClass:"u-sameRow"},e._l(i.$admins,function(a,n){return t("AuthorTag",{key:a+"_"+n,attrs:{path:a,show_image_only:!0}})}),1)])])}),0)],1)])},ue=[],pe=d(_e,he,ue,!1,null,"b53ae7c3");const fe=pe.exports,me={props:{pane_infos:Object},components:{StorySectionTemplate:()=>p(()=>import("./StorySectionTemplate-DW6cWgJX.js"),[]),AgoraTemplate:()=>p(()=>import("./AgoraTemplate-BSmS01ri.js"),[])},data(){return{is_loading:!0,collection:void 0,path:"collections/"+this.pane_infos.opened_collection_slug,fetch_coll_error_message:"",show_qr_code_modal:!1}},i18n:{messages:{fr:{make_public:"Accès public (sans mot de passe ou compte)"},en:{make_public:"Allow access to everyone (without password or account)"}}},async created(){const s=await this.$api.getFolder({path:this.path}).catch(e=>{e.code==="folder_private"?this.fetch_coll_error_message=this.$t("coll_is_private"):this.fetch_coll_error_message=e.code,this.is_loading=!1});this.collection=s,this.is_loading=!1,this.$api.join({room:this.path}),this.$eventHub.$on("collection.addStack",this.addToStack)},mounted(){},beforeDestroy(){this.$api.leave({room:this.path}),this.$eventHub.$off("collection.addStack",this.addToStack)},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.collection})},share_url(){let s={};this.collection.template==="story_with_sections"&&(s={display:"section"}),this.collection.template==="agora"&&this.collection.autoscroll===!0&&(s={scroll:"auto"});const e=this.$router.resolve({path:this.createURLFromPath(this.collection.$path),query:s});return window.location.origin+e.href}},methods:{addToStack(){},async removeCollection(){await this.$api.deleteItem({path:this.collection.$path}),this.$emit("close")}}};var ve=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_openedCollection"},[t("transition",{attrs:{name:"slideup",mode:"out-in"}},[e.is_loading?t("div",{key:"loader"},[t("div",{staticClass:"_spinner"},[t("LoaderSpinner")],1)]):e.fetch_coll_error_message?t("div",{key:"err",staticClass:"_error"},[t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return e.$emit("close")}}},[t("b-icon",{attrs:{icon:"arrow-left"}}),e._v(" "+e._s(e.$t("back"))+" ")],1),t("div",{},[e._v(" "+e._s(e.fetch_coll_error_message)+" ")])]):t("div",{key:e.collection.$path},[t("div",{staticClass:"_titleBar"},[t("TitleField",{attrs:{field_name:"title",content:e.collection.title,path:e.collection.$path,tag:"h1",required:!0,can_edit:e.can_edit}})],1),t("div",{staticClass:"_topbar"},[t("div",{},[t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return e.$emit("close")}}},[t("b-icon",{attrs:{icon:"arrow-left"}}),e._v(" "+e._s(e.$t("back"))+" ")],1)]),t("AuthorField",{staticClass:"_admins",attrs:{label:e.$t("admins"),instructions:e.$t("media_editing_instructions"),field:"$admins",authors_paths:e.collection.$admins,path:e.collection.$path,can_edit:e.can_edit,show_image_only:!0}}),e.can_edit?t("StatusTag",{attrs:{status:e.collection.$status||"public",status_options:["public","private"],path:e.collection.$path,can_edit:e.can_edit}}):e._e(),e.can_edit?t("DropDown",[e.can_edit?t("RemoveMenu",{attrs:{remove_text:e.$t("remove")},on:{remove:e.removeCollection}}):e._e(),t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){e.show_qr_code_modal=!0}}},[t("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[t("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[t("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),t("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),t("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),t("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),t("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])]),e._v(" "+e._s(e.$t("direct_link"))+" ")])],1):e._e(),e.show_qr_code_modal?t("QRModal",{attrs:{url_to_access:e.share_url},on:{close:function(i){e.show_qr_code_modal=!1}}},[t("ToggleField",{attrs:{label:e.$t("make_public"),field_name:"$public",content:e.collection.$public===!0,path:e.collection.$path,can_edit:e.can_edit}})],1):e._e()],1),t("div",{staticClass:"_cont"},[!e.collection.template||e.collection.template==="story_with_sections"?t("StorySectionTemplate",{attrs:{publication:e.collection,pane_infos:e.pane_infos,can_edit:e.can_edit},on:{updatePane:function(i){return e.$emit("updatePane",i)}}}):e.collection.template==="agora"?t("AgoraTemplate",{attrs:{publication:e.collection,can_edit:e.can_edit}}):e._e()],1)])])],1)},we=[],ge=d(me,ve,we,!1,null,"3ae679d4");const ye=ge.exports,$e={props:{},components:{CollectionsList:fe,OpenedCollection:ye},data(){return{}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{pane_infos(){var e,t;let s={};return(e=this.$route.query)!=null&&e.collection&&(s.opened_collection_slug=this.$route.query.collection),(t=this.$route.query)!=null&&t.section&&(s.section=this.$route.query.section),s}},methods:{openCollection(s){this.updateCollectionQuery(s)},closeCollection(){this.updateCollectionQuery(!1)},updatePane({key:s,value:e}){this.updatePageQuery({prop:s,val:e})},async updateCollectionQuery(s){this.updatePageQuery({prop:"collection",val:s})}}};var ke=function(){var i;var e=this,t=e._self._c;return t("div",{staticClass:"_collections"},[t("CollectionsList",{on:{open:e.openCollection}}),(i=e.pane_infos)!=null&&i.opened_collection_slug?t("OpenedCollection",{attrs:{pane_infos:e.pane_infos},on:{updatePane:e.updatePane,close:e.closeCollection}}):e._e()],1)},be=[],Ce=d($e,ke,be,!1,null,"6dbbe7c4");const Se=Ce.exports,ze={props:{},components:{Splitpanes:q,Pane:V,SharedFolder2:ne,CollectionsPane:Se},data(){return{path:"folders",folders:void 0,shared_folder_path:void 0,possible_panes:[{key:"archive",label:"ARCHIVE",icon:"grid3x3-gap"},{key:"collection",label:"COLLECTION",icon:"layout-sidebar-inset-reverse"}],top_panes_width:{archive:50,collection:50},panes_width:{archive:50,collection:50},show_chutier:!0}},async created(){const s=this.loadPanesWidthFromStorage();s?this.panes_width=s:this.$root.is_mobile_view?(this.panes_width.archive=100,this.panes_width.collection=0):(this.panes_width.archive=100,this.panes_width.collection=0),await this.loadFolder()},async mounted(){},beforeDestroy(){},watch:{connected_as(){},panes_width:{handler(){Object.entries(this.panes_width).map(([s,e])=>this.top_panes_width[s]=e),this.savePanesWidthToStorage()},deep:!0}},computed:{min_toppane_width(){return 0}},methods:{async loadFolder(){await this.$api.getFolders({path:"authors"}),this.folders=await this.$api.getFolders({path:this.path}).catch(s=>{this.fetch_spaces_error=s.response}),this.folders.length===0?(await this.createFolder(),window.location.reload()):this.shared_folder_path=this.folders[0].$path},async createFolder(){try{return await this.$api.createFolder({path:this.path,additional_meta:{title:"default",$admins:"everyone"}})}catch{}},resizeTopPane(s){s.map((e,t)=>{const i=Number(e.size.toFixed(1));t===0&&(this.top_panes_width.archive=i),t===1&&(this.top_panes_width.collection=i)})},resizedPane(s){s.map((e,t)=>{const i=Number(e.size.toFixed(1));t===0&&(this.panes_width.archive=i),t===1&&(this.panes_width.collection=i)})},setTopbarWidth(s){return`
        --topPane-width: ${this.top_panes_width[s]}%;
      `},togglePane(s){this.panes_width[s]>0?Object.entries(this.panes_width).map(([e,t])=>e===s?this.panes_width[e]=0:this.panes_width[e]=100):Object.entries(this.panes_width).map(([e,t])=>this.panes_width[e]=50)},savePanesWidthToStorage(){localStorage.setItem("panes_width",JSON.stringify(this.panes_width))},loadPanesWidthFromStorage(){try{const s=localStorage.getItem("panes_width");if(s){const e=JSON.parse(s);return e.format&&delete e.format,e.chutier&&delete e.chutier,e}}catch{}return!1}}};var Pe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_contributeView"},[e.shared_folder_path?[t("div",{staticClass:"_topBarIndication"},e._l(e.possible_panes,function(i){return t("div",{key:i.key,staticClass:"_topBarIndication--item",style:e.setTopbarWidth(i.key),on:{click:function(a){return e.togglePane(i.key)}}},[t("span",{staticClass:"_topBarIndication--item--names"},[t("b-icon",{attrs:{icon:i.icon}}),e._v(" "+e._s(i.label)+" ")],1)])}),0),t("splitpanes",{staticClass:"_splitpanes",attrs:{"watch-slots":""},on:{resize:e.resizeTopPane,resized:e.resizedPane}},e._l(["archive","collection"],function(i){return t("pane",{key:i,attrs:{size:e.panes_width[i]}},[i==="archive"?t("div",{staticClass:"_sharedContent"},[t("SharedFolder2",{attrs:{shared_folder_path:e.shared_folder_path}})],1):i==="collection"?t("CollectionsPane"):e._e()],1)}),1)]:t("LoaderSpinner")],2)},xe=[],Me=d(ze,Pe,xe,!1,null,"c4366270");const Oe=Me.exports;export{Oe as default};
