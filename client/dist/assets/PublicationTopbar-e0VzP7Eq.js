import{n as c,b as u}from"../build.js";const d={props:{path:String,source_title:String,publication:Object},components:{SpaceProjectPicker:u},data(){return{navigation_to_copy:!1,show_modal:!1,destination_project_path:void 0,remove_original:!1,new_title:this.$t("copy_of")+" "+this.source_title,is_copying:!1}},created(){},async mounted(){},beforeDestroy(){},watch:{show_modal(){this.show_modal&&(this.navigation_to_copy=void 0)}},computed:{project_medias_to_copy(){return this.publication.$files.reduce((o,t)=>(Object.prototype.hasOwnProperty.call(t,"source_medias")&&t.source_medias.map(e=>{const i=this.getSourceMedia({source_media:e,folder_path:this.publication.$path});o.includes(i.$path)||o.push(i.$path)}),o),[])}},methods:{async confirm(){this.is_copying=!0;const o=this.destination_project_path+"/publications",t=await this.$api.copyFolder({path:this.path,path_to_destination_type:o,new_meta:{title:this.new_title}}).catch(s=>{throw s==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):s==="not_allowed_to_copy_to_space"&&this.$alertify.delay(4e3).error(this.$t("not_allowed_to_copy_to_space")),this.is_copying=!1,"fail"}),e=await this.$api.getFolder({path:t});if(this.$alertify.closeLogOnClick(!0).delay(4e3).success("publication_copy_success"),this.getParent(this.path)!==this.destination_project_path+"/publications"){this.$alertify.closeLogOnClick(!0).delay(4e3).log("has_linked_media_to_copy");for(let s of this.project_medias_to_copy){const l=await this.$api.copyFile({path:s,path_to_destination_folder:this.destination_project_path,new_meta:{group:"imported_from_"+t}}).catch(n=>{this.$alertify.delay(4e3).error(n)}),_=this.getFilename(s);if(l!==_)for(let n of e.$files){if(!Object.prototype.hasOwnProperty.call(n,"source_medias")||!n.source_medias.some(r=>r.meta_filename_in_project&&r.meta_filename_in_project===_))continue;const p=n.source_medias.map(r=>(r.meta_filename_in_project===_&&(r.meta_filename_in_project=l),r));await this.$api.updateMeta({path:n.$path,new_meta:{source_medias:p}})}}this.$alertify.closeLogOnClick(!0).delay(4e3).success("linked media copied")}let i={};i.projectpanes=JSON.stringify([{type:"publish",size:100,folder:this.getFilename(e.$path)}]);const a={path:this.createURLFromPath(this.destination_project_path),query:i};this.remove_original?(this.is_copying=!1,await this.$api.deleteItem({path:this.path}),this.$emit("close")):(this.is_copying=!1,this.navigation_to_copy=this.$router.resolve(a).href)}}};var h=function(){var t=this,e=t._self._c;return e("div",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){t.show_modal=!0}}},[e("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("duplicate_or_move"))+" ")],1),t.show_modal?e("BaseModal2",{attrs:{title:t.$t("duplicate_or_move")},on:{close:function(i){t.show_modal=!1}}},[t.navigation_to_copy?[e("a",{staticClass:"u-button u-button_bleumarine",attrs:{href:t.navigation_to_copy}},[t._v(" "+t._s(t.$t("open_copy"))+" ")])]:[e("div",{staticClass:"u-spacingBottom"},[e("div",{staticClass:"u-instructions"},[e("small",[t._v(" "+t._s(t.$t("dmp_instr"))+" ")])]),e("br"),e("SpaceProjectPicker",{staticClass:"u-spacingBottom",attrs:{path:t.path},on:{newProjectSelected:function(i){t.destination_project_path=i}}}),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title_of_copy")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_title,maxlength:40,required:!0},on:{"update:content":function(i){t.new_title=i}}})],1),e("div",{},[e("ToggleInput",{attrs:{content:t.remove_original,label:t.$t("remove_original"),options:{true:t.$t("remove_original_after_copy"),false:t.$t("keep_original_after_copy")}},on:{"update:content":function(i){t.remove_original=i}}})],1)],1),e("template",{slot:"footer"},[t.is_copying?e("LoaderSpinner"):[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(i){t.show_modal=!1}}},[e("b-icon",{attrs:{icon:"x-circle"}}),t._v(" "+t._s(t.$t("cancel"))+" ")],1),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button",autofocus:"",disabled:!t.destination_project_path},on:{click:t.confirm}},[t.remove_original?[t._v(" "+t._s(t.$t("move"))+" ")]:[t._v(" "+t._s(t.$t("duplicate"))+" ")]],2)]],2)]],2):t._e()],1)},m=[],f=c(d,h,m,!1,null,"dacd200e");const b=f.exports,v={props:{file:Object},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var g=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"u-metaField"},[e("DLabel",{attrs:{str:t.$t("filename")}}),e("div",{staticClass:"u-filename"},[t._v(t._s(t.file.$media_filename))])],1),t.file.$infos.hasOwnProperty("size")?e("SizeDisplay",{attrs:{size:t.file.$infos.size}}):t._e(),t.file.$infos.hasOwnProperty("width")||t.file.$infos.hasOwnProperty("height")?e("ResolutionDisplay",{attrs:{width:t.file.$infos.width,height:t.file.$infos.height}}):t._e(),t.file.$infos.hasOwnProperty("duration")?e("DurationDisplay",{attrs:{title:t.$t("duration"),duration:t.file.$infos.duration}}):t._e()],1)},$=[],y=c(v,g,$,!1,null,"6acd4e9c");const w=y.exports,x={props:{publication_path:String,instructions:Object},components:{ShowExportedFileInfos:w},data(){return{is_exporting:!1,created_doc:void 0,task_progress:0}},created(){},async mounted(){await this.startExport()},beforeDestroy(){},watch:{},computed:{export_href(){return this.created_doc?this.makeMediaFileURL({$path:this.created_doc.$path,$media_filename:this.created_doc.$media_filename}):!1}},methods:{async startExport(){const o=await this.$api.exportFolder({path:this.publication_path,instructions:this.instructions});this.$api.join({room:"task_"+o}),this.$alertify.delay(4e3).log(this.$t("compilation_started")),this.is_exporting=!0;const t=({task_id:i,progress:a})=>{i===o&&(this.task_progress=a)};this.$eventHub.$on("task.status",t);const e=({task_id:i,message:a})=>{i===o&&(this.$eventHub.$off("task.ended",e),this.$api.leave({room:"task_"+o}),a.event==="completed"?this.created_doc=a.file:a.event==="aborted"||a.event==="failed"&&a.info,this.is_exporting=!1)};this.$eventHub.$on("task.ended",e)},async saveToProject(){this.$eventHub.$emit("pane.animate","collect"),this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("media_was_saved_to_project")),this.$emit("close")},removeAndCloseModal(){this.created_doc&&this.$api.deleteItem({path:this.created_doc.$path}),this.$emit("close")}}};var k=function(){var t=this,e=t._self._c;return e("BaseModal2",{on:{close:t.removeAndCloseModal}},[t.is_exporting?[e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.$t("export_in_progress"))+" ")]),e("div",[e("div"),e("div",[e("AnimatedCounter",{attrs:{value:t.task_progress}})],1)])]:[t.created_doc?[t.instructions.recipe==="webpage"?e("div",{staticClass:"u-instructions",domProps:{innerHTML:t._s(t.$t("webpage_export_instructions"))}}):e("MediaContent",{staticClass:"_preview",attrs:{file:t.created_doc,resolution:1600,context:"full"}}),e("div",{staticClass:"u-spacingBottom"}),e("ShowExportedFileInfos",{attrs:{file:t.created_doc}}),e("a",{staticClass:"u-buttonLink",attrs:{disabled:!t.export_href,download:t.created_doc.$media_filename,href:t.export_href,target:"_blank"}},[t._v(" "+t._s(t.$t("download"))+" ")])]:t._e(),e("template",{slot:"footer"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:t.removeAndCloseModal}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),e("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:t.saveToProject}},[e("span",{staticClass:"u-icon",domProps:{innerHTML:t._s(t.dodoc_icon_collect)}}),t._v(" "+t._s(t.$t("save_to_project"))+" ")])])]],2)},C=[],P=c(x,k,C,!1,null,"33c3a635");const j=P.exports,M={props:{modal_title:String,publication:Object,pane_infos:String},components:{ExportItemAndSaveOrDownload:j},data(){return{task_instructions:!1,page_to_export_as_image:1,page_width:this.publication.page_width||210,page_height:this.publication.page_height||297,export_mode:"pdf",export_options:[{key:"pdf",label:this.$t("pdf")},{key:"png",label:this.$t("image")},{key:"webpage",label:this.$t("webpage")}]}},created(){if(this.publication_ratio=this.page_height/this.page_width,this.pane_infos&&this.pane.page_id&&this.publication.pages){const o=this.publication.pages.findIndex(t=>t.id===this.pane.page_id);o&&(this.page_to_export_as_image=o+1)}},mounted(){},beforeDestroy(){},watch:{},computed:{page_count(){return this.publication.pages.length},export_mode_icon(){if(this.export_mode==="pdf")return"file-pdf";if(this.export_mode==="png")return"file-earmark-image";if(this.export_mode==="webpage")return"window"},custom_resolution_unit(){return this.publication.layout_mode==="print"||this.publication.template==="edition"?"mm":"px"}},methods:{async exportPublication(o){var i;const t={};t.$origin="publish",t.$credits=this.$t("created_by_publication",{publication_title:this.publication.title}),(i=this.connected_as)!=null&&i.$path&&(t.$authors=[this.connected_as.$path]);let e={recipe:o,page_width:this.page_width,page_height:this.page_height,layout_mode:this.publication.layout_mode||"print",suggested_file_name:this.publication.title,additional_meta:t};o==="webpage"&&(e.layout_mode="screen"),this.publication.template==="page_by_page"&&this.export_mode==="png"&&(e.page=this.page_to_export_as_image),this.publication.page_spreads===!0&&(e.page_width*=2),this.task_instructions=e}}};var H=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.modal_title},on:{close:function(i){return t.$emit("close")}}},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("document_type")}}),e("RadioCheckboxInput",{attrs:{value:t.export_mode,options:t.export_options,can_edit:!0},on:{"update:value":function(i){t.export_mode=i}}})],1),t.export_mode==="pdf"?void 0:t._e(),t.export_mode==="png"?[t.publication.template==="page_by_page"?[e("div",{staticClass:"u-spacingBottom"}),e("div",{},[e("DLabel",{attrs:{str:t.$t("page_to_export")}}),e("select",{directives:[{name:"model",rawName:"v-model",value:t.page_to_export_as_image,expression:"page_to_export_as_image"}],on:{change:function(i){var a=Array.prototype.filter.call(i.target.options,function(s){return s.selected}).map(function(s){var l="_value"in s?s._value:s.value;return l});t.page_to_export_as_image=i.target.multiple?a:a[0]}}},t._l(new Array(t.page_count),function(i,a){return e("option",{key:a+1,domProps:{textContent:t._s(a+1)}})}),0)],1)]:t._e()]:t._e(),e("template",{slot:"footer"},[e("div"),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(i){return t.exportPublication(t.export_mode)}}},[e("b-icon",{attrs:{icon:t.export_mode_icon}}),t._v(" "+t._s(t.$t("create"))+" ")],1)]),t.task_instructions?e("ExportItemAndSaveOrDownload",{attrs:{publication_path:t.publication.$path,instructions:t.task_instructions},on:{close:function(i){t.task_instructions=!1}}}):t._e()],2)},S=[],D=c(M,H,S,!1,null,"fe5c81b1");const F=D.exports,O={props:{publication:Object,pane_infos:Object,no_back_button:Boolean,can_edit:Boolean},components:{DuplicatePublication:b,ExportPubliModal:F},data(){return{show_export_pdf_modal:!1,show_qr_code_modal:!1,is_exporting:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{share_url(){let o={};this.publication.template==="page_by_page"?o={display:"slides"}:this.publication.template==="story_with_sections"?o={display:"section"}:this.publication.template==="cartography"&&(o={display:"section"});const t=this.$router.resolve({path:this.createURLFromPath(this.publication.$path),query:o});return window.location.origin+t.href}},methods:{async removePublication(){this.fetch_status="pending",this.fetch_error=null;try{const o=await this.$api.deleteItem({path:this.publication.$path});this.response=o.data,this.fetch_status="success"}catch(o){this.fetch_status="error",this.fetch_error=o.response.data}},async setCorrectPermForAdmins(){await this.$api.updateMeta({path:this.publication.$path,new_meta:{$admins:"parent_contributors"}})},openSettings(){this.$eventHub.$emit("publication.settings.toggle")},closeSettings(){this.$eventHub.$emit("publication.settings.close")}}};var Z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_topbar"},[t.no_back_button!==!0?e("button",{staticClass:"u-button u-button_icon _backPubli",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"arrow-left-circle","aria-label":t.$t("back_to_publications")}})],1):t._e(),e("div",{staticClass:"_publiTitle"},[e("TitleField",{attrs:{label:t.$t("title"),show_label:!1,field_name:"title",tag:"h3",maxlength:40,required:!0,content:t.publication.title,path:t.publication.$path,can_edit:t.can_edit}})],1),e("div",{staticClass:"_buttonRow"},[t.can_edit&&t.publication.$admins!=="parent_contributors"?e("div",{},[e("small",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.setCorrectPermForAdmins}},[t._v(" set perm to parent ")]),t._v(" "+t._s(t.publication.$admins)+" ")])]):t._e(),t.can_edit?e("StatusTag",{attrs:{status:t.publication.$status||"public",status_options:["public","private"],path:t.publication.$path,can_edit:t.can_edit}}):t._e(),t.can_edit&&!["cartography"].includes(t.publication.template)?e("button",{staticClass:"u-button u-button_transparent",attrs:{type:"button",caret:""},on:{click:t.openSettings}},[e("b-icon",{attrs:{slot:"prefix",icon:"gear","aria-label":t.$t("settings")},slot:"prefix"}),t._v(" "+t._s(t.$t("settings"))+" ")],1):t._e(),t.can_edit?e("DropDown",{on:{show:t.closeSettings}},[e("DuplicatePublication",{attrs:{path:t.publication.$path,source_title:t.publication.title,publication:t.publication},on:{close:function(i){return t.$emit("close")}}}),e("RemoveMenu",{attrs:{modal_title:t.$t("remove_publication",{name:t.publication.title})},on:{remove:t.removePublication}})],1):t._e(),e("DropDown",{attrs:{right:!0},on:{show:t.closeSettings}},[e("template",{slot:"trigger"},[e("b-icon",{attrs:{icon:"box-arrow-up-right"}}),t._v(" "+t._s(t.$t("share"))+" ")],1),t.can_edit?e("div",[e("button",{staticClass:"u-buttonLink _exportBtn",attrs:{type:"button"},on:{click:function(i){t.show_export_pdf_modal=!0}}},[e("b-icon",{attrs:{icon:"save2-fill"}}),t._v(" "+t._s(t.$t("export"))+" ")],1)]):t._e(),t.show_export_pdf_modal?e("ExportPubliModal",{attrs:{modal_title:t.$t("export_publi",{name:t.publication.title}),publication:t.publication,pane_infos:t.pane_infos},on:{close:function(i){t.show_export_pdf_modal=!1}}}):t._e(),e("div",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){t.show_qr_code_modal=!0}}},[e("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[e("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[e("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),e("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),e("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),e("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),e("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])]),t._v(" "+t._s(t.$t("direct_link"))+" ")])]),t.show_qr_code_modal?e("QRModal",{attrs:{url_to_access:t.share_url},on:{close:function(i){t.show_qr_code_modal=!1}}},[e("ToggleField",{attrs:{label:t.$t("make_publication_public"),field_name:"$public",content:t.publication.$public===!0,path:t.publication.$path,can_edit:t.can_edit}})],1):t._e()],2)],1)])},L=[],V=c(O,Z,L,!1,null,"a20b0f93");const I=V.exports;export{I as P,w as S};
