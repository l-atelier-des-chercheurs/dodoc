import b from"./SharedFolder2-CCgdT9ew.js";import{n as d,S as P,_ as m}from"../build.js";import"./KeywordsField-AsQHz9NZ.js";import"./FileShown-nkTc91-2.js";var x=Object.defineProperty,y=Object.defineProperties,C=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,w=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,f=(t,e,i)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,M=(t,e)=>{for(var i in e||(e={}))w.call(e,i)&&f(t,i,e[i]);if(u)for(var i of u(e))z.call(e,i)&&f(t,i,e[i]);return t},k=(t,e)=>y(t,C(e)),E=(t,e)=>{var i={};for(var s in t)w.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(t!=null&&u)for(var s of u(t))e.indexOf(s)<0&&z.call(t,s)&&(i[s]=t[s]);return i};function S(t,e,i,s,n,a,o,l){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=i,r._compiled=!0);var c;if(n&&(c=n),c)if(r.functional){r._injectStyles=c;var p=r.render;r.render=function($,_){return c.call(_),p($,_)}}else{var h=r.beforeCreate;r.beforeCreate=h?[].concat(h,c):[c]}return{exports:t,options:r}}const R={name:"splitpanes",props:{horizontal:{type:Boolean},pushOtherPanes:{type:Boolean,default:!0},dblClickSplitter:{type:Boolean,default:!0},rtl:{type:Boolean,default:!1},firstSplitter:{type:Boolean}},provide(){return{requestUpdate:this.requestUpdate,onPaneAdd:this.onPaneAdd,onPaneRemove:this.onPaneRemove,onPaneClick:this.onPaneClick}},data:()=>({container:null,ready:!1,panes:[],touch:{mouseDown:!1,dragging:!1,activeSplitter:null},splitterTaps:{splitter:null,timeoutId:null}}),computed:{panesCount(){return this.panes.length},indexedPanes(){return this.panes.reduce((t,e)=>(t[e.id]=e)&&t,{})}},methods:{updatePaneComponents(){this.panes.forEach(t=>{t.update&&t.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[t.id].size}%`})})},bindEvents(){document.addEventListener("mousemove",this.onMouseMove,{passive:!1}),document.addEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.addEventListener("touchmove",this.onMouseMove,{passive:!1}),document.addEventListener("touchend",this.onMouseUp))},unbindEvents(){document.removeEventListener("mousemove",this.onMouseMove,{passive:!1}),document.removeEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.removeEventListener("touchmove",this.onMouseMove,{passive:!1}),document.removeEventListener("touchend",this.onMouseUp))},onMouseDown(t,e){this.bindEvents(),this.touch.mouseDown=!0,this.touch.activeSplitter=e},onMouseMove(t){this.touch.mouseDown&&(t.preventDefault(),this.touch.dragging=!0,this.calculatePanesSize(this.getCurrentMouseDrag(t)),this.$emit("resize",this.panes.map(e=>({min:e.min,max:e.max,size:e.size}))))},onMouseUp(){this.touch.dragging&&this.$emit("resized",this.panes.map(t=>({min:t.min,max:t.max,size:t.size}))),this.touch.mouseDown=!1,setTimeout(()=>{this.touch.dragging=!1,this.unbindEvents()},100)},onSplitterClick(t,e){"ontouchstart"in window&&(t.preventDefault(),this.dblClickSplitter&&(this.splitterTaps.splitter===e?(clearTimeout(this.splitterTaps.timeoutId),this.splitterTaps.timeoutId=null,this.onSplitterDblClick(t,e),this.splitterTaps.splitter=null):(this.splitterTaps.splitter=e,this.splitterTaps.timeoutId=setTimeout(()=>{this.splitterTaps.splitter=null},500)))),this.touch.dragging||this.$emit("splitter-click",this.panes[e])},onSplitterDblClick(t,e){let i=0;this.panes=this.panes.map((s,n)=>(s.size=n===e?s.max:s.min,n!==e&&(i+=s.min),s)),this.panes[e].size-=i,this.$emit("pane-maximize",this.panes[e])},onPaneClick(t,e){this.$emit("pane-click",this.indexedPanes[e])},getCurrentMouseDrag(t){const e=this.container.getBoundingClientRect(),{clientX:i,clientY:s}="ontouchstart"in window&&t.touches?t.touches[0]:t;return{x:i-e.left,y:s-e.top}},getCurrentDragPercentage(t){t=t[this.horizontal?"y":"x"];const e=this.container[this.horizontal?"clientHeight":"clientWidth"];return this.rtl&&!this.horizontal&&(t=e-t),t*100/e},calculatePanesSize(t){const e=this.touch.activeSplitter;let i={prevPanesSize:this.sumPrevPanesSize(e),nextPanesSize:this.sumNextPanesSize(e),prevReachedMinPanes:0,nextReachedMinPanes:0};const s=0+(this.pushOtherPanes?0:i.prevPanesSize),n=100-(this.pushOtherPanes?0:i.nextPanesSize),a=Math.max(Math.min(this.getCurrentDragPercentage(t),n),s);let o=[e,e+1],l=this.panes[o[0]]||null,r=this.panes[o[1]]||null;const c=l.max<100&&a>=l.max+i.prevPanesSize,p=r.max<100&&a<=100-(r.max+this.sumNextPanesSize(e+1));if(c||p){c?(l.size=l.max,r.size=Math.max(100-l.max-i.prevPanesSize-i.nextPanesSize,0)):(l.size=Math.max(100-r.max-i.prevPanesSize-this.sumNextPanesSize(e+1),0),r.size=r.max);return}if(this.pushOtherPanes){const h=this.doPushOtherPanes(i,a);if(!h)return;({sums:i,panesToResize:o}=h),l=this.panes[o[0]]||null,r=this.panes[o[1]]||null}l!==null&&(l.size=Math.min(Math.max(a-i.prevPanesSize-i.prevReachedMinPanes,l.min),l.max)),r!==null&&(r.size=Math.min(Math.max(100-a-i.nextPanesSize-i.nextReachedMinPanes,r.min),r.max))},doPushOtherPanes(t,e){const i=this.touch.activeSplitter,s=[i,i+1];return e<t.prevPanesSize+this.panes[s[0]].min&&(s[0]=this.findPrevExpandedPane(i).index,t.prevReachedMinPanes=0,s[0]<i&&this.panes.forEach((n,a)=>{a>s[0]&&a<=i&&(n.size=n.min,t.prevReachedMinPanes+=n.min)}),t.prevPanesSize=this.sumPrevPanesSize(s[0]),s[0]===void 0)?(t.prevReachedMinPanes=0,this.panes[0].size=this.panes[0].min,this.panes.forEach((n,a)=>{a>0&&a<=i&&(n.size=n.min,t.prevReachedMinPanes+=n.min)}),this.panes[s[1]].size=100-t.prevReachedMinPanes-this.panes[0].min-t.prevPanesSize-t.nextPanesSize,null):e>100-t.nextPanesSize-this.panes[s[1]].min&&(s[1]=this.findNextExpandedPane(i).index,t.nextReachedMinPanes=0,s[1]>i+1&&this.panes.forEach((n,a)=>{a>i&&a<s[1]&&(n.size=n.min,t.nextReachedMinPanes+=n.min)}),t.nextPanesSize=this.sumNextPanesSize(s[1]-1),s[1]===void 0)?(t.nextReachedMinPanes=0,this.panes[this.panesCount-1].size=this.panes[this.panesCount-1].min,this.panes.forEach((n,a)=>{a<this.panesCount-1&&a>=i+1&&(n.size=n.min,t.nextReachedMinPanes+=n.min)}),this.panes[s[0]].size=100-t.prevPanesSize-t.nextReachedMinPanes-this.panes[this.panesCount-1].min-t.nextPanesSize,null):{sums:t,panesToResize:s}},sumPrevPanesSize(t){return this.panes.reduce((e,i,s)=>e+(s<t?i.size:0),0)},sumNextPanesSize(t){return this.panes.reduce((e,i,s)=>e+(s>t+1?i.size:0),0)},findPrevExpandedPane(t){return[...this.panes].reverse().find(i=>i.index<t&&i.size>i.min)||{}},findNextExpandedPane(t){return this.panes.find(i=>i.index>t+1&&i.size>i.min)||{}},checkSplitpanesNodes(){Array.from(this.container.children).forEach(e=>{const i=e.classList.contains("splitpanes__pane"),s=e.classList.contains("splitpanes__splitter");if(!i&&!s){e.parentNode.removeChild(e),console.warn("Splitpanes: Only <pane> elements are allowed at the root of <splitpanes>. One of your DOM nodes was removed.");return}})},addSplitter(t,e,i=!1){const s=t-1,n=document.createElement("div");n.classList.add("splitpanes__splitter"),i||(n.onmousedown=a=>this.onMouseDown(a,s),typeof window<"u"&&"ontouchstart"in window&&(n.ontouchstart=a=>this.onMouseDown(a,s)),n.onclick=a=>this.onSplitterClick(a,s+1)),this.dblClickSplitter&&(n.ondblclick=a=>this.onSplitterDblClick(a,s+1)),e.parentNode.insertBefore(n,e)},removeSplitter(t){t.onmousedown=void 0,t.onclick=void 0,t.ondblclick=void 0,t.parentNode.removeChild(t)},redoSplitters(){const t=Array.from(this.container.children);t.forEach(i=>{i.className.includes("splitpanes__splitter")&&this.removeSplitter(i)});let e=0;t.forEach(i=>{i.className.includes("splitpanes__pane")&&(!e&&this.firstSplitter?this.addSplitter(e,i,!0):e&&this.addSplitter(e,i),e++)})},requestUpdate(t){var e=t,{target:i}=e,s=E(e,["target"]);const n=this.indexedPanes[i._uid];Object.entries(s).forEach(([a,o])=>n[a]=o)},onPaneAdd(t){let e=-1;Array.from(t.$el.parentNode.children).some(n=>(n.className.includes("splitpanes__pane")&&e++,n===t.$el));const i=parseFloat(t.minSize),s=parseFloat(t.maxSize);this.panes.splice(e,0,{id:t._uid,index:e,min:isNaN(i)?0:i,max:isNaN(s)?100:s,size:t.size===null?null:parseFloat(t.size),givenSize:t.size,update:t.update}),this.panes.forEach((n,a)=>n.index=a),this.ready&&this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({addedPane:this.panes[e]}),this.$emit("pane-add",{index:e,panes:this.panes.map(n=>({min:n.min,max:n.max,size:n.size}))})})},onPaneRemove(t){const e=this.panes.findIndex(s=>s.id===t._uid),i=this.panes.splice(e,1)[0];this.panes.forEach((s,n)=>s.index=n),this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({removedPane:k(M({},i),{index:e})}),this.$emit("pane-remove",{removed:i,panes:this.panes.map(s=>({min:s.min,max:s.max,size:s.size}))})})},resetPaneSizes(t={}){!t.addedPane&&!t.removedPane?this.initialPanesSizing():this.panes.some(e=>e.givenSize!==null||e.min||e.max<100)?this.equalizeAfterAddOrRemove(t):this.equalize(),this.ready&&this.$emit("resized",this.panes.map(e=>({min:e.min,max:e.max,size:e.size})))},equalize(){const t=100/this.panesCount;let e=0,i=[],s=[];this.panes.forEach(n=>{n.size=Math.max(Math.min(t,n.max),n.min),e-=n.size,n.size>=n.max&&i.push(n.id),n.size<=n.min&&s.push(n.id)}),e>.1&&this.readjustSizes(e,i,s)},initialPanesSizing(){100/this.panesCount;let t=100,e=[],i=[],s=0;this.panes.forEach(a=>{t-=a.size,a.size!==null&&s++,a.size>=a.max&&e.push(a.id),a.size<=a.min&&i.push(a.id)});let n=100;t>.1&&(this.panes.forEach(a=>{a.size===null&&(a.size=Math.max(Math.min(t/(this.panesCount-s),a.max),a.min)),n-=a.size}),n>.1&&this.readjustSizes(t,e,i))},equalizeAfterAddOrRemove({addedPane:t,removedPane:e}={}){let i=100/this.panesCount,s=0,n=[],a=[];t&&t.givenSize!==null&&(i=(100-t.givenSize)/(this.panesCount-1)),this.panes.forEach(o=>{s-=o.size,o.size>=o.max&&n.push(o.id),o.size<=o.min&&a.push(o.id)}),!(Math.abs(s)<.1)&&(this.panes.forEach(o=>{t&&t.givenSize!==null&&t.id===o.id||(o.size=Math.max(Math.min(i,o.max),o.min)),s-=o.size,o.size>=o.max&&n.push(o.id),o.size<=o.min&&a.push(o.id)}),s>.1&&this.readjustSizes(s,n,a))},readjustSizes(t,e,i){let s;t>0?s=t/(this.panesCount-e.length):s=t/(this.panesCount-i.length),this.panes.forEach((n,a)=>{if(t>0&&!e.includes(n.id)){const o=Math.max(Math.min(n.size+s,n.max),n.min),l=o-n.size;t-=l,n.size=o}else if(!i.includes(n.id)){const o=Math.max(Math.min(n.size+s,n.max),n.min),l=o-n.size;t-=l,n.size=o}n.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[n.id].size}%`})}),Math.abs(t)>.1&&this.$nextTick(()=>{this.ready&&console.warn("Splitpanes: Could not resize panes correctly due to their constraints.")})}},watch:{panes:{deep:!0,immediate:!1,handler(){this.updatePaneComponents()}},horizontal(){this.updatePaneComponents()},firstSplitter(){this.redoSplitters()},dblClickSplitter(t){[...this.container.querySelectorAll(".splitpanes__splitter")].forEach((i,s)=>{i.ondblclick=t?n=>this.onSplitterDblClick(n,s):void 0})}},beforeDestroy(){this.ready=!1},mounted(){this.container=this.$refs.container,this.checkSplitpanesNodes(),this.redoSplitters(),this.resetPaneSizes(),this.$emit("ready"),this.ready=!0},render(t){return t("div",{ref:"container",class:["splitpanes",`splitpanes--${this.horizontal?"horizontal":"vertical"}`,{"splitpanes--dragging":this.touch.dragging}]},this.$slots.default)}};let F,N;const v={};var T=S(R,F,N,!1,O);function O(t){for(let e in v)this[e]=v[e]}var D=function(){return T.exports}(),L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"splitpanes__pane",style:t.style,on:{click:function(s){return t.onPaneClick(s,t._uid)}}},[t._t("default")],2)},q=[];const A={name:"pane",inject:["requestUpdate","onPaneAdd","onPaneRemove","onPaneClick"],props:{size:{type:[Number,String],default:null},minSize:{type:[Number,String],default:0},maxSize:{type:[Number,String],default:100}},data:()=>({style:{}}),mounted(){this.onPaneAdd(this)},beforeDestroy(){this.onPaneRemove(this)},methods:{update(t){this.style=t}},computed:{sizeNumber(){return this.size||this.size===0?parseFloat(this.size):null},minSizeNumber(){return parseFloat(this.minSize)},maxSizeNumber(){return parseFloat(this.maxSize)}},watch:{sizeNumber(t){this.requestUpdate({target:this,size:t})},minSizeNumber(t){this.requestUpdate({target:this,min:t})},maxSizeNumber(t){this.requestUpdate({target:this,max:t})}}},g={};var V=S(A,L,q,!1,I);function I(t){for(let e in g)this[e]=g[e]}var H=function(){return V.exports}();const Z={props:{modal_name:String,path:String,default_folder_status:{type:String,default:"public"}},components:{},data(){return{new_folder_title:"",new_folder_is_private:!1,new_folder_template:"story_with_sections",available_templates:[{value:"story_with_sections",label:this.$t("story_with_sections")},{value:"agora",label:this.$t("agora")}],is_creating_folder:!1,allow_save:!1,error_msg:""}},created(){},mounted(){},i18n:{messages:{fr:{agora:"Agora"},en:{agora:"Agora"}}},beforeDestroy(){},watch:{},computed:{},methods:{async createFolder(){this.is_creating_folder=!0;const t=this.setDefaultContentAdmins();this.new_folder_title=this.cleanUpString(this.new_folder_title);let e={title:this.new_folder_title,template:this.new_folder_template,requested_slug:this.new_folder_title,$status:this.new_folder_is_private===!0?"private":this.default_folder_status,$admins:t};this.new_folder_template==="agora"&&(e.autoscroll=!0);try{const i=await this.$api.createFolder({path:this.path,additional_meta:e});setTimeout(()=>{this.$emit("openNew",i)},50)}catch({code:i}){i==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):i==="token_not_allowed_must_be_contributors"?this.$alertify.delay(4e3).error(this.$t("action_not_allowed")):this.$alertify.delay(4e3).error(i),this.is_creating_folder=!1}}}};var j=function(){var e=this,i=e._self._c;return i("BaseModal2",{attrs:{title:e.modal_name},on:{close:function(s){return e.$emit("close")}}},[i("form",{staticClass:"input-validation-required",on:{submit:function(s){return s.preventDefault(),e.createFolder.apply(null,arguments)}}},[i("DLabel",{attrs:{str:e.$t("title")}}),i("TextInput",{ref:"titleInput",attrs:{content:e.new_folder_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(s){e.new_folder_title=s},toggleValidity:s=>e.allow_save=s,onEnter:e.createFolder}}),i("br"),i("div",{},[i("ToggleInput",{attrs:{content:e.new_folder_is_private,label:e.$t("private"),options:{true:e.$t("private_status_explanations"),false:e.$t("public_status_explanations")}},on:{"update:content":function(s){e.new_folder_is_private=s}}})],1),i("br"),i("div",{},[i("DLabel",{attrs:{str:e.$t("template")}}),i("select",{directives:[{name:"model",rawName:"v-model",value:e.new_folder_template,expression:"new_folder_template"}],on:{change:function(s){var n=Array.prototype.filter.call(s.target.options,function(a){return a.selected}).map(function(a){var o="_value"in a?a._value:a.value;return o});e.new_folder_template=s.target.multiple?n:n[0]}}},e._l(e.available_templates,function(s){return i("option",{key:s.value,domProps:{value:s.value}},[e._v(" "+e._s(s.label)+" ")])}),0)],1),i("br"),i("div",{staticClass:"u-sameRow",attrs:{slot:"footer"},slot:"footer"},[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){return e.$emit("close")}}},[e._v(" "+e._s(e.$t("cancel"))+" ")]),i("button",{staticClass:"u-button u-button_bleuvert",attrs:{slot:"footer",type:"submit",loading:e.is_creating_folder},slot:"footer"},[e._v(" "+e._s(e.$t("create_and_open"))+" ")])]),e.error_msg?[i("br"),i("br"),i("div",{staticClass:"u-errorMsg",domProps:{textContent:e._s(e.error_msg)}})]:e._e()],2)])},B=[],U=d(Z,j,B,!1,null,"61e6051c");const W=U.exports,Q={props:{},components:{SearchInput2:P,CreateCollection:W},data(){return{show_create_collection:!1,collections:[],path:"collections",search_coll_name:""}},i18n:{messages:{fr:{collections:"Collections",create_a_collection:"Créer une collection",search_in_titles:"Rechercher dans les titres",collection_instr:"Les collections regroupent des médias dans l’espace partagé pour les partager."},en:{collections:"Collections",create_a_collection:"Create a collection",search_in_titles:"Search in titles",collection_instr:"Collections group multiple medias"}}},async created(){this.collections=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.stack})},sorted_collections(){return this.collections.slice().filter(t=>this.canLoggedinSeeFolder({folder:t})).sort((t,e)=>t.title.localeCompare(e.title))},filtered_collections(){return this.sorted_collections.filter(t=>this.search_coll_name?this.twoStringsSearch(t.title,this.search_coll_name):!0)}},methods:{openNewCollection(t){this.show_create_collection=!1,this.$emit("open",t)}}};var J=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_collectionsList"},[i("div",{staticClass:"u-spacingBottom u-instructions"},[e._v(" "+e._s(e.$t("collection_instr"))+" ")]),i("div",{staticClass:"u-spacingBottom"},[i("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(s){e.show_create_collection=!0}}},[i("b-icon",{attrs:{icon:"plus-circle"}}),e._v("  "+e._s(e.$t("create_a_collection"))+" ")],1),e.show_create_collection?i("CreateCollection",{attrs:{modal_name:e.$t("create_a_collection"),path:"collections",default_folder_status:"private"},on:{close:function(s){e.show_create_collection=!1},openNew:e.openNewCollection}}):e._e()],1),i("div",{staticClass:"u-spacingBottom"},[i("SearchInput2",{attrs:{search_placeholder:e.$t("search_in_titles")},model:{value:e.search_coll_name,callback:function(s){e.search_coll_name=s},expression:"search_coll_name"}})],1),i("table",{staticClass:"u-spacingBottom _list"},[i("transition-group",{attrs:{tag:"tbody",name:"projectsList",appear:""}},e._l(e.filtered_collections,function(s){return i("tr",{key:s.$path,on:{click:function(n){e.$emit("open",e.getFilename(s.$path))}}},[i("td",[i("strong",[e._v(e._s(s.title))]),e._v(" – "),i("i",[e._v(e._s(e.$t(s.template||"story_with_sections").toLowerCase()))])]),i("td",[i("div",{staticClass:"u-sameRow"},e._l(s.$admins,function(n,a){return i("AuthorTag",{key:n+"_"+a,attrs:{path:n,show_image_only:!0}})}),1)])])}),0)],1)])},X=[],Y=d(Q,J,X,!1,null,"b53ae7c3");const G=Y.exports,K={props:{pane_infos:Object},components:{StorySectionTemplate:()=>m(()=>import("./StorySectionTemplate-CNfasBPl.js"),[]),AgoraTemplate:()=>m(()=>import("./AgoraTemplate-CxeqIZ1v.js"),[])},data(){return{is_loading:!0,collection:void 0,path:"collections/"+this.pane_infos.opened_collection_slug,fetch_coll_error_message:"",show_qr_code_modal:!1}},i18n:{messages:{fr:{make_public:"Accès public (sans mot de passe ou compte)"},en:{make_public:"Allow access to everyone (without password or account)"}}},async created(){const t=await this.$api.getFolder({path:this.path}).catch(e=>{e.code==="folder_private"?this.fetch_coll_error_message=this.$t("coll_is_private"):this.fetch_coll_error_message=e.code,this.is_loading=!1});this.collection=t,this.is_loading=!1,this.$api.join({room:this.path}),this.$eventHub.$on("collection.addStack",this.addToStack)},mounted(){},beforeDestroy(){this.$api.leave({room:this.path}),this.$eventHub.$off("collection.addStack",this.addToStack)},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.collection})},share_url(){let t={};this.collection.template==="story_with_sections"&&(t={display:"section"}),this.collection.template==="agora"&&this.collection.autoscroll===!0&&(t={scroll:"auto"});const e=this.$router.resolve({path:this.createURLFromPath(this.collection.$path),query:t});return window.location.origin+e.href}},methods:{addToStack(){},async removeCollection(){await this.$api.deleteItem({path:this.collection.$path}),this.$emit("close")}}};var ee=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_openedCollection"},[i("transition",{attrs:{name:"slideup",mode:"out-in"}},[e.is_loading?i("div",{key:"loader"},[i("div",{staticClass:"_spinner"},[i("LoaderSpinner")],1)]):e.fetch_coll_error_message?i("div",{key:"err",staticClass:"_error"},[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){return e.$emit("close")}}},[i("b-icon",{attrs:{icon:"arrow-left"}}),e._v(" "+e._s(e.$t("back"))+" ")],1),i("div",{},[e._v(" "+e._s(e.fetch_coll_error_message)+" ")])]):i("div",{key:e.collection.$path},[i("div",{staticClass:"_titleBar"},[i("TitleField",{attrs:{field_name:"title",content:e.collection.title,path:e.collection.$path,tag:"h1",required:!0,can_edit:e.can_edit}})],1),i("div",{staticClass:"_topbar"},[i("div",{},[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){return e.$emit("close")}}},[i("b-icon",{attrs:{icon:"arrow-left"}}),e._v(" "+e._s(e.$t("back"))+" ")],1)]),i("AuthorField",{staticClass:"_admins",attrs:{label:e.$t("admins"),instructions:e.$t("media_editing_instructions"),field:"$admins",authors_paths:e.collection.$admins,path:e.collection.$path,can_edit:e.can_edit,show_image_only:!0}}),e.can_edit?i("StatusTag",{attrs:{status:e.collection.$status||"public",status_options:["public","private"],path:e.collection.$path,can_edit:e.can_edit}}):e._e(),e.can_edit?i("DropDown",[e.can_edit?i("RemoveMenu",{attrs:{remove_text:e.$t("remove")},on:{remove:e.removeCollection}}):e._e(),i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){e.show_qr_code_modal=!0}}},[i("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[i("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[i("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),i("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),i("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),i("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),i("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])]),e._v(" "+e._s(e.$t("direct_link"))+" ")])],1):e._e(),e.show_qr_code_modal?i("QRModal",{attrs:{url_to_access:e.share_url},on:{close:function(s){e.show_qr_code_modal=!1}}},[i("ToggleField",{attrs:{label:e.$t("make_public"),field_name:"$public",content:e.collection.$public===!0,path:e.collection.$path,can_edit:e.can_edit}})],1):e._e()],1),i("div",{staticClass:"_cont"},[!e.collection.template||e.collection.template==="story_with_sections"?i("StorySectionTemplate",{attrs:{publication:e.collection,pane_infos:e.pane_infos,can_edit:e.can_edit},on:{updatePane:function(s){return e.$emit("updatePane",s)}}}):e.collection.template==="agora"?i("AgoraTemplate",{attrs:{publication:e.collection,can_edit:e.can_edit}}):e._e()],1)])])],1)},te=[],ie=d(K,ee,te,!1,null,"3ae679d4");const se=ie.exports,ne={props:{},components:{CollectionsList:G,OpenedCollection:se},data(){return{}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{pane_infos(){var e,i;let t={};return(e=this.$route.query)!=null&&e.collection&&(t.opened_collection_slug=this.$route.query.collection),(i=this.$route.query)!=null&&i.section&&(t.section=this.$route.query.section),t}},methods:{openCollection(t){this.updateCollectionQuery(t)},closeCollection(){this.updateCollectionQuery(!1)},updatePane({key:t,value:e}){this.updatePageQuery({prop:t,val:e})},async updateCollectionQuery(t){this.updatePageQuery({prop:"collection",val:t})}}};var ae=function(){var s;var e=this,i=e._self._c;return i("div",{staticClass:"_collections"},[i("CollectionsList",{on:{open:e.openCollection}}),(s=e.pane_infos)!=null&&s.opened_collection_slug?i("OpenedCollection",{attrs:{pane_infos:e.pane_infos},on:{updatePane:e.updatePane,close:e.closeCollection}}):e._e()],1)},oe=[],re=d(ne,ae,oe,!1,null,"6dbbe7c4");const le=re.exports,ce={props:{},components:{Splitpanes:D,Pane:H,SharedFolder2:b,CollectionsPane:le},data(){return{path:"folders",folders:void 0,shared_folder_path:void 0,possible_panes:[{key:"archive",label:"ARCHIVE",icon:"grid3x3-gap"},{key:"collection",label:"COLLECTION",icon:"layout-sidebar-inset-reverse"}],top_panes_width:{archive:50,collection:50},panes_width:{archive:50,collection:50},show_chutier:!0}},async created(){const t=this.loadPanesWidthFromStorage();t?this.panes_width=t:this.$root.is_mobile_view?(this.panes_width.archive=100,this.panes_width.collection=0):(this.panes_width.archive=100,this.panes_width.collection=0),await this.loadFolder()},async mounted(){},beforeDestroy(){},watch:{connected_as(){},panes_width:{handler(){Object.entries(this.panes_width).map(([t,e])=>this.top_panes_width[t]=e),this.savePanesWidthToStorage()},deep:!0}},computed:{min_toppane_width(){return 0}},methods:{async loadFolder(){await this.$api.getFolders({path:"authors"}),this.folders=await this.$api.getFolders({path:this.path}).catch(t=>{this.fetch_spaces_error=t.response}),this.folders.length===0?(await this.createFolder(),window.location.reload()):this.shared_folder_path=this.folders[0].$path},async createFolder(){try{return await this.$api.createFolder({path:this.path,additional_meta:{title:"default",$admins:"everyone"}})}catch{}},resizeTopPane(t){t.map((e,i)=>{const s=Number(e.size.toFixed(1));i===0&&(this.top_panes_width.archive=s),i===1&&(this.top_panes_width.collection=s)})},resizedPane(t){t.map((e,i)=>{const s=Number(e.size.toFixed(1));i===0&&(this.panes_width.archive=s),i===1&&(this.panes_width.collection=s)})},setTopbarWidth(t){return`
        --topPane-width: ${this.top_panes_width[t]}%;
      `},togglePane(t){this.panes_width[t]>0?Object.entries(this.panes_width).map(([e,i])=>e===t?this.panes_width[e]=0:this.panes_width[e]=100):Object.entries(this.panes_width).map(([e,i])=>this.panes_width[e]=50)},savePanesWidthToStorage(){localStorage.setItem("panes_width",JSON.stringify(this.panes_width))},loadPanesWidthFromStorage(){try{const t=localStorage.getItem("panes_width");if(t){const e=JSON.parse(t);return e.format&&delete e.format,e.chutier&&delete e.chutier,e}}catch{}return!1}}};var he=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_contributeView"},[e.shared_folder_path?[i("div",{staticClass:"_topBarIndication"},e._l(e.possible_panes,function(s){return i("div",{key:s.key,staticClass:"_topBarIndication--item",style:e.setTopbarWidth(s.key),on:{click:function(n){return e.togglePane(s.key)}}},[i("span",{staticClass:"_topBarIndication--item--names"},[i("b-icon",{attrs:{icon:s.icon}}),e._v(" "+e._s(s.label)+" ")],1)])}),0),i("splitpanes",{staticClass:"_splitpanes",attrs:{"watch-slots":""},on:{resize:e.resizeTopPane,resized:e.resizedPane}},e._l(["archive","collection"],function(s){return i("pane",{key:s,attrs:{size:e.panes_width[s]}},[s==="archive"?i("div",{staticClass:"_sharedContent"},[i("SharedFolder2",{attrs:{shared_folder_path:e.shared_folder_path}})],1):s==="collection"?i("CollectionsPane"):e._e()],1)}),1)]:i("LoaderSpinner")],2)},de=[],ue=d(ce,he,de,!1,null,"c4366270");const ge=ue.exports;export{ge as default};
