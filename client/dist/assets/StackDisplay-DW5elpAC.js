import{K as h}from"./KeywordsField-BbeEipvy.js";import{n as c}from"../build.js";const u={props:{file:Object,context:String,position:String,can_edit:Boolean},components:{},data(){return{show_infos:!0,is_dragged:!1,edit_mode:!1,is_regenerating:!1}},i18n:{messages:{fr:{},en:{}}},created(){localStorage.getItem("show_infos")?this.show_infos=localStorage.getItem("show_infos")!=="false":this.show_infos=this.can_edit||this.file.caption||this.file.$credits},mounted(){this.$eventHub.$on("fileshown.showInfos",this.showInfos),this.$eventHub.$on("fileshown.hideInfos",this.hideInfos)},beforeDestroy(){this.$eventHub.$off("fileshown.showInfos",this.showInfos),this.$eventHub.$off("fileshown.hideInfos",this.hideInfos)},watch:{show_infos(){localStorage.setItem("show_infos",this.show_infos)}},computed:{optimization_possible(){return this.fileCanBeOptimized({path:this.file.$media_filename})},optimization_strongly_recommended(){return this.fileShouldBeOptimized({path:this.file.$media_filename})}},methods:{async regenerateThumbs(){this.is_regenerating=!0,await this.$api.regenerateThumbs({path:this.file.$path}),this.is_regenerating=!1},showInfos(){this.show_infos=!0},hideInfos(){this.show_infos=!1}}};var f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_fileShown"},[e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.file?e("div",{key:t.file.$path,staticClass:"_single",attrs:{"data-type":t.file.$type}},[t.file.$type==="text"?e("div",{staticClass:"_textEditor"},[e("CollaborativeEditor2",{attrs:{path:t.file.$path,content:t.file.$content,custom_formats:["bold","italic","underline","link"],can_edit:t.can_edit,edit_on_mounted:t.context==="chutier"}})],1):e("MediaContent",{attrs:{file:t.file,context:"full",resolution:1600,show_fs_button:!0,zoom_on_click:!1}}),t.position?e("div",{staticClass:"_navArrow"},[e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:t.position==="alone"||t.position==="first"},on:{click:function(s){return t.$eventHub.$emit("carousel.prev")}}},[e("b-icon",{attrs:{icon:"arrow-left-short"}})],1),e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:t.position==="alone"||t.position==="last"},on:{click:function(s){return t.$eventHub.$emit("carousel.next")}}},[e("b-icon",{attrs:{icon:"arrow-right-short"}})],1)]):t._e(),t.file.$thumbs==="no_preview"?e("button",{staticClass:"u-buttonLink _regenerateBtn",attrs:{type:"button"},on:{click:t.regenerateThumbs}},[t.is_regenerating?e("LoaderSpinner"):[e("b-icon",{attrs:{icon:"arrow-clockwise"}}),t._v(" "+t._s(t.$t("regenerate_thumbs"))+" ")]],2):t._e(),e("div",{staticClass:"_dragEditBtn"},[e("DragFile",{attrs:{file:t.file,is_dragged:t.is_dragged},on:{"update:is_dragged":function(s){t.is_dragged=s}}})],1)],1):t._e()]),e("div",{staticClass:"_unfoldBtn"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",attrs:{type:"button"},on:{click:function(s){t.show_infos=!t.show_infos}}},[t.show_infos?e("b-icon",{attrs:{icon:"chevron-down","aria-label":t.$t("close")}}):e("b-icon",{attrs:{icon:"chevron-up","aria-label":t.$t("open")}}),t.file.caption?e("b-icon",{attrs:{icon:"text-left","aria-label":t.$t("caption")}}):t._e(),t.file.$credits?e("b-icon",{attrs:{icon:"info-circle","aria-label":t.$t("credit/reference")}}):t._e()],1)]),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("div",{key:t.file.$path,staticClass:"_infos",attrs:{"data-hide":!t.show_infos}},[e("div",{staticClass:"_infos--content"},[t.optimization_strongly_recommended?e("div",{staticClass:"u-spacingBottom _optimizeNotice"},[e("div",{},[e("OptimizeMedia",{attrs:{media:t.file},on:{close:function(s){return t.$emit("close")}}})],1)]):t._e(),t.file.$type==="url"?e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{staticClass:"_label",attrs:{str:t.$t("link")}}),e("div",[e("a",{attrs:{href:t.file.$content,target:"_blank"}},[t._v(" "+t._s(t.file.$content)+" ")])])],1):t._e(),e("div",{staticClass:"u-spacingBottom"},[e("CollaborativeEditor2",{attrs:{label:t.$t("caption"),field_to_edit:"caption",content:t.file.caption,path:t.file.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,maxlength:1280,can_edit:t.can_edit}})],1),e("div",{},[e("CollaborativeEditor2",{attrs:{label:t.$t("credit/reference"),field_to_edit:"$credits",content:t.file.$credits,path:t.file.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,maxlength:1280,can_edit:t.can_edit}})],1),t.file.$location?[e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("latitude"))+" : "+t._s(t.file.$location.latitude)+" // "+t._s(t.$t("longitude"))+" : "+t._s(t.file.$location.longitude)+" ")])]:t._e()],2)])])],1)},p=[],m=c(u,f,p,!1,null,"bd5846ba");const $=m.exports,v={props:{files:Array,can_edit:Boolean},components:{FileShown:$},data(){return{active_file_index:0,is_dragged:!1}},i18n:{messages:{fr:{},en:{}}},created(){},mounted(){this.$eventHub.$on("carousel.next",this.nextFile),this.$eventHub.$on("carousel.prev",this.prevFile)},beforeDestroy(){this.$eventHub.$off("carousel.next",this.nextFile),this.$eventHub.$off("carousel.prev",this.prevFile)},watch:{active_file_index(){this.$nextTick(()=>{this.$el.querySelector("._preview[data-iscurrent]").scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}},computed:{enable_drag(){return typeof this.$eventHub._events["mediatile.drag.end"]<"u"},current_file_shown(){return this.active_file_index!==!1?this.files[this.active_file_index]:!1},file_shown_position(){return this.files.length===1?"alone":this.active_file_index===0?"first":this.active_file_index===this.files.length-1?"last":"inbetween"}},methods:{toggleFile(i){this.active_file_index===i?this.active_file_index=!1:this.active_file_index=i},openFile(i){this.active_file_index=i},prevFile(){this.active_file_index>0&&this.active_file_index--},nextFile(){this.active_file_index<this.files.length-1&&this.active_file_index++}}};var b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackCarousel"},[!t.files||t.files.length===0?[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("nothing_to_show"))+" ")])]:t._e(),t.current_file_shown?e("FileShown",{key:t.current_file_shown.$path,staticClass:"_stackCarousel--fileshown",attrs:{file:t.current_file_shown,position:t.file_shown_position,can_edit:t.can_edit}}):t._e(),e("transition-group",{staticClass:"_list",attrs:{tag:"div",name:"listComplete"}},t._l(t.files,function(s,o){return e("div",{key:s.$path,staticClass:"_preview",attrs:{"data-iscurrent":t.current_file_shown.$path===s.$path},on:{click:function(n){return t.openFile(o)}}},[e("MediaContent",{attrs:{file:s,context:"preview",resolution:360}}),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.current_file_shown.$path===s.$path?e("div",{staticClass:"_btnRow"},[e("div",{staticClass:"_previewOverlay"}),e("select",{staticClass:"_changeOrderSelect",attrs:{size:"small"},domProps:{value:o+1},on:{change:function(n){return t.$emit("changeMediaOrder",o,+n.target.value-1)}}},t._l(new Array(t.files.length).fill(null),function(n,r){return e("option",{key:r+1,domProps:{textContent:t._s(r+1)}})}),0),e("RemoveMenu",{staticClass:"_removeBtn",attrs:{remove_text:t.$t("remove"),show_button_text:!1},on:{remove:function(n){return t.$emit("removeMediaFromStack",t.current_file_shown.$path)}}})],1):t._e()]),e("div",{staticClass:"_credits"},[s.caption?e("b-icon",{attrs:{icon:"text-left"}}):t._e(),s.$credits?e("b-icon",{attrs:{icon:"info-circle"}}):t._e()],1)],1)}),0)],2)},k=[],g=c(v,b,k,!1,null,"01d1960c");const w=g.exports,y={props:{stack_path:String,context:String,is_favorite:Boolean,can_be_added_to_fav:Boolean},components:{KeywordsField:h,StackCarousel:w},inject:{$sharedFolderPath:{default:!1}},data(){return{stack:void 0,fetch_stack_error:void 0,is_loading:!0,show_sidebar:localStorage.getItem("show_sidebar")!=="false",pane_width:void 0,ro:void 0}},i18n:{messages:{fr:{fill_title:"Veuillez remplir le champ Titre",fill_keywords:"Veuillez remplir le champ Mots-clés",files_missing:"Veuillez ajouter des médias à ce document",stack_not_public:"Ce document n'est pas public",error_loading_stack:"Erreur lors du chargement du document"},en:{fill_title:"Fill in the title field",fill_keywords:"Fill in the keywords field",files_missing:"Add medias to this document",stack_not_public:"This document is not public",error_loading_stack:"Error loading document"}}},async created(){var i;if(this.stack=await this.$api.getFolder({path:this.stack_path}).catch(t=>{this.is_loading=!1,t.code==="folder_private"?this.fetch_stack_error=this.$t("stack_not_public"):this.fetch_stack_error=this.$t("error_loading_stack")}),this.$api.join({room:this.stack.$path}),this.is_loading=!1,this.date_created_corrected=this.datetimeLocal(this.stack.date_created_corrected||this.stack.$date_created||this.stack.$date_uploaded),this.stack_files_in_order.length>0){const t=this.stack_files_in_order[0].$path;((i=this.stack.$preview)==null?void 0:i.$path)!==t&&await this.$api.updateMeta({path:this.stack.$path,new_meta:{$preview:this.getFilename(t)}})}},mounted(){this.updatePaneWidth(),this.ro=new ResizeObserver(this.updatePaneWidth),this.ro.observe(this.$el),window.addEventListener("keyup",this.handleKeyPress)},beforeDestroy(){this.ro.unobserve(this.$el),window.removeEventListener("keyup",this.handleKeyPress),this.stack&&this.$api.leave({room:this.stack.$path})},watch:{"stack.date_created_corrected"(){this.date_created_corrected=this.datetimeLocal(this.stack.date_created_corrected)},show_sidebar(){localStorage.setItem("show_sidebar",this.show_sidebar)}},computed:{can_edit(){return this.stack?this.canLoggedinEditFolder({folder:this.stack}):!1},stack_files_in_order(){return this.getStackFilesInOrder({stack:this.stack})},shared_folder_path(){return this.$sharedFolderPath?this.$sharedFolderPath():!1},share_button_is_enabled(){var i,t;return((i=this.stack.title)==null?void 0:i.length)>0&&((t=this.stack.keywords)==null?void 0:t.length)>0&&this.stack_files_in_order.length>0},dual_display(){return!!(this.show_sidebar&&this.pane_width>360*2)}},methods:{updatePaneWidth(){this.pane_width=this.$el.offsetWidth},async changeMediaOrder(i,t){var n,r;let e=this.stack_files_in_order.map(a=>this.getFilename(a.$path));function s(a,d,l){if(l>=a.length)for(var _=l-a.length+1;_--;)a.push(void 0);return a.splice(l,0,a.splice(d,1)[0]),a}s(e,i,t);let o={stack_files_metas:e};(!((n=this.stack.$preview)!=null&&n.$path)||this.getFilename((r=this.stack.$preview)==null?void 0:r.$path)!==e.at(0))&&(o.$preview=e.at(0)),await this.$api.updateMeta({path:this.stack.$path,new_meta:o})},async removeMediaFromStack(i){var e;await this.$api.copyFile({path:i,path_to_destination_folder:this.connected_as.$path,new_meta:{}}),await this.$api.deleteItem({path:i});let t=(e=this.stack)==null?void 0:e.stack_files_metas.slice();t=t.filter(s=>s!==this.getFilename(i)),await this.$api.updateMeta({path:this.stack.$path,new_meta:{stack_files_metas:t}})},async removeStack(){await this.$api.deleteItem({path:this.stack.$path}),this.$emit("close")},closeOnRemove({path:i}){i===this.stack.$path&&(this.$alertify.closeLogOnClick(!0).delay(4e3).log(this.$t("stack_was_removed")),this.$emit("close"))},async publishStack(){const i=this.shared_folder_path+"/stacks";await this.$api.copyFolder({path:this.stack.$path,path_to_destination_type:i,new_meta:{$status:"public"}}),await this.$api.deleteItem({path:this.stack.$path}),this.$emit("close")},handleKeyPress(i){if(i.key==="Escape")return this.$emit("close"),!1;i.key==="ArrowLeft"?this.$eventHub.$emit("carousel.prev"):i.key==="ArrowRight"?this.$eventHub.$emit("carousel.next"):i.key==="ArrowUp"?this.$eventHub.$emit("fileshown.showInfos"):i.key==="ArrowDown"&&this.$eventHub.$emit("fileshown.hideInfos")}}};var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackDisplay",attrs:{"data-context":t.context}},[e("div",{staticClass:"_closeStack"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",on:{click:function(s){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("div",{staticClass:"_panes"},[t.is_loading?e("LoaderSpinner"):t.fetch_stack_error?e("div",[t._v(" "+t._s(t.fetch_stack_error)+" ")]):[e("div",{staticClass:"_showSidebar"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",attrs:{type:"button"},on:{click:function(s){s.stopPropagation(),t.show_sidebar=!0}}},[e("b-icon",{attrs:{icon:"list-ul","aria-label":t.$t("show")}})],1)]),e("transition",{attrs:{name:"slideleft",mode:"out-in"}},[t.show_sidebar?e("div",{staticClass:"_infos"},[e("div",{staticClass:"_allFields"},[e("div",{staticClass:"_titleRow"},[e("TitleField",{attrs:{label:t.stack.title?"":t.$t("title"),field_name:"title",content:t.stack.title,path:t.stack.$path,required:!0,tag:"h1",can_edit:t.can_edit}}),t.can_be_added_to_fav?e("button",{staticClass:"u-button u-button_icon _addToColl",attrs:{type:"button"},on:{click:function(s){return s.stopPropagation(),t.$emit("toggleFav")}}},[t.is_favorite?e("b-icon",{attrs:{icon:"star-fill","aria-label":t.$t("remove")}}):e("b-icon",{attrs:{icon:"star","aria-label":t.$t("add")}})],1):t._e()],1),e("hr"),e("div",[e("CollaborativeEditor2",{attrs:{label:t.$t("description"),field_to_edit:"description",content:t.stack.description,path:t.stack.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,can_edit:t.can_edit}})],1),e("hr"),e("div",{},[e("KeywordsField",{attrs:{label:t.$t("keywords"),field_name:"keywords",keywords:t.stack.keywords,path:t.stack.$path,can_edit:t.can_edit}})],1),e("hr"),e("PositionPicker",{attrs:{field_name:"$location",label:t.$t("location"),content:t.stack.$location,path:t.stack.$path,can_edit:t.can_edit}}),e("hr"),e("div",{staticClass:"_dateFields"},[e("div",{},[e("DateField",{attrs:{label:t.$t("created"),field_name:"date_created_corrected",date:t.date_created_corrected,path:t.stack.$path,input_type:"datetime-local",can_edit:t.can_edit}}),t._v(" "+t._s(t.date_created_corrected)+" ")],1),e("div",{},[e("DateField",{attrs:{label:t.$t("date_modified"),field_name:"date_modified",date:t.stack.$date_modified,path:t.stack.$path,input_type:"datetime-local",can_edit:!1}})],1)]),e("hr"),e("div",{staticClass:"u-spacingBottom"},[e("AuthorField",{attrs:{label:t.$t("authors"),field:"$authors",instructions:t.$t("file_author_instructions"),authors_paths:t.stack.$authors,path:t.stack.$path,can_edit:t.can_edit,no_options:!0}})],1),e("div",{staticClass:"u-spacingBottom"},[e("AuthorField",{attrs:{label:t.$t("admins"),field:"$admins",instructions:t.$t("media_editing_instructions"),authors_paths:t.stack.$admins,path:t.stack.$path,can_edit:t.can_edit}})],1),e("hr"),t.can_edit?e("div",{staticClass:"u-sameRow"},[e("DownloadFolder",{attrs:{path:t.stack.$path}}),e("RemoveMenu",{attrs:{remove_text:t.$t("remove"),remove_expl:t.$t("remove_stack_instr")},on:{remove:t.removeStack}})],1):t._e(),t.is_instance_admin?e("div",{},[t.can_edit?e("StatusTag",{attrs:{status:t.stack.$status||"public",status_options:["public","private"],path:t.stack.$path,can_edit:t.can_edit}}):t._e()],1):t._e()],1),t.context==="chutier"?e("div",{staticClass:"_bottomBtns"},[e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("button",{key:t.share_button_is_enabled,staticClass:"u-button u-button_red _btn",attrs:{type:"button",disabled:!t.share_button_is_enabled},on:{click:t.publishStack}},[t._v(" "+t._s(t.$t("publish"))+"  "),e("b-icon",{staticStyle:{"font-size":"1rem"},attrs:{icon:"arrow-right-square",circle:""}})],1)]),e("div",{staticClass:"u-instructions"},[!t.stack.title||t.stack.title.length===0?e("div",[t._v(" "+t._s(t.$t("fill_title"))+" ")]):t._e(),!t.stack.keywords||t.stack.keywords.length===0?e("div",[t._v(" "+t._s(t.$t("fill_keywords"))+" ")]):t._e(),t.stack_files_in_order.length===0?e("div",[t._v(" "+t._s(t.$t("files_missing"))+" ")]):t._e()])],1):t._e(),e("button",{staticClass:"u-button u-button_icon u-button_transparent _hideSidebar",attrs:{type:"button"},on:{click:function(s){s.stopPropagation(),t.show_sidebar=!1}}},[e("b-icon",{attrs:{icon:"arrow-left","aria-label":t.$t("hide")}})],1)]):t._e()]),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.show_sidebar&&!t.dual_display?e("div",{staticClass:"_overlay",on:{click:function(s){t.show_sidebar=!1}}}):t._e()]),e("StackCarousel",{staticClass:"_topCarousel",attrs:{"data-dualdisplay":t.dual_display,files:t.stack_files_in_order,can_edit:t.can_edit},on:{removeMediaFromStack:t.removeMediaFromStack,changeMediaOrder:t.changeMediaOrder}})]],2)])},F=[],x=c(y,C,F,!1,null,"445316ad");const B=x.exports;export{$ as F,B as S};
