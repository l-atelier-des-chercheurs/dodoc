import{M as a}from"./ModuleCreator-BuKlxDlC.js";import{P as l}from"./PublicationModule-7JcAXgFr.js";import{n as c}from"../build.js";import"./MediaPicker-BkCMiT_E.js";import"./CaptionCreditsPage-CnMu4XJn.js";import"./FlickityCarousel-BRYWTejq.js";const d={props:{publication:Object,section:Object,can_edit:Boolean},components:{ModuleCreator:a,PublicationModule:l},data(){return{medias:[],module_being_edited:void 0}},created(){this.$eventHub.$on("module.none_edited",this.unselectModuleEdited)},async mounted(){},beforeDestroy(){this.$eventHub.$off("module.none_edited",this.unselectModuleEdited)},watch:{},computed:{section_modules_list(){return this.getModulesForSection({publication:this.publication,section:this.section}).map(({_module:i})=>i)},story_styles(){return this.makeStoryStyles({publication:this.publication})},title_is_visible(){return this.section.section_title_is_visible!==!1}},methods:{async addModules({meta_filenames:i}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.section,meta_filenames:i});const t=i.at(-1);this.toggleNewModuleEdit({meta_filename:t})},async insertModules({meta_filenames:i,index:t}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.section,index:t,meta_filenames:i});const e=i.at(-1);this.toggleNewModuleEdit({meta_filename:e})},toggleNewModuleEdit({meta_filename:i}){const t=this.publication.$path+"/"+i;setTimeout(()=>{this.$eventHub.$emit(`module.enable_edit.${i}`),this.$eventHub.$emit("publication.map.openPin",t)},150)},async toggleSectionVisibility(){await this.$api.updateMeta({path:this.section.$path,new_meta:{section_title_is_visible:!this.title_is_visible}})},async duplicateSection(){await this.duplicateSection2({publication:this.publication,og_modules:this.section_modules_list,section:this.section}),this.$emit("nextSection")},async removeSection(){this.$emit("prevSection"),this.removeSection2({publication:this.publication,group:"sections_list",section:this.section})},async moveModuleTo({path:i,new_position:t}){await this.moveModuleTo2({publication:this.publication,section:this.section,meta_filename:this.getFilename(i),new_position:t})},async duplicatePublicationMedia({source_module_path:i,copy_meta_filename:t}){const e=this.getFilename(i);await this.duplicatePublicationMedia2({publication:this.publication,section:this.section,source_meta_filename:e,copy_meta_filename:t})},unselectModuleEdited(){this.module_being_edited=void 0},async removeModule(i){await this.removeModule2({publication:this.publication,section:this.section,path:i})}}};var u=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_singleSection"},[e("div",{staticClass:"_storyContainer"},[t.section?e("div",{staticClass:"_storyContent",style:t.story_styles},[t.can_edit||t.section.section_title||t.section.section_description?e("div",{staticClass:"_topbar"},[e("div",{staticClass:"_text"},[t.can_edit||t.title_is_visible?e("div",{staticClass:"_sectionTitle",class:{"is--hidden":!t.title_is_visible}},[e("TitleField",{attrs:{field_name:"section_title",content:t.section.section_title||t.$t("untitled"),path:t.section.$path,required:!0,maxlength:60,tag:"h1",can_edit:t.can_edit}}),t.can_edit?e("EditBtn",{attrs:{btn_type:t.title_is_visible?"show":"hide",label:t.$t("show_title")},on:{click:t.toggleSectionVisibility}}):t._e()],1):t._e(),t.section.section_description?e("div",[e("div",{domProps:{textContent:t._s(t.section.section_description)}})]):t._e()]),t.can_edit?e("div",{staticClass:"_buttons"},[t.can_edit?e("DropDown",{attrs:{show_label:!1,right:!0}},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.duplicateSection}},[e("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("duplicate"))+" ")],1),e("RemoveMenu",{attrs:{modal_title:t.$t("remove_section")},on:{remove:t.removeSection}})],1):t._e()],1):t._e()]):t._e(),e("transition-group",{staticClass:"_storyModules",attrs:{tag:"div",name:"StoryModules",appear:"",duration:700}},[t._l(t.section_modules_list,function(s,n){return[e("div",{key:"mc_"+n,staticClass:"_spacer"},[t.can_edit?e("ModuleCreator",{attrs:{publication_path:t.publication.$path,types_available:["capture","import","write","embed","table"]},on:{addModules:({meta_filenames:o})=>t.insertModules({meta_filenames:o,index:n})}}):t._e()],1),e("PublicationModule",{key:s.$path,staticClass:"_mediaPublication",attrs:{publimodule:s,module_being_edited:t.module_being_edited,module_position:t.section_modules_list.length===1?"alone":n===0?"first":n===t.section_modules_list.length-1?"last":"inbetween",can_edit:t.can_edit},on:{"update:module_being_edited":function(o){t.module_being_edited=o},moveUp:function(o){return t.moveModuleTo({path:s.$path,new_position:n-1})},moveDown:function(o){return t.moveModuleTo({path:s.$path,new_position:n+1})},duplicate:function(o){return t.duplicatePublicationMedia({source_module_path:s.$path,copy_meta_filename:o})},changeSectionForModule:function(o){return t.$emit("changeSectionForModule",s.$path)},remove:function(o){return t.removeModule(s.$path)}}})]})],2),t.can_edit?e("ModuleCreator",{staticClass:"_lastModule",attrs:{start_collapsed:!1,publication_path:t.publication.$path,types_available:["capture","import","write","embed","table"]},on:{addModules:t.addModules}}):t._e()],1):t._e()])])},_=[],r=c(d,u,_,!1,null,"854d7a2f");const g=r.exports;export{g as default};
