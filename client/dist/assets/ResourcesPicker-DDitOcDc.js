import{n as a,f as n}from"../build.js";const c={mixins:[n],props:{project_path:{type:String,required:!0},select_mode:{type:String,default:"single"},pick_from_types:{type:[String,Array],default:()=>["image","video","audio"]}},components:{},data(){return{resources:{images:[],videos:[],sons:[]},is_loading:!1,error:null,downloading:[],base_url:"https://latelier-des-chercheurs.fr/content/bibli-libre/"}},created(){this.loadResources()},mounted(){},beforeDestroy(){},watch:{},computed:{normalizedPickFromTypes(){return typeof this.pick_from_types=="string"?[this.pick_from_types]:Array.isArray(this.pick_from_types)?this.pick_from_types:["image","video","audio"]}},methods:{async loadResources(){this.is_loading=!0,this.error=null;try{const t=await fetch("https://latelier-des-chercheurs.fr/bibli-libre");if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.json();this.resources=this.transformApiData(s)}catch(t){console.error("Error loading resources:",t),this.error=this.$t("failed_to_load_resources")}finally{this.is_loading=!1}},transformApiData(t){const s={images:[],videos:[],sons:[]};return t.medias&&Array.isArray(t.medias)&&t.medias.forEach(e=>{const r={src:e.src,filename:e.filename,size:e.size,mime:e.mime,modified:e.modified,credits:e.filename};switch(e.$type){case"image":this.normalizedPickFromTypes.includes("image")&&s.images.push(r);break;case"video":this.normalizedPickFromTypes.includes("video")&&s.videos.push(r);break;case"audio":this.normalizedPickFromTypes.includes("audio")&&s.sons.push(r);break}}),s},getFullUrl(t){return t},handleImageError(t){t.target.style.display="none"},async downloadResource(t,s){if(!this.downloading.includes(t)){this.downloading.push(t);try{const e=this.getFullUrl(t),r=this.getFilenameForResource(t),i={url:e,$credits:this.getCreditsForResource(t),$origin:"resources_picker",$authors:[this.connected_as.$path],requested_slug:r},{uploaded_meta:o}=await this.$api.uploadFile({path:this.project_path,additional_meta:i});o&&(this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("resource_imported_successfully")),setTimeout(()=>{this.$emit("pickResources",[o])},200))}catch(e){console.error("Error downloading resource:",e),this.$alertify.delay(4e3).error(this.$t("failed_to_import_resource"))}finally{const e=this.downloading.indexOf(t);e>-1&&this.downloading.splice(e,1)}}},getFilenameForResource(t){const e=[...this.resources.images||[],...this.resources.videos||[],...this.resources.sons||[]].find(r=>r.src===t);return(e==null?void 0:e.filename)||this.extractFilenameFromUrl(t)},extractFilenameFromUrl(t){try{return new URL(t).pathname.split("/").pop()||"downloaded-resource"}catch{return"downloaded-resource"}},getCreditsForResource(t){const e=[...this.resources.images||[],...this.resources.videos||[],...this.resources.sons||[]].find(r=>r.src===t);return(e==null?void 0:e.credits)||t}}};var l=function(){var s=this,e=s._self._c;return e("BaseModal2",{attrs:{title:s.$t("free_resources"),size:"large"},on:{close:function(r){return s.$emit("close")}}},[s.is_loading?e("div",{staticClass:"_loading"},[e("LoaderSpinner"),e("p",[s._v(s._s(s.$t("loading_resources")))])],1):s.error?e("div",{staticClass:"_error"},[e("p",[s._v(s._s(s.error))]),e("button",{staticClass:"u-button",on:{click:s.loadResources}},[s._v(" "+s._s(s.$t("retry"))+" ")])]):e("div",{staticClass:"_resourcesGrid"},[s.normalizedPickFromTypes.includes("image")&&s.resources.images&&s.resources.images.length>0?e("div",{staticClass:"_section"},[e("h3",[s._v(s._s(s.$t("images")))]),e("div",{staticClass:"_grid"},s._l(s.resources.images,function(r,i){return e("div",{key:`img-${i}`,staticClass:"_resourceCard"},[e("div",{staticClass:"_preview"},[e("img",{attrs:{src:s.getFullUrl(r.src),alt:r.credits||"Image"},on:{error:s.handleImageError}})]),e("div",{staticClass:"_info"},[r.credits?e("p",{staticClass:"_credits"},[s._v(s._s(r.credits))]):s._e(),e("button",{staticClass:"u-button u-button_small",attrs:{disabled:s.downloading.includes(r.src)},on:{click:function(o){return s.downloadResource(r.src,"image")}}},[e("b-icon",{attrs:{icon:"download"}}),s._v(" "+s._s(s.downloading.includes(r.src)?s.$t("downloading"):s.$t("download"))+" ")],1)])])}),0)]):s._e(),s.normalizedPickFromTypes.includes("video")&&s.resources.videos&&s.resources.videos.length>0?e("div",{staticClass:"_section"},[e("h3",[s._v(s._s(s.$t("videos")))]),e("div",{staticClass:"_grid"},s._l(s.resources.videos,function(r,i){return e("div",{key:`vid-${i}`,staticClass:"_resourceCard"},[e("div",{staticClass:"_preview"},[e("video",{attrs:{src:s.getFullUrl(r.src),controls:"",preload:"metadata"}})]),e("div",{staticClass:"_info"},[r.credits?e("p",{staticClass:"_credits"},[s._v(s._s(r.credits))]):s._e(),e("button",{staticClass:"u-button u-button_small",attrs:{disabled:s.downloading.includes(r.src)},on:{click:function(o){return s.downloadResource(r.src,"video")}}},[e("b-icon",{attrs:{icon:"download"}}),s._v(" "+s._s(s.downloading.includes(r.src)?s.$t("downloading"):s.$t("download"))+" ")],1)])])}),0)]):s._e(),s.normalizedPickFromTypes.includes("audio")&&s.resources.sons&&s.resources.sons.length>0?e("div",{staticClass:"_section"},[e("h3",[s._v(s._s(s.$t("audio")))]),e("div",{staticClass:"_grid"},s._l(s.resources.sons,function(r,i){return e("div",{key:`aud-${i}`,staticClass:"_resourceCard"},[e("div",{staticClass:"_preview"},[e("audio",{attrs:{src:s.getFullUrl(r.src),controls:"",preload:"metadata"}})]),e("div",{staticClass:"_info"},[r.credits?e("p",{staticClass:"_credits"},[s._v(s._s(r.credits))]):s._e(),e("button",{staticClass:"u-button u-button_small",attrs:{disabled:s.downloading.includes(r.src)},on:{click:function(o){return s.downloadResource(r.src,"audio")}}},[e("b-icon",{attrs:{icon:"download"}}),s._v(" "+s._s(s.downloading.includes(r.src)?s.$t("downloading"):s.$t("download"))+" ")],1)])])}),0)]):s._e()])])},d=[],u=a(c,l,d,!1,null,"1b7d840e");const m=u.exports;export{m as R};
