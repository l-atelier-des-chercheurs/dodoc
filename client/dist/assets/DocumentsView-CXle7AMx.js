import{n,S as c,_ as l}from"../build.js";const _={props:{modal_name:String,path:String,default_folder_status:{type:String,default:"public"}},components:{},data(){return{new_folder_title:"",new_folder_is_private:!1,new_folder_template:"story_with_sections",available_templates:[{value:"story_with_sections",label:this.$t("story_with_sections")},{value:"agora",label:this.$t("agora")}],is_creating_folder:!1,allow_save:!1,error_msg:""}},created(){},mounted(){},i18n:{messages:{fr:{agora:"Agora"},en:{agora:"Agora"}}},beforeDestroy(){},watch:{},computed:{},methods:{async createFolder(){this.is_creating_folder=!0;const s=this.setDefaultContentAdmins();this.new_folder_title=this.cleanUpString(this.new_folder_title);let t={title:this.new_folder_title,template:this.new_folder_template,requested_slug:this.new_folder_title,$status:this.new_folder_is_private===!0?"private":this.default_folder_status,$admins:s};this.new_folder_template==="agora"&&(t.autoscroll=!0);try{const e=await this.$api.createFolder({path:this.path,additional_meta:t});setTimeout(()=>{this.$emit("openNew",e)},50)}catch({code:e}){e==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):e==="token_not_allowed_must_be_contributors"?this.$alertify.delay(4e3).error(this.$t("action_not_allowed")):this.$alertify.delay(4e3).error(e),this.is_creating_folder=!1}}}};var d=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.modal_name},on:{close:function(o){return t.$emit("close")}}},[e("form",{staticClass:"input-validation-required",on:{submit:function(o){return o.preventDefault(),t.createFolder.apply(null,arguments)}}},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_folder_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(o){t.new_folder_title=o},toggleValidity:o=>t.allow_save=o,onEnter:t.createFolder}}),e("br"),e("div",{},[e("ToggleInput",{attrs:{content:t.new_folder_is_private,label:t.$t("private"),options:{true:t.$t("private_status_explanations"),false:t.$t("public_status_explanations")}},on:{"update:content":function(o){t.new_folder_is_private=o}}})],1),e("br"),e("div",{},[e("DLabel",{attrs:{str:t.$t("template")}}),e("select",{directives:[{name:"model",rawName:"v-model",value:t.new_folder_template,expression:"new_folder_template"}],on:{change:function(o){var i=Array.prototype.filter.call(o.target.options,function(a){return a.selected}).map(function(a){var r="_value"in a?a._value:a.value;return r});t.new_folder_template=o.target.multiple?i:i[0]}}},t._l(t.available_templates,function(o){return e("option",{key:o.value,domProps:{value:o.value}},[t._v(" "+t._s(o.label)+" ")])}),0)],1),e("br"),e("div",{staticClass:"u-sameRow",attrs:{slot:"footer"},slot:"footer"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(o){return t.$emit("close")}}},[t._v(" "+t._s(t.$t("cancel"))+" ")]),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{slot:"footer",type:"submit",loading:t.is_creating_folder},slot:"footer"},[t._v(" "+t._s(t.$t("create_and_open"))+" ")])]),t.error_msg?[e("br"),e("br"),e("div",{staticClass:"u-errorMsg",domProps:{textContent:t._s(t.error_msg)}})]:t._e()],2)])},u=[],h=n(_,d,u,!1,null,"61e6051c");const p=h.exports,m={props:{},components:{SearchInput2:c,CreateCollection:p},data(){return{show_create_collection:!1,collections:[],path:"collections",search_coll_name:""}},i18n:{messages:{fr:{collections:"Collections",create_a_collection:"Créer une collection",search_in_titles:"Rechercher dans les titres",collection_instr:"Les collections regroupent des médias dans l’espace partagé pour les partager."},en:{collections:"Collections",create_a_collection:"Create a collection",search_in_titles:"Search in titles",collection_instr:"Collections group multiple medias"}}},async created(){this.collections=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.stack})},sorted_collections(){return this.collections.slice().filter(s=>this.canLoggedinSeeFolder({folder:s})).sort((s,t)=>s.title.localeCompare(t.title))},filtered_collections(){return this.sorted_collections.filter(s=>this.search_coll_name?this.twoStringsSearch(s.title,this.search_coll_name):!0)}},methods:{openNewCollection(s){this.show_create_collection=!1,this.$emit("open",s)}}};var v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_collectionsList"},[e("div",{staticClass:"u-spacingBottom u-instructions"},[t._v(" "+t._s(t.$t("collection_instr"))+" ")]),e("div",{staticClass:"u-spacingBottom"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(o){t.show_create_collection=!0}}},[e("b-icon",{attrs:{icon:"plus-circle"}}),t._v("  "+t._s(t.$t("create_a_collection"))+" ")],1),t.show_create_collection?e("CreateCollection",{attrs:{modal_name:t.$t("create_a_collection"),path:"collections",default_folder_status:"private"},on:{close:function(o){t.show_create_collection=!1},openNew:t.openNewCollection}}):t._e()],1),e("div",{staticClass:"u-spacingBottom"},[e("SearchInput2",{attrs:{search_placeholder:t.$t("search_in_titles")},model:{value:t.search_coll_name,callback:function(o){t.search_coll_name=o},expression:"search_coll_name"}})],1),e("table",{staticClass:"u-spacingBottom _list"},[e("transition-group",{attrs:{tag:"tbody",name:"projectsList",appear:""}},t._l(t.filtered_collections,function(o){return e("tr",{key:o.$path,on:{click:function(i){t.$emit("open",t.getFilename(o.$path))}}},[e("td",[e("strong",[t._v(t._s(o.title))]),t._v(" – "),e("i",[t._v(t._s(t.$t(o.template||"story_with_sections").toLowerCase()))])]),e("td",[e("div",{staticClass:"u-sameRow"},t._l(o.$admins,function(i,a){return e("AuthorTag",{key:i+"_"+a,attrs:{path:i,show_image_only:!0}})}),1)])])}),0)],1)])},f=[],$=n(m,v,f,!1,null,"b53ae7c3");const g=$.exports,b={props:{pane_infos:Object},components:{StorySectionTemplate:()=>l(()=>import("./StorySectionTemplate-CNfasBPl.js"),[]),AgoraTemplate:()=>l(()=>import("./AgoraTemplate-CxeqIZ1v.js"),[])},data(){return{is_loading:!0,collection:void 0,path:"collections/"+this.pane_infos.opened_collection_slug,fetch_coll_error_message:"",show_qr_code_modal:!1}},i18n:{messages:{fr:{make_public:"Accès public (sans mot de passe ou compte)"},en:{make_public:"Allow access to everyone (without password or account)"}}},async created(){const s=await this.$api.getFolder({path:this.path}).catch(t=>{t.code==="folder_private"?this.fetch_coll_error_message=this.$t("coll_is_private"):this.fetch_coll_error_message=t.code,this.is_loading=!1});this.collection=s,this.is_loading=!1,this.$api.join({room:this.path}),this.$eventHub.$on("collection.addStack",this.addToStack)},mounted(){},beforeDestroy(){this.$api.leave({room:this.path}),this.$eventHub.$off("collection.addStack",this.addToStack)},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.collection})},share_url(){let s={};this.collection.template==="story_with_sections"&&(s={display:"section"}),this.collection.template==="agora"&&this.collection.autoscroll===!0&&(s={scroll:"auto"});const t=this.$router.resolve({path:this.createURLFromPath(this.collection.$path),query:s});return window.location.origin+t.href}},methods:{addToStack(){},async removeCollection(){await this.$api.deleteItem({path:this.collection.$path}),this.$emit("close")}}};var w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openedCollection"},[e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.is_loading?e("div",{key:"loader"},[e("div",{staticClass:"_spinner"},[e("LoaderSpinner")],1)]):t.fetch_coll_error_message?e("div",{key:"err",staticClass:"_error"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(o){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),e("div",{},[t._v(" "+t._s(t.fetch_coll_error_message)+" ")])]):e("div",{key:t.collection.$path},[e("div",{staticClass:"_titleBar"},[e("TitleField",{attrs:{field_name:"title",content:t.collection.title,path:t.collection.$path,tag:"h1",required:!0,can_edit:t.can_edit}})],1),e("div",{staticClass:"_topbar"},[e("div",{},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(o){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1)]),e("AuthorField",{staticClass:"_admins",attrs:{label:t.$t("admins"),instructions:t.$t("media_editing_instructions"),field:"$admins",authors_paths:t.collection.$admins,path:t.collection.$path,can_edit:t.can_edit,show_image_only:!0}}),t.can_edit?e("StatusTag",{attrs:{status:t.collection.$status||"public",status_options:["public","private"],path:t.collection.$path,can_edit:t.can_edit}}):t._e(),t.can_edit?e("DropDown",[t.can_edit?e("RemoveMenu",{attrs:{remove_text:t.$t("remove")},on:{remove:t.removeCollection}}):t._e(),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(o){t.show_qr_code_modal=!0}}},[e("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[e("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[e("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),e("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),e("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),e("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),e("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])]),t._v(" "+t._s(t.$t("direct_link"))+" ")])],1):t._e(),t.show_qr_code_modal?e("QRModal",{attrs:{url_to_access:t.share_url},on:{close:function(o){t.show_qr_code_modal=!1}}},[e("ToggleField",{attrs:{label:t.$t("make_public"),field_name:"$public",content:t.collection.$public===!0,path:t.collection.$path,can_edit:t.can_edit}})],1):t._e()],1),e("div",{staticClass:"_cont"},[!t.collection.template||t.collection.template==="story_with_sections"?e("StorySectionTemplate",{attrs:{publication:t.collection,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(o){return t.$emit("updatePane",o)}}}):t.collection.template==="agora"?e("AgoraTemplate",{attrs:{publication:t.collection,can_edit:t.can_edit}}):t._e()],1)])])],1)},y=[],C=n(b,w,y,!1,null,"3ae679d4");const k=C.exports,S={props:{},components:{CollectionsList:g,OpenedCollection:k},data(){return{}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{pane_infos(){var t,e;let s={};return(t=this.$route.query)!=null&&t.collection&&(s.opened_collection_slug=this.$route.query.collection),(e=this.$route.query)!=null&&e.section&&(s.section=this.$route.query.section),s}},methods:{openCollection(s){this.updateCollectionQuery(s)},closeCollection(){this.updateCollectionQuery(!1)},updatePane({key:s,value:t}){this.updatePageQuery({prop:s,val:t})},async updateCollectionQuery(s){this.updatePageQuery({prop:"collection",val:s})}}};var V=function(){var o;var t=this,e=t._self._c;return e("div",{staticClass:"_collections"},[e("CollectionsList",{on:{open:t.openCollection}}),(o=t.pane_infos)!=null&&o.opened_collection_slug?e("OpenedCollection",{attrs:{pane_infos:t.pane_infos},on:{updatePane:t.updatePane,close:t.closeCollection}}):t._e()],1)},Z=[],F=n(S,V,Z,!1,null,"6dbbe7c4");const H=F.exports,L={props:{},components:{CollectionsPane:H},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var q=function(){var t=this,e=t._self._c;return e("div",[e("CollectionsPane")],1)},x=[],T=n(L,q,x,!1,null,"8dd99ae5");const D=T.exports;export{D as default};
