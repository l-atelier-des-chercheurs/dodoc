import{n as l,S as h,b as u,_ as f,d as p}from"../build.js";import{K as v}from"./KeywordsField-B8AZHPAc.js";import{F as m}from"./FileShown-CvQXdy3a.js";const k={props:{shared_files:Array,group_mode:String,sort_order:String,search_str:String,filetype_filter:String,author_path_filter:String,available_keywords:Array,keywords_filter:Array,fav_filter:Boolean,view_mode:String},components:{SingleKeyword:u,SearchInput2:h},data(){return{show_filter_sort_pane:!1,all_authors:[],show_all_keywords:!1,kw_search:"",group_options:[{key:"day",label:this.$t("day")},{key:"month",label:this.$t("month")},{key:"year",label:this.$t("year")}],type_of_media_to_display:"all",types_of_medias:[{key:"all",label:this.$t("all_medias_types")},{key:"image",label:this.$t("image")},{key:"video",label:this.$t("video")},{key:"audio",label:this.$t("audio")},{key:"text",label:this.$t("text")},{key:"pdf",label:this.$t("pdf")},{key:"stl",label:this.$t("stl")},{key:"other",label:this.$t("other")}]}},i18n:{messages:{fr:{search_fields:"Rechercher dans les champs titre et description des documents."},en:{search_fields:"Search in titles or descriptions of documents."}}},async created(){this.all_authors=await this.$api.getFolders({path:"authors"})},async mounted(){},beforeDestroy(){},watch:{},computed:{available_keywords_except_active(){return this.available_keywords.filter(t=>this.keywords_filter.includes(t.title)?!1:this.kw_search?this.twoStringsSearch(t.title,this.kw_search):!0)},collapsable_keywords(){return this.show_all_keywords?this.available_keywords_except_active:this.available_keywords_except_active.slice(0,10)},can_be_reset(){return this.group_mode!=="year"||this.sort_order!=="date_modified"||this.search_str!==""||this.author_path_filter!==""||this.filetype_filter!=="all"||this.keywords_filter.length>0}},methods:{resetFilters(){this.$emit("update:group_mode","year"),this.$emit("update:sort_order","date_modified"),this.$emit("update:search_str",""),this.$emit("update:author_path_filter",""),this.$emit("update:filetype_filter","all"),this.$emit("update:keywords_filter",[])},filterByKeyword(a){let t=this.keywords_filter.slice();this.keywords_filter.includes(a)?t=t.filter(e=>e!==a):t.push(a),this.$emit("update:keywords_filter",t)},removeFilter(a){this.$nextTick(()=>{this.filterByKeyword(a)})},addFilter(a){this.$nextTick(()=>{this.kw_search="",this.filterByKeyword(a)})}}};var $=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_filterBar"},[e("div",{staticClass:"_topBtn"},[e("div",{},[e("button",{staticClass:"u-buttonLink",class:{"is--active":t.show_filter_sort_pane},attrs:{type:"button"},on:{click:function(s){t.show_filter_sort_pane=!t.show_filter_sort_pane}}},[e("b-icon",{attrs:{icon:"filter"}}),t._v(" "+t._s(t.$t("filters"))+" ")],1)]),e("div",{staticClass:"_searchField"},[e("SearchInput2",{attrs:{value:t.search_str,search_placeholder:t.$t("search_fields")},on:{input:function(s){return t.$emit("update:search_str",s)}}})],1),e("div",{staticClass:"u-sameRow"},[e("div",[e("button",{staticClass:"u-button u-button_icon u-button_transparent",class:{"is--active":t.fav_filter===!0},attrs:{type:"button"},on:{click:function(s){return t.$emit("update:fav_filter",!t.fav_filter)}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("button",{staticClass:"u-button u-button_icon",class:{"is--active":t.view_mode==="list"},attrs:{type:"button"},on:{click:function(s){return t.$emit("update:view_mode","list")}}},[e("b-icon",{attrs:{icon:"grid3x3"}})],1),e("button",{staticClass:"u-button u-button_icon",class:{"is--active":t.view_mode==="map"},attrs:{type:"button"},on:{click:function(s){return t.$emit("update:view_mode","map")}}},[e("b-icon",{attrs:{icon:"map-fill"}})],1)])]),e("transition",{attrs:{name:"pagechange"}},[t.show_filter_sort_pane?e("div",{staticClass:"_filterPane"},[e("div",{staticClass:"_filterPane--row"},[e("select",{staticClass:"_selectField",domProps:{value:t.sort_order},on:{change:function(s){return t.$emit("update:sort_order",s.target.value)}}},[e("option",{attrs:{value:"date_modified"},domProps:{textContent:t._s(t.$t("date_modified"))}}),e("option",{attrs:{value:"date_created"},domProps:{textContent:t._s(t.$t("date_created"))}})]),e("select",{staticClass:"_selectField",domProps:{value:t.group_mode},on:{change:function(s){return t.$emit("update:group_mode",s.target.value)}}},t._l(t.group_options,function(s){return e("option",{key:s.key,domProps:{value:s.key,textContent:t._s(s.label)}})}),0),e("select",{staticClass:"_selectField",domProps:{value:t.author_path_filter},on:{change:function(s){return t.$emit("update:author_path_filter",s.target.value)}}},[e("option",{attrs:{value:""},domProps:{textContent:t._s(t.$t("none"))}}),t._l(t.all_authors,function(s){return e("option",{key:s.$path,domProps:{value:s.$path,textContent:t._s(s.name)}})})],2),e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.can_be_reset?e("button",{staticClass:"u-buttonLink _resetFilters",attrs:{type:"button"},on:{click:t.resetFilters}},[t._v(" "+t._s(t.$t("reset"))+" ")]):t._e()])],1),e("div",{staticClass:"_filterPane--row"},[e("div",{staticClass:"_tag"},[e("DLabel",{attrs:{str:t.$t("filter_by_keyword")}}),e("div",{staticClass:"_searchKW"},[e("SearchInput2",{attrs:{search_placeholder:t.$t("search")},model:{value:t.kw_search,callback:function(s){t.kw_search=s},expression:"kw_search"}})],1),t.keywords_filter.length>0?e("div",{staticClass:"u-keywords _usedKw"},t._l(t.keywords_filter,function(s){return e("SingleKeyword",{key:s,attrs:{keyword:s,can_remove:!0},on:{remove:function(i){return t.removeFilter(s)}}})}),1):t._e(),e("div",{staticClass:"u-keywords"},[t._l(t.collapsable_keywords,function(s){return e("SingleKeyword",{key:s.title,attrs:{keyword:s.title,count:s.count,can_add:!0},on:{add:function(i){return t.addFilter(s.title)}}})}),t.available_keywords_except_active.length>10?e("button",{staticClass:"u-buttonLink",class:{"is--active":t.show_all_keywords},attrs:{type:"button"},on:{click:function(s){t.show_all_keywords=!t.show_all_keywords}}},[t._v(" "+t._s(t.$t("show_all_keywords"))+" ")]):t._e()],2)],1)])]):t._e()])],1)},w=[],y=l(k,$,w,!1,null,"2e40d8e3");const g=y.exports,b={props:{stack:Object,is_selected:Boolean,is_favorite:Boolean,can_be_added_to_fav:Boolean},components:{},data(){return{start_slide:!1,stack_files:void 0,index_of_slide_file_to_show:void 0}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{number_of_medias_in_stack(){var a;return((a=this.stack.stack_files_metas)==null?void 0:a.length)||0},slide_file_to_show(){return this.stack_files&&this.index_of_slide_file_to_show!==void 0?this.stack_files[this.index_of_slide_file_to_show]:!1}},methods:{openStack(){const a=this.getFilename(this.stack.$path);this.$emit("openStack",a)},async startSlide(a){this.start_slide=!0,setTimeout(async()=>{if(this.start_slide){const t=await this.loadFiles();this.stack_files=t,this.updateMousePos(a)}},200)},updateMousePos(a){if(!this.stack_files)return;const{pageX:t}=a,{x:e,width:s}=this.$el.getBoundingClientRect(),i=(t-e)/s;this.index_of_slide_file_to_show=Math.floor(i*this.number_of_medias_in_stack)},endSlide(){this.start_slide=!1,this.stack_files=void 0,this.index_of_slide_file_to_show=void 0},async loadFiles(){const a=await this.$api.getFolder({path:this.stack.$path});return this.getStackFilesInOrder({stack:a})}}};var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackPreview",on:{mouseenter:t.startSlide,mousemove:t.updateMousePos,mouseleave:t.endSlide}},[e("button",{staticClass:"_stackPreview--content",class:{"is--slider":t.start_slide,"is--selected":t.is_selected},attrs:{type:"button"},on:{click:t.openStack}},[e("div",{staticClass:"_preview"},[e("div",{key:"preview",staticClass:"_mainPreview",class:{"is--showingSlides":t.slide_file_to_show}},[t.stack.$preview?e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:t.stack.$preview}}):e("b-icon",{attrs:{icon:"eye-slash"}})],1),t._l(t.stack_files,function(s){var i;return e("div",{key:s.$path,staticClass:"_slide",class:{"is--shown":s.$path===((i=t.slide_file_to_show)==null?void 0:i.$path)}},[e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:s}})],1)}),e("transition-group",{staticClass:"_count",attrs:{name:"projectsList"}},[t.index_of_slide_file_to_show!==void 0?[e("div",{key:"slide"},[t._v(" "+t._s(t.index_of_slide_file_to_show+1)+" ")]),e("div",{key:"slash"},[t._v("/")])]:t._e(),e("div",{key:"preview"},[t._v(" "+t._s(t.number_of_medias_in_stack)+" ")])],2)],2),e("div",{staticClass:"_title"},[t._v(" "+t._s(t.stack.title)+" ")])]),e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.can_be_added_to_fav&&(t.is_favorite||t.start_slide)?e("div",[e("button",{staticClass:"u-button u-button_icon u-button_transparent _addToFav",attrs:{type:"button","data-isfav":t.is_favorite},on:{click:function(s){return s.stopPropagation(),t.$emit("toggleFav")}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):t._e()])],1)},F=[],S=l(b,C,F,!1,null,"0785e8a6");const x=S.exports,L={props:{files:Array,can_edit:Boolean},components:{FileShown:m},data(){return{active_file_index:0,is_dragged:!1}},i18n:{messages:{fr:{},en:{}}},created(){},mounted(){this.$eventHub.$on("carousel.next",this.nextFile),this.$eventHub.$on("carousel.prev",this.prevFile)},beforeDestroy(){this.$eventHub.$off("carousel.next",this.nextFile),this.$eventHub.$off("carousel.prev",this.prevFile)},watch:{active_file_index(){this.$nextTick(()=>{this.$el.querySelector("._preview[data-iscurrent]").scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}},computed:{enable_drag(){return typeof this.$eventHub._events["mediatile.drag.end"]<"u"},current_file_shown(){return this.active_file_index!==!1?this.files[this.active_file_index]:!1},file_shown_position(){return this.files.length===1?"alone":this.active_file_index===0?"first":this.active_file_index===this.files.length-1?"last":"inbetween"}},methods:{toggleFile(a){this.active_file_index===a?this.active_file_index=!1:this.active_file_index=a},openFile(a){this.active_file_index=a},prevFile(){this.active_file_index>0&&this.active_file_index--},nextFile(){this.active_file_index<this.files.length-1&&this.active_file_index++}}};var M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackCarousel"},[!t.files||t.files.length===0?[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("nothing_to_show"))+" ")])]:t._e(),t.current_file_shown?e("FileShown",{key:t.current_file_shown.$path,staticClass:"_stackCarousel--fileshown",attrs:{file:t.current_file_shown,position:t.file_shown_position,can_edit:t.can_edit}}):t._e(),e("transition-group",{staticClass:"_list",attrs:{tag:"div",name:"listComplete"}},t._l(t.files,function(s,i){return e("div",{key:s.$path,staticClass:"_preview",attrs:{"data-iscurrent":t.current_file_shown.$path===s.$path},on:{click:function(r){return t.openFile(i)}}},[e("MediaContent",{attrs:{file:s,context:"preview",resolution:360}}),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.current_file_shown.$path===s.$path?e("div",{staticClass:"_btnRow"},[e("div",{staticClass:"_previewOverlay"}),e("select",{staticClass:"_changeOrderSelect",attrs:{size:"small"},domProps:{value:i+1},on:{change:function(r){return t.$emit("changeMediaOrder",i,+r.target.value-1)}}},t._l(new Array(t.files.length).fill(null),function(r,n){return e("option",{key:n+1,domProps:{textContent:t._s(n+1)}})}),0),e("RemoveMenu",{staticClass:"_removeBtn",attrs:{remove_text:t.$t("remove"),show_button_text:!1},on:{remove:function(r){return t.$emit("removeMediaFromStack",t.current_file_shown.$path)}}})],1):t._e()]),e("div",{staticClass:"_credits"},[s.caption?e("b-icon",{attrs:{icon:"text-left"}}):t._e(),s.$credits?e("b-icon",{attrs:{icon:"info-circle"}}):t._e()],1)],1)}),0)],2)},P=[],B=l(L,M,P,!1,null,"01d1960c");const A=B.exports,D={props:{stack_path:String,context:String,is_favorite:Boolean,can_be_added_to_fav:Boolean,can_be_selected:String},components:{KeywordsField:v,StackCarousel:A},inject:{},data(){return{stack:void 0,fetch_stack_error:void 0,is_loading:!0,show_sidebar:localStorage.getItem("show_sidebar")!=="false",pane_width:void 0,ro:void 0}},i18n:{messages:{fr:{fill_title:"Veuillez remplir le champ Titre",fill_keywords:"Veuillez remplir le champ Mots-clés",files_missing:"Veuillez ajouter des médias à ce document",stack_not_public:"Ce document n'est pas public",error_loading_stack:"Erreur lors du chargement du document",select_stack:"Sélectionner ce document"},en:{fill_title:"Fill in the title field",fill_keywords:"Fill in the keywords field",files_missing:"Add medias to this document",stack_not_public:"This document is not public",error_loading_stack:"Error loading document",select_stack:"Select this document"}}},async created(){var a;if(this.stack=await this.$api.getFolder({path:this.stack_path}).catch(t=>{this.is_loading=!1,t.code==="folder_private"?this.fetch_stack_error=this.$t("stack_not_public"):this.fetch_stack_error=this.$t("error_loading_stack")}),this.$api.join({room:this.stack.$path}),this.is_loading=!1,this.date_created_corrected=this.datetimeLocal(this.stack.date_created_corrected||this.stack.$date_created||this.stack.$date_uploaded),this.stack_files_in_order.length>0){const t=this.stack_files_in_order[0].$path;((a=this.stack.$preview)==null?void 0:a.$path)!==t&&await this.$api.updateMeta({path:this.stack.$path,new_meta:{$preview:this.getFilename(t)}})}},mounted(){this.updatePaneWidth(),this.ro=new ResizeObserver(this.updatePaneWidth),this.ro.observe(this.$el),window.addEventListener("keyup",this.handleKeyPress)},beforeDestroy(){this.ro.unobserve(this.$el),window.removeEventListener("keyup",this.handleKeyPress),this.stack&&this.$api.leave({room:this.stack.$path})},watch:{"stack.date_created_corrected"(){this.date_created_corrected=this.datetimeLocal(this.stack.date_created_corrected)},show_sidebar(){localStorage.setItem("show_sidebar",this.show_sidebar)}},computed:{can_edit(){return this.stack?this.canLoggedinEditFolder({folder:this.stack}):!1},stack_files_in_order(){return this.getStackFilesInOrder({stack:this.stack})},share_button_is_enabled(){var a,t;return((a=this.stack.title)==null?void 0:a.length)>0&&((t=this.stack.keywords)==null?void 0:t.length)>0&&this.stack_files_in_order.length>0},dual_display(){return!!(this.show_sidebar&&this.pane_width>360*2)}},methods:{updatePaneWidth(){this.pane_width=this.$el.offsetWidth},async changeMediaOrder(a,t){var r,n;let e=this.stack_files_in_order.map(o=>this.getFilename(o.$path));function s(o,c,_){if(_>=o.length)for(var d=_-o.length+1;d--;)o.push(void 0);return o.splice(_,0,o.splice(c,1)[0]),o}s(e,a,t);let i={stack_files_metas:e};(!((r=this.stack.$preview)!=null&&r.$path)||this.getFilename((n=this.stack.$preview)==null?void 0:n.$path)!==e.at(0))&&(i.$preview=e.at(0)),await this.$api.updateMeta({path:this.stack.$path,new_meta:i})},async removeMediaFromStack(a){var e;await this.$api.copyFile({path:a,path_to_destination_folder:this.connected_as.$path,new_meta:{}}),await this.$api.deleteItem({path:a});let t=(e=this.stack)==null?void 0:e.stack_files_metas.slice();t=t.filter(s=>s!==this.getFilename(a)),await this.$api.updateMeta({path:this.stack.$path,new_meta:{stack_files_metas:t}})},async removeStack(){await this.$api.deleteItem({path:this.stack.$path}),this.$emit("close")},closeOnRemove({path:a}){a===this.stack.$path&&(this.$alertify.closeLogOnClick(!0).delay(4e3).log(this.$t("stack_was_removed")),this.$emit("close"))},handleKeyPress(a){if(a.key==="Escape")return this.$emit("close"),!1;a.key==="ArrowLeft"?this.$eventHub.$emit("carousel.prev"):a.key==="ArrowRight"?this.$eventHub.$emit("carousel.next"):a.key==="ArrowUp"?this.$eventHub.$emit("fileshown.showInfos"):a.key==="ArrowDown"&&this.$eventHub.$emit("fileshown.hideInfos")}}};var R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackDisplay",attrs:{"data-context":t.context}},[e("div",{staticClass:"_closeStack"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",on:{click:function(s){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("div",{staticClass:"_panes"},[t.is_loading?e("LoaderSpinner"):t.fetch_stack_error?e("div",[t._v(" "+t._s(t.fetch_stack_error)+" ")]):[e("div",{staticClass:"_showSidebar"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",attrs:{type:"button"},on:{click:function(s){s.stopPropagation(),t.show_sidebar=!0}}},[e("b-icon",{attrs:{icon:"list-ul","aria-label":t.$t("show")}})],1)]),e("transition",{attrs:{name:"slideleft",mode:"out-in"}},[t.show_sidebar?e("div",{staticClass:"_infos"},[e("div",{staticClass:"_allFields"},[e("div",{staticClass:"_titleRow"},[e("TitleField",{attrs:{label:t.$t("title"),field_name:"title",content:t.stack.title,path:t.stack.$path,required:!0,tag:"h1",can_edit:t.can_edit}}),t.can_be_added_to_fav?e("button",{staticClass:"u-button u-button_icon _addToColl",attrs:{type:"button"},on:{click:function(s){return s.stopPropagation(),t.$emit("toggleFav")}}},[t.is_favorite?e("b-icon",{attrs:{icon:"star-fill","aria-label":t.$t("remove")}}):e("b-icon",{attrs:{icon:"star","aria-label":t.$t("add")}})],1):t._e()],1),e("hr"),e("div",[e("CollaborativeEditor2",{attrs:{label:t.$t("description"),field_to_edit:"description",content:t.stack.description,path:t.stack.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,can_edit:t.can_edit}})],1),e("hr"),e("div",{},[e("KeywordsField",{attrs:{label:t.$t("keywords"),field_name:"keywords",keywords:t.stack.keywords,path:t.stack.$path,can_edit:t.can_edit}})],1),e("hr"),e("PositionPicker",{attrs:{field_name:"$location",label:t.$t("location"),content:t.stack.$location,path:t.stack.$path,can_edit:t.can_edit}}),e("hr"),e("div",{staticClass:"_dateFields"},[e("div",{},[e("DateField",{attrs:{label:t.$t("created"),field_name:"date_created_corrected",date:t.date_created_corrected,path:t.stack.$path,input_type:"datetime-local",can_edit:t.can_edit}}),t._v(" "+t._s(t.date_created_corrected)+" ")],1),e("div",{},[e("DateField",{attrs:{label:t.$t("date_modified"),field_name:"date_modified",date:t.stack.$date_modified,path:t.stack.$path,input_type:"datetime-local",can_edit:!1}})],1)]),e("hr"),e("div",{staticClass:"u-spacingBottom"},[e("AuthorField",{attrs:{label:t.$t("authors"),field:"$authors",instructions:t.$t("file_author_instructions"),authors_paths:t.stack.$authors,path:t.stack.$path,can_edit:t.can_edit,no_options:!0}})],1),e("div",{staticClass:"u-spacingBottom"},[e("AuthorField",{attrs:{label:t.$t("admins"),field:"$admins",instructions:t.$t("media_editing_instructions"),authors_paths:t.stack.$admins,path:t.stack.$path,can_edit:t.can_edit}})],1),e("hr"),t.can_edit?e("div",{staticClass:"u-sameRow"},[e("DownloadFolder",{attrs:{path:t.stack.$path}}),e("RemoveMenu",{attrs:{remove_text:t.$t("remove"),remove_expl:t.$t("remove_stack_instr")},on:{remove:t.removeStack}})],1):t._e(),t.is_instance_admin?e("div",{},[t.can_edit?e("StatusTag",{attrs:{status:t.stack.$status||"public",status_options:["public","private"],path:t.stack.$path,can_edit:t.can_edit}}):t._e()],1):t._e()],1),t.context==="chutier"?e("div",{staticClass:"_bottomBtns"},[e("div",{staticClass:"u-instructions"},[!t.stack.title||t.stack.title.length===0?e("div",[t._v(" "+t._s(t.$t("fill_title"))+" ")]):t._e(),!t.stack.keywords||t.stack.keywords.length===0?e("div",[t._v(" "+t._s(t.$t("fill_keywords"))+" ")]):t._e(),t.stack_files_in_order.length===0?e("div",[t._v(" "+t._s(t.$t("files_missing"))+" ")]):t._e()])]):t._e(),e("button",{staticClass:"u-button u-button_icon u-button_transparent _hideSidebar",attrs:{type:"button"},on:{click:function(s){s.stopPropagation(),t.show_sidebar=!1}}},[e("b-icon",{attrs:{icon:"arrow-left","aria-label":t.$t("hide")}})],1)]):t._e()]),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.show_sidebar&&!t.dual_display?e("div",{staticClass:"_overlay",on:{click:function(s){t.show_sidebar=!1}}}):t._e()]),e("StackCarousel",{staticClass:"_topCarousel",attrs:{"data-dualdisplay":t.dual_display,files:t.stack_files_in_order,can_edit:t.can_edit},on:{removeMediaFromStack:t.removeMediaFromStack,changeMediaOrder:t.changeMediaOrder}})]],2),t.can_be_selected==="single_stack"?e("div",{staticClass:"_selectBar"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(s){return t.$emit("selectStack")}}},[t._v(" "+t._s(t.$t("select_stack"))+" ")])]):t._e()])},H=[],I=l(D,R,H,!1,null,"95bea0ce");const O=I.exports,K={props:{shared_folder_path:String,select_mode:{type:[Boolean,String],default:!1}},components:{FilterBar:g,StackPreview:x,AdminLumaSettings:p,StackDisplay:O,MediaMap:()=>f(()=>import("./MediaMap-D0mvYxY2.js"),[])},data(){return{folder:void 0,all_stacks:[],is_loading_folder:!0,show_admin_settings:!1,last_selected_stack_path:void 0,view_mode:"list",sort_order:localStorage.getItem("archive.sort_order")||"date_modified",search_str:"",filetype_filter:"all",author_path_filter:"",keywords_filter:[],group_mode:"year",fav_filter:!1}},i18n:{messages:{fr:{only_my_fav:"Que les favoris",select_stack:"Sélectionner ce document"},en:{only_my_fav:"Favourites",select_stack:"Select this document"}}},async created(){},async mounted(){this.folder=await this.$api.getFolder({path:this.shared_folder_path}),this.all_stacks=await this.$api.getFolders({path:this.stack_shared_folder_path}),this.$api.join({room:this.stack_shared_folder_path}),this.is_loading_folder=!1},beforeDestroy(){this.$api.leave({room:this.stack_shared_folder_path})},watch:{opened_stack(){this.opened_stack&&(this.last_selected_stack_path=this.opened_stack.$path)},sort_order(){localStorage.setItem("archive.sort_order",this.sort_order)}},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.folder})},stack_shared_folder_path(){return this.shared_folder_path+"/stacks"},can_be_added_to_fav(){var a;return this.connected_as&&((a=this.connected_as)==null?void 0:a.$path)!==void 0},sorted_stacks(){return this.all_stacks.slice().sort((a,t)=>+new Date(t.$date_modified)-+new Date(a.$date_modified))},filtered_stacks(){return this.sorted_stacks.filter(a=>{var t;return this.fav_filter&&!this.isFavorite(a.$path)||this.author_path_filter&&!((t=a.$authors)!=null&&t.includes(this.author_path_filter))||this.keywords_filter.length>0&&(!a.keywords||!Array.isArray(a.keywords)||this.keywords_filter.some(e=>!a.keywords.includes(e)))?!1:this.search_str?!!(a.title&&a.title.toLowerCase().includes(this.search_str.toLowerCase())||a.description&&a.description.toLowerCase().includes(this.search_str.toLowerCase())):!0})},grouped_stacks(){let a=["$date_modified"];return this.sort_order==="date_created"?a=["date_created_corrected","$date_created","$date_uploaded"]:this.sort_order==="date_modified"&&(a=["$date_modified"]),this.groupFilesBy(this.filtered_stacks,a,this.group_mode)},available_keywords(){return this.filtered_stacks.reduce((t,e)=>(e.keywords&&Array.isArray(e.keywords)&&e.keywords.map(s=>{const i=t.find(r=>r.title===s);i?i.count+=1:t.push({title:s,count:1})}),t),[]).sort((t,e)=>e.count-t.count)},opened_stack(){var a;return(a=this.$route.query)!=null&&a.stack?this.all_stacks.find(t=>this.getFilename(t.$path)===this.$route.query.stack):!1}},methods:{toggleMediaFocus(a){const t=this.getFilename(a);this.openStack(t)},openStack(a){let t=Object.assign({},this.$route.query)||{};t.stack=a,this.$router.push({query:t})},isFavorite(a){var t;return!((t=this.connected_as)!=null&&t.favorites)||this.connected_as.favorites.length===0?!1:this.connected_as.favorites.some(e=>e.stack_path===a)},async toggleFav(a){var e;let t=(e=this.connected_as)!=null&&e.favorites?this.connected_as.favorites.slice():[];this.isFavorite(a)?t=t.filter(s=>s.stack_path!==a):t.push({stack_path:a,added:+new Date}),await this.$api.updateMeta({path:this.connected_as.$path,new_meta:{favorites:t}})},closeStack(){let a=Object.assign({},this.$route.query)||{};delete a.stack,this.$router.push({query:a})}}};var T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_sharedFolder"},[e("div",{staticClass:"_topBar"},[e("button",{staticClass:"u-button u-button_white u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){return t.$router.push("/share")}}},[e("b-icon",{attrs:{icon:"arrow-left-short"}})],1),e("TitleField",{attrs:{field_name:"title",label:t.$t("title"),show_label:!1,tag:"b",content:t.folder.title||t.$t("untitled"),path:t.folder.$path,required:!0,can_edit:t.can_edit}})],1),e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.opened_stack?e("StackDisplay",{key:t.opened_stack.$path,staticClass:"_stackModal",attrs:{stack_path:t.opened_stack.$path,context:"archive",can_be_added_to_fav:t.can_be_added_to_fav,can_be_selected:t.select_mode,is_favorite:t.isFavorite(t.opened_stack.$path)},on:{toggleFav:function(s){return t.toggleFav(t.opened_stack.$path)},prevMedia:function(s){return t.navMedia(-1)},nextMedia:function(s){return t.navMedia(1)},selectStack:function(s){return t.$emit("selectStack",t.opened_stack)},close:t.closeStack}}):t._e()],1),e("div",{staticClass:"_sharedFolder--content"},[e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.is_loading_folder?e("div",{staticClass:"_loader"},[e("LoaderSpinner")],1):e("div",[e("FilterBar",{attrs:{group_mode:t.group_mode,sort_order:t.sort_order,search_str:t.search_str,filetype_filter:t.filetype_filter,author_path_filter:t.author_path_filter,available_keywords:t.available_keywords,keywords_filter:t.keywords_filter,fav_filter:t.fav_filter,view_mode:t.view_mode},on:{"update:group_mode":function(s){t.group_mode=s},"update:sort_order":function(s){t.sort_order=s},"update:search_str":function(s){t.search_str=s},"update:filetype_filter":function(s){t.filetype_filter=s},"update:author_path_filter":function(s){t.author_path_filter=s},"update:keywords_filter":function(s){t.keywords_filter=s},"update:fav_filter":function(s){t.fav_filter=s},"update:view_mode":function(s){t.view_mode=s}}}),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("transition-group",{key:t.sort_order+"-"+t.group_mode,attrs:{tag:"div",name:"projectsList",appear:""}},[t.grouped_stacks.length===0?e("div",{key:"nocontent",staticClass:"u-instructions _noContent"},[t._v(" "+t._s(t.$t("no_content"))+" ")]):[t.view_mode==="list"?t._l(t.grouped_stacks,function({label:s,files:i}){return e("div",{key:s,staticClass:"_dayFileSection"},[e("div",{staticClass:"_label"},[t._v(" "+t._s(s)+" ")]),e("transition-group",{staticClass:"_itemGrid",attrs:{tag:"div",name:"listComplete",appear:""}},t._l(i,function(r){return e("StackPreview",{key:r.$path,attrs:{stack:r,is_selected:r.$path===t.last_selected_stack_path,can_be_added_to_fav:t.can_be_added_to_fav,is_favorite:t.isFavorite(r.$path)},on:{toggleFav:function(n){return t.toggleFav(r.$path)},openStack:t.openStack}})}),1)],1)}):t.view_mode==="map"?e("div",{key:"mediaMap",staticClass:"_mediamapContainer"},[e("MediaMap",{attrs:{medias:t.filtered_stacks},on:{toggleMediaFocus:t.toggleMediaFocus}})],1):t._e()]],2)],1)],1)])],1)],1)},j=[],E=l(K,T,j,!1,null,"e4f2c138");const W=E.exports;export{W as default};
