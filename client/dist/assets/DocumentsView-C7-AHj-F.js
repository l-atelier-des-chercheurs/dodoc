import{n as r,S as i}from"../build.js";const c={props:{modal_name:String,path:String,default_folder_status:{type:String,default:"public"}},components:{},data(){return{new_folder_title:"",new_folder_is_private:!1,new_folder_template:"story_with_sections",available_templates:[{value:"story_with_sections",label:this.$t("story_with_sections")},{value:"agora",label:this.$t("agora")},{value:"edition",label:this.$t("edition")}],is_creating_folder:!1,allow_save:!1,error_msg:""}},created(){},mounted(){},i18n:{messages:{fr:{agora:"Agora"},en:{agora:"Agora"}}},beforeDestroy(){},watch:{},computed:{},methods:{async createFolder(){this.is_creating_folder=!0;const s=this.setDefaultContentAdmins();this.new_folder_title=this.cleanUpString(this.new_folder_title);let t={title:this.new_folder_title,template:this.new_folder_template,requested_slug:this.new_folder_title,$status:this.new_folder_is_private===!0?"private":this.default_folder_status,$admins:s};this.new_folder_template==="agora"&&(t.autoscroll=!0);try{const e=await this.$api.createFolder({path:this.path,additional_meta:t});setTimeout(()=>{this.$emit("openNew",e)},50)}catch({code:e}){e==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):e==="token_not_allowed_must_be_contributors"?this.$alertify.delay(4e3).error(this.$t("action_not_allowed")):this.$alertify.delay(4e3).error(e),this.is_creating_folder=!1}}}};var _=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.modal_name},on:{close:function(o){return t.$emit("close")}}},[e("form",{staticClass:"input-validation-required",on:{submit:function(o){return o.preventDefault(),t.createFolder.apply(null,arguments)}}},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_folder_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(o){t.new_folder_title=o},toggleValidity:o=>t.allow_save=o,onEnter:t.createFolder}}),e("br"),e("div",{},[e("ToggleInput",{attrs:{content:t.new_folder_is_private,label:t.$t("private"),options:{true:t.$t("private_status_explanations"),false:t.$t("public_status_explanations")}},on:{"update:content":function(o){t.new_folder_is_private=o}}})],1),e("br"),e("div",{},[e("DLabel",{attrs:{str:t.$t("template")}}),e("select",{directives:[{name:"model",rawName:"v-model",value:t.new_folder_template,expression:"new_folder_template"}],on:{change:function(o){var a=Array.prototype.filter.call(o.target.options,function(l){return l.selected}).map(function(l){var n="_value"in l?l._value:l.value;return n});t.new_folder_template=o.target.multiple?a:a[0]}}},t._l(t.available_templates,function(o){return e("option",{key:o.value,domProps:{value:o.value}},[t._v(" "+t._s(o.label)+" ")])}),0)],1),e("br"),e("div",{staticClass:"u-sameRow",attrs:{slot:"footer"},slot:"footer"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(o){return t.$emit("close")}}},[t._v(" "+t._s(t.$t("cancel"))+" ")]),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{slot:"footer",type:"submit",loading:t.is_creating_folder},slot:"footer"},[t._v(" "+t._s(t.$t("create_and_open"))+" ")])]),t.error_msg?[e("br"),e("br"),e("div",{staticClass:"u-errorMsg",domProps:{textContent:t._s(t.error_msg)}})]:t._e()],2)])},u=[],d=r(c,_,u,!1,null,"6640990b");const p=d.exports,f={props:{},components:{SearchInput2:i,CreateCollection:p},data(){return{show_create_collection:!1,collections:[],path:"collections",search_coll_name:""}},i18n:{messages:{fr:{collections:"Collections",create_a_collection:"Créer une collection",search_in_titles:"Rechercher dans les titres",collection_instr:"Les collections regroupent des médias dans l’espace partagé pour les partager.",agora:"Agora"},en:{collections:"Collections",create_a_collection:"Create a collection",search_in_titles:"Search in titles",collection_instr:"Collections group multiple medias",agora:"Agora"}}},async created(){this.collections=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.stack})},sorted_collections(){return this.collections.slice().filter(s=>this.canLoggedinSeeFolder({folder:s})).sort((s,t)=>s.title.localeCompare(t.title))},filtered_collections(){return this.sorted_collections.filter(s=>this.search_coll_name?this.twoStringsSearch(s.title,this.search_coll_name):!0)}},methods:{openNewCollection(s){this.show_create_collection=!1,this.$emit("open",s)},getURLToFolder(s){return`/publish/${s.split("/").at(-1)}`}}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_collectionsList"},[e("div",{staticClass:"u-spacingBottom u-instructions"},[t._v(" "+t._s(t.$t("collection_instr"))+" ")]),e("div",{staticClass:"u-spacingBottom"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(o){t.show_create_collection=!0}}},[e("b-icon",{attrs:{icon:"plus-circle"}}),t._v("  "+t._s(t.$t("create_a_collection"))+" ")],1),t.show_create_collection?e("CreateCollection",{attrs:{modal_name:t.$t("create_a_collection"),path:"collections",default_folder_status:"private"},on:{close:function(o){t.show_create_collection=!1},openNew:t.openNewCollection}}):t._e()],1),e("div",{staticClass:"u-spacingBottom _searchinput"},[e("SearchInput2",{attrs:{search_placeholder:t.$t("search_in_titles")},model:{value:t.search_coll_name,callback:function(o){t.search_coll_name=o},expression:"search_coll_name"}})],1),e("div",{staticClass:"_collections"},[t.filtered_collections.length===0?e("div",{key:"nopublis",staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("no_collections"))+" ")]):t._e(),t._l(t.filtered_collections,function(o){return e("router-link",{key:o.$path,staticClass:"_collection",attrs:{to:t.getURLToFolder(o.$path)}},[e("h3",[t._v(t._s(o.title))]),e("div",{staticClass:"_collection_type"},[t._v(" "+t._s(t.$t(o.template||"story").toLowerCase())+" ")]),Array.isArray(o.$admins)?e("div",{staticClass:"u-listOfAvatars"},t._l(o.$admins,function(a,l){return e("AuthorTag",{key:a+"_"+l,attrs:{path:a,show_image_only:!0}})}),1):t._e()])})],2)])},m=[],v=r(f,h,m,!1,null,"c045c2ba");const g=v.exports,$={props:{},components:{CollectionsList:g},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{openCollection(s){this.$router.push({path:"/publish/"+s})}}};var w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_documentsView"},[e("CollectionsList",{on:{open:t.openCollection}})],1)},b=[],C=r($,w,b,!1,null,"8ddf29e7");const k=C.exports;export{k as default};
