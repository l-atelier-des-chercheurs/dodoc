import{P as $t}from"./PublicationSettings-DIeHMtor.js";import{W as yt}from"./WidthHeightField-CIgRrgzN.js";import{n as S,I as zt}from"../build.js";import{S as st}from"./SinglePage-DiGdmda6.js";import{M as St}from"./ModuleCreator-C_GEj5ST.js";import{a as xt,s as Pt,p as Ct,j,r as T,i as q,b as E,c as C,k as rt,l as N,d as O,e as Mt,G as lt,f as A,E as ct,g as H,P as Et,h as Tt,t as kt,m as G}from"./agent.esm-BHqsbQuq.js";import"./PublicationModule-DSsuMPCo.js";import"./MediaPicker-D4tDYCoF.js";import"./ResourcesPicker-B0s7t8Vv.js";import"./CaptionCreditsPage-DdRviFVp.js";import"./FlickityCarousel-BRYWTejq.js";const Rt={props:{publication:Object,is_spread:Boolean},components:{},data(){return{edit_mode:!1,is_saving:!1,can_edit:!0,top:this.publication.page_margin_top||0,bottom:this.publication.page_margin_bottom||0,left:this.publication.page_margin_left||0,right:this.publication.page_margin_right||0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{unit(){return this.publication.layout_mode==="screen"?"px":"mm"}},methods:{enableEditMode(){this.edit_mode=!0},cancel(){this.edit_mode=!1,this.is_saving=!1},async updateMargins(){this.is_saving=!0;try{const n={page_margin_top:this.top,page_margin_bottom:this.bottom,page_margin_left:this.left,page_margin_right:this.right};await this.$api.updateMeta({path:this.publication.$path,new_meta:n}),this.edit_mode=!1,this.is_saving=!1}catch(n){this.is_saving=!1,this.edit_mode=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldntbesaved")),this.$alertify.closeLogOnClick(!0).error(n.response.data)}}}};var At=function(){var t=this,i=t._self._c;return i("div",[i("fieldset",[i("legend",{staticClass:"u-label"},[t._v(t._s(t.$t("margins")))]),i("div",{staticClass:"u-instructions"},[i("small",[t._v(t._s(t.$t("margins_instructions")))])]),i("br"),t.can_edit&&!t.edit_mode?i("EditBtn",{attrs:{is_unfolded:!0},on:{click:t.enableEditMode}}):t._e(),i("br"),i("br"),i("div",{staticClass:"u-sameRow"},[i("div",{},[i("DLabel",{attrs:{str:t.$t("top")}}),i("div",{staticClass:"u-inputGroup"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.top,expression:"top",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.top},on:{input:function(e){e.target.composing||(t.top=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),i("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1),i("div",{},[i("DLabel",{attrs:{str:t.$t("bottom")}}),i("div",{staticClass:"u-inputGroup"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.bottom,expression:"bottom",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.bottom},on:{input:function(e){e.target.composing||(t.bottom=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),i("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1)]),i("br"),i("div",{staticClass:"u-sameRow"},[i("div",{},[i("DLabel",{attrs:{str:t.is_spread?t.$t("margins_inside"):t.$t("left")}}),i("div",{staticClass:"u-inputGroup"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.left,expression:"left",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.left},on:{input:function(e){e.target.composing||(t.left=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),i("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1),i("br"),i("div",{},[i("DLabel",{attrs:{str:t.is_spread?t.$t("margins_outside"):t.$t("right")}}),i("div",{staticClass:"u-inputGroup"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.right,expression:"right",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.right},on:{input:function(e){e.target.composing||(t.right=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),i("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1)]),t.edit_mode?i("div",{staticClass:"_footer"},[i("SaveCancelButtons",{staticClass:"_scb",attrs:{is_saving:t.is_saving},on:{save:t.updateMargins,cancel:t.cancel}})],1):t._e()],1)])},Ot=[],Yt=S(Rt,At,Ot,!1,null,"c63921a7");const Xt=Yt.exports,Bt={props:{publication:Object,is_spread:Boolean},components:{},data(){return{edit_mode:!1,is_saving:!1,can_edit:!0,enable_pagination:this.publication.enable_pagination||!1,pagn_starts_on_page:this.publication.pagn_starts_on_page||1,right:this.publication.pagn_right||10,bottom:this.publication.pagn_bottom||10}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{unit(){return this.publication.layout_mode==="screen"?"px":"mm"}},methods:{enableEditMode(){this.edit_mode=!0},cancel(){this.edit_mode=!1,this.is_saving=!1,this.enable_pagination=this.publication.enable_pagination,this.pagn_starts_on_page=this.publication.pagn_starts_on_page,this.right=this.publication.pagn_right||10,this.bottom=this.publication.pagn_bottom||10},async updatePagination(){this.is_saving=!0;try{const n={enable_pagination:this.enable_pagination,pagn_starts_on_page:this.pagn_starts_on_page,pagn_right:this.right,pagn_bottom:this.bottom};await this.$api.updateMeta({path:this.publication.$path,new_meta:n}),this.edit_mode=!1,this.is_saving=!1}catch(n){this.is_saving=!1,this.edit_mode=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldntbesaved")),this.$alertify.closeLogOnClick(!0).error(n.response.data)}}}};var Lt=function(){var t=this,i=t._self._c;return i("div",[i("fieldset",[i("legend",{staticClass:"u-label"},[t._v(t._s(t.$t("pagination")))]),i("div",{staticClass:"u-instructions"},[i("small",[t._v(t._s(t.$t("pagination_instructions")))]),t.is_spread?i("small",[t._v(" "+t._s(t.$t("pagination_instructions_spread")))]):t._e()]),i("br"),t.can_edit&&!t.edit_mode?i("EditBtn",{attrs:{is_unfolded:!0},on:{click:t.enableEditMode}}):t._e(),i("br"),i("br"),i("ToggleInput",{attrs:{content:t.enable_pagination,label:t.$t("enable"),disabled:!t.edit_mode},on:{"update:content":function(e){t.enable_pagination=e}}}),i("br"),i("div",{},[i("DLabel",{attrs:{str:t.$t("pagn_starts_on_page")}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.pagn_starts_on_page,expression:"pagn_starts_on_page",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.pagn_starts_on_page},on:{input:function(e){e.target.composing||(t.pagn_starts_on_page=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})],1),i("br"),i("div",{staticClass:"u-sameRow"},[i("div",{},[i("DLabel",{attrs:{str:t.is_spread?t.$t("distance_to_outside"):t.$t("distance_to_right")}}),i("div",{staticClass:"u-inputGroup"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.right,expression:"right",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.right},on:{input:function(e){e.target.composing||(t.right=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),i("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1),i("div",{},[i("DLabel",{attrs:{str:t.$t("distance_to_bottom")}}),i("div",{staticClass:"u-inputGroup"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.bottom,expression:"bottom",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.bottom},on:{input:function(e){e.target.composing||(t.bottom=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),i("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1)]),t.edit_mode?i("div",{staticClass:"_footer"},[i("SaveCancelButtons",{staticClass:"_scb",attrs:{is_saving:t.is_saving},on:{save:t.updatePagination,cancel:t.cancel}})],1):t._e()],1)])},Ht=[],Wt=S(Bt,Lt,Ht,!1,null,"d5ec9d18");const Dt=Wt.exports,It={props:{publication:Object},components:{WidthHeightField:yt,SetMargins:Xt,PaginationOption:Dt},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var Nt=function(){var t=this,i=t._self._c;return i("div",{staticClass:"_pageSettings"},[i("WidthHeightField",{attrs:{publication:t.publication}}),i("br"),i("ToggleField",{attrs:{label:t.$t("page_spreads"),field_name:"page_spreads",content:t.publication.page_spreads,path:t.publication.$path,can_edit:!0}}),i("br"),i("SetMargins",{attrs:{publication:t.publication,is_spread:t.publication.page_spreads===!0}}),i("br"),i("PaginationOption",{attrs:{publication:t.publication,is_spread:t.publication.page_spreads===!0}})],1)},Ft=[],Vt=S(It,Nt,Ft,!1,null,"a6299bd3");const Zt=Vt.exports,jt={props:{label:String,value:Number,page_modules:Array},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{list_all_z_index(){return this.page_modules.map(n=>n.z_index||0)},max_z_index(){return Math.max(...this.list_all_z_index)},min_z_index(){return Math.min(...this.list_all_z_index)}},methods:{moveToBack(){this.$emit("save",this.min_z_index-1)},moveToFront(){this.$emit("save",this.max_z_index+1)}}};var qt=function(){var t=this,i=t._self._c;return i("div",{staticClass:"_depthInput"},[t.label?i("DLabel",{attrs:{str:t.label,for:t.label}}):t._e(),i("div",{staticClass:"u-sameRow"},[i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:t.value===t.max_z_index},on:{click:t.moveToFront}},[i("b-icon",{attrs:{icon:"front"}}),t._v(" "+t._s(t.$t("move_to_front"))+" ")],1),i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:t.value===t.min_z_index},on:{click:t.moveToBack}},[i("b-icon",{attrs:{icon:"back"}}),t._v(" "+t._s(t.$t("move_to_back"))+" ")],1)])],1)},Gt=[],Ut=S(jt,qt,Gt,!1,null,"162ecdfc");const Jt=Ut.exports,Kt={props:{pages:Array,current_page_id:String},components:{},data(){return{page_id_to_move_to:void 0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{all_pages_in_select(){return this.pages.map((n,t)=>({key:n.id,text:t+1}))}},methods:{setNewPage(n){this.page_id_to_move_to=n},submit(){this.$emit("submit",this.page_id_to_move_to),this.$emit("close")}}};var Qt=function(){var t=this,i=t._self._c;return i("BaseModal2",{attrs:{title:t.$t("move_to_page")},on:{close:function(e){return t.$emit("close")}}},[i("div",{},[i("SelectField2",{attrs:{value:t.current_page_id,options:t.all_pages_in_select,can_edit:!0,hide_validation:!0},on:{change:t.setNewPage}})],1),i("template",{slot:"footer"},[i("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}},[i("b-icon",{attrs:{icon:"x-circle"}}),t._v(" "+t._s(t.$t("cancel"))+" ")],1),i("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button",autofocus:"",disabled:!t.page_id_to_move_to||t.page_id_to_move_to===t.current_page_id},on:{click:t.submit}},[t._v(" "+t._s(t.$t("move"))+" ")])])],2)},te=[],ee=S(Kt,Qt,te,!1,null,"897dc9dc");const ut=ee.exports,ie={props:{on_click:Object,pages:Array,current_page_id:String,path:String},components:{SelectPage:ut},data(){var n,t,i;return{type_of_link:((n=this.on_click)==null?void 0:n.type)||"",content_url:((t=this.on_click)==null?void 0:t.url)||"",content_page_id:((i=this.on_click)==null?void 0:i.page_id)||"",show_page_select:!1,options:[{key:"",label:this.$t("do_nothing")},{key:"url",label:this.$t("open_webpage")},{key:"page",label:this.$t("navigate_to_page")}]}},created(){},mounted(){},beforeDestroy(){},watch:{type_of_link:{handler(n,t){n==="page"&&t!=="page"&&!this.content_page_id&&(this.show_page_select=!0)}}},computed:{selected_page_id(){return this.pages.findIndex(n=>n.id===this.content_page_id)+1},active_page_number(){return this.pages.findIndex(n=>n.id===this.current_page_id)+1},allow_save(){return this.type_of_link==="page"?this.content_page_id.length>0:this.type_of_link==="url"?this.content_url.length>0:this.type_of_link===""}},methods:{linkToPage(n){this.content_page_id=n,this.show_page_select=!1},save(){let n;this.type_of_link==="url"?n={type:this.type_of_link,url:this.content_url}:this.type_of_link==="page"?n={type:this.type_of_link,page_id:this.content_page_id}:n={},this.$emit("save",{on_click:n}),this.$emit("close")}}};var ae=function(){var t=this,i=t._self._c;return i("BaseModal2",{attrs:{title:t.$t("on_click")},on:{close:function(e){return t.$emit("close")}}},[i("div",{staticClass:"u-spacingBottom"},[i("RadioCheckboxInput",{attrs:{value:t.type_of_link,options:t.options,can_edit:!0},on:{"update:value":function(e){t.type_of_link=e}}})],1),t.type_of_link==="url"?i("div",{staticClass:"_options"},[i("TextInput",{attrs:{content:t.content_url,input_type:"url",placeholder:t.$t("url_to_open")},on:{"update:content":function(e){t.content_url=e}}})],1):t.type_of_link==="page"?i("div",{staticClass:"_options"},[t._v(" "+t._s(t.$t("page_number"))+" = "),i("b",[t.selected_page_id?[t._v(" "+t._s(t.selected_page_id)+" ")]:[t._v(" "+t._s(t.$t("no_page_selected"))+" ")]],2),i("EditBtn",{attrs:{label_position:"right"},on:{click:function(e){t.show_page_select=!0}}}),t.show_page_select?i("SelectPage",{attrs:{pages:t.pages,current_page_id:t.current_page_id,allow_save:t.allow_save},on:{submit:t.linkToPage,close:function(e){t.show_page_select=!1}}}):t._e()],1):t._e(),i("SaveCancelButtons",{attrs:{slot:"footer"},on:{save:t.save,cancel:function(e){return t.$emit("close")}},slot:"footer"})],1)},oe=[],ne=S(ie,ae,oe,!1,null,"11a3ac03");const se=ne.exports,re={props:{can_edit:Boolean,pages:Array,active_page_number:Number,active_spread_index:[Boolean,Number],is_spread:Boolean,page_width:Number,page_height:Number,scale:Number,show_grid:Boolean,snap_to_grid:Boolean,grid_z_index:String,gridstep_in_mm:Number,layout_mode:{type:String,default:"print"},page_color:String,pagination:[Boolean,Object],publication_path:String,page_modules:Array,page_opened_id:String,active_module:[Boolean,Object],display_as_public:Boolean},components:{DepthInput:Jt,ModuleCreator:St,SelectPage:ut,LinkToPageOrURL:se,ImportFileZone:zt},data(){return{show_page_options:!1,show_move_to_page_modal:!1,show_edit_link_modal:!1,show_all_medias:!1,has_editor_toolbar:!1}},created(){},mounted(){this.$eventHub.$on("module.text_editing_enabled",this.displayToolbarAndToolTip),this.$eventHub.$on("module.text_editing_disabled",this.removeToolbar),this.$eventHub.$on("module.open_remove_modal",this.openRemoveModal)},beforeDestroy(){this.$eventHub.$off("module.text_editing_enabled",this.displayToolbarAndToolTip),this.$eventHub.$off("module.text_editing_disabled",this.removeToolbar),this.$eventHub.$off("module.open_remove_modal",this.openRemoveModal)},watch:{},computed:{is_last_page(){return this.active_page_number===this.pages.length-1},module_meta_filename(){return this.active_module?this.active_module.$path.substring(this.active_module.$path.lastIndexOf("/")+1):""},active_module_first_media(){return this.firstMedia(this.active_module)},first_media_ratio(){var n,t;return(t=(n=this.active_module_first_media)==null?void 0:n.$infos)==null?void 0:t.ratio},is_shape(){return this.getModuleType(this.active_module.module_type)==="shape"},unit(){return this.layout_mode==="screen"?"px":"mm"},magnification(){return this.layout_mode==="screen"?1:this.$root.page_magnification},show_caption(){return!(this.active_module.module_type==="text"||this.is_shape)},has_pagination(){return this.active_page_number-this.pagination.pagination_start_on_page>=0},active_page(){return this.pages[this.active_page_number]},hide_pagination(){return this.pages[this.active_page_number].hide_pagination===!0},new_module_meta(){const n=Math.max(...this.page_modules.map(o=>o.z_index||0))+1;let t=this.$root.default_new_module_left,i=this.$root.default_new_module_top;this.$root.set_new_module_offset_left&&(t=(this.$root.set_new_module_offset_left+this.$root.zoom_offset)/this.magnification),this.$root.set_new_module_offset_top&&(i=(this.$root.set_new_module_offset_top+this.$root.zoom_offset)/this.magnification);const e=Math.max(this.$root.default_new_module_width,this.$root.default_new_module_width/this.scale)/this.magnification,s=Math.max(this.$root.default_new_module_height,this.$root.default_new_module_height/this.scale)/this.magnification;return this.gridstep_in_mm,{page_id:this.page_opened_id,x:t,y:i,width:e,height:s,rotation:0,margins:0,opacity:1,outline_width:0,z_index:n}}},methods:{createPageAndOpen(){this.$emit("createPage"),setTimeout(()=>{this.$emit("nextPage")},500)},moveToAnotherPage(n){this.show_move_to_page_modal=!1,this.updateMediaPubliMeta({page_id:n}),this.setActive(!1)},displayToolbarAndToolTip({$toolbar:n,$tooltip:t}){this.has_editor_toolbar=!0,this.$nextTick(()=>{this.$refs.editor_toolbar&&this.$refs.editor_toolbar.append(n),this.$refs.editor_tooltip&&this.$refs.editor_tooltip.append(t)})},removeToolbar(){this.has_editor_toolbar=!1},openRemoveModal(){this.$refs.removeMenu.show_confirm_delete=!0},getPageNumberFromId(n){return this.pages.findIndex(t=>t.id===n)+1},enableModuleEdit({meta_filenames:n}){const t=n.at(-1);setTimeout(()=>{this.$eventHub.$emit(`module.enable_edit.${t}`),this.$eventHub.$emit(`module.panTo.${t}`)},150)},async setSize(n){if(n==="real_size"){const t=this.active_module.width*this.first_media_ratio;await this.updateMediaPubliMeta({height:t})}else n==="full"?await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height,x:0,y:0,rotation:0}):n==="half_left"?await this.updateMediaPubliMeta({width:this.page_width/2,height:this.page_height,x:0,y:0,rotation:0}):n==="half_right"?await this.updateMediaPubliMeta({width:this.page_width/2,height:this.page_height,x:this.page_width/2,y:0,rotation:0}):n==="half_top"?await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height/2,x:0,y:0,rotation:0}):n==="half_bottom"&&await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height/2,x:0,y:this.page_height/2,rotation:0})},changeModulePage(){this.$eventHub.$emit(`module.move.${this.module_meta_filename}`)},duplicateModule(){this.$eventHub.$emit(`module.duplicate.${this.module_meta_filename}`)},removeModule(){this.$eventHub.$emit(`module.remove.${this.module_meta_filename}`),this.$eventHub.$emit("module.setActive",!1)},setActive(n){this.$eventHub.$emit("module.setActive",n),n&&this.$nextTick(()=>{const t=this.getFilename(n);this.$eventHub.$emit(`module.panTo.${t}`)})},async updateMediaPubliMeta(n){this.active_module&&await this.$api.updateMeta({path:this.active_module.$path,new_meta:n}).catch(t=>{throw this.$alertify.delay(4e3).error(t),t})}}};var le=function(){var t=this,i=t._self._c;return i("div",{staticClass:"_pageMenu"},[i("div",{staticClass:"_pageMenu--pane"},[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}},[i("b-icon",{attrs:{icon:"grid-fill"}}),t.is_spread?[t._v(t._s(t.$t("list_of_spreads")))]:[t._v(t._s(t.$t("list_of_pages")))]],2),i("div",{staticClass:"_titleRow"},[i("button",{staticClass:"u-button u-button_transparent u-button_icon",attrs:{type:"button",disabled:t.active_page_number<=0},on:{click:function(e){return t.$emit("prevPage")}}},[i("b-icon",{attrs:{icon:"arrow-left-square"}})],1),i("div",{staticClass:"_name"},[i("transition",{attrs:{name:"slideupFade",mode:"out-in"}},[i("div",{key:t.active_page_number},[i("b",[t._v(t._s(t.$t("page"))+" "+t._s(t.active_page_number+1))])])]),i("transition",{attrs:{name:"slideupFade",mode:"out-in"}},[t.active_spread_index!==!1?i("span",{key:t.active_spread_index},[t.active_spread_index===0?[t._v(" ("+t._s(t.$t("cover"))+") ")]:[t._v(" ("+t._s(t.$t("spread").toLowerCase())+" "+t._s(t.active_spread_index+1)+") ")]],2):t._e()])],1),i("button",{staticClass:"u-button u-button_transparent u-button_icon",attrs:{type:"button",disabled:t.is_last_page},on:{click:function(e){return t.$emit("nextPage")}}},[i("b-icon",{attrs:{icon:"arrow-right-square"}})],1)]),t.is_last_page?i("div",{staticClass:"u-spacingBottom"},[i("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("last_page_reached"))+" ")]),t.can_edit?i("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:t.createPageAndOpen}},[i("b-icon",{attrs:{icon:"plus-square"}}),t._v(" "+t._s(t.$t("create_page"))+" ")],1):t._e(),i("hr")]):t._e(),i("div",{staticClass:"_scale"},[i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{can_toggle:!1,label:t.$t("scale"),value:Math.round(t.scale*100),min:10,max:200,step:1,ticks:[10,25,50,100,200],default_value:100,suffix:"%"},on:{save:function(e){return t.$emit("update:scale",e/100)}}})],1),t.can_edit?i("div",{staticClass:"u-displayAsPublic"},[i("ToggleInput",{attrs:{content:t.display_as_public,label:t.$t("preview")},on:{"update:content":function(e){return t.$emit("update:display_as_public",e)}}})],1):t._e()]),t.can_edit&&!t.display_as_public?[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.has_editor_toolbar&&!t.active_module,expression:"!has_editor_toolbar && !active_module"}],key:t.active_page_number,staticClass:"_pageMenu--pane"},[i("div",{},[i("DLabel",{attrs:{str:t.$t("add_on_page")}}),i("ModuleCreator",{attrs:{publication_path:t.publication_path,pre_addtl_meta:t.new_module_meta,context:"page_by_page",start_collapsed:!1,enable_clipboard_paste:!0},on:{addModules:t.enableModuleEdit}})],1),t.can_edit&&!t.active_module?[i("div",{staticClass:"u-spacingBottom"}),i("div",{},[t.can_edit?i("ToggledSection",{staticClass:"u-spacingBottom",attrs:{label:t.$t("show_grid"),show_toggle:t.show_grid},on:{"update:show_toggle":function(e){return t.$emit("update:show_grid",e)}}},[i("RadioCheckboxInput",{attrs:{value:t.grid_z_index,options:[{label:t.$t("over"),key:"over"},{label:t.$t("under"),key:"under"}],can_edit:!0},on:{"update:value":function(e){return t.$emit("update:grid_z_index",e)}}}),i("div",{staticClass:"u-spacingBottom"}),i("RangeValueInput",{attrs:{label:t.$t("gridstep"),can_toggle:!1,value:t.gridstep_in_mm,min:1,max:20,step:1,ticks:[5,10,20,50],default_value:10,suffix:t.unit},on:{save:function(e){return t.$emit("update:gridstep_in_mm",e)}}}),i("div",{staticClass:"u-spacingBottom"}),i("ToggleInput",{staticClass:"u-spacingBottom",attrs:{content:t.snap_to_grid,label:t.$t("snap_to_grid")},on:{"update:content":function(e){return t.$emit("update:snap_to_grid",e)}}})],1):t._e()],1),i("div",{},[i("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("page_color"),value:t.page_color},on:{save:function(e){return t.$emit("updatePageOptions",{page_number:t.active_page_number,value:{page_color:e}})}}}),i("DLabel",{attrs:{str:t.$t("format,margins,pagination")}}),i("div",{},[i("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(e){return t.$eventHub.$emit("publication.settings.toggle")}}},[i("b-icon",{attrs:{slot:"prefix",icon:"gear","aria-label":t.$t("settings")},slot:"prefix"}),t._v(" "+t._s(t.$t("settings"))+" ")],1)]),t.has_pagination?[i("div",{staticClass:"u-spacingBottom"}),i("ToggleInput",{attrs:{content:t.hide_pagination,label:t.$t("hide_pagination")},on:{"update:content":function(e){return t.$emit("updatePageOptions",{page_number:t.active_page_number,value:{hide_pagination:e}})}}})]:t._e()],2)]:t._e()],2),!t.has_editor_toolbar&&!t.active_module?i("div",{staticClass:"_pageMenu--pane"},[i("DetailsPane",{attrs:{header:t.$t("on_this_page"),icon:"images",has_items:t.page_modules.length,is_open_initially:!1,can_be_toggled:!0}},[i("div",{staticClass:"_mediaList"},t._l(t.page_modules,function(e){return i("div",{key:e.$path,staticClass:"u-sameRow",on:{click:function(s){return t.setActive(e.$path)}}},[t.getModuleType(e.module_type)==="shape"?[t._v(" "+t._s(t.$t(e.module_type))+" ")]:t.firstMedia(e)?i("MediaContent",{staticClass:"_preview",attrs:{file:t.firstMedia(e),resolution:50,context:"preview"}}):[t._v(" – ")]],2)}),0)])],1):t._e(),!t.has_editor_toolbar&&t.active_module?i("div",{key:"media-"+t.active_module.$path,staticClass:"_pageMenu--pane"},[i("DLabel",{attrs:{str:t.$t("media"),instructions:t.$t("active_media_instr")}}),t.active_module.module_type==="mosaic"&&t.active_module_first_media?i("MediaContent",{staticClass:"_activeModulePreview",attrs:{file:t.active_module_first_media,resolution:50,context:"preview"}}):t.active_module.module_type==="text"&&t.active_module_first_media?i("span",{staticClass:"u-textEllipsis u-textEllipsis_3 _textExtract"},[i("CollaborativeEditor3",{ref:"textBloc",attrs:{path:t.active_module_first_media.$path,content:t.active_module_first_media.$content,can_edit:!1}})],1):i("span",[t._v(" "+t._s(t.$t(t.active_module.module_type))+" ")]),i("div",{staticClass:"u-spacingBottom"}),i("div",{staticClass:"u-mediaOptions"},[i("div",[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(e){t.show_move_to_page_modal=!0}}},[i("b-icon",{attrs:{icon:"arrow-left-right"}}),t._v(" "+t._s(t.$t("move_to_page"))+" ")],1)]),t.show_move_to_page_modal?i("SelectPage",{attrs:{pages:t.pages,current_page_id:t.active_page.id},on:{submit:t.moveToAnotherPage,close:function(e){t.show_move_to_page_modal=!1}}}):t._e(),i("div",{},[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.duplicateModule}},[i("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("duplicate"))+" ")],1)]),i("div",{},[t.active_module.locked===!0?i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(e){return t.updateMediaPubliMeta({locked:!1})}}},[i("b-icon",{attrs:{icon:"unlock"}}),t._v(" "+t._s(t.$t("unlock"))+" ")],1):i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(e){return t.updateMediaPubliMeta({locked:!0})}}},[i("b-icon",{attrs:{icon:"lock"}}),t._v(" "+t._s(t.$t("lock"))+" ")],1)]),i("div",{},[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(e){return t.setActive(!1)}}},[i("b-icon",{attrs:{icon:"dash-square-dotted"}}),t._v(" "+t._s(t.$t("unselect"))+" ")],1)]),i("RemoveMenu",{ref:"removeMenu",attrs:{modal_title:t.$t("withdraw_from_page")},on:{remove:t.removeModule}})],1),i("div",{staticClass:"u-spacingBottom"}),t.show_caption?[i("TitleField",{attrs:{label:t.active_module.caption?t.$t("caption"):t.$t("add_caption"),field_name:"caption",input_type:"editor",custom_formats:["bold","italic","link","emoji"],content:t.active_module.caption,path:t.active_module.$path,maxlength:640,can_edit:t.can_edit}}),t.active_module_first_media&&t.active_module_first_media.caption&&!t.active_module.caption?i("div",{},[i("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("copy_first_media_caption"))+" ")]),i("button",{staticClass:"u-buttonLink _firstMediaCaption",attrs:{type:"button"},domProps:{innerHTML:t._s(t.$sanitize(t.active_module_first_media.caption))},on:{click:function(e){return t.updateMediaPubliMeta({caption:t.active_module_first_media.caption})}}})]):t._e(),i("div",{staticClass:"u-spacingBottom"})]:t._e(),i("div",[i("DLabel",{attrs:{str:t.$t("on_click")}}),i("div",[t.active_module.on_click&&t.active_module.on_click.type==="url"&&t.active_module.on_click.url?[t._v(" "+t._s(t.$t("open_webpage"))+" "),i("br"),i("b",[t._v(t._s(t.active_module.on_click.url))])]:t.active_module.on_click&&t.active_module.on_click.type==="page"&&t.active_module.on_click.page_id?[t._v(" "+t._s(t.$t("navigate_to_page"))+" "),i("br"),i("b",[t._v(t._s(t.getPageNumberFromId(t.active_module.on_click.page_id)))])]:[t._v(" "+t._s(t.$t("do_nothing"))+" ")],i("EditBtn",{attrs:{label_position:"left"},on:{click:function(e){t.show_edit_link_modal=!0}}})],2),t.show_edit_link_modal?i("LinkToPageOrURL",{attrs:{path:t.active_module.$path,on_click:t.active_module.on_click,pages:t.pages,current_page_id:t.active_page.id},on:{save:t.updateMediaPubliMeta,close:function(e){t.show_edit_link_modal=!1}}}):t._e()],1),i("div",{staticClass:"u-spacingBottom"}),i("div",{staticClass:"u-sameRow"},[i("NumberInput",{attrs:{label:t.$t("position")+" →",value:t.active_module.x,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({x:e})}}}),i("NumberInput",{attrs:{label:t.$t("position")+" ↓",value:t.active_module.y,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({y:e})}}})],1),i("div",{staticClass:"u-sameRow"},[i("NumberInput",{attrs:{label:t.$t("width")+" ↔",value:t.active_module.width,min:0,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({width:e})}}}),i("NumberInput",{attrs:{label:t.$t("height")+" ↕",value:t.active_module.height,min:0,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({height:e})}}})],1),i("div",{staticClass:"_setSizeBtn"},[t.first_media_ratio?i("button",{staticClass:"u-button_icon",attrs:{type:"button",title:t.$t("real_size")},on:{click:function(e){return t.setSize("real_size")}}},[i("b-icon",{attrs:{icon:"slash-square-fill",rotate:"90","aria-label":t.$t("real_size")}})],1):t._e(),i("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(e){return t.setSize("full")}}},[i("b-icon",{attrs:{icon:"square-fill","aria-label":t.$t("full_page")}})],1),i("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(e){return t.setSize("half_left")}}},[i("b-icon",{attrs:{icon:"square-half"}})],1),i("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(e){return t.setSize("half_right")}}},[i("b-icon",{attrs:{icon:"square-half",rotate:"180"}})],1),i("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(e){return t.setSize("half_top")}}},[i("b-icon",{attrs:{icon:"square-half",rotate:"90"}})],1),i("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(e){return t.setSize("half_bottom")}}},[i("b-icon",{attrs:{icon:"square-half",rotate:"270"}})],1)]),i("div",{staticClass:"u-spacingBottom"}),i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("angle"),value:t.active_module.rotation,min:0,max:360,step:1,ticks:[0,90,180,270,360],default_value:0,suffix:"°"},on:{save:function(e){return t.updateMediaPubliMeta({rotation:e})}}}),i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("margins"),value:t.active_module.margins,min:0,max:50,step:1,default_value:0,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({margins:e})}}}),t.active_module.module_type!=="ellipsis"?i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("border_radius"),value:t.active_module.border_radius,min:0,max:50,step:1,default_value:0,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({border_radius:e})}}}):t._e(),i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("drop_shadow"),value:t.active_module.drop_shadow?t.active_module.drop_shadow*100:void 0,min:0,max:100,step:1,ticks:[0,25,50,75,100],default_value:0,suffix:"%"},on:{save:function(e){return t.updateMediaPubliMeta({drop_shadow:e/100})}}}),i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("opacity"),value:Math.round(t.active_module.opacity*100),min:1,max:100,step:1,ticks:[1,25,50,75,100],default_value:100,suffix:"%"},on:{save:function(e){return t.updateMediaPubliMeta({opacity:e/100})}}}),i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("blur"),value:t.active_module.blur||0,min:0,max:10,step:.5,ticks:[0,1,2,3,4,5,6,7,8,9,10],default_value:0,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({blur:e})}}}),i("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("background_color"),value:t.active_module.background_color,allow_transparent:!0,default_value:t.is_shape?"transparent":""},on:{save:function(e){return t.updateMediaPubliMeta({background_color:e})}}}),i("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("outline_width"),value:t.active_module.outline_width,min:0,max:20,step:1,ticks:[0,5,10,15,20],default_value:0,suffix:t.unit},on:{save:function(e){return t.updateMediaPubliMeta({outline_width:e})}}}),t.active_module.outline_width>0?i("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("outline_color"),value:t.active_module.outline_color,allow_transparent:!0,default_value:"#000000"},on:{save:function(e){return t.updateMediaPubliMeta({outline_color:e})}}}):t._e(),t.active_module_first_media&&t.active_module_first_media.$type==="image"?i("ToggleInput",{staticClass:"u-spacingBottom",attrs:{content:t.active_module.show_fs_button,label:t.$t("show_fs_button")},on:{"update:content":function(e){return t.updateMediaPubliMeta({show_fs_button:e})}}}):t._e(),i("DepthInput",{attrs:{label:t.$t("z_index"),value:t.active_module.z_index,page_modules:t.page_modules},on:{save:function(e){return t.updateMediaPubliMeta({z_index:e})}}})],2):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:t.has_editor_toolbar,expression:"has_editor_toolbar"}],key:"text-toolbar-"+t.active_page_number,staticClass:"_pageMenu--pane"},[i("div",{ref:"editor_toolbar",staticClass:"_editorToolbar"}),i("div",{ref:"editor_tooltip",staticClass:"_editorToolbar"})])]:t._e()],2)},ce=[],ue=S(re,le,ce,!1,null,"89847e17");const _e=ue.exports;var F=function(n,t){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])},F(n,t)};function V(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");F(n,t);function i(){this.constructor=n}n.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var z=function(){return z=Object.assign||function(t){for(var i,e=1,s=arguments.length;e<s;e++){i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},z.apply(this,arguments)};function de(n,t,i,e){var s=arguments.length,o=s<3?t:e===null?e=Object.getOwnPropertyDescriptor(t,i):e,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,i,e);else for(var r=n.length-1;r>=0;r--)(a=n[r])&&(o=(s<3?a(o):s>3?a(t,i,o):a(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}function U(n,t,i){if(i||arguments.length===2)for(var e=0,s=t.length,o;e<s;e++)(o||!(e in t))&&(o||(o=Array.prototype.slice.call(t,0,e)),o[e]=t[e]);return n.concat(o||Array.prototype.slice.call(t))}var pe=xt(),he=pe.browser.name==="safari",k="infinite-viewer-",J="".concat(k,"wrapper"),K="".concat(k,"scroll-area"),ge="".concat(k,"scroll-bar"),_t="".concat(k,"horizontal-scroll-bar"),dt="".concat(k,"vertical-scroll-bar"),Q="".concat(k,"scroll-thumb"),pt=Pt(Ct(k,`
{
    position: relative;
    overscroll-behavior: none;
}
.wrapper {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: auto;
    scrollbar-width: none;
    top: 0;
    left: 0;
    will-change: scroll-position;
}
.restrict-wrapper {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
}
.wrapper::-webkit-scrollbar {
    display: none;
}
.scroll-area {
    position:absolute;
    top:0;
    left:0;
    transform-origin: 0 0;
}
.scroll-bar {
    position:absolute;
    width: 10px;
    height: 10px;
    box-sizing: border-box;
    right: 0;
    bottom: 0;
    overflow: hidden;
}
.horizontal-scroll-bar {
    width: calc(100% - 20px);
    right: 10px;
    height: 14px;
}
.vertical-scroll-bar {
    height: calc(100% - 20px);
    bottom: 10px;
    width: 14px;
}
.scroll-thumb {
    position:relative;
    opacity: 0.7;
    background: #333;
    border-radius: 3px;
    left: 0px;
    top: 0px;
    z-index: 10;
    width: 6px;
    height: 6px;
    transition: all ease 0.2s;
    opacity: 0;
}
.scroll-bar:hover .scroll-thumb {
    border-radius: 5px;
    opacity: 1;
}
.horizontal-scroll-bar .scroll-thumb {
    margin: 4px 0px;
    transition-property: opacity, margin, height, border-radius;
}
.vertical-scroll-bar .scroll-thumb {
    margin: 0px 4px;
    transition-property: opacity, margin, width, border-radius;
}
.horizontal-scroll-bar:hover .scroll-thumb {
    height: 10px;
    margin: 2px 0px;
}
.vertical-scroll-bar:hover .scroll-thumb {
    width: 10px;
    margin: 0px 2px;
}
`)),$={margin:500,threshold:100,zoom:1,zoomX:1,zoomY:1,rangeX:[-1/0,1/0],rangeY:[-1/0,1/0],rangeOffsetX:[0,0],rangeOffsetY:[0,0],wrapperElement:null,scrollAreaElement:null,horizontalScrollElement:null,verticalScrollElement:null,usePinch:!1,useAutoZoom:!1,useMouseDrag:!1,pinchThreshold:30,cspNonce:"",maxPinchWheel:1/0,wheelScale:.01,displayHorizontalScroll:!0,displayVerticalScroll:!0,useTransform:!0,useWheelPinch:!0,zoomRange:[.001,1/0],wheelPinchKey:"ctrl",useWheelScroll:he,zoomOffsetX:"50%",zoomOffsetY:"50%",translateZ:0,useGesture:!0,useResizeObserver:!1,pinchDirection:"all",preventWheelClick:!0,useBounceScrollBar:!1,useOverflowScroll:!1},tt=function(n){return 1-Math.pow(1-n,3)},et={horizontal:{pos:"Left",coord:"X",size:"Width"},vertical:{pos:"Top",coord:"Y",size:"Height"}},me=pt.className,Z=["margin","threshold","zoomOffsetX","zoomOffsetY","zoom","zoomX","zoomY","rangeX","rangeY","rangeOffsetX","rangeOffsetY","usePinch","useMouseDrag","pinchThreshold","maxPinchWheel","wheelScale","displayVerticalScroll","displayHorizontalScroll","translateZ","useAutoZoom","wheelPinchKey","zoomRange","zoomRangeX","zoomRangeY","pinchDirection","useOverflowScroll"],it=U(U([],Z,!0),["preventWheelClick","useWheelPinch","useWheelScroll","useGesture","cspNonce","wrapperElement","scrollAreaElement","verticalScrollElement","horizontalScrollElement","useResizeObserver","wheelContainer","useBounceScrollBar"],!1),fe=["scroll","abortPinch","dragStart","dragEnd","pinchStart","pinch"],ve=["getScrollLeft","getScrollTop","getScrollWidth","getScrollHeight","getContainerWidth","getContainerHeight","getViewportWidth","getViewportHeight","getViewportScrollWidth","getViewportScrollHeight","scrollTo","scrollBy","zoomBy","scrollCenter","getContainer","getViewport","getWrapper","setZoom","getRangeX","getRangeY","resize","getZoom","getZoomX","getZoomY","getWheelContainer","setTo","setBy"],be=1e-6;function we(n){var t=n.deltaX,i=n.deltaY,e=n.datas,s=Date.now(),o=e.speed;if(!o){e.speed=[0,0],e.time=s;return}var a=s-e.time;e.speed=[o[0]/2+t/a,o[1]/2+i/a]}function ht(n,t){var i=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return Math.abs(i/t)}function $e(n,t){var i=ht(n,t);return[-n[0]/2*i,-n[1]/2*i]}function P(n){return Math.abs(n)}function ye(n,t,i,e,s){var o=s||isFinite(i[0])?i[0]:Math.min(-1,Math.floor(n/t))*t-e,a=s||isFinite(i[1])?i[1]:Math.max(1,Math.ceil(n/t))*t+e;return[o,a]}function at(n,t){return n??t}function ot(n,t,i){var e=i.duration,s=i.easing||function(c){return 1-Math.pow(1-c,3)},o=Date.now(),a=o,r=function(){var c=Date.now(),_=c-o;e<_&&(_=e);var u=s(_/e),l=s((a-o)/e);a=c,n(u-l),!(_>=e)&&t(r)};t(r)}var nt=function(n){V(t,n);function t(e,s,o){var a=n.call(this)||this;a.type=s,a.isAppend=!1,a.size=0,a.scrollSize=0,a.isHorizontal=!1,a._onDragStart=function(l){var d=a.isHorizontal,f=l.inputEvent.target,g=l.datas,m=a.thumbElement===f;m||setTimeout(function(){requestAnimationFrame(function(){var h=a.thumbElement.getBoundingClientRect(),v=h[d?"left":"top"],p=h[d?"width":"height"],b=v+p,w=l[d?"clientX":"clientY"];if(!(v<=w&&w<=b)){var y=a.size,x=y*y/a.scrollSize;a.scrollBy(v<w?x:-x)}})},100),g.isThumb=m,l.inputEvent.stopPropagation(),l.inputEvent.preventDefault()},a._onDrag=function(l){l.datas.isThumb&&a.scrollBy(a.isHorizontal?l.deltaX:l.deltaY)},a._onWheel=function(l){var d=a.isHorizontal?l.deltaX:l.deltaY;d&&l.preventDefault(),a.trigger("scroll",{delta:d})};var r=s==="horizontal",c=rt(e),_,u=o;return o?_=o.querySelector(".".concat(Q)):(u=c.createElement("div"),_=c.createElement("div"),u.insertBefore(_,null),a.isAppend=!0),O(u,r?_t:dt),O(u,ge),O(_,Q),a.thumbElement=_,a.barElement=u,a.isHorizontal=r,a.gesto=new lt(u,{container:N(c)}).on("dragStart",function(l){return a._onDragStart(l)}).on("drag",function(l){return a._onDrag(l)}),A(a.barElement,"wheel",a._onWheel,{passive:!1}),a}var i=t.prototype;return i.scrollBy=function(e,s){var o=e/this.size;this.trigger("scroll",{delta:s?e:this.scrollSize*o})},i.render=function(e,s,o,a){this.size=o,this.scrollSize=a;var r=e&&kt(a-o,.001)>0?1:0,c=this.isHorizontal?["X","width"]:["Y","height"],_=c[0],u=c[1],l=o/a*100,d=Math.max(0,s)/a*100;this.thumbElement.style.cssText+="".concat(u,": ").concat(l,"%;opacity: ").concat(r,";")+"transform: translate".concat(_,"(").concat(100/l*d,"%)")},i.destroy=function(){T(this.barElement,"wheel",this._onWheel),this.gesto.off(),this.off()},t}(ct),ze=function(n){V(t,n);function t(e,s,o){s===void 0&&(s={}),o===void 0&&(o={});var a=n.call(this)||this;return a._containerElement=e,a.offsetX=0,a.offsetY=0,a.containerWidth=0,a.containerHeight=0,a.viewportWidth=0,a.viewportHeight=0,a.viewportScrollWidth=0,a.viewportScrollHeight=0,a.scrollLeft=0,a.scrollTop=0,a._scrollTimer=0,a._zoomTimer=0,a._viewportElement=null,a._wheelContainerElement=null,a.dragFlag=!1,a.isLoop=!1,a._tempScale=[1,1],a._tempRect=null,a._tempRectTimer=null,a._onDestroys=[],a._asLeft=0,a._asTop=0,a.resize=function(){var r=a._containerElement,c=r.offsetWidth,_=r.offsetHeight,u=a._viewportElement,l=u.offsetWidth,d=u.offsetHeight,f=u.scrollWidth,g=u.scrollHeight;a.containerWidth=c,a.containerHeight=_,a.viewportWidth=l,a.viewportHeight=d,a.viewportScrollWidth=Math.max(l,f),a.viewportScrollHeight=Math.max(d,g),a.render(),a._scrollBy(0,0)},a._onScroll=function(){var r=a.wrapperElement,c=r.scrollLeft,_=r.scrollTop,u=a.zoom,l=u===void 0?$.zoom:u,d=c-a.scrollLeft,f=_-a.scrollTop,g=a.getScrollLeft(),m=a.getScrollTop();a.isLoop&&(a.isLoop=!1),a.scrollLeft=c,a.scrollTop=_,a.scrollTo(g+d/l,m+f/l)},a.onWheel=function(r){var c=a.options,_=c.pinchDirection,u=c.maxPinchWheel||1/0,l=r["".concat(a.wheelPinchKey,"Key")]||r.ctrlKey;if(c.useWheelPinch&&l){var d=r.deltaY,f=d>=0?1:-1,g=Math.min(u,Math.abs(d));d=f*g;var m=-d,h=Math.max(1+m*(c.wheelScale||.01),be);clearTimeout(a._tempRectTimer),a._tempRectTimer=window.setTimeout(function(){a._tempRect=null},100),a._triggerPinch({distance:g,scale:h,rotation:0,zoom:a.zoom*h,zoomX:a.zoomX*(_==="vertical"?1:h),zoomY:a.zoomY*(_==="horizontal"?1:h),inputEvent:r,isWheel:!0,clientX:r.clientX,clientY:r.clientY,ratioX:0,ratioY:0})}else if(c.useWheelScroll){var v=r.deltaX,d=r.deltaY;r.shiftKey&&!v&&(v=d,d=0),a.scrollBy(v/a.zoomX,d/a.zoomY)}else return;r.preventDefault()},a.onGestureStart=function(r){a._tempScale=[a.zoomX,a.zoomY],a._setClientRect(),r.preventDefault()},a.onGestureChange=function(r){if(r.preventDefault(),a.gesto.isFlag()||!a._tempScale){a._tempScale=[1,1];return}var c=r.scale,_=a._tempScale[0],u=a._tempScale[1],l=a.options.pinchDirection;a._triggerPinch({distance:0,scale:c,rotation:r.rotation,inputEvent:r,isWheel:!0,zoom:(_+u)*c/2,zoomX:_*(l==="vertical"?1:c),zoomY:u*(l==="horizontal"?1:c),clientX:r.clientX,clientY:r.clientY,ratioX:0,ratioY:0})},a.onGestureEnd=function(){},j(s)?(a._viewportElement=s,a.options=z(z({},$),o)):(a._viewportElement=e.children[0],a.options=z(z({},$),s)),a.init(),a}var i=t.prototype;return i.getContainer=function(){return this._containerElement},i.getWheelContainer=function(){return this._wheelContainerElement},i.getViewport=function(){return this._viewportElement},i.getWrapper=function(){return this.wrapperElement},i.geScrollArea=function(){return this.scrollAreaElement},i.destroy=function(){this.off(),this.gesto.unset(),this.verticalScrollbar.destroy(),this.horizontalScrollbar.destroy(),this.injectResult.destroy();var e=this._containerElement;this._onDestroys.forEach(function(s){s()}),T(this.wrapperElement,"scroll",this._onScroll),T(this._wheelContainerElement,"wheel",this.onWheel),T(e,"gesturestart",this.onGestureStart),T(e,"gesturechange",this.onGestureChange),T(e,"gesturesend",this.onGestureEnd),this.gesto=null,this.injectResult=null,this._containerElement=null,this._viewportElement=null,this.options=null},i.getScrollTop=function(e){e===void 0&&(e={});var s=!1,o=!1;q(e)?(s=e.range,o=e.absolute):s=e;var a=this.zoomY,r=this.scrollTop/a+this.offsetY+(s?P(this.getRangeY()[0]):0);return o?r*a:r},i.getScrollLeft=function(e){e===void 0&&(e={});var s=!1,o=!1;q(e)?(s=e.range,o=e.absolute):s=e;var a=this.zoomX,r=this.scrollLeft/a+this.offsetX+(s?P(this.getRangeX()[0]):0);return o?r*a:r},i.getScrollWidth=function(e){var s=this._getScrollRangeX(),o=this.zoomX,a=this.containerWidth/o+P(s[0])+s[1];return e?a:a*o},i.getScrollHeight=function(e){var s=this._getScrollRangeY(),o=this.zoomY,a=this.containerHeight/o+P(s[0])+s[1];return e?a:a*o},i.scrollCenter=function(e){e===void 0&&(e={}),this.resize();var s=this.zoomX,o=this.zoomY,a=-(this.containerWidth/s-this.viewportWidth)/2,r=-(this.containerHeight/o-this.viewportHeight)/2;return e.absolute&&(a*=s,r*=o),e.horizontal===!1&&(a=this.getScrollLeft()),e.vertical===!1&&(r=this.getScrollTop()),this.scrollTo(a,r,e)},i.setTo=function(e){var s=e.x,o=s===void 0?this.getScrollLeft():s,a=e.y,r=a===void 0?this.getScrollTop():a,c=e.zoom,_=c===void 0?[this.getZoomX(),this.getZoomY()]:c,u=e.duration,l=this,d=l.zoomX,f=l.zoomY,g=l.zoomRange,m=this,h=m.zoomOffsetX,v=h===void 0?$.zoomOffsetX:h,p=m.zoomOffsetY,b=p===void 0?$.zoomOffsetY:p;"zoomOffsetX"in e&&(v=e.zoomOffsetX),"zoomOffsetY"in e&&(b=e.zoomOffsetY);var w=H(_)?_:[_,_],y=w[0],x=w[1],Y=this.zoomRangeX||g,M=this.zoomRangeY||g,R=E(y,Y[0],Y[1]),X=E(x,M[0],M[1]),D=C("".concat(v),this.viewportWidth)*(1/d-1/R),I=C("".concat(b),this.viewportHeight)*(1/f-1/X);this.scrollTo(o-D,r-I,{duration:u}),this.setZoom(_,{zoomOffsetX:v,zoomOffsetY:b,duration:u,zoomBase:"fixed"})},i.setBy=function(e){var s=e.x,o=s===void 0?0:s,a=e.y,r=a===void 0?0:a,c=e.zoom,_=c===void 0?[0,0]:c,u=H(_)?_:[_,_],l=u[0],d=u[1];this.setTo(z(z({},e),{x:this.getScrollLeft()+o,y:this.getScrollTop()+r,zoom:[this.zoomX+l,this.zoomY+d]}))},i.scrollBy=function(e,s,o){if(this._pauseScrollAnimation(),!o||!o.duration){var a=this.getScrollLeft(),r=this.getScrollTop();return o!=null&&o.absolute&&(a*=this.zoomX,r*=this.zoomY),this._scrollTo(a+e,r+s,o)}else return this._startScrollAnimation([e,s],o),!0},i.scrollTo=function(e,s,o){if(this._pauseScrollAnimation(),!o||!o.duration)return this._scrollTo(e,s,o);var a=this.getScrollLeft(),r=this.getScrollTop();return o!=null&&o.absolute&&(a*=this.zoomX,r*=this.zoomY),this.scrollBy(e-a,s-r,o)},i.zoomBy=function(e,s){this._pauseZoomAnimation();var o=H(e)?e:[e,e],a=o[0],r=o[1];!s||!s.duration?this._setZoom([this.zoomX+a,this.zoomY+r],s):this._startZoomAnimation([a,r],s)},i.setZoom=function(e,s){if(this._pauseZoomAnimation(),!s||!s.duration)this._setZoom(e,s);else{var o=H(e)?e:[e,e],a=o[0],r=o[1];this._startZoomAnimation([a-this.zoomX,r-this.zoomY],s)}},i.getViewportWidth=function(){return this.viewportWidth},i.getViewportHeight=function(){return this.viewportWidth},i.getViewportScrollWidth=function(){return this.viewportScrollWidth},i.getViewportScrollHeight=function(){return this.viewportScrollHeight},i.getContainerWidth=function(){return this.containerWidth},i.getContainerHeight=function(){return this.containerHeight},i.getZoom=function(){return(this.zoomX+this.zoomY)/2},i.getZoomX=function(){return this.zoomX},i.getZoomY=function(){return this.zoomY},i.getRangeX=function(e,s){return this._getRangeCoord("horizontal",e,s)},i.getRangeY=function(e,s){return this._getRangeCoord("vertical",e,s)},i.init=function(){var e=this,s,o=this._containerElement,a=this.options,r=rt(o),c=N(o),_=a.wrapperElement||o.querySelector(".".concat(J)),u=a.scrollAreaElement||o.querySelector(".".concat(K)),l=a.horizontalScrollElement||o.querySelector(".".concat(_t)),d=a.verticalScrollElement||o.querySelector(".".concat(dt));_||(_=r.createElement("div"),_.insertBefore(this._viewportElement,null),o.insertBefore(_,null)),this.wrapperElement=_,u||(u=r.createElement("div"),_.insertBefore(u,_.firstChild)),this.scrollAreaElement=u,O(o,me),O(_,J),O(u,K);var f=new nt(o,"horizontal",l),g=new nt(o,"vertical",d);this.horizontalScrollbar=f,this.verticalScrollbar=g,f.on("scroll",function(p){e.scrollBy(p.delta/e.zoomX,0)}),g.on("scroll",function(p){e.scrollBy(0,p.delta/e.zoomY)}),f.isAppend&&o.insertBefore(f.barElement,null),g.isAppend&&o.insertBefore(g.barElement,null),this.injectResult=pt.inject(o,{nonce:this.options.cspNonce});var m=a.wheelContainer,h=null;if(m&&(Mt(m)?h=r.querySelector(m):j(m)?h=m:("value"in m||"current"in m)&&(h=m.current||m.value)),h||(h=o),this._wheelContainerElement=h,this.gesto=new lt(o,{container:N(o),events:["touch","mouse"],preventWheelClick:(s=this.options.preventWheelClick)!==null&&s!==void 0?s:!0}).on("dragStart",function(p){var b=p.inputEvent,w=p.stop,y=p.datas;if(!e.useMouseDrag&&p.isMouseEvent){w();return}e._pauseScrollAnimation(),e.dragFlag=!1;var x=e.trigger("dragStart",p);if(x===!1){w();return}b.preventDefault(),y.startEvent=b}).on("drag",function(p){!e.options.usePinch||p.isPinch||e.useMouseDrag&&p.isMouseEvent?(e.trigger("drag",z(z({},p),{inputEvent:p.inputEvent})),we(p),e.scrollBy(-p.deltaX/e.zoomX,-p.deltaY/e.zoomY)):!e.dragFlag&&p.movement>a.pinchThreshold&&(e.dragFlag=!0,e.trigger("abortPinch",{inputEvent:p.datas.startEvent||p.inputEvent}))}).on("dragEnd",function(p){e.trigger("dragEnd",{isDrag:p.isDrag,isDouble:p.isDouble,inputEvent:p.inputEvent}),e._startScrollAnimationBySpeed(p.datas.speed)}).on("pinchStart",function(p){var b=p.inputEvent,w=p.datas,y=p.stop;b.preventDefault(),e._pauseScrollAnimation(),w.startZoom=[e.zoomX,e.zoomY];var x=e.trigger("pinchStart",{inputEvent:b});x===!1&&y(),e._setClientRect()}).on("pinch",function(p){var b=p.scale,w=e.options.pinchDirection;e._triggerPinch({rotation:p.rotation,distance:p.distance,scale:p.scale,inputEvent:p.inputEvent,isWheel:!1,zoom:p.datas.startZoom*b,zoomX:e.zoomX*(w==="vertical"?1:b),zoomY:e.zoomY*(w==="horizontal"?1:b),clientX:p.clientX,clientY:p.clientY,ratioX:0,ratioY:0})}).on("pinchEnd",function(){e._tempRect=null}),A(_,"scroll",this._onScroll),a.useResizeObserver){var v=new c.ResizeObserver(function(){e.resize()});v.observe(this._viewportElement),v.observe(this._containerElement),this._onDestroys.push(function(){v.disconnect()})}else A(c,"resize",this.resize),this._onDestroys.push(function(){T(c,"resize",e.resize)});(a.useWheelPinch||a.useWheelScroll)&&A(h,"wheel",this.onWheel,{passive:!1}),a.useGesture&&(A(o,"gesturestart",this.onGestureStart,{passive:!1}),A(o,"gesturechange",this.onGestureChange,{passive:!1})),this.resize()},i.render=function(){var e=this,s=e.offsetX,o=e.offsetY,a=e.zoomX,r=a===void 0?$.zoomX:a,c=e.zoomY,_=c===void 0?$.zoomY:c,u=e.translateZ,l=u===void 0?0:u;e.rangeX,e.rangeY,e.containerWidth,e.containerHeight;var d=this.options.useTransform,f=d===void 0?$.useTransform:d,g=-s*r,m=-o*_;this.scrollAreaElement.style.cssText="width:calc(100% + ".concat(this.getScrollAreaWidth(),"px);")+"height:calc(100% + ".concat(this.getScrollAreaHeight(),"px);");var h=this._viewportElement.style;f===!1?h.cssText+="position: relative; left: ".concat(g,"px; top: ").concat(m,"px; "):h.cssText+="transform-origin: 0 0;"+"transform:translate3d(".concat(g,"px, ").concat(m,"px, ").concat(l,"px) scale(").concat(r,", ").concat(_,");"),this.renderScroll()},i.renderScroll=function(){var e=this,s=e.zoomX,o=e.zoomY,a=e.containerWidth,r=e.containerHeight,c=this.horizontalScrollbar,_=this.verticalScrollbar;if(this.options.useBounceScrollBar){var u=this.getScrollLeft(!0)*s,l=this.getRangeX(!0),d=a+P(l[0])+P(l[1]),f=this.getScrollTop(!0)*o,g=this.getRangeY(!0),m=r+P(g[0])+P(g[1]);c.render(this.displayHorizontalScroll,u,a,d),_.render(this.displayVerticalScroll,f,r,m)}else{var h=this._getScrollRangeX(),v=this._getScrollRangeY(),u=this.getScrollLeft(),f=this.getScrollTop(),d=this.containerWidth+P(h[0])+h[1],m=this.containerHeight+P(v[0])+v[1];c.render(this.displayHorizontalScroll,u-h[0],a,d),_.render(this.displayVerticalScroll,f-v[0],r,m)}},i.move=function(e,s){var o=this.wrapperElement;o.scrollLeft=e,o.scrollTop=s},i.setDisplayVerticalScroll=function(e){this.options.displayVerticalScroll=e,this.renderScroll()},i.setDisplayHorizontalScroll=function(e){this.options.displayHorizontalScroll=e,this.renderScroll()},i._startZoomAnimation=function(e,s){var o=this;if(e){var a=s.duration,r=s.easing||tt;ot(function(c){return o._setZoom([o.zoomX+e[0]*c,o.zoomY+e[1]*c],s)},function(c){o._zoomTimer=requestAnimationFrame(c)},{easing:r,duration:a})}},i._startScrollAnimation=function(e,s){var o=this;if(!(!e[0]&&!e[1])){var a=s.duration,r=s.easing||tt;ot(function(c){return o._scrollBy(e[0]*c,e[1]*c,s)},function(c){o._scrollTimer=requestAnimationFrame(c)},{easing:r,duration:a})}},i._startScrollAnimationBySpeed=function(e){if(!(!e||!e[0]&&!e[1])){var s=-6e-4,o=ht(e,s),a=$e(e,s);return this._startScrollAnimation(a,{duration:o})}},i._pauseScrollAnimation=function(){cancelAnimationFrame(this._scrollTimer),this._scrollTimer=0},i._pauseZoomAnimation=function(){cancelAnimationFrame(this._zoomTimer),this._zoomTimer=0},i.getScrollAreaWidth=function(){var e=this.getRangeX(!0),s=e[0],o=e[1];return s||o?this.margin*2:0},i.getScrollAreaHeight=function(){var e=this.getRangeY(!0),s=e[0],o=e[1];return s||o?this.margin*2:0},i._triggerPinch=function(e){var s=e.clientX,o=e.clientY,a=e.zoomX,r=e.zoomY;this.useAutoZoom&&this._zoomByClient([a,r],s,o),this._tempRect||this._setClientRect();var c=this.zoomRange,_=this.zoomRangeX||c,u=this.zoomRangeY||c,l=this._tempRect,d=l.left,f=l.top,g=l.width,m=l.height,h=(s-d)/g*100,v=(o-f)/m*100;this.trigger("pinch",z(z({},e),{zoom:E((a+r)/2,c[0],c[1]),zoomX:E(a,_[0],_[1]),zoomY:E(r,u[0],u[1]),ratioX:h,ratioY:v}))},i._setClientRect=function(){var e=this.getContainer().getBoundingClientRect();this._tempRect={left:e.left,top:e.top,width:e.width,height:e.height}},i._zoomByClient=function(e,s,o){this._tempRect||this._setClientRect();var a=this._tempRect,r=a.left,c=a.top,_=a.width,u=a.height,l=this.options,d=l.zoomOffsetX,f=l.zoomOffsetY;l.zoomOffsetX="".concat((s-r)/_*100,"%"),l.zoomOffsetY="".concat((o-c)/u*100,"%"),this._setZoom(e,{zoomBase:"screen"}),l.zoomOffsetX=d,l.zoomOffsetY=f},i._setZoom=function(e,s){s===void 0&&(s={});var o=s.zoomBase,a=this,r=a.containerWidth,c=a.containerHeight,_=a.zoomX,u=a.zoomY,l=a.zoomRange,d=this,f=d.zoomOffsetX,g=f===void 0?$.zoomOffsetX:f,m=d.zoomOffsetY,h=m===void 0?$.zoomOffsetY:m;"zoomOffsetX"in s&&(g=s.zoomOffsetX),"zoomOffsetY"in s&&(h=s.zoomOffsetY);var v=this.getScrollLeft(),p=this.getScrollTop(),b=H(e)?e:[e,e],w=b[0],y=b[1],x=this.zoomRangeX||l,Y=this.zoomRangeY||l,M=E(w,x[0],x[1]),R=E(y,Y[0],Y[1]),X=this.options;X.zoomX=M,X.zoomY=R,X.zoom=(M+R)/2;var D=this.getScrollLeft(),I=this.getScrollTop(),B=0,L=0;o==="fixed"?(B=C("".concat(g),this.viewportWidth),L=C("".concat(h),this.viewportHeight)):o==="viewport"?(B=(-v+C("".concat(g),this.viewportWidth))*_,L=(-p+C("".concat(h),this.viewportHeight))*u):(B=C("".concat(g),r),L=C("".concat(h),c));var ft=v+B/_,vt=p+L/u,bt=D+B/M,wt=I+L/R;this._scrollBy(ft-bt,vt-wt,{zoom:!!(M-_||R-u)}),this.render()},i._scrollBy=function(e,s,o){var a=this.getScrollLeft(),r=this.getScrollTop();return o!=null&&o.absolute&&(a*=this.zoomX,r*=this.zoomY),this._scrollTo(a+e,r+s,o)},i._scrollTo=function(e,s,o){var a=this,r=this,c=r.scrollLeft,_=r.scrollTop,u=o==null?void 0:o.absolute;this._scrollToType("horizontal",e,u),this._scrollToType("vertical",s,u);var l=this.scrollLeft,d=this.scrollTop;this.render();var f=this.getScrollLeft(),g=this.getScrollTop();return this._emitScrollEvent(f,g,o==null?void 0:o.zoom),Math.round(c)!==l||Math.round(_)!==d?(this.isLoop=!0,this.move(l,d),requestAnimationFrame(function(){if(a.isLoop){a.isLoop=!1;var m=a.wrapperElement,h=m.scrollLeft,v=m.scrollTop;a.scrollLeft=h,a.scrollTop=v,(l!==Math.round(h)||d!==Math.round(v))&&a._scrollTo(f,g)}}),!1):!0},i._scrollToType=function(e,s,o){var a=et[e],r=this,c=r.margin,_=c===void 0?$.margin:c,u=r.threshold,l=u===void 0?$.threshold:u,d=this["scroll".concat(a.pos)],f=this["getRange".concat(a.coord)](!0,!0),g=f[0],m=f[1],h=Math.round(d),v=this["getScrollArea".concat(a.size)](),p=this["zoom".concat(a.coord)];o&&(s=s/p);var b=s*p;if(g===m)h=g,s=g/p;else if(b-l<=g){var w=Math.max(0,b-g);h=w,s=(g+w)/p}else if(b+l>=m){var y=Math.max(0,m-b);h=v-y,s=(m-y)/p}else h<l?h+=_:h>v-l&&(h-=_);h=Math.round(h),this["scroll".concat(a.pos)]=h,this["offset".concat(a.coord)]=s-h/p},i._getRangeCoord=function(e,s,o){var a=this,r=a.margin,c=r===void 0?$.margin:r,_=a.threshold,u=et[e],l=at(this["range".concat(u.coord)],$["range".concat(u.coord)]),d=at(this["rangeOffset".concat(u.coord)],$["rangeOffset".concat(u.coord)]),f=this["zoom".concat(u.coord)],g=ye(this["getScroll".concat(u.pos)](),c,l,_,o);return s?[g[0]*f+d[0],this.options.useOverflowScroll?Math.max(this["viewport".concat(u.size)]*f-this["container".concat(u.size)],g[1]*f+d[1]):g[1]*f+d[1]]:[g[0]+d[0],g[1]+d[1]]},i._emitScrollEvent=function(e,s,o){var a=this._asLeft,r=this._asTop;!o&&a===e&&r===s||(this._asLeft=e,this._asTop=s,this.trigger("scroll",{scrollLeft:e,scrollTop:s,zoomX:this.zoomX,zoomY:this.zoomY}))},i._getScrollRangeX=function(){var e=this.getScrollLeft(),s=this.rangeX,o=s[0],a=s[1];this.useOverflowScroll&&isFinite(a)&&(a=Math.max(a,this.viewportWidth-this.containerWidth/this.zoomX));var r=Math.min(0,isFinite(o)?Math.min(o,e):e),c=Math.max(0,isFinite(a)?Math.max(a,e):e),_=this.viewportScrollWidth,u=Math.max(this.containerWidth/this.zoomX,_)-_,l=Math.min(0,u+r);return[l,c]},i._getScrollRangeY=function(){var e=this.getScrollTop(),s=this.rangeY,o=s[0],a=s[1];this.useOverflowScroll&&isFinite(a)&&(a=Math.max(a,this.viewportHeight-this.containerHeight/this.zoomY));var r=Math.min(0,isFinite(o)?Math.min(o,e):e),c=Math.max(0,isFinite(a)?Math.max(a,e):e),_=this.viewportScrollHeight,u=Math.max(this.containerHeight/this.zoomY,_)-_,l=Math.min(0,u+r);return[l,c]},t=de([Et(Z,function(e,s){var o={enumerable:!0,configurable:!0,get:function(){return this.options[s]}},a=Tt("set ".concat(s));e[a]?o.set=function(r){this[a](r)}:o.set=function(r){this.options[s]=r},Object.defineProperty(e,s,o)})],t),t}(ct),Se=function(n){V(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t}(ze),W=function(){return W=Object.assign||function(t){for(var i,e=1,s=arguments.length;e<s;e++){i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},W.apply(this,arguments)},gt={};ve.forEach(function(n){gt[n]=function(){for(var t,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return(t=this.infiniteViewer)[n].apply(t,i)}});var xe={name:"infinite-viewer",methods:gt,props:it,mounted:function(){var n=this,t={},i=this.$props;it.forEach(function(o){var a=i[o];G(a)||(t[o]=i[o])});var e=this.$refs;this.infiniteViewer=new Se(e.containerElement,e.scrollAreaElement.nextElementSibling,W(W({},t),{wrapperElement:e.wrapperElement,scrollAreaElement:e.scrollAreaElement,horizontalScrollElement:e.horizontalScrollElement,verticalScrollElement:e.verticalScrollElement}));var s=this.infiniteViewer;fe.forEach(function(o){s.on(o,function(a){n.$emit(o,W({},a))})})},updated:function(){var n=this.$props,t=this.infiniteViewer;Z.forEach(function(i){var e=n[i];t[i]!==e&&!G(e)&&(t[i]=n[i])})},beforeDestroy:function(){this.infiniteViewer.destroy()}};function Pe(n,t,i,e,s,o,a,r,c,_){const u=typeof i=="function"?i.options:i;return n&&n.render&&(u.render=n.render,u.staticRenderFns=n.staticRenderFns,u._compiled=!0),i}const Ce=xe;var mt=function(){var n=this,t=n.$createElement,i=n._self._c||t;return i("div",{ref:"containerElement"},[i("div",{ref:"wrapperElement"},[i("div",{ref:"scrollAreaElement"}),n._v(" "),n._t("default")],2),n._v(" "),i("div",{ref:"horizontalScrollElement"},[i("div",{staticClass:"infinite-viewer-scroll-thumb"})]),n._v(" "),i("div",{ref:"verticalScrollElement"},[i("div",{staticClass:"infinite-viewer-scroll-thumb"})])])},Me=[];mt._withStripped=!0;const Ee=void 0,Te=Pe({render:mt,staticRenderFns:Me},Ee,Ce),ke={props:{scale:Number,contentWidth:Number,contentHeight:Number,magnification:Number},components:{VueInfiniteViewer:Te},data(){return{viewerOptions:{},scroll_left:void 0,scroll_top:void 0,debounce_zoom:void 0,debounce_scroll:void 0}},created(){},mounted(){this.updateViewerOptions(),this.$nextTick(()=>{this.scrollToCorner({animate:!1})}),this.$eventHub.$on("panzoom.panTo",this.panTo)},beforeDestroy(){this.$eventHub.$off("panzoom.panTo",this.panTo),this.$root.set_new_module_offset_left=0,this.$root.set_new_module_offset_top=0},watch:{scale(){this.updateScale(this.scale),this.updateViewerOptions()},contentWidth(){this.updateViewerOptions()},contentHeight(){this.updateViewerOptions()},magnification(){this.updateViewerOptions()}},computed:{},methods:{updateViewerOptions(){var e;let n,t;const i=200*this.magnification;if((e=this.$el)!=null&&e.offsetWidth){const s=Math.max(0,this.contentWidth*this.magnification);n=[-i,s];const o=Math.max(0,this.contentHeight*this.magnification);t=[-i,o]}console.log("rangeX",JSON.stringify(n)),console.log("rangeY",JSON.stringify(t)),this.viewerOptions={useMouseDrag:!0,useWheelScroll:!0,useAutoZoom:!0,zoomRange:[.4,10],maxPinchWheel:10,rangeX:n,rangeY:t,displayVerticalScroll:!0,displayHorizontalScroll:!0}},dragStart(n){console.log("dragStart"),n.inputEvent.target.classList.contains("panzoom-exclude")&&n.stop()},dragEnd(n){console.log("dragEnd"),n.isDrag||this.disableActiveModule()},pinchStart(){console.log("pinchStart")},abortPinch(){console.log("abortPinch")},pinch(){this.debounce_zoom&&clearTimeout(this.debounce_zoom),this.debounce_zoom=setTimeout(async()=>{const n=this.$refs.viewer.getZoom();n!==this.scale&&this.$emit("update:scale",n)},500)},panTo({x:n,y:t}){this.scrollToCorner({x:n,y:t,animate:!0})},scrollToCorner({x:n,y:t,animate:i}){const e=i?{duration:200}:void 0,s=80;let o=(n||0)+-(0+s)/this.scale,a=(t||0)+-s/this.scale;this.$refs.viewer.scrollTo(o,a,e)},updateScale(n){n!==this.$refs.viewer.getZoom()&&this.$refs.viewer.setZoom(n,{duration:200,zoomBase:"viewport",zoomOffsetX:this.$root.zoom_offset,zoomOffsetY:this.$root.zoom_offset})},disableActiveModule(){this.$eventHub.$emit("module.setActive",!1)},onScroll(){this.debounce_scroll&&clearTimeout(this.debounce_scroll),this.debounce_scroll=setTimeout(async()=>{this.$root.set_new_module_offset_left=Math.max(0,this.$refs.viewer.getScrollLeft()),this.$root.set_new_module_offset_top=Math.max(0,this.$refs.viewer.getScrollTop())},500)}}};var Re=function(){var t=this,i=t._self._c;return i("vue-infinite-viewer",t._b({ref:"viewer",staticClass:"viewer",on:{scroll:t.onScroll,dragStart:t.dragStart,dragEnd:t.dragEnd,pinchStart:t.pinchStart,abortPinch:t.abortPinch,pinch:t.pinch}},"vue-infinite-viewer",t.viewerOptions,!1),[i("div",{staticClass:"_pzViewport"},[t._t("default")],2)])},Ae=[],Oe=S(ke,Re,Ae,!1,null,"1f9737cb");const Ye=Oe.exports,Xe={props:{page_opened_id:String,publication_path:String,publication_title:String,pages:Array,spreads:[Boolean,Array],modules:Array,is_spread:Boolean,page_width:Number,page_height:Number,layout_mode:String,margins:Object,pagination:[Boolean,Object],can_edit:Boolean},components:{PageMenu:_e,SinglePage:st,PanZoom2:Ye},data(){return{scale:1,page_settings:{show_grid:!1,snap_to_grid:!1,grid_z_index:"under",gridstep_in_mm:10},display_as_public:!1,active_module_path:!1}},created(){this.$eventHub.$on("module.setActive",this.setActiveModule),document.addEventListener("keydown",this.keyPressed),this.loadSettings()},mounted(){},beforeDestroy(){this.$eventHub.$off("module.setActive",this.setActiveModule),document.removeEventListener("keydown",this.keyPressed)},watch:{page_opened_id(){this.$nextTick(()=>{})},page_settings:{handler(){this.saveSettings()},deep:!0}},computed:{active_module(){return this.active_module_path?this.modules.find(n=>n.$path===this.active_module_path):!1},active_module_first_media(){return this.firstMedia(this.active_module)},active_module_meta_filename(){return this.active_module.$path.substring(this.active_module.$path.lastIndexOf("/")+1)},active_page_number(){return this.pages.findIndex(n=>n.id===this.page_opened_id)},current_page(){return this.pages.find(n=>n.id===this.page_opened_id)},previous_page(){return this.pages[this.active_page_number-1]},next_page(){return this.pages[this.active_page_number+1]},active_spread(){return this.spreads[this.active_spread_index]},active_spread_index(){return this.is_spread&&this.spreads.findIndex(n=>n.find(t=>t&&t.id===this.page_opened_id))},current_page_magnification(){return this.layout_mode==="screen"?1:this.$root.page_magnification}},methods:{loadSettings(){const n=localStorage.getItem(`publication.page_settings.${this.publication_path}`);n&&(this.page_settings=JSON.parse(n))},saveSettings(){localStorage.setItem(`publication.page_settings.${this.publication_path}`,JSON.stringify(this.page_settings))},keyPressed(n){if(this.$root.modal_is_opened||n.target.tagName.toLowerCase()==="input"||n.target.tagName.toLowerCase()==="textarea"||n.target.className.includes("ql-editor")||n.target.hasAttribute("contenteditable"))return;let t="";(n.key==="Backspace"||n.key==="Delete")&&(t="remove",this.$eventHub.$emit("module.open_remove_modal")),t&&n.preventDefault()},setActiveModule(n){this.active_module_path=n},prevPage(){const n=this.active_page_number-1;this.setPageActive(this.pages[n].id)},nextPage(){const n=this.active_page_number+1;this.setPageActive(this.pages[n].id)},setPageActive(n){this.setActiveModule(!1),this.$emit("togglePage",n)},prevSpread(){const t=this.spreads[this.active_spread_index-1][1].id;this.setPageActive(t)},nextSpread(){const t=this.spreads[this.active_spread_index+1][0].id;this.setPageActive(t)},getCorrectPageNumber(n){return this.pages.findIndex(i=>i.id===n)}}};var Be=function(){var t=this,i=t._self._c;return i("div",{staticClass:"_openedPage",class:{"is--editable":t.can_edit&&!t.display_as_public}},[i("div",{staticClass:"_spreadNavigator"},[i("div",{staticClass:"_spreadNavigator--content",on:{click:function(e){return e.target!==e.currentTarget?null:t.setActiveModule(!1)}}},[i("div",{staticClass:"_sideCont"},[i("div",{staticClass:"_content"},[i("PageMenu",{attrs:{can_edit:t.can_edit,pages:t.pages,active_page_number:t.active_page_number,active_spread_index:t.active_spread_index,is_spread:t.is_spread,page_width:t.page_width,page_height:t.page_height,scale:t.scale,show_grid:t.page_settings.show_grid,snap_to_grid:t.page_settings.snap_to_grid,grid_z_index:t.page_settings.grid_z_index,gridstep_in_mm:t.page_settings.gridstep_in_mm,layout_mode:t.layout_mode,page_color:t.current_page.page_color,pagination:t.pagination,publication_path:t.publication_path,page_opened_id:t.page_opened_id,page_modules:t.getModulesForPage({modules:t.modules,page_id:t.page_opened_id}),active_module:t.active_module,display_as_public:t.display_as_public},on:{"update:show_grid":function(e){return t.$set(t.page_settings,"show_grid",e)},"update:snap_to_grid":function(e){return t.$set(t.page_settings,"snap_to_grid",e)},"update:grid_z_index":function(e){return t.$set(t.page_settings,"grid_z_index",e)},"update:gridstep_in_mm":function(e){return t.$set(t.page_settings,"gridstep_in_mm",e)},"update:display_as_public":function(e){t.display_as_public=e},updatePageOptions:function(e){return t.$emit("updatePageOptions",e)},"update:scale":function(e){t.scale=e},prevPage:function(e){return t.prevPage()},nextPage:function(e){return t.nextPage()},createPage:function(e){return t.$emit("createPage")},close:function(e){return t.setPageActive(!1)}}})],1)]),i("div",{staticClass:"_pagePan"},[i("PanZoom2",{attrs:{scale:t.scale,"content-width":t.page_width,"content-height":t.page_height,magnification:t.current_page_magnification},on:{"update:scale":function(e){t.scale=e}}},[i("transition",{attrs:{name:"pagechange",mode:"out-in"}},[i("div",{key:t.is_spread?"spread-"+JSON.stringify(t.active_spread.map(e=>e.id)):"page-"+t.page_opened_id,staticClass:"_pageCont",on:{click:function(e){return e.target!==e.currentTarget?null:t.setActiveModule(!1)}}},[t.is_spread?t._l(t.active_spread,function(e,s){return i("div",{key:e.id?e.id:s,staticClass:"_spreadNavigator--page",class:{"is--active":e.id===t.page_opened_id}},[e?[i("SinglePage",{attrs:{context:"full",page_modules:t.getModulesForPage({modules:t.modules,page_id:e.id}),page_width:t.page_width,page_height:t.page_height,layout_mode:t.layout_mode,page_color:e.page_color,scale:t.scale,show_grid:t.page_settings.show_grid,snap_to_grid:t.page_settings.snap_to_grid,grid_z_index:t.page_settings.grid_z_index,gridstep_in_mm:t.page_settings.gridstep_in_mm,margins:t.margins,page_number:t.getCorrectPageNumber(e.id),pagination:t.pagination,hide_pagination:t.current_page.hide_pagination===!0,active_module:t.active_module,page_is_left:s===0,can_edit:t.can_edit&&e.id===t.page_opened_id&&!t.display_as_public},on:{close:function(o){return t.setPageActive(!1)}}}),e.id!==t.page_opened_id?[i("button",{staticClass:"_openAdjacentPageBtn",attrs:{type:"button"},on:{mousedown:function(o){return o.target!==o.currentTarget?null:t.setPageActive(e.id)}}})]:t._e()]:i("div",{staticClass:"_noPage"})],2)}):i("SinglePage",{staticClass:"_spreadNavigator--page is--active",attrs:{context:"full",page_modules:t.getModulesForPage({modules:t.modules,page_id:t.page_opened_id}),page_width:t.page_width,page_height:t.page_height,layout_mode:t.layout_mode,page_color:t.current_page.page_color,scale:t.scale,show_grid:t.page_settings.show_grid,snap_to_grid:t.page_settings.snap_to_grid,grid_z_index:t.page_settings.grid_z_index,gridstep_in_mm:t.page_settings.gridstep_in_mm,margins:t.margins,page_number:t.active_page_number,pagination:t.pagination,hide_pagination:t.current_page.hide_pagination===!0,active_module:t.active_module,can_edit:t.can_edit&&!t.display_as_public},on:{close:function(e){return t.setPageActive(!1)}}})],2)])],1)],1)])])])},Le=[],He=S(Xe,Be,Le,!1,null,"1ecaea45");const We=He.exports,De={props:{index:Number,number_of_pages:Number,can_edit:Boolean},components:{},data(){return{edit_mode:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var Ie=function(){var t=this,i=t._self._c;return i("div",{staticClass:"_label"},[i("div",{staticClass:"u-sameRow u-label"},[t._v(" "+t._s(t.$t("page"))+" "),t.edit_mode?[i("select",{domProps:{value:t.index},on:{change:function(e){t.$emit("movePage",{old_position:t.index,new_position:+e.target.value}),t.edit_mode=!1}}},t._l(t.number_of_pages,function(e){return i("option",{key:e-1,domProps:{value:e-1,textContent:t._s(e)}})}),0)]:[t._v(" "+t._s(t.index+1)+" ")],t.can_edit?i("EditBtn",{on:{click:function(e){t.edit_mode=!t.edit_mode}}}):t._e()],2),t.edit_mode?i("div",{staticClass:"u-sameRow"},[i("div",{},[i("EditBtn",{attrs:{btn_type:"duplicate"},on:{click:function(e){t.$emit("duplicatePage"),t.edit_mode=!1}}})],1),t.can_edit?i("RemoveMenu",{attrs:{modal_title:t.$t("remove_page_and_content")},on:{remove:function(e){return t.$emit("removePage")}}},[i("template",{slot:"trigger"},[i("EditBtn",{attrs:{btn_type:"remove"}})],1)],2):t._e()],1):t._e()])},Ne=[],Fe=S(De,Ie,Ne,!1,null,"04815a5b");const Ve=Fe.exports,Ze={props:{publication:Object,page_opened_id:String,can_edit:Boolean},components:{SinglePage:st,OpenedPageOrSpread:We,PageLabel:Ve},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{is_creating_page:!1,previews_size:200}},created(){this.$eventHub.$on("publication.togglePage",this.togglePage)},mounted(){},beforeDestroy(){this.$eventHub.$off("publication.togglePage",this.togglePage)},watch:{},computed:{pages(){return this.publication.pages},modules(){return this.publication.$files||[]},is_spread(){return this.publication.page_spreads===!0},page_preview_zoom(){return this.calculateZoomToFit({width:this.publication.page_width,height:this.publication.page_height,desired_largest_dimension:this.previews_size,magnification:this.publication.layout_mode==="screen"?1:this.$root.page_magnification})},spreads(){return this.is_spread?this.makeSpread({pages:this.pages}):!1},margins(){return{left:this.publication.page_margin_left||0,right:this.publication.page_margin_right||0,top:this.publication.page_margin_top||0,bottom:this.publication.page_margin_bottom||0}},pagination(){return this.setPaginationFromPublication(this.publication)},meta_filenames_already_present(){const n=[],t=[];return this.pages.map(i=>{const e=i.id,s=e===this.page_opened_id;this.getModulesForPage({modules:this.modules,page_id:e}).map(a=>{a!=null&&a.source_medias&&Array.isArray(a.source_medias)&&a.source_medias.map(r=>{r.meta_filename_in_project&&(s?n.push(r.meta_filename_in_project):t.push(r.meta_filename_in_project))})})}),[{label:this.$t("on_this_page"),medias:n,color:"var(--c-orange)"},{label:this.$t("on_other_pages"),medias:t,color:"var(--c-bleuvert)"}]}},methods:{getCorrectPageNumber(n){return this.pages.findIndex(i=>i.id===n)},async createPage(n){this.is_creating_page=!0;const t=this.generatePageID();let i=this.publication.pages?this.publication.pages.slice():[];const e={id:t,page_color:"white"};typeof n!="number"?i.push(e):i.splice(n,0,e),await this.updatePubliMeta({pages:i}),await new Promise(s=>setTimeout(s,500)),this.is_creating_page=!1},removePage(n){let t=this.publication.pages.slice();t=t.filter(i=>i.id!==n),this.updatePubliMeta({pages:t})},async duplicatePage(n){let t=this.generatePageID();const i=this.publication.pages.reduce((o,a)=>{if(o.push(a),a.id===n){const r=JSON.parse(JSON.stringify(a));r.id=t,o.push(r)}return o},[]);await this.updatePubliMeta({pages:i});const e=this.getModulesForPage({modules:this.modules,page_id:n});if(e.length===0)return;const s={page_id:t};for(const o of e)await this.duplicateModuleWithSourceMedias({og_module:o,addtl_meta_to_module:s})},movePage({old_position:n,new_position:t}){let i=this.publication.pages.slice();function e(s,o,a){if(a>=s.length)for(var r=a-s.length+1;r--;)s.push(void 0);return s.splice(a,0,s.splice(o,1)[0]),s}e(i,n,t),this.updatePubliMeta({pages:i})},generatePageID(){return(Math.random().toString(36)+"00000000000000000").slice(2,8)},togglePage(n){this.$emit("togglePage",n)},async updatePageOptions({page_number:n,value:t}){let i=this.publication.pages.slice();Object.assign(i[n],t),this.updatePubliMeta({pages:i})},async updatePubliMeta(n){return await this.$api.updateMeta({path:this.publication.$path,new_meta:n})}}};var je=function(){var t=this,i=t._self._c;return i("transition",{attrs:{name:"slideup"}},[t.page_opened_id?i("OpenedPageOrSpread",{key:"openedpage",attrs:{page_opened_id:t.page_opened_id,publication_title:t.publication.title,publication_path:t.publication.$path,pages:t.pages,spreads:t.spreads,modules:t.modules,is_spread:t.is_spread,page_width:t.publication.page_width,page_height:t.publication.page_height,layout_mode:t.publication.layout_mode,margins:t.margins,pagination:t.pagination,can_edit:t.can_edit},on:{togglePage:function(e){return t.$emit("togglePage",e)},updatePageOptions:t.updatePageOptions,createPage:t.createPage}}):i("div",{staticClass:"_pagesList"},[i("div",{staticClass:"_setPreviewSize"},[i("h2",[t.is_spread?[t._v(t._s(t.$t("list_of_spreads")))]:[t._v(t._s(t.$t("list_of_pages")))]],2),i("div",{staticClass:"u-spacingBottom"}),i("RangeValueInput",{attrs:{label:t.$t("previews_size"),value:t.previews_size,can_toggle:!1,min:20,max:600,step:1,ticks:[20,50,100,200,400,600],default_value:200},on:{save:function(e){t.previews_size=e}}})],1),i("transition-group",{key:"allpages",staticClass:"_allPages",attrs:{tag:"div",name:"listComplete"}},[t.is_spread?[t._l(t.spreads,function(e,s){return[t._l(e,function(o,a){return[t.can_edit&&a===0?i("EditBtn",{key:"createPage-"+Math.max(0,s*2+a-1),staticClass:"_createPage",style:t.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;",attrs:{btn_type:"create_page"},on:{click:function(r){t.createPage(Math.max(0,s*2+a-1))}}}):t._e(),i("div",{key:o?o.id:a,attrs:{"data-pageposition":a===0?"left":"right"}},[o&&o.id?[i("div",{staticClass:"_preview"},[i("SinglePage",{attrs:{context:"preview",zoom:t.page_preview_zoom,page_modules:t.getModulesForPage({modules:t.modules,page_id:o.id}),page_width:t.publication.page_width,page_height:t.publication.page_height,layout_mode:t.publication.layout_mode,page_color:o.page_color,page_number:t.getCorrectPageNumber(o.id),pagination:t.pagination,hide_pagination:o.hide_pagination===!0,page_is_left:a===0,can_edit:!1}}),i("button",{staticClass:"u-button _openPage",attrs:{type:"button"},domProps:{innerHTML:t._s(t.$t("open"))},on:{click:function(r){return t.$emit("togglePage",o.id)}}})],1),i("PageLabel",{attrs:{index:s*2+a-1,number_of_pages:t.pages.length,can_edit:t.can_edit},on:{movePage:function(r){return t.movePage({old_position:r.old_position,new_position:r.new_position})},duplicatePage:function(r){return t.duplicatePage(o.id)},removePage:function(r){return t.removePage(o.id)}}})]:t._e()],2)]})]})]:t._l(t.pages,function(e,s){return i("div",{key:"page-"+e.id,staticClass:"u-sameRow _singlePage"},[i("div",{staticClass:"_createPageBtn"},[t.can_edit?i("EditBtn",{key:"createPage"+s,style:t.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;",attrs:{btn_type:"create_page"},on:{click:function(o){return t.createPage(s)}}}):t._e()],1),i("div",{staticClass:"_page"},[i("div",{staticClass:"_preview"},[i("SinglePage",{attrs:{context:"preview",zoom:t.page_preview_zoom,page_modules:t.getModulesForPage({modules:t.modules,page_id:e.id}),page_width:t.publication.page_width,page_height:t.publication.page_height,layout_mode:t.publication.layout_mode,page_color:e.page_color,page_number:t.getCorrectPageNumber(e.id),pagination:t.pagination,hide_pagination:e.hide_pagination===!0,can_edit:!1}}),i("button",{staticClass:"u-button _openPage",attrs:{type:"button"},domProps:{innerHTML:t._s(t.$t("open"))},on:{click:function(o){return t.$emit("togglePage",e.id)}}})],1),i("PageLabel",{staticClass:"_pageLabel",attrs:{index:s,number_of_pages:t.pages.length,can_edit:t.can_edit},on:{movePage:function(o){return t.movePage({old_position:o.old_position,new_position:o.new_position})},duplicatePage:function(o){return t.duplicatePage(e.id)},removePage:function(o){return t.removePage(e.id)}}})],1)])}),t.can_edit?i("span",{key:"createPage",style:t.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;"},[i("EditBtn",{attrs:{btn_type:"create_page",is_unfolded:!0},on:{click:t.createPage}})],1):t._e()],2)],1)],1)},qe=[],Ge=S(Ze,je,qe,!1,null,"70559577");const Ue=Ge.exports,Je={props:{publication:Object,pane_infos:Object,can_edit:Boolean},components:{PublicationSettings:$t,PageSettings:Zt,PagesList:Ue},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{page_opened_id(){return this.pane_infos.page_id}},methods:{}};var Ke=function(){var t=this,i=t._self._c;return i("div",{staticClass:"_pageTemplate"},[i("PagesList",{attrs:{publication:t.publication,page_opened_id:t.page_opened_id,can_edit:t.can_edit},on:{togglePage:function(e){return t.$emit("updatePane",{key:"page_id",value:e})}}}),i("PublicationSettings",[i("PageSettings",{attrs:{publication:t.publication}})],1)],1)},Qe=[],ti=S(Je,Ke,Qe,!1,null,"6a52712c");const di=ti.exports;export{di as default};
