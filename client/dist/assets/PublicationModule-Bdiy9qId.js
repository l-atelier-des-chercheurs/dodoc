import{n,S as _,a as p,H as m}from"../build.js";import{M as r}from"./MediaPicker-BkCMiT_E.js";import{C as d}from"./CaptionCreditsPage-CnMu4XJn.js";import{F as h}from"./FlickityCarousel-BRYWTejq.js";const b={props:{medias_with_linked:Array,context:String,publimodule:Object,page_template:String,show_fs_button:Boolean,number_of_max_medias:[Boolean,Number],publication_path:String,edit_mode:Boolean,can_edit:Boolean},components:{MediaPicker:r,CaptionCreditsPage:d},data(){return{show_media_picker:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{is_single_text(){return this.medias_with_linked.length===1&&this.medias_with_linked[0]._linked_media.$type==="text"},is_multiple_medias(){return this.medias_with_linked.length>1},single_media_displayed_at_full_ratio(){var i,a,s,l,u;const o=(i=this.medias_with_linked[0]._linked_media.$infos)==null?void 0:i.ratio,t=(a=this.publimodule)!=null&&a.height&&((s=this.publimodule)!=null&&s.width)?((l=this.publimodule)==null?void 0:l.height)/((u=this.publimodule)==null?void 0:u.width):!1;if(!o||!t)return!1;const e=10;return Math.round(o*e)===Math.round(t*e)}},methods:{itemKey(o,t){return o!=null&&o.$path?o.$path+"_"+t:"no_media_"+t},itemStyle({media_with_linked:o}){let t={};return t["--object-fit"]=o.objectFit||"cover",t},mediaIsSquare(o){var t;return((t=o.$infos)==null?void 0:t.ratio)===1},removeMedia(o){this.$emit("removeMediaAtIndex",{index:o})},mediaDraggedSuccessfully(o){console.log("mediaDraggedSuccessfully"),this.$emit("removeMediaAtIndex",{index:o,remove_source:!1})},showAspectRatioOptions(o){return!(this.medias_with_linked.length===1&&this.page_template!=="page_by_page"||["stl","obj","text","table","other"].includes(o._linked_media.$type)||this.page_template!=="page_by_page"&&this.mediaIsSquare(o._linked_media)||this.single_media_displayed_at_full_ratio)}}};var f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_mediaGrid",class:{"is--multipleMedias":t.is_multiple_medias&&!t.$root.is_mobile_view,"is--singleText":t.is_single_text}},[t._l(t.medias_with_linked,function(i,a){return[e("div",{key:t.itemKey(i._linked_media,a),staticClass:"_mediaGrid--item",style:t.itemStyle({media_with_linked:i}),attrs:{"data-mediatype":i._linked_media.$type}},[i._linked_media?i._linked_media.$type==="text"?e("CollaborativeEditor3",{key:t.edit_mode,staticClass:"_mediaContent--collabEditor",attrs:{content:i._linked_media.$content,path:i._linked_media.$path,mode:t.edit_mode?"always_active":"normal",can_edit:t.edit_mode}}):i._linked_media.$type==="table"?e("TableEditor",{staticClass:"_mediaContent--table",attrs:{content:i._linked_media.$content,path:i._linked_media.$path,can_edit:t.edit_mode}}):e("MediaContent",{attrs:{file:i._linked_media,resolution:t.context==="preview"?220:1600,context:t.context,show_fs_button:t.show_fs_button,can_edit:t.can_edit}}):e("div",{staticClass:"u-instructions _noSourceMedia",domProps:{textContent:t._s(t.$t("source_media_missing"))}}),e("CaptionCreditsPage",{attrs:{media:i._linked_media,publication_path:t.publication_path,can_edit:t.can_edit}}),e("div",{staticClass:"_btnRow"},[t.edit_mode&&t.page_template!=="page_by_page"?e("DragFile",{staticClass:"_df",attrs:{size:"small",file:i._linked_media},on:{dragfileSuccess:function(s){return t.mediaDraggedSuccessfully(a)}}}):t._e(),t.edit_mode?[t.showAspectRatioOptions(i)?[!i.objectFit||i.objectFit==="cover"?t._e():e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){return s.stopPropagation(),t.$emit("updateMediaOpt",{index:a,opt:{objectFit:"cover"}})}}},[e("b-icon",{attrs:{icon:"aspect-ratio"}})],1),i.objectFit!=="contain"?e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){return s.stopPropagation(),t.$emit("updateMediaOpt",{index:a,opt:{objectFit:"contain"}})}}},[e("b-icon",{attrs:{icon:"aspect-ratio-fill"}})],1):t._e()]:t._e(),t.is_multiple_medias?e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){return t.removeMedia(a)}}},[e("b-icon",{attrs:{icon:"trash"}})],1):t._e()]:t._e()],2)],1)]}),t.can_edit&&(!t.number_of_max_medias||t.medias_with_linked.length<t.number_of_max_medias)?e("div",{staticClass:"_mediaPickerTile"},[t.edit_mode?e("EditBtn",{attrs:{btn_type:"add",is_unfolded:!1},on:{click:function(i){t.show_media_picker=!0}}}):t._e(),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication_path},on:{pickMedias:function(i){return t.$emit("pickMedias",i)},close:function(i){t.show_media_picker=!1}}}):t._e(),!t.number_of_max_medias||t.medias_with_linked.length<t.number_of_max_medias?[e("DropZone",{staticClass:"_dzAfter",attrs:{rotate:-90},on:{mediaDropped:function(i){return t.$emit("pickMedias",[i])}}})]:t._e()],2):t._e()],2)},v=[],$=n(b,f,v,!1,null,"309f2c7b");const g=$.exports,y={props:{medias_with_linked:Array,publication_path:String,mode:String,edit_mode:Boolean},components:{SlickItem:_,SlickList:p,MediaPicker:r},directives:{handle:m},data(){return{show_media_picker:!1,show_media_preview_for:null}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{slicklist_key(){let o=this.edit_mode+"_";return this.medias_with_linked.forEach(t=>{o+=t._linked_media.$path+"_"}),o}},methods:{}};var k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_filesList"},[e("DLabel",{attrs:{str:t.mode==="source"?t.$t("source_files"):void 0}}),e("SlickList",{key:t.slicklist_key,staticClass:"_listOfFiles",attrs:{axis:"y",value:t.medias_with_linked,useDragHandle:!0},on:{input:function(i){return t.$emit("reorderMedias",i)}}},t._l(t.medias_with_linked,function({_linked_media:i},a){return e("SlickItem",{key:i.$path,staticClass:"_reorderedFile",attrs:{index:a}},[t.edit_mode?e("button",{staticClass:"u-button u-button_icon _dragHandle",attrs:{type:"button"}},[e("b-icon",{directives:[{name:"handle",rawName:"v-handle"}],attrs:{icon:"grip-vertical",label:t.$t("move")}})],1):t._e(),i&&i.$path?e(t.mode==="source"?"DownloadFile":"span",{tag:"component",staticClass:"_link",attrs:{file:i}},[["image","video","audio","pdf","stl","url"].includes(i.$type)?e("button",{staticClass:"_link--previewBtn",attrs:{type:"button"},on:{click:function(s){s.preventDefault(),t.show_media_preview_for=i}}},[e("MediaContent",{staticClass:"_preview",attrs:{context:"preview",file:i,resolution:220}})],1):e("div",{staticClass:"_preview _preview--none"},[e("b-icon",{attrs:{icon:"file-earmark-arrow-down"}})],1),t.show_media_preview_for===i?e("BaseModal2",{on:{close:function(s){t.show_media_preview_for=null}}},[e("MediaContent",{attrs:{file:t.show_media_preview_for,context:"preview",resolution:1600}}),e("div",{staticClass:"u-spacingBottom"}),e("DownloadFile",{attrs:{file:t.show_media_preview_for}})],1):t._e(),e("span",{staticClass:"_link--filename",domProps:{textContent:t._s(i.$media_filename)}}),i.$infos.size&&t.mode==="source"?[e("span",{staticClass:"u-instructions _link--filesize",domProps:{textContent:t._s(t.formatBytes(i.$infos.size))}})]:t._e(),t.mode==="source"?e("b-icon",{staticClass:"_download",attrs:{icon:"file-earmark-arrow-down-fill"}}):t._e()],2):t._e(),t.edit_mode?e("div",{staticClass:"_removeItem"},[e("EditBtn",{attrs:{btn_type:"remove",label_position:"left",is_unfolded:!1},on:{click:function(s){return t.$emit("removeMediaAtIndex",{index:a})}}})],1):t._e()],1)}),1),t.edit_mode?e("div",{staticClass:"_addBtnSection"},[e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(i){t.show_media_picker=!0}}},[e("b-icon",{attrs:{icon:"plus-circle"}}),t._v(" "+t._s(t.$t("add_files"))+" ")],1),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication_path},on:{pickMedias:function(i){return t.$emit("pickMedias",i)},close:function(i){t.show_media_picker=!1}}}):t._e(),e("DropZone",{on:{mediaDropped:function(i){return t.$emit("pickMedias",[i])}}})],1):t._e()],1)},w=[],M=n(y,k,w,!1,null,"3692ab42");const c=M.exports,C={props:{medias_with_linked:Array,publication_path:String},components:{FilesList:c},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var x=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.$t("change_order")},on:{close:function(i){return t.$emit("close")}},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div"),e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[t._v(" "+t._s(t.$t("close"))+" ")])]},proxy:!0}])},[e("FilesList",{attrs:{mode:"carousel",medias_with_linked:t.medias_with_linked,publication_path:t.publication_path,edit_mode:!0},on:{pickMedias:function(i){return t.$emit("pickMedias",i)},reorderMedias:function(i){return t.$emit("reorderMedias",i)},removeMediaAtIndex:function(i){return t.$emit("removeMediaAtIndex",i)}}})],1)},S=[],O=n(C,x,S,!1,null,"baaa75a5");const B=O.exports,F={props:{medias_with_linked:Array,context:String,page_template:String,show_fs_button:Boolean,number_of_max_medias:[Boolean,Number],publication_path:String,publi_width:Number,edit_mode:Boolean,can_edit:Boolean},components:{FlickityCarousel:h,MediaPicker:r,CaptionCreditsPage:d,ChangeOrderModal:B},data(){return{show_media_picker:!1,show_change_order_modal:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{slider_key(){const o=this.medias_with_linked.map((t,e)=>t.meta_filename_in_project+"-index-"+e);return o?JSON.stringify(o):"none"}},methods:{itemStyle({media_with_linked:o}){let t={};return t["--object-fit"]=o.objectFit||"cover",t},mediaIsSquare(o){var t;return((t=o.$infos)==null?void 0:t.ratio)===1},showObjectFitFor(o){return!(!o._linked_media||this.mediaIsSquare(o._linked_media)||!["image","video","stl","pdf"].includes(o._linked_media.$type))}}};var I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_carousel",class:{}},[e("FlickityCarousel",{key:t.slider_key,staticClass:"_mainCarousel",attrs:{show_fullscreen_button:!0}},t._l(t.medias_with_linked,function(i,a){return e("div",{key:i._linked_media&&i._linked_media.$path||"no_media_"+a,staticClass:"carousel-cell",style:t.itemStyle({media_with_linked:i}),attrs:{"data-mediatype":i._linked_media.$type}},[i._linked_media?e("MediaContent",{attrs:{file:i._linked_media,resolution:t.context==="preview"?220:1600,context:t.context,show_fs_button:!1,display_credits_caption:!0,can_edit_credits_caption:t.can_edit}}):e("span",{staticClass:"_noSourceMedia u-instructions",domProps:{textContent:t._s(t.$t("source_media_missing"))}}),e("CaptionCreditsPage",{attrs:{media:i._linked_media,publication_path:t.publication_path,can_edit:t.can_edit}}),t.edit_mode?e("div",{staticClass:"_btnRow"},[e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){t.show_change_order_modal=!0}}},[e("b-icon",{attrs:{icon:"arrow-left-right"}})],1),t.showObjectFitFor(i)?[!i.objectFit||i.objectFit==="cover"?t._e():e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){return t.$emit("updateMediaOpt",{index:a,opt:{objectFit:"cover"}})}}},[e("b-icon",{attrs:{icon:"aspect-ratio"}})],1),i.objectFit!=="contain"?e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){return t.$emit("updateMediaOpt",{index:a,opt:{objectFit:"contain"}})}}},[e("b-icon",{attrs:{icon:"aspect-ratio-fill"}})],1):t._e()]:t._e(),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){return t.$emit("removeMediaAtIndex",{index:a})}}},[e("b-icon",{attrs:{icon:"trash"}})],1)],2):t._e()],1)}),0),t.show_change_order_modal?e("ChangeOrderModal",{attrs:{medias_with_linked:t.medias_with_linked,publication_path:t.publication_path},on:{pickMedias:function(i){return t.$emit("pickMedias",i)},reorderMedias:function(i){return t.$emit("reorderMedias",i)},removeMediaAtIndex:function(i){return t.$emit("removeMediaAtIndex",i)},close:function(i){t.show_change_order_modal=!1}}}):t._e(),t.can_edit?e("div",{staticClass:"_mediaPickerTile"},[e("EditBtn",{attrs:{btn_type:"add",is_unfolded:!1},on:{click:function(i){t.show_media_picker=!0}}}),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication_path},on:{pickMedias:function(i){return t.$emit("pickMedias",i)},close:function(i){t.show_media_picker=!1}}}):t._e(),e("DropZone",{staticClass:"_dzAfter",on:{mediaDropped:function(i){return t.$emit("pickMedias",[i])}}})],1):t._e()],1)},P=[],A=n(F,I,P,!1,null,"35a243c4");const j=A.exports,E={props:{publimodule:Object,context:{type:String,default:"full"},page_template:String,number_of_max_medias:[Boolean,Number],show_fs_button:Boolean,edit_mode:Boolean,can_edit:Boolean},components:{MosaicMediaGrid:g,FilesList:c,MediaCarousel:j},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{publication_path(){return this.getParent(this.publimodule.$path)},medias_with_linked(){return this.publimodule.source_medias?this.publimodule.source_medias.reduce((o,t)=>{const e=this.getSourceMedia({source_media:t,folder_path:this.publication_path});if(e){const i=Object.assign({},t,{_linked_media:e});o.push(i)}return o},[]):[]}},methods:{async pickMedias(o){let t=this.publimodule.source_medias.slice()||[];for(const e of o){const i=this.$root.publication_include_mode,a=await this.prepareMediaForPublication({path_to_source_media_meta:e.$path,publication_path:this.publication_path,import_mode:i});t.push(a)}this.$emit("updateMeta",{source_medias:t})},async removeMediaAtIndex({index:o,remove_source:t=!0}){const e=this.publimodule.source_medias.slice(),i=e[o];if(e.splice(o,1),e.length===0?this.$emit("remove",{with_content:!1}):this.$emit("updateMeta",{source_medias:e}),Object.prototype.hasOwnProperty.call(i,"meta_filename")&&t===!0){const a=this.getSourceMedia({source_media:{meta_filename:i.meta_filename},folder_path:this.publication_path});await this.$api.deleteItem({path:a.$path})}},reorderMedias(o){const t=o.map(e=>(delete e._linked_media,e));this.$emit("updateMeta",{source_medias:t})},updateMediaOpt({index:o,opt:t}){const e=this.publimodule.source_medias.slice();Object.assign(e[o],t),this.$emit("updateMeta",{source_medias:e})}}};var D=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[e("div",{key:t.medias_with_linked.length>1?"multiple":"single",staticClass:"_mediasModule",style:`--number_of_medias: ${t.medias_with_linked.length}`},[e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.publimodule.module_type==="mosaic"?e("MosaicMediaGrid",{key:"mosaic",attrs:{medias_with_linked:t.medias_with_linked,publimodule:t.publimodule,context:t.context,page_template:t.page_template,show_fs_button:t.show_fs_button,number_of_max_medias:t.number_of_max_medias,publication_path:t.publication_path,edit_mode:t.edit_mode,can_edit:t.can_edit},on:{pickMedias:t.pickMedias,removeMediaAtIndex:t.removeMediaAtIndex,updateMediaOpt:t.updateMediaOpt}}):t.publimodule.module_type==="files"?e("FilesList",{key:"filelist",attrs:{mode:"source",medias_with_linked:t.medias_with_linked,publication_path:t.publication_path,edit_mode:t.edit_mode,can_edit:t.can_edit},on:{pickMedias:t.pickMedias,reorderMedias:t.reorderMedias,removeMediaAtIndex:t.removeMediaAtIndex}}):t.publimodule.module_type==="carousel"?e("MediaCarousel",{attrs:{medias_with_linked:t.medias_with_linked,context:t.context,page_template:t.page_template,show_fs_button:t.show_fs_button,publication_path:t.publication_path,publi_width:t.publimodule.size,edit_mode:t.edit_mode,can_edit:t.can_edit},on:{pickMedias:t.pickMedias,reorderMedias:t.reorderMedias,removeMediaAtIndex:t.removeMediaAtIndex,updateMediaOpt:t.updateMediaOpt}}):t._e()],1)],1)])},z=[],T=n(E,D,z,!1,null,"4aa29987");const L=T.exports,H={props:{publimodule:Object,module_position:String,module_being_edited:String,magnification:Number,border_radius:{type:Object,default:()=>({x:0,y:0})},context:String,page_template:String,number_of_max_medias:{type:[Boolean,Number],default:!1},can_edit:Boolean},components:{MediasModule:L},inject:{$getMapOptions:{default:!1}},data(){return{is_repicking_location:!1,observer:void 0,show_instructions_modal:!1}},created(){},mounted(){this.$eventHub.$on(`module.enable_edit.${this.module_meta_filename}`,this.enableEdit),this.$eventHub.$on(`module.duplicate.${this.module_meta_filename}`,this.duplicateModule),this.$eventHub.$on(`module.remove.${this.module_meta_filename}`,this.removeModule),this.$eventHub.$on(`publication.story.scrollTo.${this.publimodule.$path}`,this.scrollToModule),this.$eventHub.$on("publication.map.click",this.setRepickLocation),this.startIntersectionObserver()},beforeDestroy(){this.$eventHub.$off(`module.enable_edit.${this.module_meta_filename}`,this.enableEdit),this.$eventHub.$off(`module.duplicate.${this.module_meta_filename}`,this.duplicateModule),this.$eventHub.$off(`module.remove.${this.module_meta_filename}`,this.removeModule),this.$eventHub.$off(`publication.story.scrollTo.${this.publimodule.$path}`,this.scrollToModule),this.$eventHub.$off("publication.map.click",this.setRepickLocation),this.endIntersectionObserver()},watch:{edit_mode(){this.$refs.textBloc&&(this.edit_mode?this.$nextTick(()=>this.$refs.textBloc.enableEditor()):this.$refs.textBloc.disableEditor()),this.edit_mode||(this.is_repicking_location=!1)}},computed:{is_associated_to_map(){return this.$getMapOptions},is_active_on_map(){return this.$getMapOptions?this.$getMapOptions().opened_pin_path===this.publimodule.$path:!1},zoom_level_options(){return new Array(20).fill(0).map((t,e)=>e===0?{key:"",text:this.$t("dont_zoom")}:e===1?{key:e,text:e+" ("+this.$t("very_far")+")"}:e===19?{key:e,text:e+" ("+this.$t("very_close")+")"}:{key:e})},available_module_types(){return this.publimodule.module_type==="text"?["text","mosaic","carousel","files"]:["mosaic","carousel","files"]},pin_options(){return this.$getMapOptions?this.$getMapOptions().pins_infos.find(({path:o})=>o===this.publimodule.$path):!1},has_coordinates(){var o,t;return((o=this.publimodule.location)==null?void 0:o.latitude)&&((t=this.publimodule.location)==null?void 0:t.longitude)},edit_mode(){return this.module_being_edited===this.publimodule.$path},module_meta_filename(){return this.publimodule.$path.split("/").at(-1)},show_caption(){var o;return!(this.module_type==="text"||this.module_type==="shape"||this.publimodule.source_medias.length===1&&((o=this.publimodule.source_medias[0].meta_filename)!=null&&o.startsWith("text-"))||!this.publimodule.caption&&!this.edit_mode)},module_type(){return this.getModuleType(this.publimodule.module_type)},show_fs_button(){return this.page_template==="page_by_page"?this.publimodule.show_fs_button===!0:!0},first_media(){return this.firstMedia(this.publimodule)},media_styles(){let o=0;if(!this.$root.is_mobile_view)return this.publimodule.align==="center"&&(this.publimodule.size===66.6?o=16.6:this.publimodule.size===50?o=25:this.publimodule.size===33.3&&(o=33.3)),this.publimodule.align==="right"&&(this.publimodule.size===66.6?o=33.3:this.publimodule.size===50?o=50:this.publimodule.size===33.3&&(o=66.6)),{"--module-width":this.publimodule.size||100,"--module-margin-left":o}}},methods:{async updateMeta(o){await this.$api.updateMeta({path:this.publimodule.$path,new_meta:o}).catch(t=>{throw this.$alertify.delay(4e3).error(t),t})},repickLocation(){this.is_repicking_location=!0,this.$eventHub.$emit("publication.map.disableTools")},showModuleOnMap(){this.$eventHub.$emit("publication.map.openPin",this.publimodule.$path)},pinButtonClick(){this.scrollToModule()},preventClickTraversing(o){this.edit_mode&&o.stopPropagation()},async setRepickLocation({longitude:o,latitude:t}){this.is_repicking_location&&(await this.updateMeta({location:{longitude:o,latitude:t}}).catch(e=>{throw this.$alertify.delay(4e3).error(e),e}),this.is_repicking_location=!1,await new Promise(e=>setTimeout(e,100)),this.showModuleOnMap())},async eraseCoords(){await this.updateMeta({location:{}}).catch(o=>{throw this.$alertify.delay(4e3).error(o),o})},enableEdit(){this.$emit("update:module_being_edited",this.publimodule.$path)},disableEdit(){this.$emit("update:module_being_edited",void 0)},scrollToModule(o="auto"){this.$el&&(console.log("scrollToModule "+this.publimodule.$path),this.$el.scrollIntoView({behavior:o,block:"start",inline:"nearest"}))},startIntersectionObserver(){let o=(e,i)=>{e.forEach(a=>{a.isIntersecting&&this.is_associated_to_map&&this.has_coordinates&&!this.is_active_on_map&&this.showModuleOnMap()})},t="-10%";try{t=window.getComputedStyle(this.$el).getPropertyValue("scroll-margin-top")}catch{}this.observer=new IntersectionObserver(o,{rootMargin:`${t} 0% -80% 0%`}),this.observer.observe(this.$refs.sentinel)},endIntersectionObserver(){this.observer.unobserve(this.$el)},changeModuleType(o){const t=o.target.value;this.updateMeta({module_type:t})},async duplicateModule(){let o={};this.page_template==="page_by_page"&&(o.x=(this.publimodule.x||0)+10,o.y=(this.publimodule.y||0)+10);const t=await this.duplicateModuleWithSourceMedias({og_module:this.publimodule,addtl_meta_to_module:o});this.$emit("duplicate",t),this.disableEdit()},async removeModule({with_content:o=!0}={}){if(o)try{for(let t of this.publimodule.source_medias)if(Object.prototype.hasOwnProperty.call(t,"meta_filename")){const e=this.getParent(this.publimodule.$path),i=this.getSourceMedia({source_media:t,folder_path:e});i&&await this.$api.deleteItem({path:i.$path})}}catch(t){this.$alertify.delay(4e3).error(t)}await this.$api.deleteItem({path:this.publimodule.$path}).catch(t=>{throw this.$alertify.delay(4e3).error(t),t}),this.$emit("remove")}}};var R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_publicationModule",attrs:{"data-type":t.module_type},on:{click:t.preventClickTraversing}},[e("transition",{attrs:{name:"showOptions",mode:"out-in",appear:""}},[t.edit_mode&&t.page_template!=="page_by_page"?e("div",{staticClass:"_sideOptions"},[e("div",{staticClass:"_sideOptions--content"},[e("div",{staticClass:"_arrows"},[t.$listeners.hasOwnProperty("moveUp")?e("button",{staticClass:"u-button _sideBtns _moveBefore",attrs:{disabled:t.module_position==="first"||t.module_position==="alone",type:"button"},on:{click:function(i){return t.$emit("moveUp")}}},[e("svg",{staticStyle:{transform:"rotate(90deg)"},attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 168 168"}},[e("path",{staticStyle:{fill:"currentColor"},attrs:{d:"M87.46,49.46,73.39,64.77a65.3,65.3,0,0,1-6.15,6.15A47.8,47.8,0,0,1,61,75.29H131.6V91.14H61A39.1,39.1,0,0,1,67,95.51q2.81,2.46,6.36,6.15L87.46,117,74.48,128,34.17,83.21,74.48,38.39Z"}})])]):t._e(),t.$listeners.hasOwnProperty("moveDown")?e("button",{staticClass:"u-button _sideBtns _moveAfter",attrs:{type:"button",disabled:t.module_position==="last"||t.module_position==="alone"},on:{click:function(i){return t.$emit("moveDown")}}},[e("svg",{staticStyle:{transform:"rotate(90deg)"},attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 168 168"}},[e("path",{staticStyle:{fill:"currentColor"},attrs:{d:"M78.31,117l14.07-15.31a65.3,65.3,0,0,1,6.15-6.15,47.52,47.52,0,0,1,6.29-4.37H34.17V75.29h70.65a39.1,39.1,0,0,1-6.08-4.37q-2.8-2.46-6.36-6.15L78.31,49.46l13-11.07L131.6,83.21,91.29,128Z"}})])]):t._e()]),e("div",{staticClass:"_options"},[e("div",{staticClass:"_advanced_menu"},[e("div",[e("select",{attrs:{disabled:t.available_module_types.length<=1},domProps:{value:t.publimodule.module_type},on:{change:t.changeModuleType}},t._l(t.available_module_types,function(i){return e("option",{key:i,domProps:{value:i}},[t._v(" "+t._s(t.$t(`module.label.${i}`))+" ")])}),0)]),e("fieldset",{staticClass:"_buttonRow"},[e("button",{staticClass:"u-button u-button_verysmall u-button_bleuvert",attrs:{type:"button"},on:{click:function(i){t.show_instructions_modal=!t.show_instructions_modal}}},[e("b-icon",{class:{"is--active":t.show_instructions_modal},attrs:{icon:t.show_instructions_modal?"info-circle-fill":"info-circle"}})],1),t.show_instructions_modal?e("BaseModal2",{attrs:{title:t.$t("text_image_layout")},on:{close:function(i){t.show_instructions_modal=!1}}},[e("p",[t._v(" "+t._s(t.$t("width_alignment_grid_only_non_mobile"))+" ")])]):t._e(),t._l([100,66.6,50,33.3],function(i){return e("button",{key:i,staticClass:"u-button u-button_verysmall u-button_bleuvert _sizes",class:{"is--active":!t.publimodule.size&&i===100||t.publimodule.size===i},attrs:{type:"button"},on:{click:function(a){return t.updateMeta({size:i})}}},[t._v(" "+t._s(i)+"% ")])}),t.publimodule.size&&t.publimodule.size!==100?t._l(["left","center","right"],function(i){return e("button",{key:i,staticClass:"u-button u-button_small u-button_bleuvert",class:{"is--active":!t.publimodule.align&&i==="left"||t.publimodule.align===i},attrs:{type:"button"},on:{click:function(a){return t.updateMeta({align:i})}}},[i==="left"?e("b-icon",{attrs:{icon:"align-start"}}):t._e(),i==="center"?e("b-icon",{attrs:{icon:"align-center"}}):t._e(),i==="right"?e("b-icon",{attrs:{icon:"align-end"}}):t._e()],1)}):t._e()],2)]),t.is_associated_to_map?e("div",{staticClass:"_carto"},[t._e(),e("div",{},[e("button",{staticClass:"u-button u-button_red u-button_small",attrs:{type:"button"},on:{click:function(i){return i.stopPropagation(),t.repickLocation.apply(null,arguments)}}},[t.has_coordinates?[e("b-icon",{attrs:{icon:"pin-map-fill"}}),t._v(" "+t._s(t.$t("change_location"))+" ")]:[e("b-icon",{attrs:{icon:"pin-map"}}),t._v(" "+t._s(t.$t("place_on_map"))+" ")]],2)]),t.has_coordinates?e("div",{},[e("SelectField2",{attrs:{value:t.publimodule.zoom_level,options:t.zoom_level_options,can_edit:t.can_edit,hide_validation:!0,size:"small"},on:{change:function(i){return t.updateMeta({zoom_level:i})}}})],1):t._e(),t.has_coordinates?e("div",{},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.eraseCoords}},[e("b-icon",{attrs:{icon:"x-circle"}}),t._v(" "+t._s(t.$t("erase"))+" ")],1)]):t._e()]):t._e(),e("DropDown",{attrs:{show_label:!1,right:!0}},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.duplicateModule}},[e("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("duplicate"))+" ")],1),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return t.$emit("changeSectionForModule")}}},[e("b-icon",{attrs:{icon:"arrow-left-right"}}),t._v(" "+t._s(t.$t("change_section"))+" ")],1),t.can_edit?e("RemoveMenu",{attrs:{show_button_text:!0},on:{remove:t.removeModule}}):t._e()],1)],1),e("div",{staticClass:"_saveBtn"},[e("EditBtn",{attrs:{btn_type:"check",label_position:"left"},on:{click:t.disableEdit}})],1),t.is_repicking_location?e("div",{staticClass:"_repickNotice"},[e("div",{staticClass:"_repickNotice--content"},[e("div",[t._v(" "+t._s(t.$t("click_on_map_to_repick_location"))+" ")]),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){t.is_repicking_location=!1}}},[t._v(" "+t._s(t.$t("cancel"))+" ")])])]):t._e()])]):t._e()]),e("div",{staticClass:"_content",style:t.media_styles},[e("div",{ref:"sentinel"}),t.is_associated_to_map&&t.has_coordinates?e("button",{ref:"pinButton",staticClass:"u-button _pinButton",class:{"is--active":t.is_active_on_map},style:`--pin-color: ${t.pin_options?t.pin_options.color:""}`,attrs:{type:"button"},on:{click:function(i){return i.stopPropagation(),t.pinButtonClick.apply(null,arguments)}}},[e("img",{attrs:{src:t.pin_options.pin_preview_src}})]):t._e(),t.can_edit&&(t.page_template!=="page_by_page"||t.publimodule.module_type==="text")?e("div",{staticClass:"_floatingEditBtn"},[e("span",{on:{click:function(i){return i.stopPropagation(),t.enableEdit.apply(null,arguments)},touchstart:function(i){return i.stopPropagation(),t.enableEdit.apply(null,arguments)}}},[t.edit_mode?t._e():e("EditBtn",{attrs:{label_position:"left"}})],1)]):t._e(),["mosaic","carousel","files"].includes(t.publimodule.module_type)?e("MediasModule",{attrs:{publimodule:t.publimodule,edit_mode:t.edit_mode,can_edit:t.can_edit,context:t.context,page_template:t.page_template,number_of_max_medias:t.number_of_max_medias,show_fs_button:t.show_fs_button},on:{updateMeta:t.updateMeta,remove:t.removeModule}}):t.publimodule.module_type==="text"&&t.first_media?e("CollaborativeEditor3",{ref:"textBloc",attrs:{path:t.first_media.$path,content:t.first_media.$content,scrollingContainer:t.$el,line_selected:!1,can_edit:t.can_edit},on:{lineClicked:function(i){return t.$emit("lineClicked",i)},contentIsEdited:function(i){return t.$emit("contentIsEdited",i)},contentIsNotEdited:function(i){return t.$emit("contentIsNotEdited",i)}}}):t.module_type==="shape"?[e("svg",{attrs:{viewBox:"0 0 100 100",preserveAspectRatio:"none",xmlns:"http://www.w3.org/2000/svg"}},[t.publimodule.module_type==="ellipsis"?e("circle",{attrs:{cx:"50",cy:"50",r:50-t.publimodule.outline_width*t.magnification/8,"vector-effect":"non-scaling-stroke"}}):t.publimodule.module_type==="rectangle"?e("rect",{attrs:{x:t.publimodule.outline_width*t.magnification/4,y:t.publimodule.outline_width*t.magnification/4,width:100-t.publimodule.outline_width*t.magnification/2,height:100-t.publimodule.outline_width*t.magnification/2,"vector-effect":"non-scaling-stroke",rx:t.border_radius.x,ry:t.border_radius.y}}):t.publimodule.module_type==="line"?e("g",[e("rect",{attrs:{width:"100",height:"100","vector-effect":"non-scaling-stroke",stroke:"none",rx:t.border_radius.x,ry:t.border_radius.y}}),e("line",{attrs:{x1:t.publimodule.outline_width*t.magnification/4||0,y1:"50",x2:100-(t.publimodule.outline_width*t.magnification/4||0),y2:"50","vector-effect":"non-scaling-stroke"}})]):t.publimodule.module_type==="arrow"?e("g",[e("rect",{attrs:{width:"100",height:"100","vector-effect":"non-scaling-stroke",stroke:"none",rx:t.border_radius.x,ry:t.border_radius.y}}),e("line",{attrs:{x1:t.publimodule.outline_width*t.magnification/4||0,y1:"50",x2:100-(t.publimodule.outline_width*t.magnification/4||0),y2:"50","vector-effect":"non-scaling-stroke"}}),e("g",{attrs:{transform:`
              translate(${100-(t.publimodule.outline_width*t.magnification/4||0)}, 50)`,preserveAspectRatio:""}},[e("line",{attrs:{x1:"0",y1:"0",x2:"-10",y2:"-10","vector-effect":"non-scaling-stroke"}}),e("line",{attrs:{x1:"0",y1:"0",x2:"-10",y2:"10","vector-effect":"non-scaling-stroke"}})])]):t._e()])]:e("small",[t._v(t._s(t.$t("nothing_to_show")))]),t.show_caption?e("div",{staticClass:"_captionField"},[e("CollaborativeEditor3",{staticClass:"_caption",attrs:{label:t.edit_mode&&!t.publimodule.caption&&t.page_template!=="page_by_page"?t.$t("add_caption"):void 0,field_to_edit:"caption",content:t.publimodule.caption,path:t.publimodule.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,can_edit:t.page_template!=="page_by_page"?t.can_edit:!1}}),t.edit_mode&&t.first_media&&t.first_media.caption&&!t.publimodule.caption&&t.page_template!=="page_by_page"?e("div",{},[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("copy_first_media_caption"))+" ")]),e("button",{attrs:{type:"button"},on:{click:function(i){return t.updateMeta({caption:t.first_media.caption})}}},[t._v(" "+t._s(t.first_media.caption)+" ")])]):t._e()],1):t._e()],2),t.edit_mode&&t.page_template!=="page_by_page"?e("div",{staticClass:"_selectorIndicator"}):t._e()],1)},N=[],q=n(H,R,N,!1,null,"2e9b517b");const U=q.exports;export{U as P};
