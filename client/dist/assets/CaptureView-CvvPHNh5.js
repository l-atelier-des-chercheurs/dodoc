import{n as he,c as Q,d as tt,_ as _t,R as vt}from"../build.js";const gt={props:{available_modes:Array,selected_mode:String,disable_change_mode:Boolean},components:{},data(){return{id:(Math.random().toString(36)+"00000000000000000").slice(2,8),available_mode_picto:{photo:this.$root.publicPath+"images/i_icone-dodoc_image.svg",video:this.$root.publicPath+"images/i_icone-dodoc_video.svg",stopmotion:this.$root.publicPath+"images/i_icone-dodoc_anim.svg",audio:this.$root.publicPath+"images/i_icone-dodoc_audio.svg",vecto:this.$root.publicPath+"images/i_icone-dodoc_vecto.svg",lines:this.$root.publicPath+"images/i_icone-dodoc_lines.svg"}}},created(){},mounted(){this.$eventHub.$on("mode.set.previous",this.previousMode),this.$eventHub.$on("mode.set.next",this.nextMode)},beforeDestroy(){this.$eventHub.$off("mode.set.previous",this.previousMode),this.$eventHub.$off("mode.set.next",this.nextMode)},watch:{},computed:{},methods:{previousMode(){if(this.disable_change_mode)return;let d=this.available_modes.indexOf(this.selected_mode);d>0?this.$emit("changeMode",this.available_modes[d-1]):this.$emit("changeMode",this.available_modes[this.available_modes.length-1])},nextMode(){if(this.disable_change_mode)return;let d=this.available_modes.indexOf(this.selected_mode);d<this.available_modes.length-1?this.$emit("changeMode",this.available_modes[d+1]):this.$emit("changeMode",this.available_modes[0])}}};var yt=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_modeSelector"},[e.available_modes.length>1?i("div",{staticClass:"_arrows"},[i("button",{staticClass:"u-button u-button_transparent",attrs:{type:"button"},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),e.previousMode.apply(null,arguments)}}},[i("svg",{staticStyle:{"enable-background":"new 0 0 169 169"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"169px",height:"169px",viewBox:"0 0 169 169","xml:space":"preserve"}},[i("path",{attrs:{fill:"currentColor",stroke:"currentColor","stroke-width":"10","stroke-linejoin":"round",d:"M60.2,84.5l48.6-24.3l0,48.6L60.2,84.5z"}})])])]):e._e(),e._l(e.available_modes,function(a){return i("div",{key:a},[i("input",{attrs:{type:"radio",id:e.id+"_"+a},domProps:{value:a,checked:e.selected_mode===a},on:{click:function(l){return e.$emit("changeMode",a)}}}),i("label",{attrs:{for:e.id+"_"+a}},[i("div",{staticClass:"_picto",attrs:{content:e.$t(a)}},[i("img",{attrs:{src:e.available_mode_picto[a]}})]),e.selected_mode===a?i("span",[e._v(e._s(e.$t(a)))]):e._e()])])}),e.available_modes.length>1?i("div",{staticClass:"_arrows"},[i("button",{staticClass:"u-button u-button_transparent",attrs:{type:"button"},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),e.nextMode.apply(null,arguments)}}},[i("svg",{staticStyle:{"enable-background":"new 0 0 169 169"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"169px",height:"169px",viewBox:"0 0 169 169","xml:space":"preserve"}},[i("path",{attrs:{fill:"currentColor",stroke:"currentColor","stroke-width":"10","stroke-linejoin":"round",d:"M108.8,84.5l-48.6,24.3V60.2L108.8,84.5z"}})])])]):e._e()],2)},bt=[],wt=he(gt,yt,bt,!1,null,"f6fea736");const Ct=wt.exports,xt={props:{media_to_validate:Object,audio_output_deviceId:String},components:{},data(){return{}},created(){},mounted(){this.setSinkId()},beforeDestroy(){},watch:{audio_output_deviceId:{handler(){this.setSinkId()}}},computed:{},methods:{setSinkId(){this.audio_output_deviceId&&(this.media_to_validate.type==="video"||this.media_to_validate.type==="audio")&&this.$refs.videoElement.setSinkId(this.audio_output_deviceId)}}};var St=function(){var e=this,i=e._self._c;return e.media_to_validate?i("div",{staticClass:"m_previewValidation"},[e.media_to_validate.type==="image"?i("img",{attrs:{src:e.media_to_validate.objectURL}}):e.media_to_validate.type==="video"||e.media_to_validate.type==="audio"?i("vue-plyr",{staticClass:"m_previewValidation--video"},[i("video",{ref:"videoElement",attrs:{src:e.media_to_validate.objectURL,poster:e.media_to_validate.preview,preload:"auto"}})]):e.media_to_validate.type==="svg"?i("div",{staticClass:"m_previewValidation--svg",domProps:{innerHTML:e._s(e.media_to_validate.preview)}}):e._e()],1):e._e()},kt=[],Rt=he(xt,St,kt,!1,null,"5db7b05e");const Tt=Rt.exports,Mt={props:{media_is_being_sent:Boolean,media_being_sent_percent:Number,can_add_to_fav:Boolean,cancelButtonIsBackButton:{type:Boolean,default:!1}},components:{},data(){return{selected_button:1}},created(){},mounted(){document.addEventListener("keyup",this.captureKeyListener)},beforeDestroy(){document.removeEventListener("keyup",this.captureKeyListener)},watch:{},computed:{},methods:{captureKeyListener(d){switch(console.log("METHODS • MediaValidationButtons: captureKeyListener"),d.key){case"w":case"z":case"ArrowLeft":this.selectedMoveLeft();break;case"s":case"ArrowRight":this.selectedMoveRight();break;case"a":case"q":case" ":this.validateButton(this.selected_button);break}return d.preventDefault(),!1},selectedMoveLeft(){console.log("METHODS • MediaValidationButtons: captureKeyListener / goleft"),this.selected_button+=this.selected_button>0?-1:0},selectedMoveRight(){console.log("METHODS • MediaValidationButtons: captureKeyListener / goright"),this.selected_button+=this.selected_button<2?1:0},validateButton(d){d===0?this.$emit("cancel"):d===1?this.$emit("save"):d===2&&this.$emit("save_and_fav")}}};var Dt=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_mediaValidationButtons"},[i("button",{staticClass:"u-button u-button_transparent _arrows",attrs:{type:"button"},on:{click:e.selectedMoveLeft}},[i("svg",{staticStyle:{"enable-background":"new 0 0 169 169"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"169px",height:"169px",viewBox:"0 0 169 169","xml:space":"preserve"}},[i("path",{attrs:{fill:"currentColor",d:"M60.2,84.5l48.6-24.3l0,48.6L60.2,84.5z"}})])]),i("button",{staticClass:"u-button u-button_black",class:{"is--active":e.selected_button===0},attrs:{type:"button"},on:{mousedown:function(a){return a.stopPropagation(),a.preventDefault(),e.validateButton(0)},touchstart:function(a){return a.stopPropagation(),a.preventDefault(),e.validateButton(0)},mouseover:function(a){e.selected_button=0}}},[e.cancelButtonIsBackButton?[i("span",{},[e._v("‹ "+e._s(e.$t("back")))])]:[i("svg",{staticStyle:{"enable-background":"new 0 0 168 168"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 168 168","xml:space":"preserve"}},[i("polygon",{attrs:{fill:"currentColor",points:`42.6,57.2 57.5,42.4 84.1,69 110.8,42.4 125.6,57.2 99,83.9 125.6,110.5 110.8,125.4 
      84.1,98.7 57.5,125.4 42.6,110.5 69.3,83.9`}})]),i("span",{},[e._v(e._s(e.$t("cancel")))])]],2),i("div",{staticClass:"_valStarBtns"},[i("button",{staticClass:"u-button u-button_red _checkBtn",class:{"is--active":e.selected_button===1},attrs:{type:"button",title:e.$t("save")},on:{click:function(a){return e.validateButton(1)},mouseover:function(a){e.selected_button=1}}},[i("svg",{staticStyle:{"enable-background":"new 0 0 168 168"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 168 168","xml:space":"preserve"}},[i("rect",{attrs:{x:"51.4",y:"73.1",transform:"matrix(0.7071 -0.7071 0.7071 0.7071 -53.857 72.9892)",width:"19.5",height:"56.8",fill:"currentColor"}}),i("rect",{attrs:{x:"53.2",y:"77.3",transform:"matrix(0.7071 -0.7071 0.7071 0.7071 -31.6875 97.6563)",width:"97.6",height:"19.5",fill:"currentColor"}})]),i("span",{staticClass:"c-rouge"},[e._v(e._s(e.$t("save")))]),i("span",{staticClass:"u-icon",domProps:{innerHTML:e._s(e.dodoc_icon_collect)}})]),e.can_add_to_fav?i("button",{staticClass:"u-button u-button_red _favBtn",class:{"is--active":e.selected_button===2},attrs:{type:"button",title:e.$t("add_to_fav")},on:{click:function(a){return e.validateButton(2)},mouseover:function(a){e.selected_button=2}}},[i("b-icon",{attrs:{icon:e.selected_button===2?"star-fill":"star"}})],1):e._e()]),i("button",{staticClass:"u-button u-button_transparent u-colorOrange _arrows",attrs:{type:"button"},on:{click:e.selectedMoveRight}},[i("svg",{staticStyle:{"enable-background":"new 0 0 169 169"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"169px",height:"169px",viewBox:"0 0 169 169","xml:space":"preserve"}},[i("path",{attrs:{fill:"currentColor",d:"M108.8,84.5l-48.6,24.3V60.2L108.8,84.5z"}})])]),e.media_is_being_sent?i("div",{staticClass:"m_mediaValidationButtons--overlay"},[i("transition",{attrs:{name:"fade_fast",duration:150}},[i("LoaderSpinner")],1),i("span",{staticClass:"m_mediaValidationButtons--overlay--percent",domProps:{textContent:e._s(e.media_being_sent_percent+"%")}})],1):e._e()])},Et=[],Lt=he(Mt,Dt,Et,!1,null,"bea2767e");const ut=Lt.exports,$t={props:{medias:Array,frame_rate:Number,output_format:String,created_stopmotion:[Boolean,Object]},components:{},data(){return{current_media_index:0,is_playing:!1,new_frame_rate:this.frame_rate,new_output_format:this.output_format,next_image_timeout:null}},created(){},mounted(){},beforeDestroy(){},watch:{new_frame_rate(){this.$emit("update:frame_rate",this.new_frame_rate)},new_output_format(){this.$emit("update:output_format",this.new_output_format)}},computed:{current_media(){return this.medias[this.current_media_index]}},methods:{playPausePreview(){this.is_playing?this.stopPreview():this.playPreview()},stopPreview(){this.is_playing=!1,window.clearTimeout(this.next_image_timeout)},playPreview(){this.is_playing=!0;const d=()=>{const e=this.current_media.duration,i=1e3/this.frame_rate,a=e*i;this.next_image_timeout=window.setTimeout(()=>{if(this.current_media_index<this.medias.length-1)this.current_media_index++,d();else{this.is_playing=!1;return}},a)};this.current_media_index=0,d(this.current_media_index)}}};var Pt=function(){var e=this,i=e._self._c;return i("div",[i("div",{staticClass:"_player"},[e.created_stopmotion?[i("MediaContent",{key:e.created_stopmotion.$path,attrs:{context:"full",file:e.created_stopmotion,resolution:1600}})]:[e.current_media?i("MediaContent",{attrs:{file:e.current_media.media,resolution:1600}}):e._e(),e.is_playing?e._e():i("div",{staticClass:"_miniListPreview"},e._l(e.medias,function({media:a}){return i("MediaContent",{key:"previews-"+a.$path,attrs:{file:a,resolution:1600}})}),1),i("div",{staticClass:"_imgCount"},[e._v(" "+e._s(e.current_media_index+1)+"/"+e._s(e.medias.length)+" ")]),i("button",{staticClass:"_playPauseBtn",attrs:{type:"button"},on:{click:e.playPausePreview}},[e.is_playing?e._e():i("img",{attrs:{src:`${e.$root.publicPath}images/i_play.svg`,width:"48",height:"48",draggable:"false"}})]),i("transition",{attrs:{name:"fade"}},[e.is_playing?e._e():i("div",{staticClass:"_fps"},[i("div",{staticClass:"u-sameRow"},[i("div",[i("label",{staticClass:"u-label",attrs:{for:"fps_select"}},[e._v(e._s(e.$t("img_per_second")))]),i("select",{directives:[{name:"model",rawName:"v-model.number",value:e.new_frame_rate,expression:"new_frame_rate",modifiers:{number:!0}}],attrs:{size:"small",name:"fps_select",id:"fps_select"},on:{change:function(a){var l=Array.prototype.filter.call(a.target.options,function(m){return m.selected}).map(function(m){var o="_value"in m?m._value:m.value;return e._n(o)});e.new_frame_rate=a.target.multiple?l:l[0]}}},[i("option",[e._v("2")]),i("option",[e._v("4")]),i("option",[e._v("8")]),i("option",[e._v("15")]),i("option",[e._v("24")]),i("option",[e._v("30")])])]),i("div",[i("label",{staticClass:"u-label",attrs:{for:"output_format"}},[e._v(e._s(e.$t("format")))]),i("select",{directives:[{name:"model",rawName:"v-model",value:e.new_output_format,expression:"new_output_format"}],attrs:{size:"small",name:"output_format",id:e.output_format},on:{change:function(a){var l=Array.prototype.filter.call(a.target.options,function(m){return m.selected}).map(function(m){var o="_value"in m?m._value:m.value;return o});e.new_output_format=a.target.multiple?l:l[0]}}},[i("option",{domProps:{value:"gif"}},[e._v(e._s(e.$t("gif")))]),i("option",{domProps:{value:"mp4"}},[e._v(e._s(e.$t("video")))])])])])])])]],2)])},At=[],Ot=he($t,Pt,At,!1,null,"7a1f6f4c");const Ut=Ot.exports,Bt={props:{value:Number,frame_rate:Number},components:{},data(){return{local_value:this.value}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{seconds_equivalent(){return parseFloat((this.local_value/this.frame_rate).toFixed(2)).toLocaleString(this.$i18n.locale)}},methods:{}};var It=function(){var e=this,i=e._self._c;return i("BaseModal2",{attrs:{title:e.$t("duration")},on:{close:function(a){return e.$emit("close")}}},[i("div",{staticClass:"u-inputGroup u-spacingBottom"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.local_value,expression:"local_value",modifiers:{number:!0}}],staticClass:"_input",attrs:{type:"number",name:e.$t("duration"),id:"_input_"+e.$t("duration"),size:"medium",min:1,max:3600,step:1},domProps:{value:e.local_value},on:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.$emit("save",e.local_value)},input:function(a){a.target.composing||(e.local_value=e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}}),i("span",{staticClass:"u-suffix"},[e._v(" "+e._s((e.local_value>1?e.$t("images"):e.$t("image")).toLowerCase())+" ")])]),i("p",{staticClass:"u-instructions"},[e._v(" "+e._s(e.$t("duration_explanation",{seconds_equivalent:e.seconds_equivalent,frame_rate:e.frame_rate}))+" ")]),i("div",{staticClass:"u-spacingBottom"}),i("template",{slot:"footer"},[i("div"),i("SaveCancelButtons",{staticClass:"_scb",attrs:{allow_save:!0},on:{save:function(a){return e.$emit("save",e.local_value)},cancel:function(a){return e.$emit("close")}}})],1)],2)},Ft=[],Nt=he(Bt,It,Ft,!1,null,"a1dd6337");const Vt=Nt.exports,Ht={props:{current_stopmotion_path:String,stream:MediaStream,show_live_feed:Boolean,is_validating_stopmotion_video:Boolean,onion_skin_opacity:Number,stopmotion_frame_rate:Number},components:{MediaValidationButtons:ut,PreviewStopmotion:Ut,ImageDurationPicker:Vt},data(){return{stopmotion:null,fetch_stopmotion_error:void 0,show_options_menu:!1,frame_rate:this.stopmotion_frame_rate,output_format:"mp4",validating_video_preview:!1,previous_photo_to_show:!1,media_is_being_sent:!1,show_advanced_menu:!1,compilation_in_progress:!1,created_stopmotion:!1,preview_playing_event:void 0,show_duration_menu:!1,status_saving_to_project:!1}},created(){},async mounted(){this.$eventHub.$on("stopmotion.addImage",this.appendToStopMotion),this.$eventHub.$on("stopmotion.test",this.testStopmotion);const d=await this.$api.getFolder({path:this.current_stopmotion_path}).catch(e=>{this.fetch_stopmotion_error=e.response});this.stopmotion=d,this.$api.join({room:this.current_stopmotion_path})},beforeDestroy(){this.$api.leave({room:this.current_stopmotion_path}),this.$eventHub.$off("stopmotion.addImage",this.appendToStopMotion)},watch:{frame_rate(){this.$emit("update:stopmotion_frame_rate",this.frame_rate)},stopmotion_frame_rate(){this.frame_rate=this.stopmotion_frame_rate},medias(){this.medias.length>0&&this.show_live_feed&&(this.previous_photo_to_show=this.medias[this.medias.length-1].media,this.$nextTick(()=>{this.$nextTick(()=>{this.$refs.mediaPreviews.$el.scrollLeft=1e6})}))},stream:{handler(){},immediate:!0},previous_photo_to_show(){this.$emit("showPreviousImage",this.previous_photo_to_show),this.$nextTick(()=>{const d=document.querySelector(".m_stopmotionpanel--medias--list--items.is--current_single");d&&d.scrollIntoView({behavior:"smooth",inline:"nearest"})})},validating_video_preview(){this.$emit("update:is_validating_stopmotion_video",this.validating_video_preview)}},computed:{medias(){var d,e,i;return(d=this.stopmotion)!=null&&d.images_list&&((i=(e=this.stopmotion)==null?void 0:e.$files)==null?void 0:i.length)>0?this.stopmotion.images_list.reduce((l,m)=>{const o=m.m||m,w=m.d||1,b=this.stopmotion.$files.find(M=>M.$path.endsWith(o));return b&&l.push({media:b,duration:w}),l},[]):[]},images_list(){return this.medias.map(d=>({m:this.getFilename(d.media.$path),d:d.duration}))},image_index_currently_shown(){return this.previous_photo_to_show?this.medias.findIndex(d=>d.media.$path===this.previous_photo_to_show.$path):!1},current_photo_duration(){var d;return(d=this.medias.find(e=>e.media.$path===this.previous_photo_to_show.$path))==null?void 0:d.duration}},methods:{async appendToStopMotion({imageData:d}){const e={};e.$origin="capture";const{meta_filename:i}=await this.$api.uploadFile({path:this.current_stopmotion_path,filename:+new Date+".jpeg",file:d,additional_meta:e}).catch(l=>{throw this.$alertify.delay(4e3).error(l),l});let a=this.images_list.slice();a.push({m:i,d:1}),await this.$api.updateMeta({path:this.current_stopmotion_path,new_meta:{images_list:a}})},previewPlay({loop:d=!1}={}){(this.show_live_feed||this.image_index_currently_shown===this.medias.length-1)&&this.firstImage();const e=i=>{if(i>this.medias.length-1)return d?e(0):this.pausePreview();this.previous_photo_to_show=this.medias[i].media;const a=this.medias[i].duration;this.preview_playing_event=window.setTimeout(()=>e(i+1),1e3/this.frame_rate*a)};e(this.image_index_currently_shown)},pausePreview(){window.clearTimeout(this.preview_playing_event),this.preview_playing_event=void 0},testStopmotion(){this.validating_video_preview=!0,this.$nextTick(()=>{this.$nextTick(()=>{})})},photoIsActive(d){var e;return((e=this.previous_photo_to_show)==null?void 0:e.$path)===d&&!this.show_live_feed},showVideoFeed(){this.previous_photo_to_show=this.medias[this.medias.length-1].media,this.$emit("update:show_live_feed",!0)},firstImage(){this.previous_photo_to_show=this.medias[0].media,this.$emit("update:show_live_feed",!1)},prevImage(){if(this.show_live_feed){this.previous_photo_to_show=this.medias.at(-1).media,this.$emit("update:show_live_feed",!1);return}this.previous_photo_to_show=this.medias[this.image_index_currently_shown-1].media},nextImage(){if(this.image_index_currently_shown===this.medias.length-1)return this.showVideoFeed();this.previous_photo_to_show=this.medias[this.image_index_currently_shown+1].media},lastImage(){this.showVideoFeed()},async updateMediaDurationForCurrentPreviousPhoto(d){const e=this.images_list.slice();e[this.image_index_currently_shown].d=d,await this.$api.updateMeta({path:this.current_stopmotion_path,new_meta:{images_list:e}}),this.show_duration_menu=!1},backToStopmotion(){console.log("METHODS • StopmotionPanel: backToStopmotion"),this.validating_video_preview=!1,this.created_stopmotion=!1,this.$emit("update:show_live_feed",!0)},async exportStopmotion({fav:d=!1}={}){var l;this.compilation_in_progress=!0;const e={fav:d,$origin:"capture"};(l=this.connected_as)!=null&&l.$path&&(e.$authors=[this.connected_as.$path]);const i=await this.$api.exportFolder({path:this.current_stopmotion_path,instructions:{recipe:"stopmotion",field:"images_list",frame_rate:this.frame_rate,output_format:this.output_format,additional_meta:e}});this.$alertify.delay(4e3).log(this.$t("compilation_started")),this.backToStopmotion();const a=({task_id:m,message:o})=>{var w;if(m===i)if(this.$eventHub.$off("task.ended",a),this.compilation_in_progress=!1,o.event==="completed"){const b=this.getFilename((w=o.file)==null?void 0:w.$path);b&&this.$emit("insertMedia",b),this.$emit("close")}else this.$alertify.delay(4e3).error(o.info)};this.$eventHub.$on("task.ended",a)},async saveToProject(d){let{space_slug:e,project_slug:i}=this.decomposePath(d);const a=this.createPath({space_slug:e,project_slug:i});this.status_saving_to_project="saving",await this.$api.copyFile({path:d,path_to_destination_folder:a,new_meta:{$origin:"capture"}}).catch(l=>{this.$alertify.delay(4e3).error(l)}),this.status_saving_to_project="saved",setTimeout(()=>{this.status_saving_to_project=!1},3e3)},async removeMedia(d){let e=this.images_list.slice();e=e.filter(i=>!d.endsWith(i.m)),this.nextImage(),await this.$api.updateMeta({path:this.current_stopmotion_path,new_meta:{images_list:e}}),await this.$api.deleteItem({path:d})}}};var Wt=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_stopmotionpanel",class:{"is--showing_video_validation":e.validating_video_preview}},[e.stopmotion?e.fetch_stopmotion_error?i("div",[e._v(" "+e._s(e.fetch_stopmotion_error)+" ")]):[e.validating_video_preview?i("div",{ref:"videoPreview",staticClass:"m_stopmotionpanel--videopreview"},[i("PreviewStopmotion",{attrs:{medias:e.medias,frame_rate:e.frame_rate,output_format:e.output_format,created_stopmotion:e.created_stopmotion},on:{"update:frame_rate":function(a){e.frame_rate=a},"update:output_format":function(a){e.output_format=a}}}),i("transition",{attrs:{name:"fade_fast",duration:150,mode:"out-in"}},[e.compilation_in_progress?i("LoaderSpinner"):e._e()],1)],1):[i("div",{staticClass:"m_stopmotionpanel--toprowbuttons"},[i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.image_index_currently_shown===0&&!e.show_live_feed},on:{click:e.firstImage}},[i("b-icon",{attrs:{icon:"chevron-double-left","aria-label":e.$t("first_image")}})],1),i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.image_index_currently_shown===0&&!e.show_live_feed},on:{click:e.prevImage}},[i("b-icon",{attrs:{icon:"chevron-left","aria-label":e.$t("previous_image")}})],1),i("div",{},[e.preview_playing_event?i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.show_live_feed},on:{click:e.pausePreview}},[i("b-icon",{attrs:{icon:"pause-fill"}}),e._v("   "+e._s(e.$t("pause"))+" ")],1):[i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.medias.length<=1},on:{click:e.previewPlay}},[i("b-icon",{attrs:{icon:"play-fill"}}),e._v("   "+e._s(e.$t("play"))+" ")],1),i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.medias.length<=1},on:{click:function(a){return e.previewPlay({loop:!0})}}},[i("b-icon",{attrs:{icon:"play-circle-fill"}}),e._v("   "+e._s(e.$t("loop"))+" ")],1)]],2),i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.show_live_feed},on:{click:e.nextImage}},[i("b-icon",{attrs:{icon:"chevron-right","aria-label":e.$t("next_image")}})],1),i("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.show_live_feed},on:{click:e.lastImage}},[i("b-icon",{attrs:{icon:"chevron-double-right","aria-label":e.$t("last_image")}})],1)]),i("div",{staticClass:"m_stopmotionpanel--medias"},[i("transition-group",{ref:"mediaPreviews",staticClass:"m_stopmotionpanel--medias--list",attrs:{name:"listComplete"}},[e._l(e.medias,function({media:a,duration:l},m){return i("div",{key:a.$path,staticClass:"m_stopmotionpanel--medias--list--items",class:{"is--current_single":e.previous_photo_to_show&&e.previous_photo_to_show.$path===a.$path&&!e.show_live_feed},on:{click:function(o){e.previous_photo_to_show=a,e.$emit("update:show_live_feed",!1)}}},[i("MediaContent",{attrs:{file:a,resolution:240}}),i("div",{staticClass:"_optionBtns"},[l>1||e.photoIsActive(a.$path)?i("button",{staticClass:"u-button u-button_small u-button_bleumarine",attrs:{type:"button",title:e.$t("duration")},on:{click:function(o){e.show_duration_menu=!e.show_duration_menu}}},[i("b-icon",{attrs:{icon:"clock"}}),e._v(" "+e._s(l)+" ")],1):e._e(),e.show_duration_menu&&e.photoIsActive(a.$path)?i("ImageDurationPicker",{attrs:{value:e.current_photo_duration,frame_rate:e.stopmotion_frame_rate},on:{close:function(o){e.show_duration_menu=!1},save:function(o){return e.updateMediaDurationForCurrentPreviousPhoto(o,m)}}}):e._e(),e.photoIsActive(a.$path)?[i("RemoveMenu",{attrs:{modal_title:e.$t("remove_this_image")},on:{remove:function(o){return e.removeMedia(a.$path)}}},[i("button",{staticClass:"u-button u-button_small u-button_red",attrs:{slot:"trigger",type:"button",title:e.$t("remove_this_image")},slot:"trigger"},[i("b-icon",{attrs:{icon:"trash"}})],1)]),i("button",{staticClass:"u-button u-button_small",attrs:{type:"button"},on:{click:function(o){e.show_options_menu=!e.show_options_menu}}},[i("b-icon",{attrs:{icon:"three-dots"}})],1),e.show_options_menu?i("BaseModal2",{attrs:{title:e.$t("options")},on:{close:function(o){e.show_options_menu=!1}}},[i("MediaContent",{attrs:{file:a,resolution:1600}}),i("div",{staticClass:"u-spacingBottom"}),i("div",{staticClass:"u-sameRow"},[i("div",[i("DownloadFile",{attrs:{file:a}})],1),i("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:function(o){return e.saveToProject(a.$path)}}},[i("span",{staticClass:"u-icon",domProps:{innerHTML:e._s(e.dodoc_icon_collect)}}),e._v(" "+e._s(e.$t("save_to_project"))+" ")])]),e.status_saving_to_project?i("div",{staticClass:"_saveNotice"},[e.status_saving_to_project==="saving"?i("div",[i("LoaderSpinner"),e._v(" "+e._s(e.$t("saving"))+" ")],1):e.status_saving_to_project==="saved"?i("div",[e._v(" "+e._s(e.$t("media_was_saved_to_project"))+" ")]):e._e()]):e._e()],1):e._e()]:e._e()],2)],1)}),i("div",{key:"live_feed",staticClass:"m_stopmotionpanel--medias--list--items",class:{"is--current_single":e.show_live_feed},attrs:{"data-content":e.$t("live")},on:{click:e.showVideoFeed}},[i("video",{ref:"videoElement",attrs:{autoplay:"",playsinline:"",muted:""},domProps:{muted:!0,srcObject:e.stream}}),e.show_live_feed?i("div",{key:"_onion_skin",staticClass:"_onion_skin"},[i("label",{},[i("span",[e._v(e._s(e.$t("onion_skin").toLowerCase()))]),i("input",{staticClass:"_onion_skin_range",attrs:{type:"range",min:"0",max:".9",step:"0.01","data-use":"onionskin"},domProps:{value:e.onion_skin_opacity},on:{input:function(a){return e.$emit("update:onion_skin_opacity",+a.target.value)}}})])]):e._e()])],2)],1)],e.validating_video_preview?i("MediaValidationButtons",{attrs:{media_is_being_sent:e.media_is_being_sent,can_add_to_fav:!0,cancelButtonIsBackButton:!0},on:{cancel:e.backToStopmotion,save:function(a){return e.exportStopmotion()},save_and_fav:function(a){return e.exportStopmotion({fav:!0})}}}):e._e(),e.media_is_being_sent?i("div",{staticClass:"_loader"},[i("LoaderSpinner")],1):e._e()]:i("LoaderSpinner")],2)},jt=[],Gt=he(Ht,Wt,jt,!1,null,"b7bc7fd5");const zt=Gt.exports,qt={props:{location_to_add_to_medias:Object},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{newPosition(d){this.$emit("update:location_to_add_to_medias",d),setTimeout(()=>{this.$emit("close")},1e3)}}};var Kt=function(){var e=this,i=e._self._c;return i("BaseModal2",{attrs:{title:e.$t("location")},on:{close:function(a){return e.$emit("close")}}},[i("div",{staticClass:"u-instructions u-spacingBottom"},[e._v(" "+e._s(e.$t("location_stored_in_localstorage"))+" ")]),i("PositionPicker",{attrs:{field_name:"$location",content:e.location_to_add_to_medias,can_edit:!0},on:{newPosition:e.newPosition}})],1)},Xt=[],Jt=he(qt,Kt,Xt,!1,null,"923bb630");const Yt=Jt.exports,Qt={props:{label:String,pane_type:String},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var Zt=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_capturePane",attrs:{"data-type":e.pane_type}},[i("div",{staticClass:"_topbar"},[i("div",{staticClass:"_topbar--title"},[i("h3",{},[e._v(" "+e._s(e.label)+" ")]),i("button",{staticClass:"u-button u-button_icon _close_button",attrs:{type:"button"},on:{click:function(a){return e.$emit("close")}}},[i("b-icon",{attrs:{icon:"x-lg",label:e.$t("close")}})],1)])]),e._t("default")],2)},ei=[],ti=he(Qt,Zt,ei,!1,null,"409b3941");const ii=ti.exports;var lt={exports:{}};(function(d,e){var i=function(a,l){var m="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(t){t&&(typeof window<"u"||typeof Q>"u"||(Q.navigator={userAgent:m,getUserMedia:function(){}},Q.console||(Q.console={}),typeof Q.console.debug>"u"&&(Q.console.debug=Q.console.info=Q.console.error=Q.console.log=Q.console.log||function(){console.log(arguments)}),typeof document>"u"&&(t.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var p={getContext:function(){return p},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return p},document.addEventListener=document.removeEventListener=t.addEventListener=t.removeEventListener=function(){},t.HTMLVideoElement=t.HTMLMediaElement=function(){}),typeof io>"u"&&(t.io=function(){return{on:function(p,f){f=f||function(){},p==="connect"&&f()},emit:function(p,f,R){R=R||function(){},(p==="open-room"||p==="join-room")&&R(!0,f.sessionid,null)}}}),typeof location>"u"&&(t.location={protocol:"file:",href:"",hash:"",origin:"self"}),typeof screen>"u"&&(t.screen={width:0,height:0}),typeof URL>"u"&&(t.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),t.window=Q))})(typeof Q<"u"?Q:null);function o(t,p){function f(h){return!h.audio&&!h.video&&!h.screen&&h.data}var R="";R+="?userid="+t.userid,R+="&sessionid="+t.sessionid,R+="&msgEvent="+t.socketMessageEvent,R+="&socketCustomEvent="+t.socketCustomEvent,R+="&autoCloseEntireSession="+!!t.autoCloseEntireSession,t.session.broadcast===!0&&(R+="&oneToMany=true"),R+="&maxParticipantsAllowed="+t.maxParticipantsAllowed,t.enableScalableBroadcast&&(R+="&enableScalableBroadcast=true",R+="&maxRelayLimitPerUser="+(t.maxRelayLimitPerUser||2)),R+="&extra="+JSON.stringify(t.extra||{}),t.socketCustomParameters&&(R+=t.socketCustomParameters);try{io.sockets={}}catch{}if(t.socketURL||(t.socketURL="/"),t.socketURL.substr(t.socketURL.length-1,1)!="/")throw'"socketURL" MUST end with a slash.';t.enableLogs&&(t.socketURL=="/"?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",t.socketURL));try{t.socket=io(t.socketURL+R)}catch{t.socket=io.connect(t.socketURL+R,t.socketOptions)}var g=t.multiPeersHandler;t.socket.on("extra-data-updated",function(h,E){t.peers[h]&&(t.peers[h].extra=E,t.onExtraDataUpdated({userid:h,extra:E}),v(h,E))});function v(h,E){t.peersBackup[h]||(t.peersBackup[h]={userid:h,extra:{}}),t.peersBackup[h].extra=E}function y(h){if(h.remoteUserId==t.userid){if(t.peers[h.sender]&&t.peers[h.sender].extra!=h.message.extra&&(t.peers[h.sender].extra=h.extra,t.onExtraDataUpdated({userid:h.sender,extra:h.extra}),v(h.sender,h.extra)),h.message.streamSyncNeeded&&t.peers[h.sender]){var E=t.streamEvents[h.message.streamid];if(!E||!E.stream)return;var U=h.message.action;if(U==="ended"||U==="inactive"||U==="stream-removed"){t.peersBackup[E.userid]&&(E.extra=t.peersBackup[E.userid].extra),t.onstreamended(E);return}var j=h.message.type!="both"?h.message.type:null;typeof E.stream[U]=="function"&&E.stream[U](j);return}if(h.message==="dropPeerConnection"){t.deletePeer(h.sender);return}if(h.message.allParticipants){h.message.allParticipants.indexOf(h.sender)===-1&&h.message.allParticipants.push(h.sender),h.message.allParticipants.forEach(function(s){g[t.peers[s]?"renegotiatePeer":"createNewPeer"](s,{localPeerSdpConstraints:{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!t.session.oneway||t.direction==="one-way",isDataOnly:f(t.session)})});return}if(h.message.newParticipant){if(h.message.newParticipant==t.userid||t.peers[h.message.newParticipant])return;g.createNewPeer(h.message.newParticipant,h.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!t.session.oneway||t.direction==="one-way",isDataOnly:f(t.session)});return}if(h.message.readyForOffer&&(t.attachStreams.length&&(t.waitingForLocalMedia=!1),t.waitingForLocalMedia)){setTimeout(function(){y(h)},1);return}if(h.message.newParticipationRequest&&h.sender!==t.userid){t.peers[h.sender]&&t.deletePeer(h.sender);var L={extra:h.extra||{},localPeerSdpConstraints:h.message.remotePeerSdpConstraints||{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:h.message.localPeerSdpConstraints||{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:typeof h.message.isOneWay<"u"?h.message.isOneWay:!!t.session.oneway||t.direction==="one-way",isDataOnly:typeof h.message.isDataOnly<"u"?h.message.isDataOnly:f(t.session),dontGetRemoteStream:typeof h.message.isOneWay<"u"?h.message.isOneWay:!!t.session.oneway||t.direction==="one-way",dontAttachLocalStream:!!h.message.dontGetRemoteStream,connectionDescription:h,successCallback:function(){}};t.onNewParticipant(h.sender,L);return}if(h.message.changedUUID&&t.peers[h.message.oldUUID]&&(t.peers[h.message.newUUID]=t.peers[h.message.oldUUID],delete t.peers[h.message.oldUUID]),h.message.userLeft){g.onUserLeft(h.sender),h.message.autoCloseEntireSession&&t.leave();return}g.addNegotiatedMessage(h.message,h.sender)}}t.socket.on(t.socketMessageEvent,y);var k=!1;t.socket.resetProps=function(){k=!1},t.socket.on("connect",function(){k||(k=!0,t.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){t.socket.emit("extra-data-updated",t.extra)},1e3),p&&p(t.socket))}),t.socket.on("disconnect",function(h){t.onSocketDisconnect(h)}),t.socket.on("error",function(h){t.onSocketError(h)}),t.socket.on("user-disconnected",function(h){h!==t.userid&&(t.onUserStatusChanged({userid:h,status:"offline",extra:t.peers[h]?t.peers[h].extra||{}:{}}),t.deletePeer(h))}),t.socket.on("user-connected",function(h){h!==t.userid&&t.onUserStatusChanged({userid:h,status:"online",extra:t.peers[h]?t.peers[h].extra||{}:{}})}),t.socket.on("closed-entire-session",function(h,E){t.leave(),t.onEntireSessionClosed({sessionid:h,userid:h,extra:E})}),t.socket.on("userid-already-taken",function(h,E){t.onUserIdAlreadyTaken(h,E)}),t.socket.on("logs",function(h){t.enableLogs&&console.debug("server-logs",h)}),t.socket.on("number-of-broadcast-viewers-updated",function(h){t.onNumberOfBroadcastViewersUpdated(h)}),t.socket.on("set-isInitiator-true",function(h){h==t.sessionid&&(t.isInitiator=!0)})}function w(t){var p=this,f=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];t.peers={getLength:function(){var v=0;for(var y in this)f.indexOf(y)==-1&&v++;return v},selectFirst:function(){var v;for(var y in this)f.indexOf(y)==-1&&(v=this[y]);return v},getAllParticipants:function(v){var y=[];for(var k in this)f.indexOf(k)==-1&&k!=v&&y.push(k);return y},forEach:function(v){this.getAllParticipants().forEach(function(y){v(t.peers[y])})},send:function(v,y){var k=this;if(!B(v.size)&&!B(v.type)){if(t.enableFileSharing){p.shareFile(v,y);return}typeof v!="string"&&(v=JSON.stringify(v))}if(v.type!=="text"&&!(v instanceof ArrayBuffer)&&!(v instanceof DataView)){S.send({text:v,channel:this,connection:t,remoteUserId:y});return}if(v.type==="text"&&(v=JSON.stringify(v)),y){var h=t.peers[y];if(h){if(!h.channels.length){t.peers[y].createDataChannel(),t.renegotiate(y),setTimeout(function(){k.send(v,y)},3e3);return}h.channels.forEach(function(E){E.send(v)});return}}this.getAllParticipants().forEach(function(E){if(!k[E].channels.length){t.peers[E].createDataChannel(),t.renegotiate(E),setTimeout(function(){k[E].channels.forEach(function(U){U.send(v)})},3e3);return}k[E].channels.forEach(function(U){U.send(v)})})}},this.uuid=t.userid,this.getLocalConfig=function(v,y,k){return k||(k={}),{streamsToShare:k.streamsToShare||{},rtcMultiConnection:t,connectionDescription:k.connectionDescription,userid:y,localPeerSdpConstraints:k.localPeerSdpConstraints,remotePeerSdpConstraints:k.remotePeerSdpConstraints,dontGetRemoteStream:!!k.dontGetRemoteStream,dontAttachLocalStream:!!k.dontAttachLocalStream,renegotiatingPeer:!!k.renegotiatingPeer,peerRef:k.peerRef,channels:k.channels||[],onLocalSdp:function(h){p.onNegotiationNeeded(h,y)},onLocalCandidate:function(h){h=Ye.processCandidates(t,h),h&&p.onNegotiationNeeded(h,y)},remoteSdp:v,onDataChannelMessage:function(h){if(!t.fbr&&t.enableFileSharing&&R(),typeof h=="string"||!t.enableFileSharing){p.onDataChannelMessage(h,y);return}var E=this;if(h instanceof ArrayBuffer||h instanceof DataView){t.fbr.convertToObject(h,function(U){E.onDataChannelMessage(U)});return}if(h.readyForNextChunk){t.fbr.getNextChunk(h,function(U,j){t.peers[y].channels.forEach(function(L){L.send(U)})},y);return}if(h.chunkMissing){t.fbr.chunkMissing(h);return}t.fbr.addChunk(h,function(U){t.peers[y].peer.channel.send(U)})},onDataChannelError:function(h){p.onDataChannelError(h,y)},onDataChannelOpened:function(h){p.onDataChannelOpened(h,y)},onDataChannelClosed:function(h){p.onDataChannelClosed(h,y)},onRemoteStream:function(h){t.peers[y]&&t.peers[y].streams.push(h),p.onGettingRemoteMedia(h,y)},onRemoteStreamRemoved:function(h){p.onRemovingRemoteMedia(h,y)},onPeerStateChanged:function(h){p.onPeerStateChanged(h),h.iceConnectionState==="new"&&p.onNegotiationStarted(y,h),h.iceConnectionState==="connected"&&p.onNegotiationCompleted(y,h),h.iceConnectionState.search(/closed|failed/gi)!==-1&&(p.onUserLeft(y),p.disconnectWith(y))}}},this.createNewPeer=function(v,y){if(!(t.maxParticipantsAllowed<=t.getAllParticipants().length)){if(y=y||{},t.isInitiator&&t.session.audio&&t.session.audio==="two-way"&&!y.streamsToShare&&(y.isOneWay=!1,y.isDataOnly=!1,y.session=t.session),!y.isOneWay&&!y.isDataOnly){y.isOneWay=!0,this.onNegotiationNeeded({enableMedia:!0,userPreferences:y},v);return}y=t.setUserPreferences(y,v);var k=this.getLocalConfig(null,v,y);t.peers[v]=new be(k)}},this.createAnsweringPeer=function(v,y,k){k=t.setUserPreferences(k||{},y);var h=this.getLocalConfig(v,y,k);t.peers[y]=new be(h)},this.renegotiatePeer=function(v,y,k){if(!t.peers[v]){t.enableLogs&&console.error("Peer ("+v+") does not exist. Renegotiation skipped.");return}y||(y={}),y.renegotiatingPeer=!0,y.peerRef=t.peers[v].peer,y.channels=t.peers[v].channels;var h=this.getLocalConfig(k,v,y);t.peers[v]=new be(h)},this.replaceTrack=function(v,y,k){if(!t.peers[y])throw"This peer ("+y+") does not exist.";var h=t.peers[y].peer;if(h.getSenders&&typeof h.getSenders=="function"&&h.getSenders().length){h.getSenders().forEach(function(E){k&&E.track.kind==="video"&&(t.peers[y].peer.lastVideoTrack=E.track,E.replaceTrack(v)),!k&&E.track.kind==="audio"&&(t.peers[y].peer.lastAudioTrack=E.track,E.replaceTrack(v))});return}console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(y)},this.onNegotiationNeeded=function(v,y){},this.addNegotiatedMessage=function(v,y){if(v.type&&v.sdp){v.type=="answer"&&t.peers[y]&&t.peers[y].addRemoteSdp(v),v.type=="offer"&&(v.renegotiatingPeer?this.renegotiatePeer(y,null,v):this.createAnsweringPeer(v,y)),t.enableLogs&&console.log("Remote peer's sdp:",v.sdp);return}if(v.candidate){t.peers[y]&&t.peers[y].addRemoteCandidate(v),t.enableLogs&&console.log("Remote peer's candidate pairs:",v.candidate);return}if(v.enableMedia){t.session=v.userPreferences.session||t.session,t.session.oneway&&t.attachStreams.length&&(t.attachStreams=[]),v.userPreferences.isDataOnly&&t.attachStreams.length&&(t.attachStreams.length=[]);var k={};t.attachStreams.forEach(function(h){k[h.streamid]={isAudio:!!h.isAudio,isVideo:!!h.isVideo,isScreen:!!h.isScreen}}),v.userPreferences.streamsToShare=k,p.onNegotiationNeeded({readyForOffer:!0,userPreferences:v.userPreferences},y)}v.readyForOffer&&t.onReadyForOffer(y,v.userPreferences)},this.onGettingRemoteMedia=function(v,y){},this.onRemovingRemoteMedia=function(v,y){},this.onGettingLocalMedia=function(v){},this.onLocalMediaError=function(v,y){t.onMediaError(v,y)};function R(){t.fbr=new FileBufferReader,t.fbr.onProgress=function(v){t.onFileProgress(v)},t.fbr.onBegin=function(v){t.onFileStart(v)},t.fbr.onEnd=function(v){t.onFileEnd(v)}}this.shareFile=function(v,y){R(),t.fbr.readAsArrayBuffer(v,function(k){var h=t.getAllParticipants();y&&(h=[y]),h.forEach(function(E){t.fbr.getNextChunk(k,function(U){t.peers[E].channels.forEach(function(j){j.send(U)})},E)})},{userid:t.userid,chunkSize:DetectRTC.browser.name==="Firefox"?15e3:t.chunkSize||0})};var g=new n(t);this.onDataChannelMessage=function(v,y){g.receive(JSON.parse(v),y,t.peers[y]?t.peers[y].extra:{})},this.onDataChannelClosed=function(v,y){v.userid=y,v.extra=t.peers[y]?t.peers[y].extra:{},t.onclose(v)},this.onDataChannelError=function(v,y){v.userid=y,event.extra=t.peers[y]?t.peers[y].extra:{},t.onerror(v)},this.onDataChannelOpened=function(v,y){if(t.peers[y].channels.length){t.peers[y].channels=[v];return}t.peers[y].channels.push(v),t.onopen({userid:y,extra:t.peers[y]?t.peers[y].extra:{},channel:v})},this.onPeerStateChanged=function(v){t.onPeerStateChanged(v)},this.onNegotiationStarted=function(v,y){},this.onNegotiationCompleted=function(v,y){},this.getRemoteStreams=function(v){return v=v||t.peers.getAllParticipants()[0],t.peers[v]?t.peers[v].streams:[]}}(function(){var t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",H=typeof process=="object"&&typeof process.versions=="object"&&process.versions.node&&!process.browser;if(H){var p=process.versions.node.toString().replace("v","");t="Nodejs/"+p+" (NodeOS) AppleWebKit/"+p+" (KHTML, like Gecko) Nodejs/"+p+" Nodejs/"+p}(function(F){typeof window<"u"||(typeof window>"u"&&typeof Q<"u"&&(Q.navigator={userAgent:t,getUserMedia:function(){}},F.window=Q),typeof location>"u"&&(F.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(F.screen={width:0,height:0}))})(typeof Q<"u"?Q:window);var f=window.navigator;typeof f<"u"?(typeof f.webkitGetUserMedia<"u"&&(f.getUserMedia=f.webkitGetUserMedia),typeof f.mozGetUserMedia<"u"&&(f.getUserMedia=f.mozGetUserMedia)):f={getUserMedia:function(){},userAgent:t};var R=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(f.userAgent||""),g=f.userAgent.indexOf("Edge")!==-1&&(!!f.msSaveOrOpenBlob||!!f.msSaveBlob),v=!!window.opera||f.userAgent.indexOf(" OPR/")>=0,y=typeof window.InstallTrigger<"u",k=/^((?!chrome|android).)*safari/i.test(f.userAgent),h=!!window.chrome&&!v,E=typeof document<"u"&&!!document.documentMode&&!g;function U(){f.appVersion;var F=f.userAgent,K=f.appName,X=""+parseFloat(f.appVersion),Y=parseInt(f.appVersion,10),W,ee,Ae;if(k&&!h&&F.indexOf("CriOS")!==-1&&(k=!1,h=!0),v){K="Opera";try{X=f.userAgent.split("OPR/")[1].split(" ")[0],Y=X.split(".")[0]}catch{X="0.0.0.0",Y=0}}else E?(ee=F.indexOf("rv:"),ee>0?X=F.substring(ee+3):(ee=F.indexOf("MSIE"),X=F.substring(ee+5)),K="IE"):h?(ee=F.indexOf("Chrome"),K="Chrome",X=F.substring(ee+7)):k?(ee=F.indexOf("Safari"),K="Safari",X=F.substring(ee+7),(ee=F.indexOf("Version"))!==-1&&(X=F.substring(ee+8)),f.userAgent.indexOf("Version/")!==-1&&(X=f.userAgent.split("Version/")[1].split(" ")[0])):y?(ee=F.indexOf("Firefox"),K="Firefox",X=F.substring(ee+8)):(W=F.lastIndexOf(" ")+1)<(ee=F.lastIndexOf("/"))&&(K=F.substring(W,ee),X=F.substring(ee+1),K.toLowerCase()===K.toUpperCase()&&(K=f.appName));return g&&(K="Edge",X=f.userAgent.split("Edge/")[1]),(Ae=X.search(/[; \)]/))!==-1&&(X=X.substring(0,Ae)),Y=parseInt(""+X,10),isNaN(Y)&&(X=""+parseFloat(f.appVersion),Y=parseInt(f.appVersion,10)),{fullVersion:X,version:Y,name:K,isPrivateBrowsing:!1}}function j(F,K){var X=0,Y=50,W=!1,ee=window.setInterval(function(){F()&&(window.clearInterval(ee),K(W)),X++>Y&&(window.clearInterval(ee),W=!0,K(W))},10)}function L(F){var K=F.toLowerCase();if(K.indexOf("msie")===0&&K.indexOf("trident")===0)return!1;var X=/(?:msie|rv:)\s?([\d\.]+)/.exec(K);return!!(X&&parseInt(X[1],10)>=10)}function s(F){var K;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){K=!1},function(Y){K=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var X;try{X=window.indexedDB.open("test"),X.onerror=function(){return!0}}catch{K=!0}typeof K>"u"&&j(function(){return X.readyState==="done"},function(W){W||(K=!X.result)})}else if(L(window.navigator.userAgent)){K=!1;try{window.indexedDB||(K=!0)}catch{K=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch{K=!0}typeof K>"u"&&(K=!1,window.localStorage.removeItem("test"))}}catch{K=!1}j(function(){return typeof K<"u"},function(W){F(K)})}var u={Android:function(){return f.userAgent.match(/Android/i)},BlackBerry:function(){return f.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return f.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return f.userAgent.match(/Opera Mini/i)},Windows:function(){return f.userAgent.match(/IEMobile/i)},any:function(){return u.Android()||u.BlackBerry()||u.iOS()||u.Opera()||u.Windows()},getOsName:function(){var F="Unknown OS";return u.Android()&&(F="Android"),u.BlackBerry()&&(F="BlackBerry"),u.iOS()&&(F="iOS"),u.Opera()&&(F="Opera Mini"),u.Windows()&&(F="Windows"),F}};function r(){for(var F="-",K=f.appVersion,X=f.userAgent,Y=F,W=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],ee=0,Ae;Ae=W[ee];ee++)if(Ae.r.test(X)){Y=Ae.s;break}var De=F;switch(/Windows/.test(Y)&&(/Windows (.*)/.test(Y)&&(De=/Windows (.*)/.exec(Y)[1]),Y="Windows"),Y){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(X)&&(De=/Mac OS X (10[\.\_\d]+)/.exec(X)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(X)&&(De=/Android ([\.\_\d]+)/.exec(X)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(X)&&(De=/OS (\d+)_(\d+)_?(\d+)?/.exec(K),De=De[1]+"."+De[2]+"."+(De[3]|0));break}return{osName:Y,osVersion:De}}var c="Unknown OS",T="Unknown OS Version";function O(F){F=(F||f.userAgent).toLowerCase();var K=F.match(/android\s([0-9\.]*)/);return K?K[1]:!1}var z=r();z&&z.osName&&z.osName!="-"?(c=z.osName,T=z.osVersion):u.any()&&(c=u.getOsName(),c=="Android"&&(T=O()));var H=typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;c==="Unknown OS"&&H&&(c="Nodejs",T=process.versions.node.toString().replace("v",""));var Z=!1,ne=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(F){typeof document>"u"||typeof document.createElement!="function"||(!Z&&F in document.createElement("canvas")&&(Z=!0),!ne&&F in document.createElement("video")&&(ne=!0))});var me=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,ie=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,He=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;function Se(F,K){if(A.isWebRTCSupported){var X=!0,Y=!0;ve(function(W){W?W.match(me)?(X=!1,F("Local: "+W,X,Y)):(W.match(He)&&(Y=!1),F("Public: "+W,X,Y)):F()},K)}}function ve(F,K){if(typeof document>"u"||typeof document.getElementById!="function")return;var X={},Y=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!Y){var W=document.getElementById("iframe");if(!W)return;var ee=W.contentWindow;Y=ee.RTCPeerConnection||ee.mozRTCPeerConnection||ee.webkitRTCPeerConnection}if(!Y)return;var Ae=null;A.browser==="Chrome"&&A.browser.version<58&&(Ae={optional:[{RtpDataChannels:!0}]});var De={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},Le=new Y(De,Ae);K&&(Le.addStream?Le.addStream(K):Le.addTrack&&K.getTracks()[0]&&Le.addTrack(K.getTracks()[0],K));function rt(xe){if(!xe){F();return}var Xe=ie.exec(xe);if(Xe){var st=Xe[1],pt=xe.match(me),ht=!0;X[st]===void 0&&F(st,pt,ht),X[st]=!0}}if(Le.onicecandidate=function(xe){xe.candidate&&xe.candidate.candidate?rt(xe.candidate.candidate):rt()},!K)try{Le.createDataChannel("sctp",{})}catch{}A.isPromisesSupported?Le.createOffer().then(function(xe){Le.setLocalDescription(xe).then(ot)}):Le.createOffer(function(xe){Le.setLocalDescription(xe,ot,function(){})},function(){});function ot(){var xe=Le.localDescription.sdp.split(`
`);xe.forEach(function(Xe){Xe&&Xe.indexOf("a=candidate:")===0&&rt(Xe)})}}var ge=[],le=[],pe=[],ce=[];f.mediaDevices&&f.mediaDevices.enumerateDevices&&(f.enumerateDevices=function(F){var K=f.mediaDevices.enumerateDevices();K&&K.then?f.mediaDevices.enumerateDevices().then(F).catch(function(){F([])}):F([])});var Ue=!1;(typeof ye<"u"&&"getSources"in ye||f.mediaDevices&&f.mediaDevices.enumerateDevices)&&(Ue=!0);var Ge=!1,Be=!1,ze=!1,$e=!1,Pe=!1;function qe(F){if(!Ue){F&&F();return}if(!f.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(f.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!f.enumerateDevices&&f.enumerateDevices&&(f.enumerateDevices=f.enumerateDevices.bind(f)),!f.enumerateDevices){F&&F();return}ge=[],le=[],pe=[],ce=[],Ge=!1,Be=!1,ze=!1,$e=!1,Pe=!1;var K={};f.enumerateDevices(function(X){X.forEach(function(Y){var W={};for(var ee in Y)try{typeof Y[ee]!="function"&&(W[ee]=Y[ee])}catch{}K[W.deviceId+W.label+W.kind]||(W.kind==="audio"&&(W.kind="audioinput"),W.kind==="video"&&(W.kind="videoinput"),W.deviceId||(W.deviceId=W.id),W.id||(W.id=W.deviceId),W.label?(W.kind==="videoinput"&&!Pe&&(Pe=!0),W.kind==="audioinput"&&!$e&&($e=!0)):(W.isCustomLabel=!0,W.kind==="videoinput"?W.label="Camera "+(ce.length+1):W.kind==="audioinput"?W.label="Microphone "+(le.length+1):W.kind==="audiooutput"?W.label="Speaker "+(pe.length+1):W.label="Please invoke getUserMedia once.",typeof A<"u"&&A.browser.isChrome&&A.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&typeof document<"u"&&typeof document.domain=="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1&&(W.label="HTTPs is required to get label of this "+W.kind+" device.")),W.kind==="audioinput"&&(Ge=!0,le.indexOf(W)===-1&&le.push(W)),W.kind==="audiooutput"&&(Be=!0,pe.indexOf(W)===-1&&pe.push(W)),W.kind==="videoinput"&&(ze=!0,ce.indexOf(W)===-1&&ce.push(W)),ge.push(W),K[W.deviceId+W.label+W.kind]=W)}),typeof A<"u"&&(A.MediaDevices=ge,A.hasMicrophone=Ge,A.hasSpeakers=Be,A.hasWebcam=ze,A.isWebsiteHasWebcamPermissions=Pe,A.isWebsiteHasMicrophonePermissions=$e,A.audioInputDevices=le,A.audioOutputDevices=pe,A.videoInputDevices=ce),F&&F()})}var A=window.DetectRTC||{};A.browser=U(),s(function(F){A.browser.isPrivateBrowsing=!!F}),A.browser["is"+A.browser.name]=!0,A.osName=c,A.osVersion=T,typeof process=="object"&&typeof process.versions=="object"&&process.versions["node-webkit"];var We=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(F){We||F in window&&(We=!0)}),A.isWebRTCSupported=We,A.isORTCSupported=typeof RTCIceGatherer<"u";var ae=!1;if((A.browser.isChrome&&A.browser.version>=35||A.browser.isFirefox&&A.browser.version>=34||A.browser.isEdge&&A.browser.version>=17||A.osName==="Android"&&A.browser.isChrome)&&(ae=!0),!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){var at=typeof document<"u"&&typeof document.domain=="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1;(at&&(A.browser.isChrome||A.browser.isEdge||A.browser.isOpera)||A.browser.isFirefox)&&(ae=!1)}A.isScreenCapturingSupported=ae;var Ie={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(F){Ie.isSupported||F in window&&(Ie.isSupported=!0,window[F]&&"createMediaStreamSource"in window[F].prototype&&(Ie.isCreateMediaStreamSourceSupported=!0))}),A.isAudioContextSupported=Ie.isSupported,A.isCreateMediaStreamSourceSupported=Ie.isCreateMediaStreamSourceSupported;var Ze=!1;A.browser.isChrome&&A.browser.version>31&&(Ze=!0),A.isRtpDataChannelsSupported=Ze;var Fe=!1;(A.browser.isFirefox&&A.browser.version>28||A.browser.isChrome&&A.browser.version>25||A.browser.isOpera&&A.browser.version>=11)&&(Fe=!0),A.isSctpDataChannelsSupported=Fe,A.isMobileDevice=R;var re=!1;(f.getUserMedia||f.mediaDevices&&f.mediaDevices.getUserMedia)&&(re=!0),A.browser.isChrome&&A.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&typeof document<"u"&&typeof document.domain=="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1&&(re="Requires HTTPs"),A.osName==="Nodejs"&&(re=!1),A.isGetUserMediaSupported=re;var ke="";if(screen.width){var we=screen.width?screen.width:"",Ce=screen.height?screen.height:"";ke+=""+we+" x "+Ce}A.displayResolution=ke;function fe(F,K){function X(W,ee){return ee==0?W:X(ee,W%ee)}var Y=X(F,K);return F/Y/(K/Y)}A.displayAspectRatio=fe(screen.width,screen.height).toFixed(2),A.isCanvasSupportsStreamCapturing=Z,A.isVideoSupportsStreamCapturing=ne,A.browser.name=="Chrome"&&A.browser.version>=53&&(A.isCanvasSupportsStreamCapturing||(A.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),A.isVideoSupportsStreamCapturing||(A.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),A.DetectLocalIPAddress=Se,A.isWebSocketsSupported="WebSocket"in window&&window.WebSocket.CLOSING===2,A.isWebSocketsBlocked=!A.isWebSocketsSupported,A.osName==="Nodejs"&&(A.isWebSocketsSupported=!0,A.isWebSocketsBlocked=!1),A.checkWebSocketsSupport=function(F){F=F||function(){};try{var K,X=new WebSocket("wss://echo.websocket.org:443/");X.onopen=function(){A.isWebSocketsBlocked=!1,K=new Date().getTime(),X.send("ping")},X.onmessage=function(){A.WebsocketLatency=new Date().getTime()-K+"ms",F(),X.close(),X=null},X.onerror=function(){A.isWebSocketsBlocked=!0,F()}}catch{A.isWebSocketsBlocked=!0,F()}},A.load=function(F){F=F||function(){},qe(F)},typeof ge<"u"?A.MediaDevices=ge:A.MediaDevices=[],A.hasMicrophone=Ge,A.hasSpeakers=Be,A.hasWebcam=ze,A.isWebsiteHasWebcamPermissions=Pe,A.isWebsiteHasMicrophonePermissions=$e,A.audioInputDevices=le,A.audioOutputDevices=pe,A.videoInputDevices=ce;var Me=!1;typeof document<"u"&&typeof document.createElement=="function"&&"setSinkId"in document.createElement("video")&&(Me=!0),A.isSetSinkIdSupported=Me;var Ee=!1;A.browser.isFirefox&&typeof mozRTCPeerConnection<"u"?"getSenders"in mozRTCPeerConnection.prototype&&(Ee=!0):A.browser.isChrome&&typeof webkitRTCPeerConnection<"u"&&"getSenders"in webkitRTCPeerConnection.prototype&&(Ee=!0),A.isRTPSenderReplaceTracksSupported=Ee;var Ke=!1;A.browser.isFirefox&&A.browser.version>38&&(Ke=!0),A.isRemoteStreamProcessingSupported=Ke;var Je=!1;typeof ye<"u"&&"applyConstraints"in ye.prototype&&(Je=!0),A.isApplyConstraintsSupported=Je;var et=!1;A.browser.isFirefox&&A.browser.version>=43&&(et=!0),A.isMultiMonitorScreenCapturingSupported=et,A.isPromisesSupported="Promise"in window,A.version="1.3.9",typeof A>"u"&&(window.DetectRTC={});var je=window.MediaStream;typeof je>"u"&&typeof webkitMediaStream<"u"&&(je=webkitMediaStream),typeof je<"u"&&typeof je=="function"?A.MediaStream=Object.keys(je.prototype):A.MediaStream=!1,typeof ye<"u"?A.MediaStreamTrack=Object.keys(ye.prototype):A.MediaStreamTrack=!1;var nt=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;typeof nt<"u"?A.RTCPeerConnection=Object.keys(nt.prototype):A.RTCPeerConnection=!1,window.DetectRTC=A,d.exports=A})(),typeof cordova<"u"&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome");function b(t,p,f){if(!(typeof CustomEvent>"u")){var R={arguments:f,__exposedProps__:f},g=new CustomEvent(p,R);t.dispatchEvent(g)}}function M(t,p){if(!(!p.stream||!q(p.stream,"audio").length)){if(!t||!p)throw"Both arguments are required.";if(!(!t.onspeaking||!t.onsilence)){if(typeof hark>"u")throw"hark.js not found.";hark(p.stream,{onspeaking:function(){t.onspeaking(p)},onsilence:function(){t.onsilence(p)},onvolumechange:function(f,R){t.onvolumechange&&t.onvolumechange(merge({volume:f,threshold:R},p))}})}}}function _(t,p){!p.stream||!p.stream||!p.stream.addEventListener||(p.stream.addEventListener("mute",function(f){f=t.streamEvents[p.streamid],f.session={audio:f.muteType==="audio",video:f.muteType==="video"},t.onmute(f)},!1),p.stream.addEventListener("unmute",function(f){f=t.streamEvents[p.streamid],f.session={audio:f.unmuteType==="audio",video:f.unmuteType==="video"},t.onunmute(f)},!1))}function D(){if(window.crypto&&window.crypto.getRandomValues&&navigator.userAgent.indexOf("Safari")===-1){for(var t=window.crypto.getRandomValues(new Uint32Array(3)),p="",f=0,R=t.length;f<R;f++)p+=t[f].toString(36);return p}else return(Math.random()*new Date().getTime()).toString(36).replace(/\./g,"")}function x(t,p,f){if(!f.autoCreateMediaElement){p({});return}var R=!1;!q(t,"video").length&&!t.isVideo&&!t.isScreen&&(R=!0),DetectRTC.browser.name==="Firefox"&&(f.session.video||f.session.screen)&&(R=!1);var g=document.createElement(R?"audio":"video");if(g.srcObject=t,g.setAttribute("autoplay",!0),g.setAttribute("playsinline",!0),g.setAttribute("controls",!0),g.setAttribute("muted",!1),g.setAttribute("volume",1),DetectRTC.browser.name==="Firefox"){var v="ended";"oninactive"in g&&(v="inactive"),g.addEventListener(v,function(){if(currentUserMediaRequest.remove(t.idInstance),t.type==="local"){v="ended","oninactive"in t&&(v="inactive"),C.onSyncNeeded(t.streamid,v),f.attachStreams.forEach(function(U,j){t.streamid===U.streamid&&delete f.attachStreams[j]});var h=[];f.attachStreams.forEach(function(U){U&&h.push(U)}),f.attachStreams=h;var E=f.streamEvents[t.streamid];if(E){f.onstreamended(E);return}this.parentNode&&this.parentNode.removeChild(this)}},!1)}var y=g.play();if(typeof y<"u"){var k=!1;setTimeout(function(){k||(k=!0,p(g))},1e3),y.then(function(){k||(k=!0,p(g))}).catch(function(h){k||(k=!0,p(g))})}else p(g)}window.addEventListener||(window.addEventListener=function(t,p,f){t.attachEvent&&t.attachEvent("on"+p,f)});function N(t,p){window.removeEventListener(t,p),window.addEventListener(t,p,!1)}window.attachEventListener=function(t,p,f,R){t.addEventListener(p,f,R)};function I(t){var p=[];return t.forEach(function(f){f&&p.push(f)}),p}function G(t){return!t.audio&&!t.video&&!t.screen&&t.data}function B(t){return typeof t>"u"}function V(t){return typeof t=="string"}var J=window.MediaStream;typeof J>"u"&&typeof webkitMediaStream<"u"&&(J=webkitMediaStream),typeof J<"u"&&("stop"in J.prototype||(J.prototype.stop=function(){this.getTracks().forEach(function(t){t.stop()})}));function te(t,p){return t.session.audio&&t.session.audio==="two-way"?!1:DetectRTC.browser.name==="Firefox"&&p!==!1?!0:DetectRTC.browser.name!=="Chrome"||DetectRTC.browser.version<50?!1:typeof p===!0?!0:typeof p>"u"&&t.session.audio&&t.session.screen&&!t.session.video?(p=!0,!0):!1}window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker";function q(t,p){return!t||!t.getTracks?[]:t.getTracks().filter(function(f){return f.kind===(p||"audio")})}function Re(){var t=!1;try{if(typeof RTCRtpTransceiver>"u"||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var p=new ue;try{p.addTransceiver("audio"),t=!0}catch{}p.close()}catch{t=!1}return t&&Te()}function Te(){var t=!1;try{var p=new ue({sdpSemantics:"unified-plan"});try{var f=p.getConfiguration();f.sdpSemantics=="unified-plan"?t=!0:(f.sdpSemantics=="plan-b",t=!1)}catch{t=!1}}catch{t=!1}return t}function oe(){if(!(typeof cordova>"u"||typeof cordova.plugins>"u"||typeof cordova.plugins.iosrtc>"u")){var t=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=t.RTCPeerConnection,window.RTCSessionDescription=t.RTCSessionDescription,window.RTCIceCandidate=t.RTCIceCandidate,window.MediaStream=t.MediaStream,window.MediaStreamTrack=t.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=t.getUserMedia,t.debug.enable("iosrtc*"),typeof t.selectAudioOutput=="function"&&t.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),t.registerGlobals()}}document.addEventListener("deviceready",oe,!1),oe();var se={};function de(t){var p={OfferToReceiveAudio:!!t.OfferToReceiveAudio,OfferToReceiveVideo:!!t.OfferToReceiveVideo};return p}var ue;typeof window.RTCPeerConnection<"u"?ue=window.RTCPeerConnection:typeof mozRTCPeerConnection<"u"?ue=mozRTCPeerConnection:typeof webkitRTCPeerConnection<"u"&&(ue=webkitRTCPeerConnection);var Ne=window.RTCSessionDescription||window.mozRTCSessionDescription,Ve=window.RTCIceCandidate||window.mozRTCIceCandidate,ye=window.MediaStreamTrack;function be(t){if(typeof window.RTCPeerConnection<"u"?ue=window.RTCPeerConnection:typeof mozRTCPeerConnection<"u"?ue=mozRTCPeerConnection:typeof webkitRTCPeerConnection<"u"&&(ue=webkitRTCPeerConnection),Ne=window.RTCSessionDescription||window.mozRTCSessionDescription,Ve=window.RTCIceCandidate||window.mozRTCIceCandidate,ye=window.MediaStreamTrack,!ue)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var p=t.rtcMultiConnection;this.extra=t.remoteSdp?t.remoteSdp.extra:p.extra,this.userid=t.userid,this.streams=[],this.channels=t.channels||[],this.connectionDescription=t.connectionDescription,this.addStream=function(r){p.addStream(r,f.userid)},this.removeStream=function(r){p.removeStream(r,f.userid)};var f=this;t.remoteSdp&&(this.connectionDescription=t.remoteSdp.connectionDescription);var R={};se.sdpConstraints=de({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var g,v=!!t.renegotiatingPeer;t.remoteSdp&&(v=!!t.remoteSdp.renegotiatingPeer);var y=[];if(p.attachStreams.forEach(function(r){r&&y.push(r)}),v)g=t.peerRef;else{var k="all";(p.candidates.turn||p.candidates.relay)&&!p.candidates.stun&&!p.candidates.reflexive&&!p.candidates.host&&(k="relay");try{var h={iceServers:p.iceServers,iceTransportPolicy:p.iceTransportPolicy||k};typeof p.iceCandidatePoolSize<"u"&&(h.iceCandidatePoolSize=p.iceCandidatePoolSize),typeof p.bundlePolicy<"u"&&(h.bundlePolicy=p.bundlePolicy),typeof p.rtcpMuxPolicy<"u"&&(h.rtcpMuxPolicy=p.rtcpMuxPolicy),p.sdpSemantics&&(h.sdpSemantics=p.sdpSemantics||"unified-plan"),(!p.iceServers||!p.iceServers.length)&&(h=null,p.optionalArgument=null),g=new ue(h,p.optionalArgument)}catch{try{var h={iceServers:p.iceServers};g=new ue(h)}catch{g=new ue}}}!g.getRemoteStreams&&g.getReceivers&&(g.getRemoteStreams=function(){var r=new J;return g.getReceivers().forEach(function(c){r.addTrack(c.track)}),[r]}),!g.getLocalStreams&&g.getSenders&&(g.getLocalStreams=function(){var r=new J;return g.getSenders().forEach(function(c){r.addTrack(c.track)}),[r]}),g.onicecandidate=function(r){if(!r.candidate){if(!p.trickleIce){var c=g.localDescription;t.onLocalSdp({type:c.type,sdp:c.sdp,remotePeerSdpConstraints:t.remotePeerSdpConstraints||!1,renegotiatingPeer:!!t.renegotiatingPeer||!1,connectionDescription:f.connectionDescription,dontGetRemoteStream:!!t.dontGetRemoteStream,extra:p?p.extra:{},streamsToShare:s})}return}p.trickleIce&&t.onLocalCandidate({candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex})},y.forEach(function(r){t.remoteSdp&&t.remoteSdp.remotePeerSdpConstraints&&t.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||t.dontAttachLocalStream||(r=p.beforeAddingStream(r,f),r&&(g.getLocalStreams().forEach(function(c){r&&c.id==r.id&&(r=null)}),r&&r.getTracks&&r.getTracks().forEach(function(c){try{g.addTrack(c,r)}catch{}})))}),g.oniceconnectionstatechange=g.onsignalingstatechange=function(){var r=f.extra;p.peers[f.userid]&&(r=p.peers[f.userid].extra||r),g&&(t.onPeerStateChanged({iceConnectionState:g.iceConnectionState,iceGatheringState:g.iceGatheringState,signalingState:g.signalingState,extra:r,userid:f.userid}),g&&g.iceConnectionState&&g.iceConnectionState.search(/closed|failed/gi)!==-1&&f.streams instanceof Array&&f.streams.forEach(function(c){var T=p.streamEvents[c.id]||{streamid:c.id,stream:c,type:"remote"};p.onstreamended(T)}))};var E={OfferToReceiveAudio:!!y.length,OfferToReceiveVideo:!!y.length};t.localPeerSdpConstraints&&(E=t.localPeerSdpConstraints),se.sdpConstraints=de(E);var U={};g.ontrack=function(r){if(!(!r||r.type!=="track")){if(r.stream=r.streams[r.streams.length-1],r.stream.id||(r.stream.id=r.track.id),U[r.stream.id]&&DetectRTC.browser.name!=="Safari"){r.track&&(r.track.onended=function(){g&&g.onremovestream(r)});return}U[r.stream.id]=r.stream.id;var c={};t.remoteSdp&&t.remoteSdp.streamsToShare?c=t.remoteSdp.streamsToShare:t.streamsToShare&&(c=t.streamsToShare);var T=c[r.stream.id];T?(r.stream.isAudio=T.isAudio,r.stream.isVideo=T.isVideo,r.stream.isScreen=T.isScreen):(r.stream.isVideo=!!q(r.stream,"video").length,r.stream.isAudio=!r.stream.isVideo,r.stream.isScreen=!1),r.stream.streamid=r.stream.id,R[r.stream.id]=r.stream,t.onRemoteStream(r.stream),r.stream.getTracks().forEach(function(O){O.onended=function(){g&&g.onremovestream(r)}}),r.stream.onremovetrack=function(){g&&g.onremovestream(r)}}},g.onremovestream=function(r){r.stream.streamid=r.stream.id,R[r.stream.id]&&delete R[r.stream.id],t.onRemoteStreamRemoved(r.stream)},typeof g.removeStream!="function"&&(g.removeStream=function(r){r.getTracks().forEach(function(c){g.removeTrack(c,r)})}),this.addRemoteCandidate=function(r){g.addIceCandidate(new Ve(r))},this.addRemoteSdp=function(r,c){c=c||function(){},DetectRTC.browser.name!=="Safari"&&(r.sdp=p.processSdp(r.sdp)),g.setRemoteDescription(new Ne(r)).then(c,function(T){p.enableLogs&&console.error("setRemoteDescription failed",`
`,T,`
`,r.sdp),c()}).catch(function(T){p.enableLogs&&console.error("setRemoteDescription failed",`
`,T,`
`,r.sdp),c()})};var j=!0;t.remoteSdp&&(j=!1),this.createDataChannel=function(){var r=g.createDataChannel("sctp",{});L(r)},p.session.data===!0&&!v&&(j?this.createDataChannel():g.ondatachannel=function(r){var c=r.channel;L(c)}),this.enableDisableVideoEncoding=function(r){var c;if(g.getSenders().forEach(function(O){!c&&O.track.kind==="video"&&(c=O)}),!(!c||!c.getParameters)){var T=c.getParameters();T.encodings[1]&&(T.encodings[1].active=!!r),T.encodings[2]&&(T.encodings[2].active=!!r),c.setParameters(T)}},t.remoteSdp&&(t.remoteSdp.remotePeerSdpConstraints&&(E=t.remoteSdp.remotePeerSdpConstraints),se.sdpConstraints=de(E),this.addRemoteSdp(t.remoteSdp,function(){u("createAnswer")}));function L(r){r.binaryType="arraybuffer",r.onmessage=function(c){t.onDataChannelMessage(c.data)},r.onopen=function(){t.onDataChannelOpened(r)},r.onerror=function(c){t.onDataChannelError(c)},r.onclose=function(c){t.onDataChannelClosed(c)},r.internalSend=r.send,r.send=function(c){r.readyState==="open"&&r.internalSend(c)},g.channel=r}(p.session.audio=="two-way"||p.session.video=="two-way"||p.session.screen=="two-way")&&(se.sdpConstraints=de({OfferToReceiveAudio:p.session.audio=="two-way"||t.remoteSdp&&t.remoteSdp.remotePeerSdpConstraints&&t.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:p.session.video=="two-way"||p.session.screen=="two-way"||t.remoteSdp&&t.remoteSdp.remotePeerSdpConstraints&&t.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var s={};g.getLocalStreams().forEach(function(r){s[r.streamid]={isAudio:!!r.isAudio,isVideo:!!r.isVideo,isScreen:!!r.isScreen}});function u(r){g[r](se.sdpConstraints).then(function(c){DetectRTC.browser.name!=="Safari"&&(c.sdp=p.processSdp(c.sdp)),g.setLocalDescription(c).then(function(){p.trickleIce&&(t.onLocalSdp({type:c.type,sdp:c.sdp,remotePeerSdpConstraints:t.remotePeerSdpConstraints||!1,renegotiatingPeer:!!t.renegotiatingPeer||!1,connectionDescription:f.connectionDescription,dontGetRemoteStream:!!t.dontGetRemoteStream,extra:p?p.extra:{},streamsToShare:s}),p.onSettingLocalDescription(f))},function(T){p.enableLogs&&console.error("setLocalDescription error",T)})},function(c){p.enableLogs&&console.error("sdp-error",c)})}j&&u("createOffer"),g.nativeClose=g.close,g.close=function(){if(g){try{g.nativeClose!==g.close&&g.nativeClose()}catch{}g=null,f.peer=null}},this.peer=g}var _e=function(){function t(u,r){var c=f(u);return!c.videoCodecNumbers||r==="vp8"&&c.vp8LineNumber===c.videoCodecNumbers[0]||r==="vp9"&&c.vp9LineNumber===c.videoCodecNumbers[0]||r==="h264"&&c.h264LineNumber===c.videoCodecNumbers[0]||(u=p(u,r,c)),u}function p(u,r,c,T){var O="";if(r==="vp8"){if(!c.vp8LineNumber)return u;O=c.vp8LineNumber}if(r==="vp9"){if(!c.vp9LineNumber)return u;O=c.vp9LineNumber}if(r==="h264"){if(!c.h264LineNumber)return u;O=c.h264LineNumber}var z=c.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",H=[O];return T&&(H=[]),c.videoCodecNumbers.forEach(function(Z){Z!==O&&H.push(Z)}),z+=H.join(" "),u=u.replace(c.videoCodecNumbersOriginal,z),u}function f(u){var r={};return u.split(`
`).forEach(function(c){c.indexOf("m=video")===0&&(r.videoCodecNumbers=[],c.split("SAVPF")[1].split(" ").forEach(function(T){T=T.trim(),!(!T||!T.length)&&(r.videoCodecNumbers.push(T),r.videoCodecNumbersOriginal=c)})),c.indexOf("VP8/90000")!==-1&&!r.vp8LineNumber&&(r.vp8LineNumber=c.replace("a=rtpmap:","").split(" ")[0]),c.indexOf("VP9/90000")!==-1&&!r.vp9LineNumber&&(r.vp9LineNumber=c.replace("a=rtpmap:","").split(" ")[0]),c.indexOf("H264/90000")!==-1&&!r.h264LineNumber&&(r.h264LineNumber=c.replace("a=rtpmap:","").split(" ")[0])}),r}function R(u){var r=f(u);return u=p(u,"vp9",r,!0),u=p(u,"vp8",r,!0),u}function g(u){if(!u||typeof u!="string")throw"Invalid arguments.";return u=u.replace(`a=rtcp-fb:126 nack\r
`,""),u=u.replace(`a=rtcp-fb:126 nack pli\r
`,`a=rtcp-fb:126 pli\r
`),u=u.replace(`a=rtcp-fb:97 nack\r
`,""),u=u.replace(`a=rtcp-fb:97 nack pli\r
`,`a=rtcp-fb:97 pli\r
`),u}function v(u,r){if(!(!r||!r.getSenders||!r.getSenders().length)){if(!u||typeof u!="string")throw"Invalid arguments.";r.getSenders().forEach(function(c){for(var T=c.getParameters(),O=0;O<T.codecs.length;O++)if(T.codecs[O].mimeType==u){T.codecs.unshift(T.codecs.splice(O,1));break}c.setParameters(T)})}}function y(u){return u.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function k(u,r,c){return!r||typeof isFirefox<"u"&&isFirefox||(c&&(r.screen?r.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),r.screen&&c&&(u=u.replace(/b=AS([^\r\n]+\r\n)/g,""),u=u.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:`+r.screen+`\r
`)),(r.audio||r.video)&&(u=u.replace(/b=AS([^\r\n]+\r\n)/g,"")),r.audio&&(u=u.replace(/a=mid:audio\r\n/g,`a=mid:audio\r
b=AS:`+r.audio+`\r
`)),r.screen?u=u.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:`+r.screen+`\r
`):r.video&&(u=u.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:`+r.video+`\r
`))),u}function h(u,r,c){return E(u,0,-1,r,c)}function E(u,r,c,T,O){for(var z=u.length,H=r;H<z;++H)if(u[H].indexOf(T)===0&&(!O||u[H].toLowerCase().indexOf(O.toLowerCase())!==-1))return H;return null}function U(u){var r=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),c=u.match(r);return c&&c.length===2?c[1]:null}function j(u,r){r=r||{};var c=r.min,T=r.max,O=u.split(`\r
`),z=h(O,"a=rtpmap","VP8/90000"),H;if(z&&(H=U(O[z])),!H)return u;var Z=h(O,"a=rtpmap","rtx/90000"),ne;if(Z&&(ne=U(O[Z])),!Z)return u;var me=h(O,"a=fmtp:"+ne.toString());if(me!==null){var ie=`\r
`;ie+="a=fmtp:"+H+" x-google-min-bitrate="+(c||"228")+"; x-google-max-bitrate="+(T||"228"),O[me]=O[me].concat(ie),u=O.join(`\r
`)}return u}function L(u,r){r=r||{};var c=u.split(`\r
`),T=h(c,"a=rtpmap","opus/48000"),O;if(T&&(O=U(c[T])),!O)return u;var z=h(c,"a=fmtp:"+O.toString());if(z===null)return u;var H="";return H+="; stereo="+(typeof r.stereo<"u"?r.stereo:"1"),H+="; sprop-stereo="+(typeof r["sprop-stereo"]<"u"?r["sprop-stereo"]:"1"),typeof r.maxaveragebitrate<"u"&&(H+="; maxaveragebitrate="+(r.maxaveragebitrate||128*1024*8)),typeof r.maxplaybackrate<"u"&&(H+="; maxplaybackrate="+(r.maxplaybackrate||128*1024*8)),typeof r.cbr<"u"&&(H+="; cbr="+(typeof r.cbr<"u"?r.cbr:"1")),typeof r.useinbandfec<"u"&&(H+="; useinbandfec="+r.useinbandfec),typeof r.usedtx<"u"&&(H+="; usedtx="+r.usedtx),typeof r.maxptime<"u"&&(H+=`\r
a=maxptime:`+r.maxptime),c[z]=c[z].concat(H),u=c.join(`\r
`),u}function s(u){for(var r=u.split(`\r
`),c=null,T=0;T<r.length;T++)if(r[T].search("opus/48000")!==-1){var O=extractSdp(r[T],/:(\d+) opus\/48000/i);break}for(var T=0;T<r.length;T++)if(r[T].search("a=fmtp")!==-1){var z=extractSdp(r[T],/a=fmtp:(\d+)/);if(z===O){c=T;break}}return c===null||(r[c]=r[c].concat("; stereo=1; sprop-stereo=1"),u=r.join(`\r
`)),u}return{removeVPX:R,disableNACK:g,prioritize:v,removeNonG722:y,setApplicationSpecificBandwidth:function(u,r,c){return k(u,r,c)},setVideoBitrates:function(u,r){return j(u,r)},setOpusAttributes:function(u,r){return L(u,r)},preferVP9:function(u){return t(u,"vp9")},preferCodec:t,forceStereoAudio:s}}();window.BandwidthHandler=_e;var Ye=function(){function t(p,f){var R=f.candidate,g=p.candidates,v=g.stun,y=g.turn;if(B(g.reflexive)||(v=g.reflexive),B(g.relay)||(y=g.relay),!(!g.host&&R.match(/typ host/g))&&!(!y&&R.match(/typ relay/g))&&!(!v&&R.match(/typ srflx/g))){var k=p.iceProtocols;if(!(!k.udp&&R.match(/ udp /g))&&!(!k.tcp&&R.match(/ tcp /g)))return p.enableLogs&&console.debug("Your candidate pairs:",R),{candidate:R,sdpMid:f.sdpMid,sdpMLineIndex:f.sdpMLineIndex}}}return{processCandidates:t}}(),Qe=function(){function t(p){var f=[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}];return f}return{getIceServers:t}}();function it(t,p){t.mandatory&&t.mandatory.chromeMediaSource||t.mozMediaSource||t.mediaSource?p.isScreen=!0:t.video?p.isVideo=!0:t.audio&&(p.isAudio=!0)}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(t){this.mutex=!1;var p=this.streams[t];if(p){p=p.stream;var f=p.currentUserMediaRequestOptions;this.queueRequests.indexOf(f)&&(delete this.queueRequests[this.queueRequests.indexOf(f)],this.queueRequests=I(this.queueRequests)),this.streams[t].stream=null,delete this.streams[t]}}};function Oe(t){if(currentUserMediaRequest.mutex===!0){currentUserMediaRequest.queueRequests.push(t);return}currentUserMediaRequest.mutex=!0;var p=JSON.stringify(t.localMediaConstraints);function f(k,h){it(t.localMediaConstraints,k);var E="ended";"oninactive"in k&&(E="inactive"),k.addEventListener(E,function(){delete currentUserMediaRequest.streams[p],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(t)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(t)],currentUserMediaRequest.queueRequests=I(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[p]={stream:k},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&Oe(currentUserMediaRequest.queueRequests.shift()),t.onGettingLocalMedia(k,h)}if(currentUserMediaRequest.streams[p])f(currentUserMediaRequest.streams[p].stream,!0);else{var R=!!/BB10|BlackBerry/i.test(navigator.userAgent||"");if(R||typeof navigator.mediaDevices>"u"||typeof navigator.mediaDevices.getUserMedia!="function"){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia(t.localMediaConstraints,function(k){k.streamid=k.streamid||k.id||D(),k.idInstance=p,f(k)},function(k){t.onLocalMediaError(k,t.localMediaConstraints)});return}if(typeof navigator.mediaDevices>"u"){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var g=function(){},v,y;navigator.mediaDevices={getUserMedia:function(k){return navigator.getUserMedia(k,function(h){h(stream),v=stream},function(h){g(h),y=h}),{then:function(h){if(v){h(v);return}return{then:function(E){if(y){E(y);return}g=E}}}}}}}if(t.localMediaConstraints.isScreen===!0){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(t.localMediaConstraints).then(function(k){k.streamid=k.streamid||k.id||D(),k.idInstance=p,f(k)}).catch(function(k){t.onLocalMediaError(k,t.localMediaConstraints)});else if(navigator.getDisplayMedia)navigator.getDisplayMedia(t.localMediaConstraints).then(function(k){k.streamid=k.streamid||k.id||D(),k.idInstance=p,f(k)}).catch(function(k){t.onLocalMediaError(k,t.localMediaConstraints)});else throw new Error("getDisplayMedia API is not availabe in this browser.");return}navigator.mediaDevices.getUserMedia(t.localMediaConstraints).then(function(k){k.streamid=k.streamid||k.id||D(),k.idInstance=p,f(k)}).catch(function(k){t.onLocalMediaError(k,t.localMediaConstraints)})}}var C=function(){function t(R){if(R){if(typeof R=="string"||typeof R>"u")return R;if(R.audio&&R.video)return null;if(R.audio)return"audio";if(R.video)return"video"}}function p(R,g,v){if(!R||!R.addEventListener)return;if(typeof g>"u"||g==!0){var y="ended";"oninactive"in R&&(y="inactive"),R.addEventListener(y,function(){C.onSyncNeeded(this.streamid,y)},!1)}R.mute=function(h,E){h=t(h),typeof E<"u"&&(g=E),(typeof h>"u"||h=="audio")&&q(R,"audio").forEach(function(U){U.enabled=!1,v.streamEvents[R.streamid].isAudioMuted=!0}),(typeof h>"u"||h=="video")&&q(R,"video").forEach(function(U){U.enabled=!1}),(typeof g>"u"||g==!0)&&C.onSyncNeeded(R.streamid,"mute",h),v.streamEvents[R.streamid].muteType=h||"both",b(R,"mute",h)},R.unmute=function(h,E){h=t(h),typeof E<"u"&&(g=E),k(),(typeof h>"u"||h=="audio")&&q(R,"audio").forEach(function(U){U.enabled=!0,v.streamEvents[R.streamid].isAudioMuted=!1}),(typeof h>"u"||h=="video")&&(q(R,"video").forEach(function(U){U.enabled=!0}),typeof h<"u"&&h=="video"&&v.streamEvents[R.streamid].isAudioMuted&&function U(j){j||(j=0),j++,j<100&&v.streamEvents[R.streamid].isAudioMuted&&(R.mute("audio"),setTimeout(function(){U(j)},50))}()),(typeof g>"u"||g==!0)&&C.onSyncNeeded(R.streamid,"unmute",h),v.streamEvents[R.streamid].unmuteType=h||"both",b(R,"unmute",h)};function k(){if(v.streamEvents[R.streamid].mediaElement){var h=v.streamEvents[R.streamid].mediaElement;h.volume=0,f(200,5,function(){try{h.volume+=.2}catch{h.volume=1}})}}}function f(R,g,v,y){y=(y||0)+1,!(y>=g)&&setTimeout(function(){v(),f(R,g,v,y)},R)}return{setHandlers:p,onSyncNeeded:function(R,g,v){}}}();function n(t){var p={};function f(R,g,v){var y=R.uuid;if(p[y]||(p[y]=[]),p[y].push(R.message),R.last){var k=p[y].join("");R.isobject&&(k=JSON.parse(k));var h=new Date().getTime(),E=h-R.sendingTime,U={data:k,userid:g,extra:v,latency:E};t.autoTranslateText?(U.original=U.data,t.Translator.TranslateText(U.data,function(j){U.data=j,t.onmessage(U)})):t.onmessage(U),delete p[y]}}return{receive:f}}var S={send:function(t){var p=t.connection,f=t.channel,R=t.remoteUserId,g=t.text,v=p.chunkSize||1e3,y="",k=!1;V(g)||(k=!0,g=JSON.stringify(g));var h=D(),E=new Date().getTime();U(g);function U(j,L){var s={type:"text",uuid:h,sendingTime:E};j&&(L=j,s.packets=parseInt(L.length/v)),L.length>v?s.message=L.slice(0,v):(s.message=L,s.last=!0,s.isobject=k),f.send(s,R),y=L.slice(s.message.length),y.length&&setTimeout(function(){U(null,y)},p.chunkInterval||100)}}},$=function(){function t(p){var f={};p.onFileStart=function(g){var v=document.createElement("div");if(v.title=g.name,v.innerHTML="<label>0%</label> <progress></progress>",g.remoteUserId&&(v.innerHTML+=" (Sharing with:"+g.remoteUserId+")"),p.filesContainer||(p.filesContainer=document.body||document.documentElement),p.filesContainer.insertBefore(v,p.filesContainer.firstChild),!g.remoteUserId){f[g.uuid]={div:v,progress:v.querySelector("progress"),label:v.querySelector("label")},f[g.uuid].progress.max=g.maxChunks;return}f[g.uuid]||(f[g.uuid]={}),f[g.uuid][g.remoteUserId]={div:v,progress:v.querySelector("progress"),label:v.querySelector("label")},f[g.uuid][g.remoteUserId].progress.max=g.maxChunks},p.onFileProgress=function(g){var v=f[g.uuid];v&&(g.remoteUserId&&(v=f[g.uuid][g.remoteUserId],!v)||(v.progress.value=g.currentPosition||g.maxChunks||v.progress.max,R(v.progress,v.label)))},p.onFileEnd=function(g){var v=f[g.uuid];if(!v){console.error("No such progress-helper element exist.",g);return}if(!(g.remoteUserId&&(v=f[g.uuid][g.remoteUserId],!v))){var y=v.div;g.type.indexOf("image")!=-1?y.innerHTML='<a href="'+g.url+'" download="'+g.name+'">Download <strong style="color:red;">'+g.name+'</strong> </a><br /><img src="'+g.url+'" title="'+g.name+'" style="max-width: 80%;">':y.innerHTML='<a href="'+g.url+'" download="'+g.name+'">Download <strong style="color:red;">'+g.name+'</strong> </a><br /><iframe src="'+g.url+'" title="'+g.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}};function R(g,v){if(g.position!==-1){var y=+g.position.toFixed(2).split(".")[1]||100;v.innerHTML=y+"%"}}}return{handle:t}}(),P=function(){function t(p){p.autoTranslateText=!1,p.language="en",p.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",p.Translator={TranslateText:function(f,R){var g=document.createElement("script");g.type="text/javascript";var v=encodeURIComponent(f),y="method"+p.token();window[y]=function(h){if(h.data&&h.data.translations[0]&&R){R(h.data.translations[0].translatedText);return}if(h.error&&h.error.message==="Daily Limit Exceeded"){console.error('Text translation failed. Error message: "Daily Limit Exceeded."');return}if(h.error){console.error(h.error.message);return}console.error(h)};var k="https://www.googleapis.com/language/translate/v2?key="+p.googKey+"&target="+(p.language||"en-US")+"&callback=window."+y+"&q="+v;g.src=k,document.getElementsByTagName("head")[0].appendChild(g)},getListOfLanguages:function(f){var R=new XMLHttpRequest;R.onreadystatechange=function(){if(R.readyState==XMLHttpRequest.DONE){var v=JSON.parse(R.responseText);if(v&&v.data&&v.data.languages){f(v.data.languages);return}if(v.error&&v.error.message==="Daily Limit Exceeded"){console.error('Text translation failed. Error message: "Daily Limit Exceeded."');return}if(v.error){console.error(v.error.message);return}console.error(v)}};var g="https://www.googleapis.com/language/translate/v2/languages?key="+p.googKey+"&target=en";R.open("GET",g,!0),R.send(null)}}}return{handle:t}}();(function(t){l=l||{useDefaultDevices:!0},t.channel=t.sessionid=(a||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split(`
`).join("").split("\r").join(""))+"";var p=new w(t),f={};p.onGettingLocalMedia=function(s,u){if(u=u||function(){},f[s.streamid]){u();return}f[s.streamid]=!0;try{s.type="local"}catch{}t.setStreamEndHandler(s),x(s,function(r){r.id=s.streamid,r.muted=!0,r.volume=0,t.attachStreams.indexOf(s)===-1&&t.attachStreams.push(s),typeof C<"u"&&C.setHandlers(s,!0,t);var c=s.getAudioTracks().filter(function(T){return T.enabled}).length===0;t.streamEvents[s.streamid]={stream:s,type:"local",mediaElement:r,userid:t.userid,extra:t.extra,streamid:s.streamid,isAudioMuted:c};try{M(t,t.streamEvents[s.streamid]),_(t,t.streamEvents[s.streamid]),t.onstream(t.streamEvents[s.streamid])}catch{}u()},t)},p.onGettingRemoteMedia=function(s,u){try{s.type="remote"}catch{}t.setStreamEndHandler(s,"remote-stream"),x(s,function(r){r.id=s.streamid,typeof C<"u"&&C.setHandlers(s,!1,t),t.streamEvents[s.streamid]={stream:s,type:"remote",userid:u,extra:t.peers[u]?t.peers[u].extra:{},mediaElement:r,streamid:s.streamid},_(t,t.streamEvents[s.streamid]),t.onstream(t.streamEvents[s.streamid])},t)},p.onRemovingRemoteMedia=function(s,u){var r=t.streamEvents[s.streamid];r||(r={stream:s,type:"remote",userid:u,extra:t.peers[u]?t.peers[u].extra:{},streamid:s.streamid,mediaElement:t.streamEvents[s.streamid]?t.streamEvents[s.streamid].mediaElement:null}),t.peersBackup[r.userid]&&(r.extra=t.peersBackup[r.userid].extra),t.onstreamended(r),delete t.streamEvents[s.streamid]},p.onNegotiationNeeded=function(s,u,r){r=r||function(){},u=u||s.remoteUserId,s=s||"";var c={remoteUserId:u,message:s,sender:t.userid};s.remoteUserId&&s.message&&s.sender&&(c=s),g(function(){t.socket.emit(t.socketMessageEvent,c,r)})};function R(s){t.deletePeer(s)}p.onUserLeft=R,p.disconnectWith=function(s,u){t.socket&&t.socket.emit("disconnect-with",s,u||function(){}),t.deletePeer(s)},t.socketOptions={transport:"polling"};function g(s){if(t.socketAutoReConnect=!0,t.socket){s&&s(t.socket);return}if(typeof o>"u")if(typeof FirebaseConnection<"u")window.SocketConnection=FirebaseConnection;else if(typeof PubNubConnection<"u")window.SocketConnection=PubNubConnection;else throw"SocketConnection.js seems missed.";new o(t,function(u){s&&s(t.socket)})}t.openOrJoin=function(s,u){u=u||function(){},t.checkPresence(s,function(r,c){if(r){t.sessionid=c;var T=!1,O=!1,z=!!t.session.oneway,H=G(t.session);O={OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},T={OfferToReceiveAudio:z?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:z?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo};var Z={remoteUserId:t.sessionid,message:{newParticipationRequest:!0,isOneWay:z,isDataOnly:H,localPeerSdpConstraints:T,remotePeerSdpConstraints:O},sender:t.userid};h(Z.message,function(){v(Z,u)});return}if(t.waitingForLocalMedia=!0,t.isInitiator=!0,t.sessionid=c||t.sessionid,G(t.session)){y(u);return}t.captureUserMedia(function(){y(u)})})},t.waitingForLocalMedia=!1,t.open=function(s,u){u=u||function(){},t.waitingForLocalMedia=!0,t.isInitiator=!0,t.sessionid=s||t.sessionid,g(function(){if(G(t.session)){y(u);return}t.captureUserMedia(function(){y(u)})})},t.peersBackup={},t.deletePeer=function(s){if(!(!s||!t.peers[s])){var u={userid:s,extra:t.peers[s]?t.peers[s].extra:{}};if(t.peersBackup[u.userid]&&(u.extra=t.peersBackup[u.userid].extra),t.onleave(u),t.peers[s]){t.peers[s].streams.forEach(function(c){c.stop()});var r=t.peers[s].peer;if(r&&r.iceConnectionState!=="closed")try{r.close()}catch{}t.peers[s]&&(t.peers[s].peer=null,delete t.peers[s])}}},t.rejoin=function(s){if(!(t.isInitiator||!s||!Object.keys(s).length)){var u={};t.peers[s.remoteUserId]&&(u=t.peers[s.remoteUserId].extra,t.deletePeer(s.remoteUserId)),s&&s.remoteUserId&&(t.join(s.remoteUserId),t.onReConnecting({userid:s.remoteUserId,extra:u}))}},t.join=function(s,u){t.sessionid=(s?s.sessionid||s.remoteUserId||s:!1)||t.sessionid,t.sessionid+="";var r=!1,c=!1,T=!1,O=!1;if(s&&s.session||!s||typeof s=="string"){var z=s&&s.session||t.session;T=!!z.oneway,O=G(z),c={OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},r={OfferToReceiveAudio:T?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:T?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo}}u=u||{};var H=function(){};typeof u=="function"&&(H=u,u={}),typeof u.localPeerSdpConstraints<"u"&&(r=u.localPeerSdpConstraints),typeof u.remotePeerSdpConstraints<"u"&&(c=u.remotePeerSdpConstraints),typeof u.isOneWay<"u"&&(T=u.isOneWay),typeof u.isDataOnly<"u"&&(O=u.isDataOnly);var Z={remoteUserId:t.sessionid,message:{newParticipationRequest:!0,isOneWay:T,isDataOnly:O,localPeerSdpConstraints:r,remotePeerSdpConstraints:c},sender:t.userid};return h(Z.message,function(){g(function(){v(Z,H)})}),Z};function v(s,u){t.socket.emit("join-room",{sessionid:t.sessionid,session:t.session,mediaConstraints:t.mediaConstraints,sdpConstraints:t.sdpConstraints,streams:k(),extra:t.extra,password:typeof t.password<"u"&&typeof t.password!="object"?t.password:""},function(r,c){if(r===!0){if(t.enableLogs&&console.log("isRoomJoined: ",r," roomid: ",t.sessionid),t.peers[t.sessionid])return;p.onNegotiationNeeded(s)}r===!1&&t.enableLogs&&console.warn("isRoomJoined: ",c," roomid: ",t.sessionid),u(r,t.sessionid,c)})}t.publicRoomIdentifier="";function y(s){t.enableLogs&&console.log("Sending open-room signal to socket.io"),t.waitingForLocalMedia=!1,t.socket.emit("open-room",{sessionid:t.sessionid,session:t.session,mediaConstraints:t.mediaConstraints,sdpConstraints:t.sdpConstraints,streams:k(),extra:t.extra,identifier:t.publicRoomIdentifier,password:typeof t.password<"u"&&typeof t.password!="object"?t.password:""},function(u,r){u===!0&&(t.enableLogs&&console.log("isRoomOpened: ",u," roomid: ",t.sessionid),s(u,t.sessionid)),u===!1&&(t.enableLogs&&console.warn("isRoomOpened: ",r," roomid: ",t.sessionid),s(u,t.sessionid,r))})}function k(){try{return t.streamEvents.selectAll("local").map(function(s){return{streamid:s.streamid,tracks:s.stream.getTracks().length}})}catch{return[]}}function h(s,u){if(t.dontCaptureUserMedia||s.isDataOnly){u();return}s.localPeerSdpConstraints.OfferToReceiveAudio&&t.mediaConstraints.audio,s.localPeerSdpConstraints.OfferToReceiveVideo&&t.mediaConstraints.video;var r=s.session||t.session;if(r.oneway&&r.audio!=="two-way"&&r.video!=="two-way"&&r.screen!=="two-way"){u();return}r.oneway&&r.audio&&r.audio==="two-way"&&(r={audio:!0}),(r.audio||r.video||r.screen)&&(r.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:te(t)}).then(function(c){c.isScreen=!0,p.onGettingLocalMedia(c),(r.audio||r.video)&&!te(t)?t.invokeGetUserMedia(null,u):u(c)},function(c){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:te(t),video:!0,isScreen:!0},(r.audio||r.video)&&!te(t)?t.invokeGetUserMedia(null,u):u):(r.audio||r.video)&&t.invokeGetUserMedia(null,u,r))}t.getUserMedia=t.captureUserMedia=function(s,u){s=s||function(){};var r=u||t.session;if(t.dontCaptureUserMedia||G(r)){s();return}(r.audio||r.video||r.screen)&&(r.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:te(t)}).then(function(c){if(c.isScreen=!0,p.onGettingLocalMedia(c),(r.audio||r.video)&&!te(t)){var T={};for(var O in r)O!=="screen"&&(T[O]=r[O]);t.invokeGetUserMedia(u,s,T);return}s(c)},function(c){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:te(t),video:!0,isScreen:!0},function(c){if((r.audio||r.video)&&!te(t)){var T={};for(var O in r)O!=="screen"&&(T[O]=r[O]);t.invokeGetUserMedia(u,s,T);return}s(c)}):(r.audio||r.video)&&t.invokeGetUserMedia(u,s,r))},t.onbeforeunload=function(s,u){t.closeBeforeUnload&&(t.peers.getAllParticipants().forEach(function(r){p.onNegotiationNeeded({userLeft:!0},r),t.peers[r]&&t.peers[r].peer&&t.peers[r].peer.close(),delete t.peers[r]}),u||t.closeSocket(),t.isInitiator=!1)},window.ignoreBeforeUnload?t.closeBeforeUnload=!1:(t.closeBeforeUnload=!0,window.addEventListener("beforeunload",t.onbeforeunload,!1)),t.userid=D(),t.changeUserId=function(s,u){u=u||function(){},t.userid=s||D(),t.socket.emit("changed-uuid",t.userid,u)},t.extra={},t.attachStreams=[],t.session={audio:!0,video:!0},t.enableFileSharing=!1,t.bandwidth={screen:!1,audio:!1,video:!1},t.codecs={audio:"opus",video:"VP9"},t.processSdp=function(s){return Re()||DetectRTC.browser.name==="Safari"||(t.codecs.video.toUpperCase()==="VP8"&&(s=_e.preferCodec(s,"vp8")),t.codecs.video.toUpperCase()==="VP9"&&(s=_e.preferCodec(s,"vp9")),t.codecs.video.toUpperCase()==="H264"&&(s=_e.preferCodec(s,"h264")),t.codecs.audio==="G722"&&(s=_e.removeNonG722(s)),DetectRTC.browser.name==="Firefox")||((t.bandwidth.video||t.bandwidth.screen)&&(s=_e.setApplicationSpecificBandwidth(s,t.bandwidth,!!t.session.screen)),t.bandwidth.video&&(s=_e.setVideoBitrates(s,{min:t.bandwidth.video*8*1024,max:t.bandwidth.video*8*1024})),t.bandwidth.audio&&(s=_e.setOpusAttributes(s,{maxaveragebitrate:t.bandwidth.audio*8*1024,maxplaybackrate:t.bandwidth.audio*8*1024,stereo:1,maxptime:3}))),s},typeof _e<"u"&&(t.BandwidthHandler=t.CodecsHandler=_e),t.mediaConstraints={audio:{mandatory:{},optional:t.bandwidth.audio?[{bandwidth:t.bandwidth.audio*8*1024||1048576}]:[]},video:{mandatory:{},optional:t.bandwidth.video?[{bandwidth:t.bandwidth.video*8*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},DetectRTC.browser.name==="Firefox"&&(t.mediaConstraints={audio:!0,video:!0}),!l.useDefaultDevices&&!DetectRTC.isMobileDevice&&DetectRTC.load(function(){var s,u;if(DetectRTC.MediaDevices.forEach(function(c){c.kind==="audioinput"&&t.mediaConstraints.audio!==!1&&(s=c),c.kind==="videoinput"&&t.mediaConstraints.video!==!1&&(u=c)}),s){if(DetectRTC.browser.name==="Firefox"){t.mediaConstraints.audio!==!0?t.mediaConstraints.audio.deviceId=s.id:t.mediaConstraints.audio={deviceId:s.id};return}t.mediaConstraints.audio==!0&&(t.mediaConstraints.audio={mandatory:{},optional:[]}),t.mediaConstraints.audio.optional||(t.mediaConstraints.audio.optional=[]);var r=[{sourceId:s.id}];t.mediaConstraints.audio.optional=r.concat(t.mediaConstraints.audio.optional)}if(u){if(DetectRTC.browser.name==="Firefox"){t.mediaConstraints.video!==!0?t.mediaConstraints.video.deviceId=u.id:t.mediaConstraints.video={deviceId:u.id};return}t.mediaConstraints.video==!0&&(t.mediaConstraints.video={mandatory:{},optional:[]}),t.mediaConstraints.video.optional||(t.mediaConstraints.video.optional=[]);var r=[{sourceId:u.id}];t.mediaConstraints.video.optional=r.concat(t.mediaConstraints.video.optional)}}),t.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},t.sdpSemantics=null,t.iceCandidatePoolSize=null,t.bundlePolicy=null,t.rtcpMuxPolicy=null,t.iceTransportPolicy=null,t.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},t.iceServers=Qe.getIceServers(t),t.candidates={host:!0,stun:!0,turn:!0},t.iceProtocols={tcp:!0,udp:!0},t.onopen=function(s){t.enableLogs&&console.info("Data connection has been opened between you & ",s.userid)},t.onclose=function(s){t.enableLogs&&console.warn("Data connection has been closed between you & ",s.userid)},t.onerror=function(s){t.enableLogs&&console.error(s.userid,"data-error",s)},t.onmessage=function(s){t.enableLogs&&console.debug("data-message",s.userid,s.data)},t.send=function(s,u){t.peers.send(s,u)},t.close=t.disconnect=t.leave=function(){t.onbeforeunload(!1,!0)},t.closeEntireSession=function(s){s=s||function(){},t.socket.emit("close-entire-session",function u(){if(t.getAllParticipants().length){setTimeout(u,100);return}t.onEntireSessionClosed({sessionid:t.sessionid,userid:t.userid,extra:t.extra}),t.changeUserId(null,function(){t.close(),s()})})},t.onEntireSessionClosed=function(s){t.enableLogs&&console.info("Entire session is closed: ",s.sessionid,s.extra)},t.onstream=function(s){var u=t.videosContainer;u.insertBefore(s.mediaElement,u.firstChild);var r=s.mediaElement.play();if(typeof r<"u"){r.catch(function(){}).then(function(){setTimeout(function(){s.mediaElement.play()},2e3)});return}setTimeout(function(){s.mediaElement.play()},2e3)},t.onstreamended=function(s){s.mediaElement||(s.mediaElement=document.getElementById(s.streamid)),!(!s.mediaElement||!s.mediaElement.parentNode)&&s.mediaElement.parentNode.removeChild(s.mediaElement)},t.direction="many-to-many",t.removeStream=function(s,u){var r;if(t.attachStreams.forEach(function(c){c.id===s&&(r=c)}),!r){console.warn("No such stream exist.",s);return}t.peers.getAllParticipants().forEach(function(c){if(!(u&&c!==u)){var T=t.peers[c];try{T.peer.removeStream(r)}catch{}}}),t.renegotiate()},t.addStream=function(s,u){if(s.getTracks){t.attachStreams.indexOf(s)===-1&&(s.streamid||(s.streamid=s.id),t.attachStreams.push(s)),t.renegotiate(u);return}if(G(s)){t.renegotiate(u);return}(s.audio||s.video||s.screen)&&(s.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:te(t)}).then(function(c){c.isScreen=!0,p.onGettingLocalMedia(c),(s.audio||s.video)&&!te(t)?t.invokeGetUserMedia(null,function(T){r(T)}):r(c)},function(c){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:te(t),video:!0,isScreen:!0},function(c){(s.audio||s.video)&&!te(t)?t.invokeGetUserMedia(null,function(T){r(T)}):r(c)}):(s.audio||s.video)&&t.invokeGetUserMedia(null,r));function r(c){s.streamCallback&&s.streamCallback(c),t.renegotiate(u)}},t.invokeGetUserMedia=function(s,u,r){r||(r=t.session),s||(s=t.mediaConstraints),Oe({onGettingLocalMedia:function(c){var T=s.video;T&&(T.mediaSource||T.mozMediaSource||T.mandatory&&T.mandatory.chromeMediaSource)&&(c.isScreen=!0),c.isScreen||(c.isVideo=!!q(c,"video").length,c.isAudio=!c.isVideo&&q(c,"audio").length),p.onGettingLocalMedia(c,function(){typeof u=="function"&&u(c)})},onLocalMediaError:function(c,T){p.onLocalMediaError(c,T)},localMediaConstraints:s||{audio:r.audio?s.audio:!1,video:r.video?s.video:!1}})};function E(s,u){if(!s){t.enableLogs&&console.error("No stream to applyConstraints.");return}u.audio&&q(s,"audio").forEach(function(r){r.applyConstraints(u.audio)}),u.video&&q(s,"video").forEach(function(r){r.applyConstraints(u.video)})}t.applyConstraints=function(s,u){if(!ye||!ye.prototype.applyConstraints){alert("track.applyConstraints is NOT supported in your browser.");return}if(u){var r;t.streamEvents[u]&&(r=t.streamEvents[u].stream),E(r,s);return}t.attachStreams.forEach(function(c){E(c,s)})};function U(s,u,r){if(u){p.replaceTrack(s,u,r);return}t.peers.getAllParticipants().forEach(function(c){p.replaceTrack(s,c,r)})}t.replaceTrack=function(s,u,r){if(s=s||{},!ue.prototype.getSenders){t.addStream(s);return}if(s instanceof ye){U(s,u,r);return}if(s instanceof J){q(s,"video").length&&U(q(s,"video")[0],u,!0),q(s,"audio").length&&U(q(s,"audio")[0],u,!1);return}if(G(s))throw"connection.replaceTrack requires audio and/or video and/or screen.";(s.audio||s.video||s.screen)&&(s.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:te(t)}).then(function(T){T.isScreen=!0,p.onGettingLocalMedia(T),(s.audio||s.video)&&!te(t)?t.invokeGetUserMedia(null,c):c(T)},function(T){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:te(t),video:!0,isScreen:!0},(s.audio||s.video)&&!te(t)?t.invokeGetUserMedia(null,c):c):(s.audio||s.video)&&t.invokeGetUserMedia(null,c));function c(T){t.replaceTrack(T,u,r||s.video||s.screen)}},t.resetTrack=function(s,u){s||(s=t.getAllParticipants()),typeof s=="string"&&(s=[s]),s.forEach(function(r){var c=t.peers[r].peer;(typeof u>"u"||u===!0)&&c.lastVideoTrack&&t.replaceTrack(c.lastVideoTrack,r,!0),(typeof u>"u"||u===!1)&&c.lastAudioTrack&&t.replaceTrack(c.lastAudioTrack,r,!1)})},t.renegotiate=function(s){if(s){p.renegotiatePeer(s);return}t.peers.getAllParticipants().forEach(function(u){p.renegotiatePeer(u)})},t.setStreamEndHandler=function(s,u){if(!(!s||!s.addEventListener)&&(u=!!u,!s.alreadySetEndHandler)){s.alreadySetEndHandler=!0;var r="ended";"oninactive"in s&&(r="inactive"),s.addEventListener(r,function(){if(s.idInstance&&currentUserMediaRequest.remove(s.idInstance),!u){var c=[];t.attachStreams.forEach(function(z){z.id!=s.id&&c.push(z)}),t.attachStreams=c}var T=t.streamEvents[s.streamid];if(T||(T={stream:s,streamid:s.streamid,type:u?"remote":"local",userid:t.userid,extra:t.extra,mediaElement:t.streamEvents[s.streamid]?t.streamEvents[s.streamid].mediaElement:null}),u&&t.peers[T.userid]){var O=t.peers[T.userid].peer,c=[];O.getRemoteStreams().forEach(function(H){H.id!=s.id&&c.push(H)}),t.peers[T.userid].streams=c}T.userid===t.userid&&T.type==="remote"||(t.peersBackup[T.userid]&&(T.extra=t.peersBackup[T.userid].extra),t.onstreamended(T),delete t.streamEvents[s.streamid])},!1)}},t.onMediaError=function(s,u){t.enableLogs&&console.error(s,u)},t.autoCloseEntireSession=!1,t.filesContainer=t.videosContainer=document.body||document.documentElement,t.isInitiator=!1,t.shareFile=p.shareFile,typeof $<"u"&&$.handle(t),typeof P<"u"&&P.handle(t),t.token=D,t.onNewParticipant=function(s,u){t.acceptParticipationRequest(s,u)},t.acceptParticipationRequest=function(s,u){u.successCallback&&(u.successCallback(),delete u.successCallback),p.createNewPeer(s,u)},typeof C<"u"&&(t.StreamsHandler=C),t.onleave=function(s){},t.invokeSelectFileDialog=function(s){var u=new FileSelector;u.accept="*.*",u.selectSingleFile(s)},t.onmute=function(s){if(!(!s||!s.mediaElement))if(s.muteType==="both"||s.muteType==="video"){s.mediaElement.src=null;var u=s.mediaElement.pause();typeof u<"u"?u.then(function(){s.mediaElement.poster=s.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):s.mediaElement.poster=s.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else s.muteType==="audio"&&(s.mediaElement.muted=!0)},t.onunmute=function(s){!s||!s.mediaElement||!s.stream||(s.unmuteType==="both"||s.unmuteType==="video"?(s.mediaElement.poster=null,s.mediaElement.srcObject=s.stream,s.mediaElement.play()):s.unmuteType==="audio"&&(s.mediaElement.muted=!1))},t.onExtraDataUpdated=function(s){s.status="online",t.onUserStatusChanged(s,!0)},t.getAllParticipants=function(s){return t.peers.getAllParticipants(s)},typeof C<"u"&&(C.onSyncNeeded=function(s,u,r){t.peers.getAllParticipants().forEach(function(c){p.onNegotiationNeeded({streamid:s,action:u,streamSyncNeeded:!0,type:r||"both"},c)})}),t.connectSocket=function(s){g(s)},t.closeSocket=function(){try{io.sockets={}}catch{}t.socket&&(typeof t.socket.disconnect=="function"&&t.socket.disconnect(),typeof t.socket.resetProps=="function"&&t.socket.resetProps(),t.socket=null)},t.getSocket=function(s){return!s&&t.enableLogs&&console.warn("getSocket.callback paramter is required."),s=s||function(){},t.socket?s(t.socket):g(function(){s(t.socket)}),t.socket},t.getRemoteStreams=p.getRemoteStreams;var j=["selectFirst","selectAll","forEach"];if(t.streamEvents={selectFirst:function(s){return t.streamEvents.selectAll(s)[0]},selectAll:function(s){s||(s={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),s=="local"&&(s={local:!0}),s=="remote"&&(s={remote:!0}),s=="screen"&&(s={isScreen:!0}),s=="audio"&&(s={isAudio:!0}),s=="video"&&(s={isVideo:!0});var u=[];return Object.keys(t.streamEvents).forEach(function(r){var c=t.streamEvents[r];if(j.indexOf(r)===-1){var T=!0;s.local&&c.type==="local"&&(T=!1),s.remote&&c.type==="remote"&&(T=!1),s.isScreen&&c.stream.isScreen&&(T=!1),s.isVideo&&c.stream.isVideo&&(T=!1),s.isAudio&&c.stream.isAudio&&(T=!1),s.userid&&c.userid===s.userid&&(T=!1),T===!1&&u.push(c)}}),u}},t.socketURL="/",t.socketMessageEvent="RTCMultiConnection-Message",t.socketCustomEvent="RTCMultiConnection-Custom-Message",t.DetectRTC=DetectRTC,t.setCustomSocketEvent=function(s){s&&(t.socketCustomEvent=s),t.socket&&t.socket.emit("set-custom-socket-event-listener",t.socketCustomEvent)},t.getNumberOfBroadcastViewers=function(s,u){!t.socket||!s||!u||t.socket.emit("get-number-of-users-in-specific-broadcast",s,u)},t.onNumberOfBroadcastViewersUpdated=function(s){!t.enableLogs||!t.isInitiator||console.info("Number of broadcast (",s.broadcastId,") viewers",s.numberOfBroadcastViewers)},t.onUserStatusChanged=function(s,u){t.enableLogs&&!u&&console.info(s.userid,s.status)},t.getUserMediaHandler=Oe,t.multiPeersHandler=p,t.enableLogs=!0,t.setCustomSocketHandler=function(s){typeof o<"u"&&(o=s)},t.chunkSize=4e4,t.maxParticipantsAllowed=1e3,t.disconnectWith=p.disconnectWith,t.checkPresence=function(s,u){if(s=s||t.sessionid,o.name==="SSEConnection"){SSEConnection.checkPresence(s,function(r,c,T){if(!t.socket){r||(t.userid=c),t.connectSocket(function(){u(r,c,T)});return}u(r,c)});return}if(!t.socket){t.connectSocket(function(){t.checkPresence(s,u)});return}t.socket.emit("check-presence",s+"",function(r,c,T){t.enableLogs&&console.log("checkPresence.isRoomExist: ",r," roomid: ",c),u(r,c,T)})},t.onReadyForOffer=function(s,u){t.multiPeersHandler.createNewPeer(s,u)},t.setUserPreferences=function(s){return t.dontAttachStream&&(s.dontAttachLocalStream=!0),t.dontGetRemoteStream&&(s.dontGetRemoteStream=!0),s},t.updateExtraData=function(){t.socket.emit("extra-data-updated",t.extra)},t.enableScalableBroadcast=!1,t.maxRelayLimitPerUser=3,t.dontCaptureUserMedia=!1,t.dontAttachStream=!1,t.dontGetRemoteStream=!1,t.onReConnecting=function(s){t.enableLogs&&console.info("ReConnecting with",s.userid,"...")},t.beforeAddingStream=function(s){return s},t.beforeRemovingStream=function(s){return s},typeof isChromeExtensionAvailable<"u"&&(t.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),typeof isFirefoxExtensionAvailable<"u"&&(t.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),typeof getChromeExtensionStatus<"u"&&(t.getChromeExtensionStatus=getChromeExtensionStatus),t.modifyScreenConstraints=function(s){return s},t.onPeerStateChanged=function(s){t.enableLogs&&s.iceConnectionState.search(/closed|failed/gi)!==-1&&console.error("Peer connection is closed between you & ",s.userid,s.extra,"state:",s.iceConnectionState)},t.isOnline=!0,N("online",function(){t.isOnline=!0}),N("offline",function(){t.isOnline=!1}),t.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(t.isLowBandwidth=navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g)!==-1,t.isLowBandwidth)){if(t.bandwidth={audio:!1,video:!1,screen:!1},t.mediaConstraints.audio&&t.mediaConstraints.audio.optional&&t.mediaConstraints.audio.optional.length){var L=[];t.mediaConstraints.audio.optional.forEach(function(s){typeof s.bandwidth>"u"&&L.push(s)}),t.mediaConstraints.audio.optional=L}if(t.mediaConstraints.video&&t.mediaConstraints.video.optional&&t.mediaConstraints.video.optional.length){var L=[];t.mediaConstraints.video.optional.forEach(function(u){typeof u.bandwidth>"u"&&L.push(u)}),t.mediaConstraints.video.optional=L}}t.getExtraData=function(s,u){if(!s)throw"remoteUserId is required.";if(typeof u=="function"){t.socket.emit("get-remote-user-extra-data",s,function(r,c,T){u(r,c,T)});return}return t.peers[s]?t.peers[s].extra:t.peersBackup[s]?t.peersBackup[s].extra:{}},l.autoOpenOrJoin&&t.openOrJoin(t.sessionid),t.onUserIdAlreadyTaken=function(s,u){t.close(),t.closeSocket(),t.isInitiator=!1,t.userid=t.token(),t.join(t.sessionid),t.enableLogs&&console.warn("Userid already taken.",s,"Your new userid:",t.userid)},t.trickleIce=!0,t.version="3.7.0",t.onSettingLocalDescription=function(s){t.enableLogs&&console.info("Set local description for remote user",s.userid)},t.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},t.autoCreateMediaElement=!0,t.password=null,t.setPassword=function(s,u){u=u||function(){},t.socket?t.socket.emit("set-password",s,u):(t.password=s,u(!0,t.sessionid,null))},t.onSocketDisconnect=function(s){t.enableLogs&&console.warn("socket.io connection is closed")},t.onSocketError=function(s){t.enableLogs&&console.warn("socket.io connection is failed")},t.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}})(this)};d.exports=i})(lt);var ai=lt.exports;const ri=tt(ai),si={props:{audio_output_deviceId:String},components:{},data(){return{is_loading_available_devices:!1,is_loading_feed:!1,status:void 0,current_mode:"LocalSources",current_stream:void 0,local_stream:void 0,remote_stream:void 0,stream_current_settings:void 0,desired_camera_resolution:void 0,last_working_resolution:void 0,selected_devices:{video_input_device:void 0,audio_input_device:void 0,audio_output_device:void 0},connected_devices:[],predefined_resolutions:[{label:this.$t("very_high"),label_detail:"4K(UHD)",width:3840,height:2160,ratio:"16:9"},{label:this.$t("high"),label_detail:"1080p(FHD)",width:1920,height:1080,ratio:"16:9"},{label:this.$t("medium"),label_detail:"720p(HD)",width:1280,height:720,ratio:"16:9"},{label:this.$t("low"),label_detail:"VGA",width:640,height:480,ratio:"4:3"}],unavailable_camera_resolutions:[],custom_camera_resolution:{label:this.$t("custom_f"),type:"custom",width:1280,height:720},advanced_capture_options:{echoCancellation:{supported:void 0,enabled:!1},noiseSuppression:{supported:void 0,enabled:!1},cursor:{supported:void 0,enabled:!1}},rtcmulti_connection:void 0,share_this_stream:{enabled:!1,name:`DODOC-${(Math.random().toString(36)+"00000000000000000").slice(2,5)}`,status:{loading:!1,enabled:void 0,name:void 0,peers_connected:[]}},access_distant_stream:{calling:!1,callee:"",status:{enabled:!1,callee:void 0}}}},created(){},mounted(){if(!navigator.mediaDevices.getUserMedia){alert("You need a browser that supports getUserMedia");return}this.is_loading_feed=!0,this.is_loading_available_devices=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(d=>{this.local_stream=d}).catch(d=>{this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldnt_load_getusermedia")+"<br>"+d.name+": "+d.message),this.is_loading_feed=!1,this.$emit("hasFinishedLoading"),this.$emit("show")}).then(this.refreshAvailableDevices).then(()=>{this.setDefaultInputsAndOutputs()}).catch(d=>{this.is_loading_feed=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("failed_listing_devices")+"<br>"+d.name+": "+d.message)}).then(()=>this.setCameraStreamFromDefaults()).then(()=>{this.is_loading_feed=!1,this.$emit("hasFinishedLoading")}).catch(()=>{this.is_loading_feed=!1,this.$emit("hasFinishedLoading")})},beforeDestroy(){this.local_stream&&this.local_stream.getTracks().forEach(d=>d.stop()),this.remote_stream&&this.remote_stream.getTracks().forEach(d=>d.stop()),this.closeMultiRTC()},watch:{"selected_devices.video_input_device":function(){this.unavailable_camera_resolutions=[],this.last_working_resolution=!1},local_stream:function(){this.setCurrentStream()},remote_stream:function(){this.setCurrentStream()},current_mode:function(){this.setCurrentStream()},current_stream:function(){this.$emit("setStream",{stream:this.current_stream,type:this.current_mode})},selected_devices:{handler(){localStorage.setItem("selected_devices",JSON.stringify(this.selected_devices)),this.setCameraStreamFromDefaults()},deep:!0},desired_camera_resolution:{handler(){this.setCameraStreamFromDefaults()},deep:!0},last_working_resolution:{handler(){},deep:!0},share_this_stream:{handler(){this.$eventHub.$emit("stream.newSharingInformations",this.share_this_stream.status)},deep:!0},access_distant_stream:{handler(){this.$eventHub.$emit("stream.newDistantAccessInformations",this.access_distant_stream.status)},deep:!0}},computed:{all_video_input_devices(){return this.connected_devices.filter(d=>d.kind==="videoinput")},all_audio_input_devices(){return this.connected_devices.filter(d=>d.kind==="audioinput")},all_audio_output_devices(){return this.connected_devices.filter(d=>d.kind==="audiooutput")},current_settings(){let d="";return this.selected_devices.video_input_device&&(d+=this.selected_devices.video_input_device.deviceId+"-",this.selected_devices.video_input_device.deviceId==="screen_capture"&&(d+=this.advanced_capture_options.cursor.enabled+"-")),this.desired_camera_resolution&&this.desired_camera_resolution.width&&this.desired_camera_resolution.height&&(d+=this.desired_camera_resolution.width+"x"+this.desired_camera_resolution.height+"-"),this.selected_devices.audio_input_device&&(d+=this.selected_devices.audio_input_device.deviceId+"-",d+=this.noiseSuppression+"-",d+=this.echoCancellation+"-"),this.share_this_stream.enabled&&(d+=this.share_this_stream.name+"-"),this.selected_devices.audio_output_device&&(d+=this.selected_devices.audio_output_device.deviceId+"-"),d}},methods:{listDevices(){return new Promise((d,e)=>{this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : listDevices"),navigator.mediaDevices.enumerateDevices().then(i=>d(i)).catch(i=>e(i))})},setCurrentStream(){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : setCurrentStream"),this.current_mode==="RemoteSources"?this.current_stream=this.remote_stream:this.current_mode==="LocalSources"&&(this.current_stream=this.local_stream)},resInstructions(d){if(d.type!=="custom")return`${d.label_detail} • ${d.ratio} • ${d.width}×${d.height} ${this.$t("pixels")}`},setSupportedConstraints(){return new Promise(d=>{this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : setSupportedConstraints");const e=navigator.mediaDevices.getSupportedConstraints();return e&&Object.entries(this.advanced_capture_options).map(([i])=>{this.advanced_capture_options[i].supported=this.advanced_capture_options[i].enabled=e[i]===!0}),d()})},setDefaultInputsAndOutputs(){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : setDefaultInputsAndOutputs"),this.connected_devices.length!==0&&(this.all_video_input_devices.length>0&&(this.selected_devices.video_input_device=this.getDefaultDevice({key:"video_input_device",option_preference:{key:"facingMode",value:"environment"},devices_list:this.all_video_input_devices})),this.all_audio_input_devices.length>0&&(this.selected_devices.audio_input_device=this.getDefaultDevice({key:"audio_input_device",devices_list:this.all_audio_input_devices})),this.all_audio_output_devices.length>0&&(this.selected_devices.audio_output_device=this.getDefaultDevice({key:"audio_output_device",devices_list:this.all_audio_output_devices})),this.desired_camera_resolution=this.predefined_resolutions.find(d=>d.height===720))},getDefaultDevice({key:d,option_preference:e,devices_list:i}){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : getDefaultDevice");let a=!1;if(localStorage.getItem("selected_devices"))try{if(a=JSON.parse(localStorage.getItem("selected_devices")),a!=null&&a[d]){const l=i.find(m=>m.deviceId===a[d].deviceId);if(l)return l}}catch{}if(e){const l=i.find(m=>m[e.key]===e.value);if(l)return l}return this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : getDefaultDevice — settings first available device for "+d),i[0]},startMediaDeviceFeed(d){return new Promise((e,i)=>{this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : startMediaDeviceFeed");let a=[];a.push(new Promise((l,m)=>{if(!d.video)return l();d._is_webrtc_screen_capture===!0?navigator.mediaDevices.getDisplayMedia({video:d.video,audio:!1}).then(o=>l({type:"videoStream",stream:o})).catch(o=>m(o)):navigator.mediaDevices.getUserMedia({video:d.video,audio:!1}).then(o=>l({type:"videoStream",stream:o})).catch(o=>m(o))})),a.push(new Promise((l,m)=>{if(!d.audio)return l();navigator.mediaDevices.getUserMedia({video:!1,audio:d.audio}).then(o=>l({type:"audioStream",stream:o})).catch(o=>m(o))})),Promise.all(a).then(l=>{l||i("no feed available");let m=[];const o=l.find(M=>M&&M.type==="videoStream");o&&m.push(...o.stream.getTracks());const w=l.find(M=>M&&M.type==="audioStream");w&&m.push(...w.stream.getAudioTracks());let b=new MediaStream(m);e(b)}).catch(l=>i(l))})},getDesktopCapturer(){return new Promise((d,e)=>{window.electronAPI.desktopCapturer&&(this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : getDesktopCapturer"),window.electronAPI.desktopCapturer({types:["window","screen"]}).then(i=>(i=i.map(a=>({chromeMediaSource:"desktop",deviceId:a.id,kind:"videoinput",label:"🖥️ "+a.name})),d(i))).catch(i=>e(i)))})},refreshAvailableDevices(){return new Promise(d=>{this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : refreshAvailableDevices"),this.connected_devices=[],this.is_loading_available_devices=!0,this.setSupportedConstraints().then(()=>this.listDevices()).then(e=>(this.connected_devices=e.map(i=>{var b,M;const{label:a,kind:l,deviceId:m,chromeMediaSource:o=!1}=i;let w={};try{w=(M=(b=i.getCapabilities())==null?void 0:b.facingMode)==null?void 0:M[0]}catch{}return{label:a,kind:l,deviceId:m,facingMode:w,chromeMediaSource:o}}),this.connected_devices.push({deviceId:"screen_capture",kind:"videoinput",label:"🖥️ "+this.$t("screen_capture")}),this.is_loading_available_devices=!1,d()))})},setCameraStreamFromDefaults(){return new Promise((d,e)=>{this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : setCameraStreamFromDefaults"),this.is_loading_feed=!0,this.selected_devices.audio_output_device&&this.$emit("update:audio_output_deviceId",this.selected_devices.audio_output_device.deviceId),this.startLocalStream().then(()=>{this.stream_current_settings=this.current_settings,this.last_working_resolution=this.desired_camera_resolution,this.is_loading_feed=!1}).catch(i=>{if(this.is_loading_feed=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("failed_to_start_streams_change_source_or_res")+"<br>"+i.name),this.desired_camera_resolution.type!=="custom")if(this.unavailable_camera_resolutions.push(this.desired_camera_resolution.label),this.last_working_resolution)this.desired_camera_resolution=this.last_working_resolution,this.last_working_resolution=!1,setTimeout(()=>{this.setCameraStreamFromDefaults().then(()=>d()).catch(()=>e())},500);else return e()}).then(()=>(this.share_this_stream.status.loading=!0,this.setStreamSharing())).then(()=>(this.share_this_stream.status.loading=!1,this.is_loading_feed=!1,d())).catch(i=>{this.share_this_stream.status.loading=!1,this.is_loading_feed=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("failed_to_share_stream")+"<br>"+i.name)})})},startLocalStream(){return new Promise((d,e)=>{this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : startLocalStream"),this.local_stream&&this.local_stream.getTracks().forEach(a=>a.stop());let i=this.createConstraintsFromSelected();setTimeout(()=>{this.startMediaDeviceFeed(i).then(a=>(this.local_stream=a,d())).catch(a=>(console.log("getUserMedia error : ",a),this.$emit("show"),a.name==="NotAllowedError"&&(this.status="not_allowed"),e(a)))},this.local_stream?200:0)})},createConstraintsFromSelected(){var e;this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : createConstraintsFromSelected");let d={audio:!1,video:!1};return d.audio={deviceId:this.selected_devices.audio_input_device.deviceId?{exact:this.selected_devices.audio_input_device.deviceId}:void 0,echoCancellation:this.advanced_capture_options.echoCancellation.enabled,noiseSuppression:this.advanced_capture_options.noiseSuppression.enabled},(e=this.selected_devices.video_input_device)!=null&&e.chromeMediaSource?(d._is_electron_screen_capture=!0,d.video={mandatory:{chromeMediaSource:this.selected_devices.video_input_device.chromeMediaSource,chromeMediaSourceId:this.selected_devices.video_input_device.deviceId}}):this.selected_devices.video_input_device&&this.selected_devices.video_input_device.deviceId==="screen_capture"?(d._is_webrtc_screen_capture=!0,d.video={cursor:this.advanced_capture_options.cursor.enabled}):d.video={deviceId:this.selected_devices.video_input_device.deviceId?{exact:this.selected_devices.video_input_device.deviceId}:void 0,width:{exact:this.desired_camera_resolution.width},height:{exact:this.desired_camera_resolution.height}},console.log("Constraints = "+JSON.stringify(d,null,4)),d},setStreamSharing(){return new Promise((d,e)=>(this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : setStreamSharing"),this.share_this_stream.enabled?this.share_this_stream.name.length===0?e("missing_stream_name"):(this.local_stream||this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("no_stream_found_while_sharing")),this.rtcmulti_connection||this.initRTCMulti(),this.rtcmulti_connection.addStream(this.local_stream),this.rtcmulti_connection.open(this.share_this_stream.name,(i,a,l)=>{this.$root.debug_mode===!0&&console.log(`CaptureSettings • METHODS : setStreamSharing • opened room ${a}`),this.share_this_stream.status.enabled=!0,this.share_this_stream.status.name=a,this.rtcmulti_connection.onNewParticipant=(m,o)=>this.newParticipantOnStream({participantId:m,userPreferences:o}),this.rtcmulti_connection.onleave=m=>this.onParticipantLeave({participantId:m}),l&&this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("failed_to_start_stream_sharing")+" "+l.message)}),d()):(this.stopSharingStream(),d())))},newParticipantOnStream({participantId:d,userPreferences:e}){this.share_this_stream.status.peers_connected.push(d),this.$alertify.closeLogOnClick(!0).delay(8e3).success(this.$t("new_user_connected_to_stream")),this.rtcmulti_connection.acceptParticipationRequest(d,e)},onParticipantLeave(d){this.$root.debug_mode===!0&&console.log(`CaptureSettings • METHODS : onParticipantLeave ${d}`),this.share_this_stream.status.peers_connected.filter(e=>e!==d)},callStream(){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : callStream"),this.access_distant_stream.calling=!0,this.rtcmulti_connection||this.initRTCMulti();const d=setTimeout(()=>{this.access_distant_stream.calling=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error("Failed to call timeout")},5e3);this.rtcmulti_connection.onstream=e=>{this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : callStream • onstream"),e.mediaElement.removeAttribute("src"),e.mediaElement.removeAttribute("srcObject"),e.mediaElement.muted=!0,e.mediaElement.volume=0,this.access_distant_stream.calling&&(this.remote_stream=e.stream,this.access_distant_stream.calling=!1,this.access_distant_stream.status.enabled=!0,clearTimeout(d))},this.rtcmulti_connection.checkPresence(this.access_distant_stream.callee,(e,i)=>{if(this.$root.debug_mode===!0&&console.log(`CaptureSettings • METHODS : username • for ${i} and ${e}`),!e){this.$alertify.closeLogOnClick(!0).delay(4e3).error(i+" is not online."),this.access_distant_stream.calling=!1,clearTimeout(d);return}this.$alertify.closeLogOnClick(!0).delay(4e3).success(i+" is online."),this.access_distant_stream.status.callee=i,this.rtcmulti_connection.join(i)})},hangupStream(){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : hangupStream"),this.rtcmulti_connection.leave(),this.access_distant_stream.status.enabled=!1},initRTCMulti(){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : initRTCMulti"),window.rtcmulti_connection||(window.rtcmulti_connection=new ri),this.rtcmulti_connection=window.rtcmulti_connection,this.rtcmulti_connection.iceServers=[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}],navigator.connection&&navigator.connection.type==="cellular"&&navigator.connection.downlinkMax<=.115&&this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("bandwidth_very_low_for_stream_sharing")),this.rtcmulti_connection.socketURL="https://rtcmulticonnection.herokuapp.com:443/",this.rtcmulti_connection.dontCaptureUserMedia=!0,this.rtcmulti_connection.session={video:!0,audio:!0,oneway:!0},this.rtcmulti_connection.onstream=d=>{console.log("CaptureSettings: onstream"),d.mediaElement.volume=0},this.rtcmulti_connection.onstreamended=()=>{console.log("CaptureSettings: onstreamended"),this.$alertify.closeLogOnClick(!0).delay(4e3).error("onstreamended")},this.rtcmulti_connection.onMediaError=d=>{console.log("CaptureSettings: onMediaError"),this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("stream_sharing_media_error")+d.message)}},stopSharingStream(){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : stopSharingStream"),this.rtcmulti_connection&&this.share_this_stream.status.peers_connected.map(d=>{this.rtcmulti_connection.disconnectWith(d)})},closeMultiRTC(){this.$root.debug_mode===!0&&console.log("CaptureSettings • METHODS : closeMultiRTC"),this.rtcmulti_connection&&(this.stopSharingStream(),this.rtcmulti_connection.closeSocket())}}};var ni=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_captureSettings"},[i("transition",{attrs:{name:"fade_fast",duration:400}},[e.is_loading_available_devices||e.is_loading_feed?i("LoaderSpinner",{staticClass:"_loader"}):e._e()],1),i("div",{staticClass:"m_captureSettings--settings"},[e.current_mode==="LocalSources"?i("div",{},[e.status==="not_allowed"?i("div",[i("div",{staticClass:"padding-top-verysmall"},[e._v(" "+e._s(e.$t("camera_access_refused"))+" ")])]):e._e(),i("label",{staticClass:"u-label _sourcesTitle"},[e._v(" "+e._s(e.$t("sources"))+" "),i("button",{staticClass:"u-buttonLink margin-none margin-left padding-bottom-none",attrs:{type:"button"},on:{click:e.refreshAvailableDevices}},[e._v(" "+e._s(e.$t("reload"))+" ")])]),i("div",{},[i("div",{},[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("camera")))]),i("div",[e.all_video_input_devices.length===0?i("small",[e._v(" "+e._s(e.$t("no_video_input_available"))+" ")]):i("select",{directives:[{name:"model",rawName:"v-model",value:e.selected_devices.video_input_device,expression:"selected_devices.video_input_device"}],attrs:{id:"devices",name:"Video devices",title:"devices"},on:{change:function(a){var l=Array.prototype.filter.call(a.target.options,function(m){return m.selected}).map(function(m){var o="_value"in m?m._value:m.value;return o});e.$set(e.selected_devices,"video_input_device",a.target.multiple?l:l[0])}}},e._l(e.all_video_input_devices,function(a){return i("option",{key:a.deviceId,domProps:{value:a}},[e._v(" "+e._s(a.label)+" ")])}),0)]),e.selected_devices.video_input_device&&e.selected_devices.video_input_device.deviceId==="screen_capture"?i("div",{staticClass:"margin-top-veryverysmall"},[i("span",{staticClass:"u-switch u-switch-xs"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.advanced_capture_options.cursor.enabled,expression:"advanced_capture_options.cursor.enabled"}],attrs:{id:"show_cursor",type:"checkbox",disabled:!e.advanced_capture_options.cursor.supported,"true-value":"always","false-value":"never"},domProps:{checked:Array.isArray(e.advanced_capture_options.cursor.enabled)?e._i(e.advanced_capture_options.cursor.enabled,null)>-1:e._q(e.advanced_capture_options.cursor.enabled,"always")},on:{change:function(a){var l=e.advanced_capture_options.cursor.enabled,m=a.target,o=m.checked?"always":"never";if(Array.isArray(l)){var w=null,b=e._i(l,w);m.checked?b<0&&e.$set(e.advanced_capture_options.cursor,"enabled",l.concat([w])):b>-1&&e.$set(e.advanced_capture_options.cursor,"enabled",l.slice(0,b).concat(l.slice(b+1)))}else e.$set(e.advanced_capture_options.cursor,"enabled",o)}}}),i("label",{staticClass:"u-label",attrs:{for:"show_cursor"}},[e._v(e._s(e.$t("show_cursor")))]),e.advanced_capture_options.cursor.supported?e._e():i("small",[e._v(" "+e._s(e.$t("not_supported_on_this_device"))+" ")])])]):e._e()]),i("div",[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("audioinput")))]),i("div",[e.all_audio_input_devices.length===0?i("small",[e._v(" "+e._s(e.$t("no_audio_input_available"))+" ")]):i("select",{directives:[{name:"model",rawName:"v-model",value:e.selected_devices.audio_input_device,expression:"selected_devices.audio_input_device"}],attrs:{id:"devices",name:"Video devices",title:"devices"},on:{change:function(a){var l=Array.prototype.filter.call(a.target.options,function(m){return m.selected}).map(function(m){var o="_value"in m?m._value:m.value;return o});e.$set(e.selected_devices,"audio_input_device",a.target.multiple?l:l[0])}}},e._l(e.all_audio_input_devices,function(a){return i("option",{key:a.deviceId,domProps:{value:a}},[e._v(" "+e._s(a.label)+" ")])}),0)]),e.selected_devices.audio_input_device?i("div",{staticClass:"margin-top-veryverysmall"},[i("span",{staticClass:"u-switch u-switch-xs"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.advanced_capture_options.echoCancellation.enabled,expression:"advanced_capture_options.echoCancellation.enabled"}],attrs:{id:"echoCancellation",type:"checkbox",disabled:!e.advanced_capture_options.echoCancellation.supported},domProps:{checked:Array.isArray(e.advanced_capture_options.echoCancellation.enabled)?e._i(e.advanced_capture_options.echoCancellation.enabled,null)>-1:e.advanced_capture_options.echoCancellation.enabled},on:{change:function(a){var l=e.advanced_capture_options.echoCancellation.enabled,m=a.target,o=!!m.checked;if(Array.isArray(l)){var w=null,b=e._i(l,w);m.checked?b<0&&e.$set(e.advanced_capture_options.echoCancellation,"enabled",l.concat([w])):b>-1&&e.$set(e.advanced_capture_options.echoCancellation,"enabled",l.slice(0,b).concat(l.slice(b+1)))}else e.$set(e.advanced_capture_options.echoCancellation,"enabled",o)}}}),i("label",{staticClass:"u-label",attrs:{for:"echoCancellation"}},[e._v(e._s(e.$t("echoCancellation")))]),e.advanced_capture_options.echoCancellation.supported?e._e():i("small",[e._v(" "+e._s(e.$t("not_supported_on_this_device"))+" ")])])]):e._e(),e.selected_devices.audio_input_device?i("div",{staticClass:"margin-top-veryverysmall"},[i("span",{staticClass:"u-switch u-switch-xs"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.advanced_capture_options.noiseSuppression.enabled,expression:"advanced_capture_options.noiseSuppression.enabled"}],attrs:{id:"noiseSuppression",type:"checkbox",disabled:!e.advanced_capture_options.noiseSuppression.supported},domProps:{checked:Array.isArray(e.advanced_capture_options.noiseSuppression.enabled)?e._i(e.advanced_capture_options.noiseSuppression.enabled,null)>-1:e.advanced_capture_options.noiseSuppression.enabled},on:{change:function(a){var l=e.advanced_capture_options.noiseSuppression.enabled,m=a.target,o=!!m.checked;if(Array.isArray(l)){var w=null,b=e._i(l,w);m.checked?b<0&&e.$set(e.advanced_capture_options.noiseSuppression,"enabled",l.concat([w])):b>-1&&e.$set(e.advanced_capture_options.noiseSuppression,"enabled",l.slice(0,b).concat(l.slice(b+1)))}else e.$set(e.advanced_capture_options.noiseSuppression,"enabled",o)}}}),i("label",{staticClass:"u-label",attrs:{for:"noiseSuppression"}},[e._v(e._s(e.$t("noiseSuppression")))]),e.advanced_capture_options.noiseSuppression.supported?e._e():i("small",[e._v(" "+e._s(e.$t("not_supported_on_this_device"))+" ")])])]):e._e()]),i("div",[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("audiooutput")))]),i("div",[e.all_audio_output_devices.length===0?i("small",[e._v(" "+e._s(e.$t("no_audio_output_available"))+" ")]):i("select",{directives:[{name:"model",rawName:"v-model",value:e.selected_devices.audio_output_device,expression:"selected_devices.audio_output_device"}],attrs:{id:"devices",name:"Video devices",title:"devices"},on:{change:function(a){var l=Array.prototype.filter.call(a.target.options,function(m){return m.selected}).map(function(m){var o="_value"in m?m._value:m.value;return o});e.$set(e.selected_devices,"audio_output_device",a.target.multiple?l:l[0])}}},e._l(e.all_audio_output_devices,function(a){return i("option",{key:a.deviceId,domProps:{value:a}},[e._v(" "+e._s(a.label)+" ")])}),0)])])]),i("div",{staticClass:"u-spacingBottom"}),i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("resolutions")))]),i("div",[!e.selected_devices.video_input_device||!e.selected_devices.video_input_device.deviceId?i("div",[i("small",[e._v(" "+e._s(e.$t("pick_a_camera"))+" ")])]):e._e(),e.selected_devices.video_input_device&&(e.selected_devices.video_input_device.deviceId==="screen_capture"||e.selected_devices.video_input_device.chromeMediaSource)?i("div",[i("small",[e._v(" "+e._s(e.$t("cant_pick_resolution_when_screen_capture"))+" ")])]):i("div",{staticClass:"m_captureSettings--settings--resolutions"},[e._l(e.predefined_resolutions.concat(e.custom_camera_resolution),function(a){return i("div",{key:a.name},[i("label",{attrs:{for:a.label}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.desired_camera_resolution,expression:"desired_camera_resolution"}],attrs:{type:"radio",id:a.label,disabled:e.unavailable_camera_resolutions.includes(a.label)},domProps:{value:a,checked:e._q(e.desired_camera_resolution,a)},on:{change:function(l){e.desired_camera_resolution=a}}}),i("span",{staticClass:"_resolutionLabel"},[i("DLabel",{attrs:{str:a.label,tag:"div",instructions:e.resInstructions(a)}})],1)])])}),e.desired_camera_resolution&&e.desired_camera_resolution.type==="custom"?i("div",{staticClass:"u-sameRow _customResolution"},[i("label",{staticClass:"u-label",attrs:{for:"custom_width"}},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.desired_camera_resolution.width,expression:"desired_camera_resolution.width",modifiers:{number:!0}}],attrs:{name:"custom_width",type:"number",min:"2",max:"4096",step:"2"},domProps:{value:e.desired_camera_resolution.width},on:{input:function(a){a.target.composing||e.$set(e.desired_camera_resolution,"width",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}})]),i("span",{staticClass:"u-padding_verysmall _customResolutionX"},[e._v(" × ")]),i("label",{staticClass:"u-label",attrs:{for:"custom_height"}},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.desired_camera_resolution.height,expression:"desired_camera_resolution.height",modifiers:{number:!0}}],attrs:{name:"custom_height",type:"number",min:"2",max:"2160",step:"2"},domProps:{value:e.desired_camera_resolution.height},on:{input:function(a){a.target.composing||e.$set(e.desired_camera_resolution,"height",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}}),e._v(" "+e._s(e.$t("pixels"))+" ")])]):e._e()],2)])]):e.current_mode==="RemoteSources"?i("div",[i("div",[e._v(" "+e._s(e.$t("feature_not_yet_implemented"))+" ")]),i("div",{staticClass:"u-disabled"},[i("small",[e._v(e._s(e.$t("connect_to_other_users")))]),i("div",{staticClass:"padding-vert-small padding-bottom-small"},[i("label",{staticClass:"u-label",domProps:{innerHTML:e._s(e.$t("name_of_stream"))}}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.access_distant_stream.callee,expression:"access_distant_stream.callee",modifiers:{trim:!0}},{name:"uppercase",rawName:"v-uppercase"}],attrs:{type:"text",required:"",disabled:e.access_distant_stream.status.enabled,autofocus:"autofocus",onfocus:"this.select()"},domProps:{value:e.access_distant_stream.callee},on:{keydown:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:(a.preventDefault(),e.callStream.apply(null,arguments))},input:function(a){a.target.composing||e.$set(e.access_distant_stream,"callee",a.target.value.trim())},blur:function(a){return e.$forceUpdate()}}})])])]):e._e()]),e._e()],1)},oi=[],di=he(si,ni,oi,!1,null,"e9a8bee0");const ui=di.exports,li={props:{enable_effects:Boolean,videoElement:HTMLVideoElement,canvasElement:HTMLCanvasElement,project_path:String},components:{ImageSelect:()=>_t(()=>import("./ImageSelect-BvfIGH76.js"),[])},data(){return{source_stream_resolution:{width:void 0,height:void 0},flip_horizontally:!1,flip_vertically:!1,select_image:!1,chroma_key_replacement_image_url:void 0,chroma_key_settings:{enable:!1,key_color:{r:0,g:255,b:0},similarity:.02,smoothness:.08,spill:.1,replacement_color:{r:252,g:75,b:96},replacement_mode:"color",replacement_image:void 0},image_filters_settings:{brightness:{value:1,order:0,default:1,min:0,max:2,step:.01},contrast:{value:1,order:1,default:1,min:0,max:3,step:.01},hue:{value:0,order:2,default:0,min:-.5,max:.5,step:.01},saturation:{value:0,order:3,default:0,min:-1,max:1,step:.01},lightness:{value:0,order:4,default:0,min:-1,max:1,step:.01},dotscreen:{value:10,order:6,default:10,min:3,max:20,step:.01}},enable_pick_color_from_video:!1,offscreen_canvas:void 0,fragment_shader:`
precision mediump float;
#define PI 3.1415926538

uniform sampler2D videoTex;
uniform float texWidth;
uniform float texHeight;


uniform int flipHorizontally;
uniform int flipVertically;

uniform vec3 keyColor;
uniform vec3 replacementColor;
uniform sampler2D replacementImage;

uniform float similarity;
uniform float smoothness;
uniform float spill;
uniform int chromaKeyMode;

uniform float brightness;
uniform float contrast;
uniform float mid;

uniform float hue;
uniform float saturation;
uniform float lightness;

uniform float dotscreen;


// From https://github.com/libretro/glsl-shaders/blob/master/nnedi3/shaders/rgb-to-yuv.glsl
vec2 RGBtoUV(vec3 rgb) {
  return vec2(
    rgb.r * -0.169 + rgb.g * -0.331 + rgb.b *  0.5    + 0.5,
    rgb.r *  0.5   + rgb.g * -0.419 + rgb.b * -0.081  + 0.5
  );
}

vec4 ProcessChromaKey(vec2 texCoord, vec4 videoColor) {
  float chromaDist = distance(RGBtoUV(videoColor.rgb), RGBtoUV(keyColor));

  float baseMask = chromaDist - similarity;
  float fullMask = pow(clamp(baseMask / smoothness, 0., 1.), 1.5);
  videoColor.a = fullMask;

  float spillVal = pow(clamp(baseMask / spill, 0., 1.), 1.5);
  float desat = clamp(videoColor.r * 0.2126 + videoColor.g * 0.7152 + videoColor.b * 0.0722, 0., 1.);
  videoColor.rgb = mix(vec3(desat, desat, desat), videoColor.rgb, spillVal);

  return videoColor;
}
vec4 ApplyChromaKey(vec2 texCoord, vec4 videoColor)  {
  vec4 chromaVideoColor = ProcessChromaKey(texCoord, videoColor);

  vec4 replaceWith = vec4(0.0);
  if(chromaKeyMode == 0) {
    // color
    replaceWith = vec4(replacementColor, 1.0);
  } else if(chromaKeyMode == 1) {
    // image
    replaceWith = vec4(texture2D(replacementImage, texCoord));
  }

  vec4 result = mix(vec4(chromaVideoColor.rgb, 1.0), replaceWith, 1.0 - chromaVideoColor.a);
  return result;
}

vec3 RGBtoHCV(vec3 RGB) {
  float Epsilon = 0.00000000001;
  // Based on work by Sam Hocevar and Emil Persson
  vec4 P = (RGB.g < RGB.b) ? vec4(RGB.bg, -1.0, 2.0/3.0) : vec4(RGB.gb, 0.0, -1.0/3.0);
  vec4 Q = (RGB.r < P.x) ? vec4(P.xyw, RGB.r) : vec4(RGB.r, P.yzx);
  float C = Q.x - min(Q.w, Q.y);
  float H = abs((Q.w - Q.y) / (6.0 * C + Epsilon) + Q.z);
  return vec3(H, C, Q.x);
}
vec3 HUEtoRGB(float h) {
  float r = abs(h * 6.0 - 3.0) - 1.0;
  float g = 2.0 - abs(h * 6.0 - 2.0);
  float b = 2.0 - abs(h * 6.0 - 4.0);
  return clamp(vec3(r, g, b), 0.0, 1.0);
}

vec3 RGBtoHSL(vec3 RGB) {
  float Epsilon = 0.00000000001;
  vec3 HCV = RGBtoHCV(RGB);
  float L = HCV.z - HCV.y * 0.5;
  float S = HCV.y / (1.0 - abs(L * 2.0 - 1.0) + Epsilon);
  return vec3(HCV.x, S, L);
}
vec3 HSLtoRGB(vec3 HSL) {
  vec3 RGB = HUEtoRGB(HSL.x);
  float C = (1.0 - abs(2.0 * HSL.z - 1.0)) * HSL.y;
  return (RGB - 0.5) * C + HSL.z;
}
float clamp_continuous(float value) {
  float unit = value;

  if (unit > 1.0) {
    unit = mod(unit, 1.0);
  } else if (unit < 0.0) {
    unit = 1.0 + unit;
  }

  return unit;
}

float mix_factor(vec4 range, vec3 hsl) {
  float mix_factor = 0.0;

  if (hsl.x >= range.x && hsl.x <= range.w) {
    // lower range
    if (hsl.x >= range.x && hsl.x < range.y) {
      mix_factor = smoothstep(range.x, range.y, hsl.x);
    }

    // target range
    if (hsl.x >= range.y && hsl.x <= range.z) {
      mix_factor = 1.0;
    }

    // upper range
    if (hsl.x > range.z && hsl.x <= range.w) {
      mix_factor = 1.0 - smoothstep(range.z, range.w, hsl.x);
    }
  }

  vec2 lightness_range = vec2(0.0, 0.08333);
  vec2 saturation_range = vec2(0.0, 0.08333);
  mix_factor *= smoothstep(saturation_range.x, saturation_range.y, hsl.y);
  mix_factor *= smoothstep(lightness_range.x, lightness_range.y, hsl.z);

  return mix_factor;
}

float pattern(vec2 texCoord) {
  float angle = PI / 8.0;
  float s = sin(angle), c = cos(angle);
  vec2 tex = texCoord * vec2(texWidth, texHeight) - vec2(0.5, 0.5);
  vec2 point = vec2(
      c * tex.x - s * tex.y,
      s * tex.x + c * tex.y
  ) * (PI / dotscreen);
  return (sin(point.x) * sin(point.y)) * 4.0;
}

void main(void) {
  // get video image
  vec2 texCoord = vec2(gl_FragCoord.x/texWidth, 1.0 - (gl_FragCoord.y/texHeight));

  if(flipVertically == 1)
    texCoord.y = 1.0 - texCoord.y;
  if(flipHorizontally == 1)
    texCoord.x = 1.0 - texCoord.x;

  vec4 videoColor = texture2D(videoTex, texCoord);

  // apply chroma key if necessary
  if (chromaKeyMode != -1000) {
    videoColor = ApplyChromaKey(texCoord, videoColor);
  }

  // apply brightness, from https://github.com/actionnick/exposure/blob/master/src/shaders/exposure.frag
  if(brightness != -1000.0) {
    videoColor = mix(videoColor, vec4(1.0, 1.0, 1.0, 1.0), brightness - 1.0);
    videoColor.a = 1.0;
  }

  // contrast
  if(contrast != -1000.0) {
    videoColor.r = ((videoColor.r - mid) * contrast) + mid;
    videoColor.g = ((videoColor.g - mid) * contrast) + mid;
    videoColor.b = ((videoColor.b - mid) * contrast) + mid;
    videoColor.a = 1.0;
  }

  // hue, saturation, lightness
  if(hue != -1000.0 || saturation != -1000.0 || lightness != -1000.0) {
    vec3 hsl = RGBtoHSL(videoColor.rgb);
    vec4 MASTER_RANGE = vec4(0.0, 0.0, 1.0, 1.0);

    float master_mix_factor = mix_factor(MASTER_RANGE, hsl);
    // hue
    if(hue != -1000.0) {
      hsl.x = clamp_continuous(hsl.x + (hue * master_mix_factor));
    }
    // saturation
    if(saturation != -1000.0) {
      hsl.y = clamp(hsl.y + (saturation * master_mix_factor), 0.0, 1.0);
    }
    // lightness
    if(lightness != -1000.0) {
      hsl.z = clamp(mix(hsl.z, 1.0, max(0.0, lightness)), 0.0, 1.0);
      hsl.z = clamp(mix(hsl.z, 0.0, abs(min(0.0, lightness))), 0.0, 1.0);
    }

    videoColor.rgb = HSLtoRGB(hsl);
  }

  if(dotscreen != -1000.0) {
    float average = (videoColor.r + videoColor.g + videoColor.b) / 3.0;
    videoColor = vec4(vec3(average * 10.0 - 5.0 + pattern(texCoord)), videoColor.a);
  }

  gl_FragColor = videoColor;

}
      `}},created(){},updated(){},mounted(){this.$eventHub.$on("captureCanvas.pixelColorUnderMouse",this.pixelColorUnderMouse)},beforeDestroy(){this.$eventHub.$off("captureCanvas.pixelColorUnderMouse",this.pixelColorUnderMouse),this.stopWebGL()},watch:{enable_effects(){this.enable_effects||this.disableAllEffects()},enable__(){this.$emit("update:enable_effects",this.enable__),this.enable__&&this.$nextTick(()=>{this.startWebGL()})},"chroma_key_settings.replacement_mode"(){this.chroma_key_settings.replacement_mode==="image"&&(this.chroma_key_replacement_image_url=void 0,this.select_image=!0)}},computed:{enable__(){return this.flip_vertically===!0||this.flip_horizontally===!0||this.chroma_key_settings.enable===!0||Object.keys(this.image_filters_settings).some(d=>this.image_filters_settings[d].value!==this.image_filters_settings[d].default)},chroma_key_color_hex:{get(){return this.rgbToHex(this.chroma_key_settings.key_color)},set(d){this.chroma_key_settings.key_color=this.hexToRgb(d)}},chroma_key_replacement_color_hex:{get(){return this.rgbToHex(this.chroma_key_settings.replacement_color)},set(d){this.chroma_key_settings.replacement_color=this.hexToRgb(d)}}},methods:{disableAllEffects(){this.flip_vertically=!1,this.flip_horizontally=!1,this.chroma_key_settings.enable=!1,Object.keys(this.image_filters_settings).map(d=>{this.image_filters_settings[d].value=this.image_filters_settings[d].default})},hexToRgb(d){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},rgbToHex({r:d,g:e,b:i}){return d=d.toString(16),e=e.toString(16),i=i.toString(16),d.length==1&&(d="0"+d),e.length==1&&(e="0"+e),i.length==1&&(i="0"+i),"#"+d+e+i},setTogglePickColorFromVideo(){this.enable_pick_color_from_video?this.enable_pick_color_from_video=!1:this.enable_pick_color_from_video=!0},pixelColorUnderMouse({px_color:d,type:e}){this.enable_pick_color_from_video&&(this.chroma_key_settings.key_color=d,e==="click"&&this.setTogglePickColorFromVideo())},startWebGL(){console.log("CaptureEffects • METHODS : startWebGL"),this.offscreen_canvas&&this.stopWebGL(),this.offscreen_canvas=document.createElement("canvas"),this.offscreen_canvas.classList.add("offscreenCanvas");var d=this.canvasElement.getContext("2d");const e=this.offscreen_canvas.getContext("webgl",{premultipliedAlpha:!1}),i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,"attribute vec2 c; void main(void) { gl_Position=vec4(c, 0.0, 1.0); }"),e.compileShader(i);const a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,this.fragment_shader),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.error(e.getShaderInfoLog(a));const l=e.createProgram();e.attachShader(l,i),e.attachShader(l,a),e.linkProgram(l),e.useProgram(l);const m=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,m),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,-1,1,1]),e.STATIC_DRAW);const o=e.getAttribLocation(l,"c");e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o),e.activeTexture(e.TEXTURE0+0);const w=e.createTexture();e.bindTexture(e.TEXTURE_2D,w),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);const b=e.getUniformLocation(l,"videoTex");e.uniform1i(b,0);const M=e.getUniformLocation(l,"texWidth"),_=e.getUniformLocation(l,"texHeight"),D=e.getUniformLocation(l,"flipHorizontally"),x=e.getUniformLocation(l,"flipVertically"),N=e.getUniformLocation(l,"keyColor"),I=e.getUniformLocation(l,"replacementColor"),G=e.getUniformLocation(l,"replacementImage");e.uniform1i(G,1);const B=e.getUniformLocation(l,"similarity"),V=e.getUniformLocation(l,"smoothness"),J=e.getUniformLocation(l,"spill"),te=e.getUniformLocation(l,"chromaKeyMode"),q=e.getUniformLocation(l,"mid"),Re=Object.keys(this.image_filters_settings).reduce((oe,se)=>(oe[se]=e.getUniformLocation(l,se),oe),{});this.loadReplacementImageInShader();const Te=()=>{if(!this.offscreen_canvas||!this.enable__)return;console.log("CaptureEffects • METHODS : startWebGL • processFrame"),this.offscreen_canvas.width=this.videoElement.videoWidth,this.offscreen_canvas.height=this.videoElement.videoHeight,e.activeTexture(e.TEXTURE0+0),e.viewport(0,0,this.videoElement.videoWidth,this.videoElement.videoHeight),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.videoElement),e.uniform1f(M,this.videoElement.videoWidth),e.uniform1f(_,this.videoElement.videoHeight),e.uniform1i(D,this.flip_horizontally?1:0),e.uniform1i(x,this.flip_vertically?1:0),e.uniform3f(N,this.chroma_key_settings.key_color.r/255,this.chroma_key_settings.key_color.g/255,this.chroma_key_settings.key_color.b/255),e.uniform3f(I,this.chroma_key_settings.replacement_color.r/255,this.chroma_key_settings.replacement_color.g/255,this.chroma_key_settings.replacement_color.b/255),e.uniform1f(B,parseFloat(this.chroma_key_settings.similarity)),e.uniform1f(V,parseFloat(this.chroma_key_settings.smoothness)),e.uniform1f(J,parseFloat(this.chroma_key_settings.spill)),Object.entries(Re).map(([se,de])=>{e.uniform1f(de,parseFloat(this.image_filters_settings[se].value!==this.image_filters_settings[se].default?this.image_filters_settings[se].value:-1e3))}),e.uniform1f(q,parseFloat(.5));let oe=-1e3;this.chroma_key_settings.enable&&(this.chroma_key_settings.replacement_mode==="color"?oe=0:this.chroma_key_settings.replacement_mode==="image"&&(oe=1)),e.uniform1i(te,parseInt(oe)),e.drawArrays(e.TRIANGLE_FAN,0,4),d.drawImage(this.offscreen_canvas,0,0),window.requestAnimationFrame(Te)};window.requestAnimationFrame(Te)},stopWebGL(){this.offscreen_canvas=void 0},async newChromaKeyImage(d){if(console.log("CaptureEffects • METHODS : newChromaKeyImage"),!d){this.chroma_key_settings.replacement_image=void 0,this.chroma_key_replacement_image_url=void 0,this.loadReplacementImageInShader();return}const e=await createImageBitmap(d);this.chroma_key_replacement_image_url=URL.createObjectURL(d);const i=document.createElement("canvas"),a=i.getContext("2d");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const l="cover",m=e.height/e.width,o=i.height/i.width;if(m<o&&l==="contain"||m>o&&l==="cover"){const w=i.width*m;a.drawImage(e,0,(i.height-w)/2,i.width,w)}if(m>o&&l==="contain"||m<o&&l==="cover"){const w=i.width*o/m;a.drawImage(e,(i.width-w)/2,0,w,i.height)}this.chroma_key_settings.replacement_image=a.getImageData(0,0,i.width,i.height),this.loadReplacementImageInShader(),i.remove()},getMediaSrcFromPath(d){const e=this.getMediaInFolder({path_to_source_media_meta:d}),i=this.getParent(e.$path);return this.makeRelativeURLFromThumbs({$thumbs:e.$thumbs,$type:e.$type,$path:i,resolution:1600})},loadReplacementImageInShader(){const d=this.offscreen_canvas.getContext("webgl",{premultipliedAlpha:!1});d.activeTexture(d.TEXTURE1);const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e),this.chroma_key_settings.replacement_image&&d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,this.chroma_key_settings.replacement_image),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)}}};var ci=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_captureEffects"},[i("div",{staticClass:"_content"},[i("div",{staticClass:"_options"},[i("ToggleInput",{attrs:{content:e.flip_horizontally,label:e.$t("flip_horizontally")},on:{"update:content":function(a){e.flip_horizontally=a}}}),i("ToggleInput",{attrs:{content:e.flip_vertically,label:e.$t("flip_vertically")},on:{"update:content":function(a){e.flip_vertically=a}}}),i("ToggledSection",{attrs:{label:e.$t("chroma_key"),show_toggle:e.chroma_key_settings.enable},on:{"update:show_toggle":function(a){return e.$set(e.chroma_key_settings,"enable",a)}}},[i("fieldset",[i("legend",{staticClass:"u-label"},[e._v(e._s(e.$t("chroma_key_color")))]),i("ColorInput",{attrs:{label:e.$t("color"),can_toggle:!1,value:e.chroma_key_color_hex},on:{save:function(a){e.chroma_key_color_hex=a}}}),i("div",[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:e.setTogglePickColorFromVideo}},[e.enable_pick_color_from_video?[e._v(" "+e._s(e.$t("click_in_video…"))+" ")]:[e._v(" "+e._s(e.$t("pick_color_in_video"))+" ")]],2)]),i("br"),i("div",[i("div",{},[i("label",[e._v(e._s(e.$t("similarity")))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.chroma_key_settings.similarity,expression:"chroma_key_settings.similarity",modifiers:{number:!0}}],staticClass:"margin-none",attrs:{type:"range",min:"0",max:"1",step:"0.001"},domProps:{value:e.chroma_key_settings.similarity},on:{__r:function(a){e.$set(e.chroma_key_settings,"similarity",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}})]),i("div",{},[i("label",[e._v(e._s(e.$t("smoothness")))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.chroma_key_settings.smoothness,expression:"chroma_key_settings.smoothness",modifiers:{number:!0}}],staticClass:"margin-none",attrs:{type:"range",min:"0",max:"1",step:"0.001"},domProps:{value:e.chroma_key_settings.smoothness},on:{__r:function(a){e.$set(e.chroma_key_settings,"smoothness",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}})]),i("div",{},[i("label",[e._v(e._s(e.$t("spill")))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.chroma_key_settings.spill,expression:"chroma_key_settings.spill",modifiers:{number:!0}}],staticClass:"margin-none",attrs:{type:"range",min:"0",max:"1",step:"0.001",value:"0.1"},domProps:{value:e.chroma_key_settings.spill},on:{__r:function(a){e.$set(e.chroma_key_settings,"spill",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}})])])],1),i("fieldset",[i("legend",{staticClass:"u-label"},[e._v(e._s(e.$t("replace_color_with")))]),i("RadioCheckboxInput",{attrs:{value:e.chroma_key_settings.replacement_mode,options:[{label:e.$t("color"),key:"color"},{label:e.$t("image"),key:"image"}],can_edit:!0},on:{"update:value":function(a){e.chroma_key_settings.replacement_mode=a}}}),e.chroma_key_settings.replacement_mode==="image"?i("div",[i("img",{staticClass:"_imgPreview",attrs:{src:e.chroma_key_replacement_image_url}}),i("EditBtn",{attrs:{label:e.chroma_key_replacement_image_url?e.$t("edit"):e.$t("select"),is_unfolded:!0},on:{click:function(a){e.select_image=!0}}}),e.select_image?i("ImageSelect",{attrs:{label:e.$t("image"),project_path:e.project_path},on:{newPreview:e.newChromaKeyImage,close:function(a){e.select_image=!1}}}):e._e()],1):i("div",[i("ColorInput",{attrs:{can_toggle:!1,value:e.chroma_key_replacement_color_hex},on:{save:function(a){e.chroma_key_replacement_color_hex=a}}})],1)],1)]),e._l(Object.entries(e.image_filters_settings),function([a,l]){return i("div",{key:a},[i("RangeValueInput",{attrs:{label:e.$t(a),value:e.image_filters_settings[a].value,can_toggle:!0,min:l.min,max:l.max,step:l.step,ticks:l.ticks,default_value:l.default},on:{save:function(m){e.image_filters_settings[a].value=m}}})],1)})],2)])])},fi=[],mi=he(li,ci,fi,!1,null,"792ee728");const pi=mi.exports,hi={props:{stopmotion_path:String},components:{RemoveMenu:vt},data(){return{stopmotion:void 0,fetch_stopmotion_error:void 0}},created(){},async mounted(){const d=await this.$api.getFolder({path:this.stopmotion_path}).catch(e=>{this.fetch_stopmotion_error=e.response});this.stopmotion=d},beforeDestroy(){},watch:{},computed:{images(){var d,e,i;return(d=this.stopmotion)!=null&&d.images_list&&((i=(e=this.stopmotion)==null?void 0:e.$files)==null?void 0:i.length)>0?this.stopmotion.images_list.reduce((l,m)=>{const o=m.m||m,w=this.stopmotion.$files.find(b=>b.$path.endsWith("/"+o));return w&&!l.find(b=>b.$path===w.$path)&&l.push(w),l},[]):[]}},methods:{}};var _i=function(){var e=this,i=e._self._c;return e.stopmotion?i("div",{staticClass:"_preview"},[i("div",{staticClass:"_topRow"},[i("DateDisplay",{attrs:{title:e.$t("date_created"),date:e.stopmotion.$date_created,show_detail_initially:!0}}),i("div",{staticClass:"_btns"},[i("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(a){return e.$emit("load")}}},[e._v(" "+e._s(e.$t("open"))+" ")]),i("RemoveMenu",{on:{remove:function(a){return e.$emit("remove")}}})],1)],1),i("br"),i("div",{staticClass:"_images"},[i("label",{staticClass:"u-label"},[e._v(" "+e._s(e.$t("images").toUpperCase())+" = "+e._s(e.images.length)+" ")]),i("div",{staticClass:"_imagesCont"},e._l(e.images,function(a){return i("div",{key:a.$path},[i("MediaContent",{attrs:{file:a,resolution:240}})],1)}),0)])]):e._e()},vi=[],gi=he(hi,_i,vi,!1,null,"122b25e4");const yi=gi.exports,bi={props:{project_path:String},components:{StopmotionPreview:yi},data(){return{path:`${this.project_path}/stopmotions`,is_loading:!0,stopmotions:[]}},created(){},async mounted(){this.is_loading=!0,this.stopmotions=await this.$api.getFolders({path:this.path}),this.is_loading=!1,this.$api.join({room:this.path})},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{sorted_stopmotions(){return this.stopmotions.slice().sort((e,i)=>+new Date(i.$date_created)-+new Date(e.$date_created))}},methods:{async removeStopmotion(d){try{await this.$api.deleteItem({path:d})}catch{}}}};var wi=function(){var e=this,i=e._self._c;return i("BaseModal2",{attrs:{title:e.$t("stopmotion_list")},on:{close:function(a){return e.$emit("close")}}},[i("transition",{attrs:{name:"fade_fast",duration:150,mode:"out-in"}},[e.is_loading?i("LoaderSpinner"):i("div",{staticClass:"m_stopmotionList"},[e.sorted_stopmotions.length===0?i("div",{staticClass:"u-instructions"},[e._v(" "+e._s(e.$t("no_stopmotion_created_yet"))+" ")]):i("div",[i("transition-group",{attrs:{tag:"div",name:"listComplete"}},e._l(e.sorted_stopmotions,function(a){return i("div",{key:a.$path},[i("StopmotionPreview",{attrs:{stopmotion_path:a.$path},on:{load:function(l){return e.$emit("loadStopmotion",a.$path)},remove:function(l){return e.removeStopmotion(a.$path)}}})],1)}),0)],1)])],1)],1)},Ci=[],xi=he(bi,wi,Ci,!1,null,"120dceb5");const Si=xi.exports;function ki(d,e,i){i||(i=e,e=null),e=e||{};var a={},l=e.context||new AudioContext,m=l.createMediaStreamSource(d),o=l.createAnalyser(),w=null;return i&&(w=l.createScriptProcessor(2048,1,1),w.onaudioprocess=function(){i(a.get())}),o.smoothingTimeConstant=.3,o.fftSize=256,m.connect(o),a.get=function(){var b=0,M=new Uint8Array(o.frequencyBinCount);o.getByteFrequencyData(M);for(var _=0;_<M.length;_++)b+=M[_];return b/M.length/255},a.destroy=function(){w&&(w.disconnect(),o.disconnect()),m.disconnect(),e.context||l.close()},m.connect(o),w&&(o.connect(w),w.connect(l.destination)),a}const Ri={props:{stream:MediaStream,is_recording:Boolean,type:{type:String,default:"Full"}},components:{},data(){return{audio_activity:void 0,current_audio_level:0,audioHistory:[],maxHistoryPoints:1e3}},created(){},mounted(){this.startEqualizer()},beforeDestroy(){this.audio_activity.destroy()},watch:{stream(){this.startEqualizer()},is_recording(){this.audioHistory=[]}},computed:{},methods:{startEqualizer(){this.audio_activity&&this.audio_activity.destroy(),typeof this.stream=="object"&&(this.audio_activity=ki(this.stream,d=>{this.current_audio_level=d}),this.drawVolume())},drawVolume(){const d=this.$refs.canvas;if(!d)return;const e=1,i=this.$el.clientWidth*e,a=this.$el.clientHeight*e;(i!==d.width||a!==d.height)&&(d.width=i,d.height=a);const l=this.maxHistoryPoints;this.audioHistory.push(this.current_audio_level),this.audioHistory.length>l&&this.audioHistory.shift();const m=d.getContext("2d");m.fillStyle="white",m.fillRect(0,0,d.width,d.height),this.is_recording?m.fillStyle="#fc4b60":m.fillStyle="#333";const o=d.width/this.audioHistory.length,w=d.height*1.6;this.audioHistory.forEach((b,M)=>{const _=M*o,D=o,x=Math.max(b*w,2),N=d.height/2-x/2;m.fillRect(_,N,D,x)}),window.requestAnimationFrame(this.drawVolume)}}};var Ti=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_audioEqualizer"},[i("canvas",{ref:"canvas",attrs:{width:"1280",height:"720"}})])},Mi=[],Di=he(Ri,Ti,Mi,!1,null,"4657f90e");const Ei=Di.exports;var ct={exports:{}};(function(d){(function(){function e(){var i=this;this.versionnumber="1.2.6",this.imageToSVG=function(a,l,m){m=i.checkoptions(m),i.loadImage(a,function(o){l(i.imagedataToSVG(i.getImgdata(o),m))},m)},this.imagedataToSVG=function(a,l){l=i.checkoptions(l);var m=i.imagedataToTracedata(a,l);return i.getsvgstring(m,l)},this.imageToTracedata=function(a,l,m){m=i.checkoptions(m),i.loadImage(a,function(o){l(i.imagedataToTracedata(i.getImgdata(o),m))},m)},this.imagedataToTracedata=function(a,l){l=i.checkoptions(l);var m=i.colorquantization(a,l);if(l.layering===0)for(var o={layers:[],palette:m.palette,width:m.array[0].length-2,height:m.array.length-2},w=0;w<m.palette.length;w++){var b=i.batchtracepaths(i.internodes(i.pathscan(i.layeringstep(m,w),l.pathomit),l),l.ltres,l.qtres);o.layers.push(b)}else{var M=i.layering(m);l.layercontainerid&&i.drawLayers(M,i.specpalette,l.scale,l.layercontainerid);var _=i.batchpathscan(M,l.pathomit),D=i.batchinternodes(_,l),o={layers:i.batchtracelayers(D,l.ltres,l.qtres),palette:m.palette,width:a.width,height:a.height}}return o},this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.checkoptions=function(a){a=a||{},typeof a=="string"&&(a=a.toLowerCase(),i.optionpresets[a]?a=i.optionpresets[a]:a={});for(var l=Object.keys(i.optionpresets.default),m=0;m<l.length;m++)a.hasOwnProperty(l[m])||(a[l[m]]=i.optionpresets.default[l[m]]);return a},this.colorquantization=function(a,l){var m=[],o=0,w,b,M,_=[],D=a.width*a.height,x,N,I,G,B;if(a.data.length<D*4){for(var V=new Uint8ClampedArray(D*4),J=0;J<D;J++)V[J*4]=a.data[J*3],V[J*4+1]=a.data[J*3+1],V[J*4+2]=a.data[J*3+2],V[J*4+3]=255;a.data=V}for(N=0;N<a.height+2;N++)for(m[N]=[],x=0;x<a.width+2;x++)m[N][x]=-1;for(l.pal?B=l.pal:l.colorsampling===0?B=i.generatepalette(l.numberofcolors):l.colorsampling===1?B=i.samplepalette(l.numberofcolors,a):B=i.samplepalette2(l.numberofcolors,a),l.blurradius>0&&(a=i.blur(a,l.blurradius,l.blurdelta)),G=0;G<l.colorquantcycles;G++){if(G>0)for(I=0;I<B.length;I++)_[I].n>0&&(B[I]={r:Math.floor(_[I].r/_[I].n),g:Math.floor(_[I].g/_[I].n),b:Math.floor(_[I].b/_[I].n),a:Math.floor(_[I].a/_[I].n)}),_[I].n/D<l.mincolorratio&&G<l.colorquantcycles-1&&(B[I]={r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)});for(x=0;x<B.length;x++)_[x]={r:0,g:0,b:0,a:0,n:0};for(N=0;N<a.height;N++)for(x=0;x<a.width;x++){for(o=(N*a.width+x)*4,M=0,b=1024,I=0;I<B.length;I++)w=Math.abs(B[I].r-a.data[o])+Math.abs(B[I].g-a.data[o+1])+Math.abs(B[I].b-a.data[o+2])+Math.abs(B[I].a-a.data[o+3]),w<b&&(b=w,M=I);_[M].r+=a.data[o],_[M].g+=a.data[o+1],_[M].b+=a.data[o+2],_[M].a+=a.data[o+3],_[M].n++,m[N+1][x+1]=M}}return{array:m,palette:B}},this.samplepalette=function(a,l){for(var m,o=[],w=0;w<a;w++)m=Math.floor(Math.random()*l.data.length/4)*4,o.push({r:l.data[m],g:l.data[m+1],b:l.data[m+2],a:l.data[m+3]});return o},this.samplepalette2=function(a,l){for(var m,o=[],w=Math.ceil(Math.sqrt(a)),b=Math.ceil(a/w),M=l.width/(w+1),_=l.height/(b+1),D=0;D<b;D++)for(var x=0;x<w&&o.length!==a;x++)m=Math.floor((D+1)*_*l.width+(x+1)*M)*4,o.push({r:l.data[m],g:l.data[m+1],b:l.data[m+2],a:l.data[m+3]});return o},this.generatepalette=function(a){var l=[],m,o,w;if(a<8)for(var b=Math.floor(255/(a-1)),M=0;M<a;M++)l.push({r:M*b,g:M*b,b:M*b,a:255});else{var _=Math.floor(Math.pow(a,.3333333333333333)),D=Math.floor(255/(_-1)),x=a-_*_*_;for(m=0;m<_;m++)for(o=0;o<_;o++)for(w=0;w<_;w++)l.push({r:m*D,g:o*D,b:w*D,a:255});for(m=0;m<x;m++)l.push({r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)})}return l},this.layering=function(a){var l=[],m=0,o=a.array.length,w=a.array[0].length,b,M,_,D,x,N,I,G,B,V,J;for(J=0;J<a.palette.length;J++)for(l[J]=[],V=0;V<o;V++)for(l[J][V]=[],B=0;B<w;B++)l[J][V][B]=0;for(V=1;V<o-1;V++)for(B=1;B<w-1;B++)m=a.array[V][B],b=a.array[V-1][B-1]===m?1:0,M=a.array[V-1][B]===m?1:0,_=a.array[V-1][B+1]===m?1:0,D=a.array[V][B-1]===m?1:0,x=a.array[V][B+1]===m?1:0,N=a.array[V+1][B-1]===m?1:0,I=a.array[V+1][B]===m?1:0,G=a.array[V+1][B+1]===m?1:0,l[m][V+1][B+1]=1+x*2+G*4+I*8,D||(l[m][V+1][B]=2+I*4+N*8),M||(l[m][V][B+1]=0+_*2+x*4+8),b||(l[m][V][B]=0+M*2+4+D*8);return l},this.layeringstep=function(a,l){var m=[],o=a.array.length,w=a.array[0].length,b,M;for(M=0;M<o;M++)for(m[M]=[],b=0;b<w;b++)m[M][b]=0;for(M=1;M<o;M++)for(b=1;b<w;b++)m[M][b]=(a.array[M-1][b-1]===l?1:0)+(a.array[M-1][b]===l?2:0)+(a.array[M][b-1]===l?8:0)+(a.array[M][b]===l?4:0);return m},this.pointinpoly=function(a,l){for(var m=!1,o=0,w=l.length-1;o<l.length;w=o++)m=l[o].y>a.y!=l[w].y>a.y&&a.x<(l[w].x-l[o].x)*(a.y-l[o].y)/(l[w].y-l[o].y)+l[o].x?!m:m;return m},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.pathscan=function(a,l){for(var m=[],o=0,w=0,b=0,M=0,_=a[0].length,D=a.length,x=0,N=!0,I=!1,G,B=0;B<D;B++)for(var V=0;V<_;V++)if(a[B][V]==4||a[B][V]==11)for(b=V,M=B,m[o]={},m[o].points=[],m[o].boundingbox=[b,M,b,M],m[o].holechildren=[],N=!1,w=0,I=a[B][V]==11,x=1;!N;){if(m[o].points[w]={},m[o].points[w].x=b-1,m[o].points[w].y=M-1,m[o].points[w].t=a[M][b],b-1<m[o].boundingbox[0]&&(m[o].boundingbox[0]=b-1),b-1>m[o].boundingbox[2]&&(m[o].boundingbox[2]=b-1),M-1<m[o].boundingbox[1]&&(m[o].boundingbox[1]=M-1),M-1>m[o].boundingbox[3]&&(m[o].boundingbox[3]=M-1),G=i.pathscan_combined_lookup[a[M][b]][x],a[M][b]=G[0],x=G[1],b+=G[2],M+=G[3],b-1===m[o].points[0].x&&M-1===m[o].points[0].y)if(N=!0,m[o].points.length<l)m.pop();else{if(m[o].isholepath=!!I,I){for(var J=0,te=[-1,-1,_+1,D+1],q=0;q<o;q++)!m[q].isholepath&&i.boundingboxincludes(m[q].boundingbox,m[o].boundingbox)&&i.boundingboxincludes(te,m[q].boundingbox)&&i.pointinpoly(m[o].points[0],m[q].points)&&(J=q,te=m[q].boundingbox);m[J].holechildren.push(o)}o++}w++}return m},this.boundingboxincludes=function(a,l){return a[0]<l[0]&&a[1]<l[1]&&a[2]>l[2]&&a[3]>l[3]},this.batchpathscan=function(a,l){var m=[];for(var o in a)a.hasOwnProperty(o)&&(m[o]=i.pathscan(a[o],l));return m},this.internodes=function(a,l){var m=[],o=0,w=0,b=0,M=0,_=0,D,x;for(D=0;D<a.length;D++)for(m[D]={},m[D].points=[],m[D].boundingbox=a[D].boundingbox,m[D].holechildren=a[D].holechildren,m[D].isholepath=a[D].isholepath,o=a[D].points.length,x=0;x<o;x++)w=(x+1)%o,b=(x+2)%o,M=(x-1+o)%o,_=(x-2+o)%o,l.rightangleenhance&&i.testrightangle(a[D],_,M,x,w,b)&&(m[D].points.length>0&&(m[D].points[m[D].points.length-1].linesegment=i.getdirection(m[D].points[m[D].points.length-1].x,m[D].points[m[D].points.length-1].y,a[D].points[x].x,a[D].points[x].y)),m[D].points.push({x:a[D].points[x].x,y:a[D].points[x].y,linesegment:i.getdirection(a[D].points[x].x,a[D].points[x].y,(a[D].points[x].x+a[D].points[w].x)/2,(a[D].points[x].y+a[D].points[w].y)/2)})),m[D].points.push({x:(a[D].points[x].x+a[D].points[w].x)/2,y:(a[D].points[x].y+a[D].points[w].y)/2,linesegment:i.getdirection((a[D].points[x].x+a[D].points[w].x)/2,(a[D].points[x].y+a[D].points[w].y)/2,(a[D].points[w].x+a[D].points[b].x)/2,(a[D].points[w].y+a[D].points[b].y)/2)});return m},this.testrightangle=function(a,l,m,o,w,b){return a.points[o].x===a.points[l].x&&a.points[o].x===a.points[m].x&&a.points[o].y===a.points[w].y&&a.points[o].y===a.points[b].y||a.points[o].y===a.points[l].y&&a.points[o].y===a.points[m].y&&a.points[o].x===a.points[w].x&&a.points[o].x===a.points[b].x},this.getdirection=function(a,l,m,o){var w=8;return a<m?l<o?w=1:l>o?w=7:w=0:a>m?l<o?w=3:l>o?w=5:w=4:l<o?w=2:l>o?w=6:w=8,w},this.batchinternodes=function(a,l){var m=[];for(var o in a)a.hasOwnProperty(o)&&(m[o]=i.internodes(a[o],l));return m},this.tracepath=function(a,l,m){var o=0,w,b,M,_={};for(_.segments=[],_.boundingbox=a.boundingbox,_.holechildren=a.holechildren,_.isholepath=a.isholepath;o<a.points.length;){for(w=a.points[o].linesegment,b=-1,M=o+1;(a.points[M].linesegment===w||a.points[M].linesegment===b||b===-1)&&M<a.points.length-1;)a.points[M].linesegment!==w&&b===-1&&(b=a.points[M].linesegment),M++;M===a.points.length-1&&(M=0),_.segments=_.segments.concat(i.fitseq(a,l,m,o,M)),M>0?o=M:o=a.points.length}return _},this.fitseq=function(a,l,m,o,w){if(w>a.points.length||w<0)return[];var b=o,M=0,_=!0,D,x,N,I=w-o;I<0&&(I+=a.points.length);for(var G=(a.points[w].x-a.points[o].x)/I,B=(a.points[w].y-a.points[o].y)/I,V=(o+1)%a.points.length,J;V!=w;)J=V-o,J<0&&(J+=a.points.length),D=a.points[o].x+G*J,x=a.points[o].y+B*J,N=(a.points[V].x-D)*(a.points[V].x-D)+(a.points[V].y-x)*(a.points[V].y-x),N>l&&(_=!1),N>M&&(b=V,M=N),V=(V+1)%a.points.length;if(_)return[{type:"L",x1:a.points[o].x,y1:a.points[o].y,x2:a.points[w].x,y2:a.points[w].y}];var te=b;_=!0,M=0;var q=(te-o)/I,Re=(1-q)*(1-q),Te=2*(1-q)*q,oe=q*q,se=(Re*a.points[o].x+oe*a.points[w].x-a.points[te].x)/-Te,de=(Re*a.points[o].y+oe*a.points[w].y-a.points[te].y)/-Te;for(V=o+1;V!=w;)q=(V-o)/I,Re=(1-q)*(1-q),Te=2*(1-q)*q,oe=q*q,D=Re*a.points[o].x+Te*se+oe*a.points[w].x,x=Re*a.points[o].y+Te*de+oe*a.points[w].y,N=(a.points[V].x-D)*(a.points[V].x-D)+(a.points[V].y-x)*(a.points[V].y-x),N>m&&(_=!1),N>M&&(b=V,M=N),V=(V+1)%a.points.length;if(_)return[{type:"Q",x1:a.points[o].x,y1:a.points[o].y,x2:se,y2:de,x3:a.points[w].x,y3:a.points[w].y}];var ue=te;return i.fitseq(a,l,m,o,ue).concat(i.fitseq(a,l,m,ue,w))},this.batchtracepaths=function(a,l,m){var o=[];for(var w in a)a.hasOwnProperty(w)&&o.push(i.tracepath(a[w],l,m));return o},this.batchtracelayers=function(a,l,m){var o=[];for(var w in a)a.hasOwnProperty(w)&&(o[w]=i.batchtracepaths(a[w],l,m));return o},this.roundtodec=function(a,l){return+a.toFixed(l)},this.svgpathstring=function(a,l,m,o){var w=a.layers[l],b=w[m],M="",_;if(o.linefilter&&b.segments.length<3)return M;if(M="<path "+(o.desc?'desc="l '+l+" p "+m+'" ':"")+i.tosvgcolorstr(a.palette[l],o)+'d="',o.roundcoords===-1){for(M+="M "+b.segments[0].x1*o.scale+" "+b.segments[0].y1*o.scale+" ",_=0;_<b.segments.length;_++)M+=b.segments[_].type+" "+b.segments[_].x2*o.scale+" "+b.segments[_].y2*o.scale+" ",b.segments[_].hasOwnProperty("x3")&&(M+=b.segments[_].x3*o.scale+" "+b.segments[_].y3*o.scale+" ");M+="Z "}else{for(M+="M "+i.roundtodec(b.segments[0].x1*o.scale,o.roundcoords)+" "+i.roundtodec(b.segments[0].y1*o.scale,o.roundcoords)+" ",_=0;_<b.segments.length;_++)M+=b.segments[_].type+" "+i.roundtodec(b.segments[_].x2*o.scale,o.roundcoords)+" "+i.roundtodec(b.segments[_].y2*o.scale,o.roundcoords)+" ",b.segments[_].hasOwnProperty("x3")&&(M+=i.roundtodec(b.segments[_].x3*o.scale,o.roundcoords)+" "+i.roundtodec(b.segments[_].y3*o.scale,o.roundcoords)+" ");M+="Z "}for(var D=0;D<b.holechildren.length;D++){var x=w[b.holechildren[D]];if(o.roundcoords===-1)for(x.segments[x.segments.length-1].hasOwnProperty("x3")?M+="M "+x.segments[x.segments.length-1].x3*o.scale+" "+x.segments[x.segments.length-1].y3*o.scale+" ":M+="M "+x.segments[x.segments.length-1].x2*o.scale+" "+x.segments[x.segments.length-1].y2*o.scale+" ",_=x.segments.length-1;_>=0;_--)M+=x.segments[_].type+" ",x.segments[_].hasOwnProperty("x3")&&(M+=x.segments[_].x2*o.scale+" "+x.segments[_].y2*o.scale+" "),M+=x.segments[_].x1*o.scale+" "+x.segments[_].y1*o.scale+" ";else for(x.segments[x.segments.length-1].hasOwnProperty("x3")?M+="M "+i.roundtodec(x.segments[x.segments.length-1].x3*o.scale)+" "+i.roundtodec(x.segments[x.segments.length-1].y3*o.scale)+" ":M+="M "+i.roundtodec(x.segments[x.segments.length-1].x2*o.scale)+" "+i.roundtodec(x.segments[x.segments.length-1].y2*o.scale)+" ",_=x.segments.length-1;_>=0;_--)M+=x.segments[_].type+" ",x.segments[_].hasOwnProperty("x3")&&(M+=i.roundtodec(x.segments[_].x2*o.scale)+" "+i.roundtodec(x.segments[_].y2*o.scale)+" "),M+=i.roundtodec(x.segments[_].x1*o.scale)+" "+i.roundtodec(x.segments[_].y1*o.scale)+" ";M+="Z "}if(M+='" />',o.lcpr||o.qcpr){for(_=0;_<b.segments.length;_++)b.segments[_].hasOwnProperty("x3")&&o.qcpr&&(M+='<circle cx="'+b.segments[_].x2*o.scale+'" cy="'+b.segments[_].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+o.qcpr*.2+'" stroke="black" />',M+='<circle cx="'+b.segments[_].x3*o.scale+'" cy="'+b.segments[_].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+o.qcpr*.2+'" stroke="black" />',M+='<line x1="'+b.segments[_].x1*o.scale+'" y1="'+b.segments[_].y1*o.scale+'" x2="'+b.segments[_].x2*o.scale+'" y2="'+b.segments[_].y2*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />',M+='<line x1="'+b.segments[_].x2*o.scale+'" y1="'+b.segments[_].y2*o.scale+'" x2="'+b.segments[_].x3*o.scale+'" y2="'+b.segments[_].y3*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />'),!b.segments[_].hasOwnProperty("x3")&&o.lcpr&&(M+='<circle cx="'+b.segments[_].x2*o.scale+'" cy="'+b.segments[_].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+o.lcpr*.2+'" stroke="black" />');for(var D=0;D<b.holechildren.length;D++){var x=w[b.holechildren[D]];for(_=0;_<x.segments.length;_++)x.segments[_].hasOwnProperty("x3")&&o.qcpr&&(M+='<circle cx="'+x.segments[_].x2*o.scale+'" cy="'+x.segments[_].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+o.qcpr*.2+'" stroke="black" />',M+='<circle cx="'+x.segments[_].x3*o.scale+'" cy="'+x.segments[_].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+o.qcpr*.2+'" stroke="black" />',M+='<line x1="'+x.segments[_].x1*o.scale+'" y1="'+x.segments[_].y1*o.scale+'" x2="'+x.segments[_].x2*o.scale+'" y2="'+x.segments[_].y2*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />',M+='<line x1="'+x.segments[_].x2*o.scale+'" y1="'+x.segments[_].y2*o.scale+'" x2="'+x.segments[_].x3*o.scale+'" y2="'+x.segments[_].y3*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />'),!x.segments[_].hasOwnProperty("x3")&&o.lcpr&&(M+='<circle cx="'+x.segments[_].x2*o.scale+'" cy="'+x.segments[_].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+o.lcpr*.2+'" stroke="black" />')}}return M},this.getsvgstring=function(a,l){l=i.checkoptions(l);for(var m=a.width*l.scale,o=a.height*l.scale,w="<svg "+(l.viewbox?'viewBox="0 0 '+m+" "+o+'" ':'width="'+m+'" height="'+o+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+i.versionnumber+'" >',b=0;b<a.layers.length;b++)for(var M=0;M<a.layers[b].length;M++)a.layers[b][M].isholepath||(w+=i.svgpathstring(a,b,M,l));return w+="</svg>",w},this.compareNumbers=function(a,l){return a-l},this.torgbastr=function(a){return"rgba("+a.r+","+a.g+","+a.b+","+a.a+")"},this.tosvgcolorstr=function(a,l){return'fill="rgb('+a.r+","+a.g+","+a.b+')" stroke="rgb('+a.r+","+a.g+","+a.b+')" stroke-width="'+l.strokewidth+'" opacity="'+a.a/255+'" '},this.appendSVGString=function(a,l){var m;l?(m=document.getElementById(l),m||(m=document.createElement("div"),m.id=l,document.body.appendChild(m))):(m=document.createElement("div"),document.body.appendChild(m)),m.innerHTML+=a},this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.blur=function(a,l,m){var o,w,b,M,_,D,x,N,I,G,B={width:a.width,height:a.height,data:[]};if(l=Math.floor(l),l<1)return a;l>5&&(l=5),m=Math.abs(m),m>1024&&(m=1024);var V=i.gks[l-1];for(w=0;w<a.height;w++)for(o=0;o<a.width;o++){for(D=0,x=0,N=0,I=0,G=0,b=-l;b<l+1;b++)o+b>0&&o+b<a.width&&(_=(w*a.width+o+b)*4,D+=a.data[_]*V[b+l],x+=a.data[_+1]*V[b+l],N+=a.data[_+2]*V[b+l],I+=a.data[_+3]*V[b+l],G+=V[b+l]);_=(w*a.width+o)*4,B.data[_]=Math.floor(D/G),B.data[_+1]=Math.floor(x/G),B.data[_+2]=Math.floor(N/G),B.data[_+3]=Math.floor(I/G)}var J=new Uint8ClampedArray(B.data);for(w=0;w<a.height;w++)for(o=0;o<a.width;o++){for(D=0,x=0,N=0,I=0,G=0,b=-l;b<l+1;b++)w+b>0&&w+b<a.height&&(_=((w+b)*a.width+o)*4,D+=J[_]*V[b+l],x+=J[_+1]*V[b+l],N+=J[_+2]*V[b+l],I+=J[_+3]*V[b+l],G+=V[b+l]);_=(w*a.width+o)*4,B.data[_]=Math.floor(D/G),B.data[_+1]=Math.floor(x/G),B.data[_+2]=Math.floor(N/G),B.data[_+3]=Math.floor(I/G)}for(w=0;w<a.height;w++)for(o=0;o<a.width;o++)_=(w*a.width+o)*4,M=Math.abs(B.data[_]-a.data[_])+Math.abs(B.data[_+1]-a.data[_+1])+Math.abs(B.data[_+2]-a.data[_+2])+Math.abs(B.data[_+3]-a.data[_+3]),M>m&&(B.data[_]=a.data[_],B.data[_+1]=a.data[_+1],B.data[_+2]=a.data[_+2],B.data[_+3]=a.data[_+3]);return B},this.loadImage=function(a,l,m){var o=new Image;m&&m.corsenabled&&(o.crossOrigin="Anonymous"),o.onload=function(){var w=document.createElement("canvas");w.width=o.width,w.height=o.height;var b=w.getContext("2d");b.drawImage(o,0,0),l(w)},o.src=a},this.getImgdata=function(a){var l=a.getContext("2d");return l.getImageData(0,0,a.width,a.height)},this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}],this.drawLayers=function(a,l,m,o){m=m||1;var w,b,M,_,D,x;o?(x=document.getElementById(o),x||(x=document.createElement("div"),x.id=o,document.body.appendChild(x))):(x=document.createElement("div"),document.body.appendChild(x));for(D in a)if(a.hasOwnProperty(D)){w=a[D][0].length,b=a[D].length;var N=document.createElement("canvas");N.width=w*m,N.height=b*m;var I=N.getContext("2d");for(_=0;_<b;_++)for(M=0;M<w;M++)I.fillStyle=i.torgbastr(l[a[D][_][M]%l.length]),I.fillRect(M*m,_*m,m,m);x.appendChild(N)}}}d.exports=new e})()})(ct);var Li=ct.exports;const $i=tt(Li),Pi={props:{last_frame_from_video:Blob,number_of_colors:Number},components:{},data(){return{svgstr:"",is_processing_image:!1}},created(){},mounted(){},beforeDestroy(){},watch:{last_frame_from_video(){this.last_frame_from_video&&this.vectoImage()}},computed:{},methods:{vectoImage(){this.is_processing_image||(this.is_processing_image=!0,$i.imageToSVG(URL.createObjectURL(this.last_frame_from_video),d=>{this.is_processing_image=!1,this.svgstr=d},{colorsampling:0,numberofcolors:this.number_of_colors,colorquantcycles:1,scale:1,strokewidth:1,blurradius:5,blurdelta:64,viewbox:!0}))}}};var Ai=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_vecto",domProps:{innerHTML:e._s(e.svgstr)}})},Oi=[],Ui=he(Pi,Ai,Oi,!1,null,null);const Bi=Ui.exports,Ii={props:{last_frame_from_video:Blob,angle:{type:Number,default:116},boost_brightness:{type:Number,default:1},boost_contrast:{type:Number,default:1},density:{type:Number,default:.2}},components:{},data(){return{pixel_array:[],is_processing_image:!1,svg_width:600,svg_height:400}},created(){},mounted(){},beforeDestroy(){},watch:{last_frame_from_video(){this.last_frame_from_video&&this.last_frame_from_video.type==="image/jpeg"&&this.drawBlobToImage()}},computed:{lines_array(){const d=(o,w,b,M,_)=>(o-w)*(_-M)/(b-w)+M,e=1/this.density/2,i=this.svg_width-e*2,a=this.svg_height-e*2,l=this.svg_width*this.density,m=this.svg_height*this.density;return this.pixel_array.reduce((o,w)=>{let b=w.b;b*=this.boost_brightness;let M=this.boost_contrast+1,_=128*(1-M);b=b*M+_;const D=d(b,0,234,10,0);if(typeof D!="number"||D>20)return o;const x=w.x/l*i+e,N=w.y/m*a+e;return o.push({posX:x,posY:N,length:D}),o},[])}},methods:{drawBlobToImage(){if(!this.is_processing_image){this.is_processing_image=!0;var d=performance.now(),e=new Image;e.onload=()=>{var i=this.$refs.invisible_canvas;i.width=e.width,i.height=e.height,this.svg_width=e.width,this.svg_height=e.height;var a=i.getContext("2d");a.drawImage(e,0,0);var l=a.getImageData(0,0,i.width,i.height).data;let m=[];const o=Math.round(i.width*this.density),w=Math.round(i.height*this.density);for(let x=0;x<=o;x++)for(let N=0;N<=w;N++){const I=Math.floor(i.width/o*x),G=Math.floor(i.height/w*N);var[b,M,_]=this.getImageDataFaster(I,G,1,1,i.width,i.height,l);const B=b+b+b+_+M+M+M+M>>3;m.push({x,y:N,b:B})}this.pixel_array=m,this.is_processing_image=!1;var D=performance.now();this.$root.debug_mode===!0&&console.log("Lines • METHODS : drawBlobToImage = took "+(D-d)+" milliseconds.")},e.src=URL.createObjectURL(this.last_frame_from_video)}},getImageDataFaster(d,e,i,a,l,m,o){for(var w=new Uint32Array(i*a*4),b=0,M=e;M<a+e;M+=1)for(var _=d;_<i+d;_+=1)for(var D=(M*l+_)*4,x=0;x<4;x++)_<0||_>=l||M<0||M>=m?w[b++]=0:w[b++]=o[D+x];return w}}};var Fi=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_lines"},[i("svg",{ref:"pattern",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${e.svg_width} ${e.svg_height}`,"stroke-linecap":"round",stroke:"#000","stroke-width":"1"}},[i("rect",{attrs:{x:"0",y:"0",width:"100%",height:"100%",fill:"#ffffff",stroke:"#ff0000"}}),e._l(e.lines_array,function(a){return i("line",{key:`${a.posX}_${a.posY}`,attrs:{x1:-a.length/2,y1:0,x2:a.length/2,y2:0,transform:`translate(${a.posX}, ${a.posY}) rotate(${e.angle} 0 0)`}})})],2),i("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"invisible_canvas"})])},Ni=[],Vi=he(Ii,Fi,Ni,!1,null,null);const Hi=Vi.exports;var ft={exports:{}};(function(d){/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a WebRTC JavaScript library for audio/video as well as screen activity recording. It supports Chrome, Firefox, Opera, Android, and Microsoft Edge. Platforms: Linux, Mac and Windows. 
 * @summary Record audio, video or screen inside the browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recorder = RecordRTC(mediaStream or [arrayOfMediaStream], {
 *     type: 'video', // audio or video or gif or canvas
 *     recorderType: MediaStreamRecorder || CanvasRecorder || StereoAudioRecorder || Etc
 * });
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, desiredSampRate: 16000, video: HTMLVideoElement, etc.}
 */function e(C,n){if(!C)throw"First parameter is required.";n=n||{type:"video"},n=new i(C,n);var S=this;function $(L){return n.disableLogs||console.log("RecordRTC version: ",S.version),L&&(n=new i(C,L)),n.disableLogs||console.log("started recording "+n.type+" stream."),E?(E.clearRecordedData(),E.record(),y("recording"),S.recordingDuration&&v(),S):(P(function(){S.recordingDuration&&v()}),S)}function P(L){L&&(n.initCallback=function(){L(),L=n.initCallback=null});var s=new a(C,n);E=new s(C,n),E.record(),y("recording"),n.disableLogs||console.log("Initialized recorderType:",E.constructor.name,"for output-type:",n.type)}function t(L){if(L=L||function(){},!E){h();return}if(S.state==="paused"){S.resumeRecording(),setTimeout(function(){t(L)},1);return}S.state!=="recording"&&!n.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',S.state),n.disableLogs||console.log("Stopped recording "+n.type+" stream."),n.type!=="gif"?E.stop(s):(E.stop(),s()),y("stopped");function s(u){if(!E){typeof L.call=="function"?L.call(S,""):L("");return}Object.keys(E).forEach(function(T){typeof E[T]!="function"&&(S[T]=E[T])});var r=E.blob;if(!r)if(u)E.blob=r=u;else throw"Recording failed.";if(r&&!n.disableLogs&&console.log(r.type,"->",V(r.size)),L){var c;try{c=_.createObjectURL(r)}catch{}typeof L.call=="function"?L.call(S,c):L(c)}n.autoWriteToDisk&&g(function(T){var O={};O[n.type+"Blob"]=T,be.Store(O)})}}function p(){if(!E){h();return}if(S.state!=="recording"){n.disableLogs||console.warn("Unable to pause the recording. Recording state: ",S.state);return}y("paused"),E.pause(),n.disableLogs||console.log("Paused recording.")}function f(){if(!E){h();return}if(S.state!=="paused"){n.disableLogs||console.warn("Unable to resume the recording. Recording state: ",S.state);return}y("recording"),E.resume(),n.disableLogs||console.log("Resumed recording.")}function R(L){postMessage(new FileReaderSync().readAsDataURL(L))}function g(L,s){if(!L)throw"Pass a callback function over getDataURL.";var u=s?s.blob:(E||{}).blob;if(!u){n.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){g(L,s)},1e3);return}if(typeof Worker<"u"&&!navigator.mozGetUserMedia){var r=T(R);r.onmessage=function(O){L(O.data)},r.postMessage(u)}else{var c=new FileReader;c.readAsDataURL(u),c.onload=function(O){L(O.target.result)}}function T(O){try{var z=_.createObjectURL(new Blob([O.toString(),"this.onmessage =  function (eee) {"+O.name+"(eee.data);}"],{type:"application/javascript"})),H=new Worker(z);return _.revokeObjectURL(z),H}catch{}}}function v(L){if(L=L||0,S.state==="paused"){setTimeout(function(){v(L)},1e3);return}if(S.state!=="stopped"){if(L>=S.recordingDuration){t(S.onRecordingStopped);return}L+=1e3,setTimeout(function(){v(L)},1e3)}}function y(L){S&&(S.state=L,typeof S.onStateChanged.call=="function"?S.onStateChanged.call(S,L):S.onStateChanged(L))}var k='It seems that recorder is destroyed or "startRecording" is not invoked for '+n.type+" recorder.";function h(){n.disableLogs!==!0&&console.warn(k)}var E,U={startRecording:$,stopRecording:t,pauseRecording:p,resumeRecording:f,initRecorder:P,setRecordingDuration:function(L,s){if(typeof L>"u")throw"recordingDuration is required.";if(typeof L!="number")throw"recordingDuration must be a number.";return S.recordingDuration=L,S.onRecordingStopped=s||function(){},{onRecordingStopped:function(u){S.onRecordingStopped=u}}},clearRecordedData:function(){if(!E){h();return}E.clearRecordedData(),n.disableLogs||console.log("Cleared old recorded data.")},getBlob:function(){if(!E){h();return}return E.blob},getDataURL:g,toURL:function(){if(!E){h();return}return _.createObjectURL(E.blob)},getInternalRecorder:function(){return E},save:function(L){if(!E){h();return}J(E.blob,L)},getFromDisk:function(L){if(!E){h();return}e.getFromDisk(n.type,L)},setAdvertisementArray:function(L){n.advertisement=[];for(var s=L.length,u=0;u<s;u++)n.advertisement.push({duration:u,image:L[u]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){S.state==="recording"&&!n.disableLogs&&console.warn("Stop an active recorder."),E&&typeof E.clearRecordedData=="function"&&E.clearRecordedData(),E=null,y("inactive"),S.blob=null},onStateChanged:function(L){n.disableLogs||console.log("Recorder state changed:",L)},state:"inactive",getState:function(){return S.state},destroy:function(){var L=n.disableLogs;n={disableLogs:!0},S.reset(),y("destroyed"),U=S=null,oe.AudioContextConstructor&&(oe.AudioContextConstructor.close(),oe.AudioContextConstructor=null),n.disableLogs=L,n.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return S=U,U;for(var j in U)this[j]=U[j];return S=this,U}e.version="5.6.2",d.exports=e,e.getFromDisk=function(C,n){if(!n)throw"callback is mandatory.";console.log("Getting recorded "+(C==="all"?"blobs":C+" blob ")+" from disk!"),be.Fetch(function(S,$){C!=="all"&&$===C+"Blob"&&n&&n(S),C==="all"&&n&&n(S,$.replace("Blob",""))})},e.writeToDisk=function(C){console.log("Writing recorded blob(s) to disk!"),C=C||{},C.audio&&C.video&&C.gif?C.audio.getDataURL(function(n){C.video.getDataURL(function(S){C.gif.getDataURL(function($){be.Store({audioBlob:n,videoBlob:S,gifBlob:$})})})}):C.audio&&C.video?C.audio.getDataURL(function(n){C.video.getDataURL(function(S){be.Store({audioBlob:n,videoBlob:S})})}):C.audio&&C.gif?C.audio.getDataURL(function(n){C.gif.getDataURL(function(S){be.Store({audioBlob:n,gifBlob:S})})}):C.video&&C.gif?C.video.getDataURL(function(n){C.gif.getDataURL(function(S){be.Store({videoBlob:n,gifBlob:S})})}):C.audio?C.audio.getDataURL(function(n){be.Store({audioBlob:n})}):C.video?C.video.getDataURL(function(n){be.Store({videoBlob:n})}):C.gif&&C.gif.getDataURL(function(n){be.Store({gifBlob:n})})};/**
 * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
 * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCConfiguration
 * @class
 * @example
 * var options = RecordRTCConfiguration(mediaStream, options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
 */function i(C,n){return!n.recorderType&&!n.type&&(n.audio&&n.video?n.type="video":n.audio&&!n.video&&(n.type="audio")),n.recorderType&&!n.type&&(n.recorderType===Ve||n.recorderType===Ne||typeof Oe<"u"&&n.recorderType===Oe?n.type="video":n.recorderType===_e?n.type="gif":n.recorderType===ue?n.type="audio":n.recorderType===de&&(q(C,"audio").length&&q(C,"video").length||!q(C,"audio").length&&q(C,"video").length?n.type="video":q(C,"audio").length&&!q(C,"video").length&&(n.type="audio"))),typeof de<"u"&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(n.mimeType||(n.mimeType="video/webm"),n.type||(n.type=n.mimeType.split("/")[0]),n.bitsPerSecond),n.type||(n.mimeType&&(n.type=n.mimeType.split("/")[0]),n.type||(n.type="audio")),n}/**
 * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
 * @summary It returns best recorder-type available for your browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GetRecorderType
 * @class
 * @example
 * var RecorderType = GetRecorderType(options);
 * var recorder = new RecorderType(options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function a(C,n){var S;return(I||D||x)&&(S=ue),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!I&&(S=de),n.type==="video"&&(I||x)&&(S=Ve,typeof Oe<"u"&&typeof ReadableStream<"u"&&(S=Oe)),n.type==="gif"&&(S=_e),n.type==="canvas"&&(S=Ne),se()&&S!==Ne&&S!==_e&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(q(C,"video").length||q(C,"audio").length)&&(n.type==="audio"?typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("audio/webm")&&(S=de):typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&(S=de)),C instanceof Array&&C.length&&(S=Qe),n.recorderType&&(S=n.recorderType),!n.disableLogs&&S&&S.name&&console.log("Using recorderType:",S.name||S.constructor.name),!S&&G&&(S=de),S}/**
 * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
 *     video: true, // or WhammyRecorder or MediaStreamRecorder or WebAssemblyRecorder or CanvasRecorder
 *     gif: true    // or GifRecorder
 * };
 * // mimeType is optional and should be set only in advance cases.
 * recorder.mimeType = {
 *     audio: 'audio/wav',
 *     video: 'video/webm',
 *     gif:   'image/gif'
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @requires {@link RecordRTC}
 */function l(C){this.addStream=function(n){n&&(C=n)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var n=this.mediaType,S,$=this.mimeType||{audio:null,video:null,gif:null};if(typeof n.audio!="function"&&se()&&!q(C,"audio").length&&(n.audio=!1),typeof n.video!="function"&&se()&&!q(C,"video").length&&(n.video=!1),typeof n.gif!="function"&&se()&&!q(C,"video").length&&(n.gif=!1),!n.audio&&!n.video&&!n.gif)throw"MediaStream must have either audio or video tracks.";if(n.audio&&(S=null,typeof n.audio=="function"&&(S=n.audio),this.audioRecorder=new e(C,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:S,mimeType:$.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),n.video||this.audioRecorder.startRecording()),n.video){S=null,typeof n.video=="function"&&(S=n.video);var P=C;if(se()&&n.audio&&typeof n.audio=="function"){var t=q(C,"video")[0];N?(P=new B,P.addTrack(t),S&&S===Ve&&(S=de)):(P=new B,P.addTrack(t))}this.videoRecorder=new e(P,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:S,mimeType:$.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),n.audio||this.videoRecorder.startRecording()}if(n.audio&&n.video){var p=this,f=se()===!0;(n.audio instanceof ue&&n.video||n.audio!==!0&&n.video!==!0&&n.audio!==n.video)&&(f=!1),f===!0?(p.audioRecorder=null,p.videoRecorder.startRecording()):p.videoRecorder.initRecorder(function(){p.audioRecorder.initRecorder(function(){p.videoRecorder.startRecording(),p.audioRecorder.startRecording()})})}n.gif&&(S=null,typeof n.gif=="function"&&(S=n.gif),this.gifRecorder=new e(C,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:S,mimeType:$.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(n){n=n||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(S){n(S,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(S){n(S,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(S){n(S,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(n){var S={};return this.audioRecorder&&(S.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(S.video=this.videoRecorder.getBlob()),this.gifRecorder&&(S.gif=this.gifRecorder.getBlob()),n&&n(S),S},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(n){this.getBlob(function(P){P.audio&&P.video?S(P.audio,function(t){S(P.video,function(p){n({audio:t,video:p})})}):P.audio?S(P.audio,function(t){n({audio:t})}):P.video&&S(P.video,function(t){n({video:t})})});function S(P,t){if(typeof Worker<"u"){var p=$(function(g){postMessage(new FileReaderSync().readAsDataURL(g))});p.onmessage=function(R){t(R.data)},p.postMessage(P)}else{var f=new FileReader;f.readAsDataURL(P),f.onload=function(R){t(R.target.result)}}}function $(P){var t=_.createObjectURL(new Blob([P.toString(),"this.onmessage =  function (eee) {"+P.name+"(eee.data);}"],{type:"application/javascript"})),p=new Worker(t),f;if(typeof _<"u")f=_;else if(typeof webkitURL<"u")f=webkitURL;else throw"Neither URL nor webkitURL detected.";return f.revokeObjectURL(t),p}},this.writeToDisk=function(){e.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(n){n=n||{audio:!0,video:!0,gif:!0},n.audio&&this.audioRecorder&&this.audioRecorder.save(typeof n.audio=="string"?n.audio:""),n.video&&this.videoRecorder&&this.videoRecorder.save(typeof n.video=="string"?n.video:""),n.gif&&this.gifRecorder&&this.gifRecorder.save(typeof n.gif=="string"?n.gif:"")}}l.getFromDisk=e.getFromDisk,l.writeToDisk=e.writeToDisk,typeof e<"u"&&(e.MRecordRTC=l);var m="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(C){C&&(typeof window<"u"||typeof Q>"u"||(Q.navigator={userAgent:m,getUserMedia:function(){}},Q.console||(Q.console={}),(typeof Q.console.log>"u"||typeof Q.console.error>"u")&&(Q.console.error=Q.console.log=Q.console.log||function(){console.log(arguments)}),typeof document>"u"&&(C.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var n={getContext:function(){return n},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return n},C.HTMLVideoElement=function(){}),typeof location>"u"&&(C.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(C.screen={width:0,height:0}),typeof _>"u"&&(C.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),C.window=Q))})(typeof Q<"u"?Q:null);var o=window.requestAnimationFrame;if(typeof o>"u"){if(typeof webkitRequestAnimationFrame<"u")o=webkitRequestAnimationFrame;else if(typeof mozRequestAnimationFrame<"u")o=mozRequestAnimationFrame;else if(typeof msRequestAnimationFrame<"u")o=msRequestAnimationFrame;else if(typeof o>"u"){var w=0;o=function(C,n){var S=new Date().getTime(),$=Math.max(0,16-(S-w)),P=setTimeout(function(){C(S+$)},$);return w=S+$,P}}}var b=window.cancelAnimationFrame;typeof b>"u"&&(typeof webkitCancelAnimationFrame<"u"?b=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?b=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?b=msCancelAnimationFrame:typeof b>"u"&&(b=function(C){clearTimeout(C)}));var M=window.AudioContext;typeof M>"u"&&(typeof webkitAudioContext<"u"&&(M=webkitAudioContext),typeof mozAudioContext<"u"&&(M=mozAudioContext));var _=window.URL;typeof _>"u"&&typeof webkitURL<"u"&&(_=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var D=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),x=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,N=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),I=!x&&!D&&!!navigator.webkitGetUserMedia||te()||navigator.userAgent.toLowerCase().indexOf("chrome/")!==-1,G=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);G&&!I&&navigator.userAgent.indexOf("CriOS")!==-1&&(G=!1,I=!0);var B=window.MediaStream;typeof B>"u"&&typeof webkitMediaStream<"u"&&(B=webkitMediaStream),typeof B<"u"&&typeof B.prototype.stop>"u"&&(B.prototype.stop=function(){this.getTracks().forEach(function(C){C.stop()})});function V(C){var n=1e3,S=["Bytes","KB","MB","GB","TB"];if(C===0)return"0 Bytes";var $=parseInt(Math.floor(Math.log(C)/Math.log(n)),10);return(C/Math.pow(n,$)).toPrecision(3)+" "+S[$]}function J(C,n){if(!C)throw"Blob object is required.";if(!C.type)try{C.type="video/webm"}catch{}var S=(C.type||"video/webm").split("/")[1];if(S.indexOf(";")!==-1&&(S=S.split(";")[0]),n&&n.indexOf(".")!==-1){var $=n.split(".");n=$[0],S=$[1]}var P=(n||Math.round(Math.random()*9999999999)+888888888)+"."+S;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(C,P);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(C,P);var t=document.createElement("a");t.href=_.createObjectURL(C),t.download=P,t.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(t),typeof t.click=="function"?t.click():(t.target="_blank",t.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),_.revokeObjectURL(t.href)}function te(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}function q(C,n){return!C||!C.getTracks?[]:C.getTracks().filter(function(S){return S.kind===(n||"audio")})}function Re(C,n){"srcObject"in n?n.srcObject=C:"mozSrcObject"in n?n.mozSrcObject=C:n.srcObject=C}function Te(C,n){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var S=new EBML.Reader,$=new EBML.Decoder,P=EBML.tools,t=new FileReader;t.onload=function(p){var f=$.decode(this.result);f.forEach(function(y){S.read(y)}),S.stop();var R=P.makeMetadataSeekable(S.metadatas,S.duration,S.cues),g=this.result.slice(S.metadataSize),v=new Blob([R,g],{type:"video/webm"});n(v)},t.readAsArrayBuffer(C)}typeof e<"u"&&(e.invokeSaveAsDialog=J,e.getTracks=q,e.getSeekableBlob=Te,e.bytesToSize=V,e.isElectron=te);/**
 * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * Storage.AudioContext === webkitAudioContext
 * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var oe={};typeof M<"u"?oe.AudioContext=M:typeof webkitAudioContext<"u"&&(oe.AudioContext=webkitAudioContext),typeof e<"u"&&(e.Storage=oe);function se(){if(N||G||D)return!0;var C=navigator.userAgent,n=""+parseFloat(navigator.appVersion),S=parseInt(navigator.appVersion,10),$,P;return(I||x)&&($=C.indexOf("Chrome"),n=C.substring($+7)),(P=n.indexOf(";"))!==-1&&(n=n.substring(0,P)),(P=n.indexOf(" "))!==-1&&(n=n.substring(0,P)),S=parseInt(""+n,10),isNaN(S)&&(n=""+parseFloat(navigator.appVersion),S=parseInt(navigator.appVersion,10)),S>=49}/**
 * MediaStreamRecorder is an abstraction layer for {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}. It is used by {@link RecordRTC} to record MediaStream(s) in both Chrome and Firefox.
 * @summary Runs top over {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://github.com/muaz-khan|Muaz Khan}
 * @typedef MediaStreamRecorder
 * @class
 * @example
 * var config = {
 *     mimeType: 'video/webm', // vp8, vp9, h264, mkv, opus/vorbis
 *     audioBitsPerSecond : 256 * 8 * 1024,
 *     videoBitsPerSecond : 256 * 8 * 1024,
 *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
 *     checkForInactiveTracks: true,
 *     timeSlice: 1000, // concatenate intervals based blobs
 *     ondataavailable: function() {} // get intervals based blobs
 * }
 * var recorder = new MediaStreamRecorder(mediaStream, config);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", timeSlice: 1000}
 * @throws Will throw an error if first argument "MediaStream" is missing. Also throws error if "MediaRecorder API" are not supported by the browser.
 */function de(C,n){var v=this;if(typeof C>"u")throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if(n=n||{mimeType:"video/webm"},n.type==="audio"){if(q(C,"video").length&&q(C,"audio").length){var S;navigator.mozGetUserMedia?(S=new B,S.addTrack(q(C,"audio")[0])):S=new B(q(C,"audio")),C=S}(!n.mimeType||n.mimeType.toString().toLowerCase().indexOf("audio")===-1)&&(n.mimeType=I?"audio/webm":"audio/ogg"),n.mimeType&&n.mimeType.toString().toLowerCase()!=="audio/ogg"&&navigator.mozGetUserMedia&&(n.mimeType="audio/ogg")}var $=[];this.getArrayOfBlobs=function(){return $},this.record=function(){v.blob=null,v.clearRecordedData(),v.timestamps=[],g=[],$=[];var y=n;n.disableLogs||console.log("Passing following config over MediaRecorder API.",y),f&&(f=null),I&&!se()&&(y="video/vp8"),typeof MediaRecorder.isTypeSupported=="function"&&y.mimeType&&(MediaRecorder.isTypeSupported(y.mimeType)||(n.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",y.mimeType),y.mimeType=n.type==="audio"?"audio/webm":"video/webm"));try{f=new MediaRecorder(C,y),n.mimeType=y.mimeType}catch{f=new MediaRecorder(C)}y.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in f&&f.canRecordMimeType(y.mimeType)===!1&&(n.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",y.mimeType)),f.ondataavailable=function(k){if(k.data&&g.push("ondataavailable: "+V(k.data.size)),typeof n.timeSlice=="number"){if(k.data&&k.data.size&&($.push(k.data),P(),typeof n.ondataavailable=="function")){var h=n.getNativeBlob?k.data:new Blob([k.data],{type:t(y)});n.ondataavailable(h)}return}if(!k.data||!k.data.size||k.data.size<100||v.blob){v.recordingCallback&&(v.recordingCallback(new Blob([],{type:t(y)})),v.recordingCallback=null);return}v.blob=n.getNativeBlob?k.data:new Blob([k.data],{type:t(y)}),v.recordingCallback&&(v.recordingCallback(v.blob),v.recordingCallback=null)},f.onstart=function(){g.push("started")},f.onpause=function(){g.push("paused")},f.onresume=function(){g.push("resumed")},f.onstop=function(){g.push("stopped")},f.onerror=function(k){k&&(k.name||(k.name="UnknownError"),g.push("error: "+k),n.disableLogs||(k.name.toString().toLowerCase().indexOf("invalidstate")!==-1?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",k):k.name.toString().toLowerCase().indexOf("notsupported")!==-1?console.error("MIME type (",y.mimeType,") is not supported.",k):k.name.toString().toLowerCase().indexOf("security")!==-1?console.error("MediaRecorder security error",k):k.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",k):k.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",k):k.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",k):k.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",k):console.error("MediaRecorder Error",k)),function(h){if(!v.manuallyStopped&&f&&f.state==="inactive"){delete n.timeslice,f.start(10*60*1e3);return}setTimeout(h,1e3)}(),f.state!=="inactive"&&f.state!=="stopped"&&f.stop())},typeof n.timeSlice=="number"?(P(),f.start(n.timeSlice)):f.start(36e5),n.initCallback&&n.initCallback()},this.timestamps=[];function P(){v.timestamps.push(new Date().getTime()),typeof n.onTimeStamp=="function"&&n.onTimeStamp(v.timestamps[v.timestamps.length-1],v.timestamps)}function t(y){return f&&f.mimeType?f.mimeType:y.mimeType||"video/webm"}this.stop=function(y){y=y||function(){},v.manuallyStopped=!0,f&&(this.recordingCallback=y,f.state==="recording"&&f.stop(),typeof n.timeSlice=="number"&&setTimeout(function(){v.blob=new Blob($,{type:t(n)}),v.recordingCallback(v.blob)},100))},this.pause=function(){f&&f.state==="recording"&&f.pause()},this.resume=function(){f&&f.state==="paused"&&f.resume()},this.clearRecordedData=function(){f&&f.state==="recording"&&v.stop(p),p()};function p(){$=[],f=null,v.timestamps=[]}var f;this.getInternalRecorder=function(){return f};function R(){if("active"in C){if(!C.active)return!1}else if("ended"in C&&C.ended)return!1;return!0}this.blob=null,this.getState=function(){return f&&f.state||"inactive"};var g=[];this.getAllStates=function(){return g},typeof n.checkForInactiveTracks>"u"&&(n.checkForInactiveTracks=!1);var v=this;(function y(){if(!(!f||n.checkForInactiveTracks===!1)){if(R()===!1){n.disableLogs||console.log("MediaStream seems stopped."),v.stop();return}setTimeout(y,1e3)}})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}typeof e<"u"&&(e.MediaStreamRecorder=de);/**
 * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
 * @summary JavaScript standalone object for stereo audio recording.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef StereoAudioRecorder
 * @class
 * @example
 * var recorder = new StereoAudioRecorder(MediaStream, {
 *     sampleRate: 44100,
 *     bufferSize: 4096
 * });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
 */function ue(C,n){if(!q(C,"audio").length)throw"Your stream has no audio tracks.";n=n||{};var S=this,$=[],P=[],t=!1,p=0,f,R=2,g=n.desiredSampRate;n.leftChannel===!0&&(R=1),n.numberOfAudioChannels===1&&(R=1),(!R||R<1)&&(R=2),n.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+R),typeof n.checkForInactiveTracks>"u"&&(n.checkForInactiveTracks=!0);function v(){if(n.checkForInactiveTracks===!1)return!0;if("active"in C){if(!C.active)return!1}else if("ended"in C&&C.ended)return!1;return!0}this.record=function(){if(v()===!1)throw"Please make sure MediaStream is active.";u(),c=s=!1,t=!0,typeof n.timeSlice<"u"&&z()};function y(H,Z){function ne(ie,He){var Se=ie.numberOfAudioChannels,ve=ie.leftBuffers.slice(0),ge=ie.rightBuffers.slice(0),le=ie.sampleRate,pe=ie.internalInterleavedLength,ce=ie.desiredSampRate;Se===2&&(ve=Be(ve,pe),ge=Be(ge,pe),ce&&(ve=Ue(ve,ce,le),ge=Ue(ge,ce,le))),Se===1&&(ve=Be(ve,pe),ce&&(ve=Ue(ve,ce,le))),ce&&(le=ce);function Ue(re,ke,we){var Ce=Math.round(re.length*(ke/we)),fe=[],Me=Number((re.length-1)/(Ce-1));fe[0]=re[0];for(var Ee=1;Ee<Ce-1;Ee++){var Ke=Ee*Me,Je=Number(Math.floor(Ke)).toFixed(),et=Number(Math.ceil(Ke)).toFixed(),je=Ke-Je;fe[Ee]=Ge(re[Je],re[et],je)}return fe[Ce-1]=re[re.length-1],fe}function Ge(re,ke,we){return re+(ke-re)*we}function Be(re,ke){for(var we=new Float64Array(ke),Ce=0,fe=re.length,Me=0;Me<fe;Me++){var Ee=re[Me];we.set(Ee,Ce),Ce+=Ee.length}return we}function ze(re,ke){for(var we=re.length+ke.length,Ce=new Float64Array(we),fe=0,Me=0;Me<we;)Ce[Me++]=re[fe],Ce[Me++]=ke[fe],fe++;return Ce}function $e(re,ke,we){for(var Ce=we.length,fe=0;fe<Ce;fe++)re.setUint8(ke+fe,we.charCodeAt(fe))}var Pe;Se===2&&(Pe=ze(ve,ge)),Se===1&&(Pe=ve);var qe=Pe.length,A=44+qe*2,We=new ArrayBuffer(A),ae=new DataView(We);$e(ae,0,"RIFF"),ae.setUint32(4,36+qe*2,!0),$e(ae,8,"WAVE"),$e(ae,12,"fmt "),ae.setUint32(16,16,!0),ae.setUint16(20,1,!0),ae.setUint16(22,Se,!0),ae.setUint32(24,le,!0),ae.setUint32(28,le*Se*2,!0),ae.setUint16(32,Se*2,!0),ae.setUint16(34,16,!0),$e(ae,36,"data"),ae.setUint32(40,qe*2,!0);for(var at=qe,Ie=44,Ze=1,Fe=0;Fe<at;Fe++)ae.setInt16(Ie,Pe[Fe]*(32767*Ze),!0),Ie+=2;if(He)return He({buffer:We,view:ae});postMessage({buffer:We,view:ae})}if(H.noWorker){ne(H,function(ie){Z(ie.buffer,ie.view)});return}var me=k(ne);me.onmessage=function(ie){Z(ie.data.buffer,ie.data.view),_.revokeObjectURL(me.workerURL),me.terminate()},me.postMessage(H)}function k(H){var Z=_.createObjectURL(new Blob([H.toString(),";this.onmessage =  function (eee) {"+H.name+"(eee.data);}"],{type:"application/javascript"})),ne=new Worker(Z);return ne.workerURL=Z,ne}this.stop=function(H){H=H||function(){},t=!1,y({desiredSampRate:g,sampleRate:L,numberOfAudioChannels:R,internalInterleavedLength:p,leftBuffers:$,rightBuffers:R===1?[]:P,noWorker:n.noWorker},function(Z,ne){S.blob=new Blob([ne],{type:"audio/wav"}),S.buffer=new ArrayBuffer(ne.buffer.byteLength),S.view=ne,S.sampleRate=g||L,S.bufferSize=j,S.length=p,c=!1,H&&H(S.blob)})},typeof e.Storage>"u"&&(e.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!e.Storage.AudioContextConstructor||e.Storage.AudioContextConstructor.state==="closed")&&(e.Storage.AudioContextConstructor=new e.Storage.AudioContext);var h=e.Storage.AudioContextConstructor,E=h.createMediaStreamSource(C),U=[0,256,512,1024,2048,4096,8192,16384],j=typeof n.bufferSize>"u"?4096:n.bufferSize;if(U.indexOf(j)===-1&&(n.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(U,null,"	"))),h.createJavaScriptNode)f=h.createJavaScriptNode(j,R,R);else if(h.createScriptProcessor)f=h.createScriptProcessor(j,R,R);else throw"WebAudio API has no support on this browser.";E.connect(f),n.bufferSize||(j=f.bufferSize);var L=typeof n.sampleRate<"u"?n.sampleRate:h.sampleRate||44100;(L<22050||L>96e3)&&(n.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),n.disableLogs||n.desiredSampRate&&console.log("Desired sample-rate: "+n.desiredSampRate);var s=!1;this.pause=function(){s=!0},this.resume=function(){if(v()===!1)throw"Please make sure MediaStream is active.";if(!t){n.disableLogs||console.log("Seems recording has been restarted."),this.record();return}s=!1},this.clearRecordedData=function(){n.checkForInactiveTracks=!1,t&&this.stop(r),r()};function u(){$=[],P=[],p=0,c=!1,t=!1,s=!1,h=null,S.leftchannel=$,S.rightchannel=P,S.numberOfAudioChannels=R,S.desiredSampRate=g,S.sampleRate=L,S.recordingLength=p,O={left:[],right:[],recordingLength:0}}function r(){f&&(f.onaudioprocess=null,f.disconnect(),f=null),E&&(E.disconnect(),E=null),u()}this.name="StereoAudioRecorder",this.toString=function(){return this.name};var c=!1;function T(H){if(!s){if(v()===!1&&(n.disableLogs||console.log("MediaStream seems stopped."),f.disconnect(),t=!1),!t){E&&(E.disconnect(),E=null);return}c||(c=!0,n.onAudioProcessStarted&&n.onAudioProcessStarted(),n.initCallback&&n.initCallback());var Z=H.inputBuffer.getChannelData(0),ne=new Float32Array(Z);if($.push(ne),R===2){var me=H.inputBuffer.getChannelData(1),ie=new Float32Array(me);P.push(ie)}p+=j,S.recordingLength=p,typeof n.timeSlice<"u"&&(O.recordingLength+=j,O.left.push(ne),R===2&&O.right.push(ie))}}f.onaudioprocess=T,h.createMediaStreamDestination?f.connect(h.createMediaStreamDestination()):f.connect(h.destination),this.leftchannel=$,this.rightchannel=P,this.numberOfAudioChannels=R,this.desiredSampRate=g,this.sampleRate=L,S.recordingLength=p;var O={left:[],right:[],recordingLength:0};function z(){!t||typeof n.ondataavailable!="function"||typeof n.timeSlice>"u"||(O.left.length?(y({desiredSampRate:g,sampleRate:L,numberOfAudioChannels:R,internalInterleavedLength:O.recordingLength,leftBuffers:O.left,rightBuffers:R===1?[]:O.right},function(H,Z){var ne=new Blob([Z],{type:"audio/wav"});n.ondataavailable(ne),setTimeout(z,n.timeSlice)}),O={left:[],right:[],recordingLength:0}):setTimeout(z,n.timeSlice))}}typeof e<"u"&&(e.StereoAudioRecorder=ue);/**
 * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
 * @summary HTML2Canvas recording into video WebM.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef CanvasRecorder
 * @class
 * @example
 * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true, useWhammyRecorder: true });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
 * @param {object} config - {disableLogs:true, initCallback: function}
 */function Ne(C,n){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";n=n||{},n.frameInterval||(n.frameInterval=10);var S=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(U){U in document.createElement("canvas")&&(S=!0)});var $=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,P=50,t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);$&&t&&t[2]&&(P=parseInt(t[2],10)),$&&P<52&&(S=!1),n.useWhammyRecorder&&(S=!1);var p,f;if(S)if(n.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),C instanceof HTMLCanvasElement)p=C;else if(C instanceof CanvasRenderingContext2D)p=C.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&(n.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var R;this.record=function(){if(R=!0,S&&!n.useWhammyRecorder){var U;"captureStream"in p?U=p.captureStream(25):"mozCaptureStream"in p?U=p.mozCaptureStream(25):"webkitCaptureStream"in p&&(U=p.webkitCaptureStream(25));try{var j=new B;j.addTrack(q(U,"video")[0]),U=j}catch{}if(!U)throw"captureStream API are NOT available.";f=new de(U,{mimeType:n.mimeType||"video/webm"}),f.record()}else E.frames=[],h=new Date().getTime(),k();n.initCallback&&n.initCallback()},this.getWebPImages=function(U){if(C.nodeName.toLowerCase()!=="canvas"){U();return}var j=E.frames.length;E.frames.forEach(function(L,s){var u=j-s;n.disableLogs||console.log(u+"/"+j+" frames remaining"),n.onEncodingCallback&&n.onEncodingCallback(u,j);var r=L.image.toDataURL("image/webp",1);E.frames[s].image=r}),n.disableLogs||console.log("Generating WebM"),U()},this.stop=function(U){R=!1;var j=this;if(S&&f){f.stop(U);return}this.getWebPImages(function(){E.compile(function(L){n.disableLogs||console.log("Recording finished!"),j.blob=L,j.blob.forEach&&(j.blob=new Blob([],{type:"video/webm"})),U&&U(j.blob),E.frames=[]})})};var g=!1;this.pause=function(){if(g=!0,f instanceof de){f.pause();return}},this.resume=function(){if(g=!1,f instanceof de){f.resume();return}R||this.record()},this.clearRecordedData=function(){R&&this.stop(v),v()};function v(){E.frames=[],R=!1,g=!1}this.name="CanvasRecorder",this.toString=function(){return this.name};function y(){var U=document.createElement("canvas"),j=U.getContext("2d");return U.width=C.width,U.height=C.height,j.drawImage(C,0,0),U}function k(){if(g)return h=new Date().getTime(),setTimeout(k,500);if(C.nodeName.toLowerCase()==="canvas"){var U=new Date().getTime()-h;h=new Date().getTime(),E.frames.push({image:y(),duration:U}),R&&setTimeout(k,n.frameInterval);return}html2canvas(C,{grabMouse:typeof n.showMousePointer>"u"||n.showMousePointer,onrendered:function(j){var L=new Date().getTime()-h;if(!L)return setTimeout(k,n.frameInterval);h=new Date().getTime(),E.frames.push({image:j.toDataURL("image/webp",1),duration:L}),R&&setTimeout(k,n.frameInterval)}})}var h=new Date().getTime(),E=new ye.Video(100)}typeof e<"u"&&(e.CanvasRecorder=Ne);/**
 * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
 * @summary Video recording feature in Chrome.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WhammyRecorder
 * @class
 * @example
 * var recorder = new WhammyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
 */function Ve(C,n){n=n||{},n.frameInterval||(n.frameInterval=10),n.disableLogs||console.log("Using frames-interval:",n.frameInterval),this.record=function(){n.width||(n.width=320),n.height||(n.height=240),n.video||(n.video={width:n.width,height:n.height}),n.canvas||(n.canvas={width:n.width,height:n.height}),R.width=n.canvas.width||320,R.height=n.canvas.height||240,g=R.getContext("2d"),n.video&&n.video instanceof HTMLVideoElement?(v=n.video.cloneNode(),n.initCallback&&n.initCallback()):(v=document.createElement("video"),Re(C,v),v.onloadedmetadata=function(){n.initCallback&&n.initCallback()},v.width=n.video.width,v.height=n.video.height),v.muted=!0,v.play(),y=new Date().getTime(),k=new ye.Video,n.disableLogs||(console.log("canvas resolutions",R.width,"*",R.height),console.log("video width/height",v.width||R.width,"*",v.height||R.height)),S(n.frameInterval)};function S(h){h=typeof h<"u"?h:10;var E=new Date().getTime()-y;if(!E)return setTimeout(S,h,h);if(p)return y=new Date().getTime(),setTimeout(S,100);y=new Date().getTime(),v.paused&&v.play(),g.drawImage(v,0,0,R.width,R.height),k.frames.push({duration:E,image:R.toDataURL("image/webp")}),t||setTimeout(S,h,h)}function $(h){var E=-1,U=h.length;(function j(){if(E++,E===U){h.callback();return}setTimeout(function(){h.functionToLoop(j,E)},1)})()}function P(h,E,U,j,L){var s=document.createElement("canvas");s.width=R.width,s.height=R.height;var u=s.getContext("2d"),r=[],c=h.length,T={r:0,g:0,b:0},O=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),z=0,H=0,Z=!1;$({length:c,functionToLoop:function(ne,me){var ie,He,Se,ve=function(){!Z&&Se-ie<=Se*H||(Z=!0,r.push(h[me])),ne()};if(Z)ve();else{var ge=new Image;ge.onload=function(){u.drawImage(ge,0,0,R.width,R.height);var le=u.getImageData(0,0,R.width,R.height);ie=0,He=le.data.length,Se=le.data.length/4;for(var pe=0;pe<He;pe+=4){var ce={r:le.data[pe],g:le.data[pe+1],b:le.data[pe+2]},Ue=Math.sqrt(Math.pow(ce.r-T.r,2)+Math.pow(ce.g-T.g,2)+Math.pow(ce.b-T.b,2));Ue<=O*z&&ie++}ve()},ge.src=h[me].image}},callback:function(){r=r.concat(h.slice(c)),r.length<=0&&r.push(h[h.length-1]),L(r)}})}var t=!1;this.stop=function(h){h=h||function(){},t=!0;var E=this;setTimeout(function(){P(k.frames,-1,null,null,function(U){k.frames=U,n.advertisement&&n.advertisement.length&&(k.frames=n.advertisement.concat(k.frames)),k.compile(function(j){E.blob=j,E.blob.forEach&&(E.blob=new Blob([],{type:"video/webm"})),h&&h(E.blob)})})},10)};var p=!1;this.pause=function(){p=!0},this.resume=function(){p=!1,t&&this.record()},this.clearRecordedData=function(){t||this.stop(f),f()};function f(){k.frames=[],t=!0,p=!1}this.name="WhammyRecorder",this.toString=function(){return this.name};var R=document.createElement("canvas"),g=R.getContext("2d"),v,y,k}typeof e<"u"&&(e.WhammyRecorder=Ve);/**
 * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
 * @summary A real time javascript webm encoder based on a canvas hack.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef Whammy
 * @class
 * @example
 * var recorder = new Whammy().Video(15);
 * recorder.add(context || canvas || dataURL);
 * var output = recorder.compile();
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var ye=function(){function C($){this.frames=[],this.duration=$||1,this.quality=.8}C.prototype.add=function($,P){if("canvas"in $&&($=$.canvas),"toDataURL"in $&&($=$.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test($))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:$,duration:P||this.duration})};function n($){var P=_.createObjectURL(new Blob([$.toString(),"this.onmessage =  function (eee) {"+$.name+"(eee.data);}"],{type:"application/javascript"})),t=new Worker(P);return _.revokeObjectURL(P),t}function S($){function P(L){var s=p(L);if(!s)return[];for(var u=3e4,r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:U(s.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:s.width,id:176},{data:s.height,id:186}]}]}]}]}],c=0,T=0;c<L.length;){var O=[],z=0;do O.push(L[c]),z+=L[c].duration,c++;while(c<L.length&&z<u);var H=0,Z={id:524531317,data:t(T,H,O)};r[1].data.push(Z),T+=z}return v(r)}function t(L,s,u){return[{data:L,id:231}].concat(u.map(function(r){var c=y({discardable:0,frame:r.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(s)});return s+=r.duration,{data:c,id:163}}))}function p(L){if(!L[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}for(var s=L[0].width,u=L[0].height,r=L[0].duration,c=1;c<L.length;c++)r+=L[c].duration;return{duration:r,width:s,height:u}}function f(L){for(var s=[];L>0;)s.push(L&255),L=L>>8;return new Uint8Array(s.reverse())}function R(L){return new Uint8Array(L.split("").map(function(s){return s.charCodeAt(0)}))}function g(L){var s=[],u=L.length%8?new Array(9-L.length%8).join("0"):"";L=u+L;for(var r=0;r<L.length;r+=8)s.push(parseInt(L.substr(r,8),2));return new Uint8Array(s)}function v(L){for(var s=[],u=0;u<L.length;u++){var r=L[u].data;typeof r=="object"&&(r=v(r)),typeof r=="number"&&(r=g(r.toString(2))),typeof r=="string"&&(r=R(r));var c=r.size||r.byteLength||r.length,T=Math.ceil(Math.ceil(Math.log(c)/Math.log(2))/8),O=c.toString(2),z=new Array(T*7+7+1-O.length).join("0")+O,H=new Array(T).join("0")+"1"+z;s.push(f(L[u].id)),s.push(g(H)),s.push(r)}return new Blob(s,{type:"video/webm"})}function y(L){var s=0;if(s|=128,L.trackNum>127)throw"TrackNumber > 127 not supported";var u=[L.trackNum|128,L.timecode>>8,L.timecode&255,s].map(function(r){return String.fromCharCode(r)}).join("")+L.frame;return u}function k(L){for(var s=L.RIFF[0].WEBP[0],u=s.indexOf("*"),r=0,c=[];r<4;r++)c[r]=s.charCodeAt(u+3+r);var T,O,z;return z=c[1]<<8|c[0],T=z&16383,z=c[3]<<8|c[2],O=z&16383,{width:T,height:O,data:s,riff:L}}function h(L,s){return parseInt(L.substr(s+4,4).split("").map(function(u){var r=u.charCodeAt(0).toString(2);return new Array(8-r.length+1).join("0")+r}).join(""),2)}function E(L){for(var s=0,u={};s<L.length;){var r=L.substr(s,4),c=h(L,s),T=L.substr(s+4+4,c);s+=8+c,u[r]=u[r]||[],r==="RIFF"||r==="LIST"?u[r].push(E(T)):u[r].push(T)}return u}function U(L){return[].slice.call(new Uint8Array(new Float64Array([L]).buffer),0).map(function(s){return String.fromCharCode(s)}).reverse().join("")}var j=new P($.map(function(L){var s=k(E(atob(L.image.slice(23))));return s.duration=L.duration,s}));postMessage(j)}return C.prototype.compile=function($){var P=n(S);P.onmessage=function(t){if(t.data.error){console.error(t.data.error);return}$(t.data)},P.postMessage(this.frames)},{Video:C}}();typeof e<"u"&&(e.Whammy=ye);/**
 * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
 * @summary Writing blobs into IndexedDB.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * DiskStorage.Store({
 *     audioBlob: yourAudioBlob,
 *     videoBlob: yourVideoBlob,
 *     gifBlob  : yourGifBlob
 * });
 * DiskStorage.Fetch(function(dataURL, type) {
 *     if(type === 'audioBlob') { }
 *     if(type === 'videoBlob') { }
 *     if(type === 'gifBlob')   { }
 * });
 * // DiskStorage.dataStoreName = 'recordRTC';
 * // DiskStorage.onError = function(error) { };
 * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
 * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
 * @property {function} Store - This method stores blobs in IndexedDB.
 * @property {function} onError - This function is invoked for any known/unknown error.
 * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var be={init:function(){var C=this;if(typeof indexedDB>"u"||typeof indexedDB.open>"u"){console.error("IndexedDB API are not available in this browser.");return}var n=1,S=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),$,P=indexedDB.open(S,n);function t(f){f.createObjectStore(C.dataStoreName)}function p(){var f=$.transaction([C.dataStoreName],"readwrite");C.videoBlob&&f.objectStore(C.dataStoreName).put(C.videoBlob,"videoBlob"),C.gifBlob&&f.objectStore(C.dataStoreName).put(C.gifBlob,"gifBlob"),C.audioBlob&&f.objectStore(C.dataStoreName).put(C.audioBlob,"audioBlob");function R(g){f.objectStore(C.dataStoreName).get(g).onsuccess=function(v){C.callback&&C.callback(v.target.result,g)}}R("audioBlob"),R("videoBlob"),R("gifBlob")}P.onerror=C.onError,P.onsuccess=function(){if($=P.result,$.onerror=C.onError,$.setVersion)if($.version!==n){var f=$.setVersion(n);f.onsuccess=function(){t($),p()}}else p();else p()},P.onupgradeneeded=function(f){t(f.target.result)}},Fetch:function(C){return this.callback=C,this.init(),this},Store:function(C){return this.audioBlob=C.audioBlob,this.videoBlob=C.videoBlob,this.gifBlob=C.gifBlob,this.init(),this},onError:function(C){console.error(JSON.stringify(C,null,"	"))},dataStoreName:"recordRTC",dbName:null};typeof e<"u"&&(e.DiskStorage=be);/**
 * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GifRecorder
 * @class
 * @example
 * var recorder = new GifRecorder(mediaStream || canvas || context, { onGifPreview: function, onGifRecordingStarted: function, width: 1280, height: 720, frameRate: 200, quality: 10 });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     img.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
 * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
 */function _e(C,n){if(typeof GIFEncoder>"u"){var S=document.createElement("script");S.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(S)}n=n||{};var $=C instanceof CanvasRenderingContext2D||C instanceof HTMLCanvasElement;this.record=function(){if(typeof GIFEncoder>"u"){setTimeout(h.record,1e3);return}if(!R){setTimeout(h.record,1e3);return}$||(n.width||(n.width=g.offsetWidth||320),n.height||(n.height=g.offsetHeight||240),n.video||(n.video={width:n.width,height:n.height}),n.canvas||(n.canvas={width:n.width,height:n.height}),p.width=n.canvas.width||320,p.height=n.canvas.height||240,g.width=n.video.width||320,g.height=n.video.height||240),k=new GIFEncoder,k.setRepeat(0),k.setDelay(n.frameRate||200),k.setQuality(n.quality||10),k.start(),typeof n.onGifRecordingStarted=="function"&&n.onGifRecordingStarted();function E(U){if(h.clearedRecordedData!==!0){if(P)return setTimeout(function(){E(U)},100);v=o(E),typeof y===void 0&&(y=U),!(U-y<90)&&(!$&&g.paused&&g.play(),$||f.drawImage(g,0,0,p.width,p.height),n.onGifPreview&&n.onGifPreview(p.toDataURL("image/png")),k.addFrame(f),y=U)}}v=o(E),n.initCallback&&n.initCallback()},this.stop=function(E){E=E||function(){},v&&b(v),this.blob=new Blob([new Uint8Array(k.stream().bin)],{type:"image/gif"}),E(this.blob),k.stream().bin=[]};var P=!1;this.pause=function(){P=!0},this.resume=function(){P=!1},this.clearRecordedData=function(){h.clearedRecordedData=!0,t()};function t(){k&&(k.stream().bin=[])}this.name="GifRecorder",this.toString=function(){return this.name};var p=document.createElement("canvas"),f=p.getContext("2d");$&&(C instanceof CanvasRenderingContext2D?(f=C,p=f.canvas):C instanceof HTMLCanvasElement&&(f=C.getContext("2d"),p=C));var R=!0;if(!$){var g=document.createElement("video");g.muted=!0,g.autoplay=!0,g.playsInline=!0,R=!1,g.onloadedmetadata=function(){R=!0},Re(C,g),g.play()}var v=null,y,k,h=this}typeof e<"u"&&(e.GifRecorder=_e);function Ye(C,n){var S="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(r){typeof e<"u"||r&&(typeof window<"u"||typeof Q>"u"||(Q.navigator={userAgent:S,getUserMedia:function(){}},Q.console||(Q.console={}),(typeof Q.console.log>"u"||typeof Q.console.error>"u")&&(Q.console.error=Q.console.log=Q.console.log||function(){console.log(arguments)}),typeof document>"u"&&(r.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var c={getContext:function(){return c},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return c},r.HTMLVideoElement=function(){}),typeof location>"u"&&(r.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(r.screen={width:0,height:0}),typeof g>"u"&&(r.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),r.window=Q))})(typeof Q<"u"?Q:null),n=n||"multi-streams-mixer";var $=[],P=!1,t=document.createElement("canvas"),p=t.getContext("2d");t.style.opacity=0,t.style.position="absolute",t.style.zIndex=-1,t.style.top="-1000em",t.style.left="-1000em",t.className=n,(document.body||document.documentElement).appendChild(t),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var f=this,R=window.AudioContext;typeof R>"u"&&(typeof webkitAudioContext<"u"&&(R=webkitAudioContext),typeof mozAudioContext<"u"&&(R=mozAudioContext));var g=window.URL;typeof g>"u"&&typeof webkitURL<"u"&&(g=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var v=window.MediaStream;typeof v>"u"&&typeof webkitMediaStream<"u"&&(v=webkitMediaStream),typeof v<"u"&&typeof v.prototype.stop>"u"&&(v.prototype.stop=function(){this.getTracks().forEach(function(r){r.stop()})});var y={};typeof R<"u"?y.AudioContext=R:typeof webkitAudioContext<"u"&&(y.AudioContext=webkitAudioContext);function k(r,c){"srcObject"in c?c.srcObject=r:"mozSrcObject"in c?c.mozSrcObject=r:c.srcObject=r}this.startDrawingFrames=function(){h()};function h(){if(!P){var r=$.length,c=!1,T=[];if($.forEach(function(z){z.stream||(z.stream={}),z.stream.fullcanvas?c=z:T.push(z)}),c)t.width=c.stream.width,t.height=c.stream.height;else if(T.length){t.width=r>1?T[0].width*2:T[0].width;var O=1;(r===3||r===4)&&(O=2),(r===5||r===6)&&(O=3),(r===7||r===8)&&(O=4),(r===9||r===10)&&(O=5),t.height=T[0].height*O}else t.width=f.width||360,t.height=f.height||240;c&&c instanceof HTMLVideoElement&&E(c),T.forEach(function(z,H){E(z,H)}),setTimeout(h,f.frameInterval)}}function E(r,c){if(!P){var T=0,O=0,z=r.width,H=r.height;c===1&&(T=r.width),c===2&&(O=r.height),c===3&&(T=r.width,O=r.height),c===4&&(O=r.height*2),c===5&&(T=r.width,O=r.height*2),c===6&&(O=r.height*3),c===7&&(T=r.width,O=r.height*3),typeof r.stream.left<"u"&&(T=r.stream.left),typeof r.stream.top<"u"&&(O=r.stream.top),typeof r.stream.width<"u"&&(z=r.stream.width),typeof r.stream.height<"u"&&(H=r.stream.height),p.drawImage(r,T,O,z,H),typeof r.stream.onRender=="function"&&r.stream.onRender(p,T,O,z,H,c)}}function U(){P=!1;var r=j(),c=L();return c&&c.getTracks().filter(function(T){return T.kind==="audio"}).forEach(function(T){r.addTrack(T)}),C.forEach(function(T){T.fullcanvas}),r}function j(){u();var r;"captureStream"in t?r=t.captureStream():"mozCaptureStream"in t?r=t.mozCaptureStream():f.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var c=new v;return r.getTracks().filter(function(T){return T.kind==="video"}).forEach(function(T){c.addTrack(T)}),t.stream=c,c}function L(){y.AudioContextConstructor||(y.AudioContextConstructor=new y.AudioContext),f.audioContext=y.AudioContextConstructor,f.audioSources=[],f.useGainNode===!0&&(f.gainNode=f.audioContext.createGain(),f.gainNode.connect(f.audioContext.destination),f.gainNode.gain.value=0);var r=0;if(C.forEach(function(c){if(c.getTracks().filter(function(O){return O.kind==="audio"}).length){r++;var T=f.audioContext.createMediaStreamSource(c);f.useGainNode===!0&&T.connect(f.gainNode),f.audioSources.push(T)}}),!!r)return f.audioDestination=f.audioContext.createMediaStreamDestination(),f.audioSources.forEach(function(c){c.connect(f.audioDestination)}),f.audioDestination.stream}function s(r){var c=document.createElement("video");return k(r,c),c.className=n,c.muted=!0,c.volume=0,c.width=r.width||f.width||360,c.height=r.height||f.height||240,c.play(),c}this.appendStreams=function(r){if(!r)throw"First parameter is required.";r instanceof Array||(r=[r]),r.forEach(function(c){var T=new v;if(c.getTracks().filter(function(H){return H.kind==="video"}).length){var O=s(c);O.stream=c,$.push(O),T.addTrack(c.getTracks().filter(function(H){return H.kind==="video"})[0])}if(c.getTracks().filter(function(H){return H.kind==="audio"}).length){var z=f.audioContext.createMediaStreamSource(c);f.audioDestination=f.audioContext.createMediaStreamDestination(),z.connect(f.audioDestination),T.addTrack(f.audioDestination.stream.getTracks().filter(function(H){return H.kind==="audio"})[0])}C.push(T)})},this.releaseStreams=function(){$=[],P=!0,f.gainNode&&(f.gainNode.disconnect(),f.gainNode=null),f.audioSources.length&&(f.audioSources.forEach(function(r){r.disconnect()}),f.audioSources=[]),f.audioDestination&&(f.audioDestination.disconnect(),f.audioDestination=null),f.audioContext&&f.audioContext.close(),f.audioContext=null,p.clearRect(0,0,t.width,t.height),t.stream&&(t.stream.stop(),t.stream=null)},this.resetVideoStreams=function(r){r&&!(r instanceof Array)&&(r=[r]),u(r)};function u(r){$=[],r=r||C,r.forEach(function(c){if(c.getTracks().filter(function(O){return O.kind==="video"}).length){var T=s(c);T.stream=c,$.push(T)}})}this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=U}typeof e>"u"&&(d.exports=Ye);/**
 * MultiStreamRecorder can record multiple videos in single container.
 * @summary Multi-videos recorder.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MultiStreamRecorder
 * @class
 * @example
 * var options = {
 *     mimeType: 'video/webm'
 * }
 * var recorder = new MultiStreamRecorder(ArrayOfMediaStreams, options);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStreams} mediaStreams - Array of MediaStreams.
 * @param {object} config - {disableLogs:true, frameInterval: 1, mimeType: "video/webm"}
 */function Qe(C,n){C=C||[];var S=this,$,P;n=n||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}},n.frameInterval||(n.frameInterval=10),n.video||(n.video={}),n.video.width||(n.video.width=360),n.video.height||(n.video.height=240),this.record=function(){$=new Ye(C,n.elementClass||"multi-streams-mixer"),t().length&&($.frameInterval=n.frameInterval||10,$.width=n.video.width||360,$.height=n.video.height||240,$.startDrawingFrames()),n.previewStream&&typeof n.previewStream=="function"&&n.previewStream($.getMixedStream()),P=new de($.getMixedStream(),n),P.record()};function t(){var p=[];return C.forEach(function(f){q(f,"video").forEach(function(R){p.push(R)})}),p}this.stop=function(p){P&&P.stop(function(f){S.blob=f,p(f),S.clearRecordedData()})},this.pause=function(){P&&P.pause()},this.resume=function(){P&&P.resume()},this.clearRecordedData=function(){P&&(P.clearRecordedData(),P=null),$&&($.releaseStreams(),$=null)},this.addStreams=function(p){if(!p)throw"First parameter is required.";p instanceof Array||(p=[p]),C.concat(p),!(!P||!$)&&($.appendStreams(p),n.previewStream&&typeof n.previewStream=="function"&&n.previewStream($.getMixedStream()))},this.resetVideoStreams=function(p){$&&(p&&!(p instanceof Array)&&(p=[p]),$.resetVideoStreams(p))},this.getMixer=function(){return $},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}typeof e<"u"&&(e.MultiStreamRecorder=Qe);/**
 * RecordRTCPromisesHandler adds promises support in {@link RecordRTC}. Try a {@link https://github.com/muaz-khan/RecordRTC/blob/master/simple-demos/RecordRTCPromisesHandler.html|demo here}
 * @summary Promises for {@link RecordRTC}
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCPromisesHandler
 * @class
 * @example
 * var recorder = new RecordRTCPromisesHandler(mediaStream, options);
 * recorder.startRecording()
 *         .then(successCB)
 *         .catch(errorCB);
 * // Note: You can access all RecordRTC API using "recorder.recordRTC" e.g. 
 * recorder.recordRTC.onStateChanged = function(state) {};
 * recorder.recordRTC.setRecordingDuration(5000);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 * @throws Will throw an error if "new" keyword is not used to initiate "RecordRTCPromisesHandler". Also throws error if first argument "MediaStream" is missing.
 * @requires {@link RecordRTC}
 */function it(C,n){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(typeof C>"u")throw'First argument "MediaStream" is required.';var S=this;S.recordRTC=new e(C,n),this.startRecording=function(){return new Promise(function($,P){try{S.recordRTC.startRecording(),$()}catch(t){P(t)}})},this.stopRecording=function(){return new Promise(function($,P){try{S.recordRTC.stopRecording(function(t){if(S.blob=S.recordRTC.getBlob(),!S.blob||!S.blob.size){P("Empty blob.",S.blob);return}$(t)})}catch(t){P(t)}})},this.pauseRecording=function(){return new Promise(function($,P){try{S.recordRTC.pauseRecording(),$()}catch(t){P(t)}})},this.resumeRecording=function(){return new Promise(function($,P){try{S.recordRTC.resumeRecording(),$()}catch(t){P(t)}})},this.getDataURL=function($){return new Promise(function(P,t){try{S.recordRTC.getDataURL(function(p){P(p)})}catch(p){t(p)}})},this.getBlob=function(){return new Promise(function($,P){try{$(S.recordRTC.getBlob())}catch(t){P(t)}})},this.getInternalRecorder=function(){return new Promise(function($,P){try{$(S.recordRTC.getInternalRecorder())}catch(t){P(t)}})},this.reset=function(){return new Promise(function($,P){try{$(S.recordRTC.reset())}catch(t){P(t)}})},this.destroy=function(){return new Promise(function($,P){try{$(S.recordRTC.destroy())}catch(t){P(t)}})},this.getState=function(){return new Promise(function($,P){try{$(S.recordRTC.getState())}catch(t){P(t)}})},this.blob=null,this.version="5.6.2"}typeof e<"u"&&(e.RecordRTCPromisesHandler=it);/**
 * WebAssemblyRecorder lets you create webm videos in JavaScript via WebAssembly. The library consumes raw RGBA32 buffers (4 bytes per pixel) and turns them into a webm video with the given framerate and quality. This makes it compatible out-of-the-box with ImageData from a CANVAS. With realtime mode you can also use webm-wasm for streaming webm videos.
 * @summary Video recording feature in Chrome, Firefox and maybe Edge.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WebAssemblyRecorder
 * @class
 * @example
 * var recorder = new WebAssemblyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {webAssemblyPath:'webm-wasm.wasm',workerPath: 'webm-worker.js', frameRate: 30, width: 1920, height: 1080, bitrate: 1024, realtime: true}
 */function Oe(C,n){(typeof ReadableStream>"u"||typeof WritableStream>"u")&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),n=n||{},n.width=n.width||640,n.height=n.height||480,n.frameRate=n.frameRate||30,n.bitrate=n.bitrate||1200,n.realtime=n.realtime||!0;var S;function $(){return new ReadableStream({start:function(g){var v=document.createElement("canvas"),y=document.createElement("video"),k=!0;y.srcObject=C,y.muted=!0,y.height=n.height,y.width=n.width,y.volume=0,y.onplaying=function(){v.width=n.width,v.height=n.height;var h=v.getContext("2d"),E=1e3/n.frameRate,U=setInterval(function(){if(S&&(clearInterval(U),g.close()),k&&(k=!1,n.onVideoProcessStarted&&n.onVideoProcessStarted()),h.drawImage(y,0,0),g._controlledReadableStream.state!=="closed")try{g.enqueue(h.getImageData(0,0,n.width,n.height))}catch{}},E)},y.play()}})}var P;function t(g,v){if(!n.workerPath&&!v){S=!1,fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(k){k.arrayBuffer().then(function(h){t(g,h)})});return}if(!n.workerPath&&v instanceof ArrayBuffer){var y=new Blob([v],{type:"text/javascript"});n.workerPath=_.createObjectURL(y)}n.workerPath||console.error("workerPath parameter is missing."),P=new Worker(n.workerPath),P.postMessage(n.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),P.addEventListener("message",function(k){k.data==="READY"?(P.postMessage({width:n.width,height:n.height,bitrate:n.bitrate||1200,timebaseDen:n.frameRate||30,realtime:n.realtime}),$().pipeTo(new WritableStream({write:function(h){if(S){console.error("Got image, but recorder is finished!");return}P.postMessage(h.data.buffer,[h.data.buffer])}}))):k.data&&(p||R.push(k.data))})}this.record=function(){R=[],p=!1,this.blob=null,t(C),typeof n.initCallback=="function"&&n.initCallback()};var p;this.pause=function(){p=!0},this.resume=function(){p=!1};function f(g){if(!P){g&&g();return}P.addEventListener("message",function(v){v.data===null&&(P.terminate(),P=null,g&&g())}),P.postMessage(null)}var R=[];this.stop=function(g){S=!0;var v=this;f(function(){v.blob=new Blob(R,{type:"video/webm"}),g(v.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){R=[],p=!1,this.blob=null},this.blob=null}typeof e<"u"&&(e.WebAssemblyRecorder=Oe)})(ft);var Wi=ft.exports;const ji=tt(Wi);var mt={exports:{}};(function(d){(function(e,i){d.exports?d.exports=i():window.ysFixWebmDuration=i()})("fix-webm-duration",function(){var e={172351395:{name:"EBML",type:"Container"},646:{name:"EBMLVersion",type:"Uint"},759:{name:"EBMLReadVersion",type:"Uint"},754:{name:"EBMLMaxIDLength",type:"Uint"},755:{name:"EBMLMaxSizeLength",type:"Uint"},642:{name:"DocType",type:"String"},647:{name:"DocTypeVersion",type:"Uint"},645:{name:"DocTypeReadVersion",type:"Uint"},108:{name:"Void",type:"Binary"},63:{name:"CRC-32",type:"Binary"},190023271:{name:"SignatureSlot",type:"Container"},16010:{name:"SignatureAlgo",type:"Uint"},16026:{name:"SignatureHash",type:"Uint"},16037:{name:"SignaturePublicKey",type:"Binary"},16053:{name:"Signature",type:"Binary"},15963:{name:"SignatureElements",type:"Container"},15995:{name:"SignatureElementList",type:"Container"},9522:{name:"SignedElement",type:"Binary"},139690087:{name:"Segment",type:"Container"},21863284:{name:"SeekHead",type:"Container"},3515:{name:"Seek",type:"Container"},5035:{name:"SeekID",type:"Binary"},5036:{name:"SeekPosition",type:"Uint"},88713574:{name:"Info",type:"Container"},13220:{name:"SegmentUID",type:"Binary"},13188:{name:"SegmentFilename",type:"String"},1882403:{name:"PrevUID",type:"Binary"},1868715:{name:"PrevFilename",type:"String"},2013475:{name:"NextUID",type:"Binary"},1999803:{name:"NextFilename",type:"String"},1092:{name:"SegmentFamily",type:"Binary"},10532:{name:"ChapterTranslate",type:"Container"},10748:{name:"ChapterTranslateEditionUID",type:"Uint"},10687:{name:"ChapterTranslateCodec",type:"Uint"},10661:{name:"ChapterTranslateID",type:"Binary"},710577:{name:"TimecodeScale",type:"Uint"},1161:{name:"Duration",type:"Float"},1121:{name:"DateUTC",type:"Date"},15273:{name:"Title",type:"String"},3456:{name:"MuxingApp",type:"String"},5953:{name:"WritingApp",type:"String"},103:{name:"Timecode",type:"Uint"},6228:{name:"SilentTracks",type:"Container"},6359:{name:"SilentTrackNumber",type:"Uint"},39:{name:"Position",type:"Uint"},43:{name:"PrevSize",type:"Uint"},35:{name:"SimpleBlock",type:"Binary"},32:{name:"BlockGroup",type:"Container"},33:{name:"Block",type:"Binary"},34:{name:"BlockVirtual",type:"Binary"},13729:{name:"BlockAdditions",type:"Container"},38:{name:"BlockMore",type:"Container"},110:{name:"BlockAddID",type:"Uint"},37:{name:"BlockAdditional",type:"Binary"},27:{name:"BlockDuration",type:"Uint"},122:{name:"ReferencePriority",type:"Uint"},123:{name:"ReferenceBlock",type:"Int"},125:{name:"ReferenceVirtual",type:"Int"},36:{name:"CodecState",type:"Binary"},13730:{name:"DiscardPadding",type:"Int"},14:{name:"Slices",type:"Container"},104:{name:"TimeSlice",type:"Container"},76:{name:"LaceNumber",type:"Uint"},77:{name:"FrameNumber",type:"Uint"},75:{name:"BlockAdditionID",type:"Uint"},78:{name:"Delay",type:"Uint"},79:{name:"SliceDuration",type:"Uint"},72:{name:"ReferenceFrame",type:"Container"},73:{name:"ReferenceOffset",type:"Uint"},74:{name:"ReferenceTimeCode",type:"Uint"},47:{name:"EncryptedBlock",type:"Binary"},106212971:{name:"Tracks",type:"Container"},46:{name:"TrackEntry",type:"Container"},87:{name:"TrackNumber",type:"Uint"},13253:{name:"TrackUID",type:"Uint"},3:{name:"TrackType",type:"Uint"},57:{name:"FlagEnabled",type:"Uint"},8:{name:"FlagDefault",type:"Uint"},5546:{name:"FlagForced",type:"Uint"},28:{name:"FlagLacing",type:"Uint"},11751:{name:"MinCache",type:"Uint"},11768:{name:"MaxCache",type:"Uint"},254851:{name:"DefaultDuration",type:"Uint"},216698:{name:"DefaultDecodedFieldDuration",type:"Uint"},209231:{name:"TrackTimecodeScale",type:"Float"},4991:{name:"TrackOffset",type:"Int"},5614:{name:"MaxBlockAdditionID",type:"Uint"},4974:{name:"Name",type:"String"},177564:{name:"Language",type:"String"},6:{name:"CodecID",type:"String"},9122:{name:"CodecPrivate",type:"Binary"},362120:{name:"CodecName",type:"String"},13382:{name:"AttachmentLink",type:"Uint"},1742487:{name:"CodecSettings",type:"String"},1785920:{name:"CodecInfoURL",type:"String"},438848:{name:"CodecDownloadURL",type:"String"},42:{name:"CodecDecodeAll",type:"Uint"},12203:{name:"TrackOverlay",type:"Uint"},5802:{name:"CodecDelay",type:"Uint"},5819:{name:"SeekPreRoll",type:"Uint"},9764:{name:"TrackTranslate",type:"Container"},9980:{name:"TrackTranslateEditionUID",type:"Uint"},9919:{name:"TrackTranslateCodec",type:"Uint"},9893:{name:"TrackTranslateTrackID",type:"Binary"},96:{name:"Video",type:"Container"},26:{name:"FlagInterlaced",type:"Uint"},5048:{name:"StereoMode",type:"Uint"},5056:{name:"AlphaMode",type:"Uint"},5049:{name:"OldStereoMode",type:"Uint"},48:{name:"PixelWidth",type:"Uint"},58:{name:"PixelHeight",type:"Uint"},5290:{name:"PixelCropBottom",type:"Uint"},5307:{name:"PixelCropTop",type:"Uint"},5324:{name:"PixelCropLeft",type:"Uint"},5341:{name:"PixelCropRight",type:"Uint"},5296:{name:"DisplayWidth",type:"Uint"},5306:{name:"DisplayHeight",type:"Uint"},5298:{name:"DisplayUnit",type:"Uint"},5299:{name:"AspectRatioType",type:"Uint"},963876:{name:"ColourSpace",type:"Binary"},1029411:{name:"GammaValue",type:"Float"},230371:{name:"FrameRate",type:"Float"},97:{name:"Audio",type:"Container"},53:{name:"SamplingFrequency",type:"Float"},14517:{name:"OutputSamplingFrequency",type:"Float"},31:{name:"Channels",type:"Uint"},15739:{name:"ChannelPositions",type:"Binary"},8804:{name:"BitDepth",type:"Uint"},98:{name:"TrackOperation",type:"Container"},99:{name:"TrackCombinePlanes",type:"Container"},100:{name:"TrackPlane",type:"Container"},101:{name:"TrackPlaneUID",type:"Uint"},102:{name:"TrackPlaneType",type:"Uint"},105:{name:"TrackJoinBlocks",type:"Container"},109:{name:"TrackJoinUID",type:"Uint"},64:{name:"TrickTrackUID",type:"Uint"},65:{name:"TrickTrackSegmentUID",type:"Binary"},70:{name:"TrickTrackFlag",type:"Uint"},71:{name:"TrickMasterTrackUID",type:"Uint"},68:{name:"TrickMasterTrackSegmentUID",type:"Binary"},11648:{name:"ContentEncodings",type:"Container"},8768:{name:"ContentEncoding",type:"Container"},4145:{name:"ContentEncodingOrder",type:"Uint"},4146:{name:"ContentEncodingScope",type:"Uint"},4147:{name:"ContentEncodingType",type:"Uint"},4148:{name:"ContentCompression",type:"Container"},596:{name:"ContentCompAlgo",type:"Uint"},597:{name:"ContentCompSettings",type:"Binary"},4149:{name:"ContentEncryption",type:"Container"},2017:{name:"ContentEncAlgo",type:"Uint"},2018:{name:"ContentEncKeyID",type:"Binary"},2019:{name:"ContentSignature",type:"Binary"},2020:{name:"ContentSigKeyID",type:"Binary"},2021:{name:"ContentSigAlgo",type:"Uint"},2022:{name:"ContentSigHashAlgo",type:"Uint"},206814059:{name:"Cues",type:"Container"},59:{name:"CuePoint",type:"Container"},51:{name:"CueTime",type:"Uint"},55:{name:"CueTrackPositions",type:"Container"},119:{name:"CueTrack",type:"Uint"},113:{name:"CueClusterPosition",type:"Uint"},112:{name:"CueRelativePosition",type:"Uint"},50:{name:"CueDuration",type:"Uint"},4984:{name:"CueBlockNumber",type:"Uint"},106:{name:"CueCodecState",type:"Uint"},91:{name:"CueReference",type:"Container"},22:{name:"CueRefTime",type:"Uint"},23:{name:"CueRefCluster",type:"Uint"},4959:{name:"CueRefNumber",type:"Uint"},107:{name:"CueRefCodecState",type:"Uint"},155296873:{name:"Attachments",type:"Container"},8615:{name:"AttachedFile",type:"Container"},1662:{name:"FileDescription",type:"String"},1646:{name:"FileName",type:"String"},1632:{name:"FileMimeType",type:"String"},1628:{name:"FileData",type:"Binary"},1710:{name:"FileUID",type:"Uint"},1653:{name:"FileReferral",type:"Binary"},1633:{name:"FileUsedStartTime",type:"Uint"},1634:{name:"FileUsedEndTime",type:"Uint"},4433776:{name:"Chapters",type:"Container"},1465:{name:"EditionEntry",type:"Container"},1468:{name:"EditionUID",type:"Uint"},1469:{name:"EditionFlagHidden",type:"Uint"},1499:{name:"EditionFlagDefault",type:"Uint"},1501:{name:"EditionFlagOrdered",type:"Uint"},54:{name:"ChapterAtom",type:"Container"},13252:{name:"ChapterUID",type:"Uint"},5716:{name:"ChapterStringUID",type:"String"},17:{name:"ChapterTimeStart",type:"Uint"},18:{name:"ChapterTimeEnd",type:"Uint"},24:{name:"ChapterFlagHidden",type:"Uint"},1432:{name:"ChapterFlagEnabled",type:"Uint"},11879:{name:"ChapterSegmentUID",type:"Binary"},11964:{name:"ChapterSegmentEditionUID",type:"Uint"},9155:{name:"ChapterPhysicalEquiv",type:"Uint"},15:{name:"ChapterTrack",type:"Container"},9:{name:"ChapterTrackNumber",type:"Uint"},0:{name:"ChapterDisplay",type:"Container"},5:{name:"ChapString",type:"String"},892:{name:"ChapLanguage",type:"String"},894:{name:"ChapCountry",type:"String"},10564:{name:"ChapProcess",type:"Container"},10581:{name:"ChapProcessCodecID",type:"Uint"},1293:{name:"ChapProcessPrivate",type:"Binary"},10513:{name:"ChapProcessCommand",type:"Container"},10530:{name:"ChapProcessTime",type:"Uint"},10547:{name:"ChapProcessData",type:"Binary"},39109479:{name:"Tags",type:"Container"},13171:{name:"Tag",type:"Container"},9152:{name:"Targets",type:"Container"},10442:{name:"TargetTypeValue",type:"Uint"},9162:{name:"TargetType",type:"String"},9157:{name:"TagTrackUID",type:"Uint"},9161:{name:"TagEditionUID",type:"Uint"},9156:{name:"TagChapterUID",type:"Uint"},9158:{name:"TagAttachmentUID",type:"Uint"},10184:{name:"SimpleTag",type:"Container"},1443:{name:"TagName",type:"String"},1146:{name:"TagLanguage",type:"String"},1156:{name:"TagDefault",type:"Uint"},1159:{name:"TagString",type:"String"},1157:{name:"TagBinary",type:"Binary"}};function i(_,D){_.prototype=Object.create(D.prototype),_.prototype.constructor=_}function a(_,D){this.name=_||"Unknown",this.type=D||"Unknown"}a.prototype.updateBySource=function(){},a.prototype.setSource=function(_){this.source=_,this.updateBySource()},a.prototype.updateByData=function(){},a.prototype.setData=function(_){this.data=_,this.updateByData()};function l(_,D){a.call(this,_,D||"Uint")}i(l,a);function m(_){return _.length%2===1?"0"+_:_}l.prototype.updateBySource=function(){this.data="";for(var _=0;_<this.source.length;_++){var D=this.source[_].toString(16);this.data+=m(D)}},l.prototype.updateByData=function(){var _=this.data.length/2;this.source=new Uint8Array(_);for(var D=0;D<_;D++){var x=this.data.substr(D*2,2);this.source[D]=parseInt(x,16)}},l.prototype.getValue=function(){return parseInt(this.data,16)},l.prototype.setValue=function(_){this.setData(m(_.toString(16)))};function o(_,D){a.call(this,_,D||"Float")}i(o,a),o.prototype.getFloatArrayType=function(){return this.source&&this.source.length===4?Float32Array:Float64Array},o.prototype.updateBySource=function(){var _=this.source.reverse(),D=this.getFloatArrayType(),x=new D(_.buffer);this.data=x[0]},o.prototype.updateByData=function(){var _=this.getFloatArrayType(),D=new _([this.data]),x=new Uint8Array(D.buffer);this.source=x.reverse()},o.prototype.getValue=function(){return this.data},o.prototype.setValue=function(_){this.setData(_)};function w(_,D){a.call(this,_,D||"Container")}i(w,a),w.prototype.readByte=function(){return this.source[this.offset++]},w.prototype.readUint=function(){for(var _=this.readByte(),D=8-_.toString(2).length,x=_-(1<<7-D),N=0;N<D;N++)x*=256,x+=this.readByte();return x},w.prototype.updateBySource=function(){for(this.data=[],this.offset=0;this.offset<this.source.length;this.offset=x){var _=this.readUint(),D=this.readUint(),x=Math.min(this.offset+D,this.source.length),N=this.source.slice(this.offset,x),I=e[_]||{name:"Unknown",type:"Unknown"},G=a;switch(I.type){case"Container":G=w;break;case"Uint":G=l;break;case"Float":G=o;break}var B=new G(I.name,I.type);B.setSource(N),this.data.push({id:_,idHex:_.toString(16),data:B})}},w.prototype.writeUint=function(_,D){for(var x=1,N=128;_>=N&&x<8;x++,N*=128);if(!D)for(var I=N+_,G=x-1;G>=0;G--){var B=I%256;this.source[this.offset+G]=B,I=(I-B)/256}this.offset+=x},w.prototype.writeSections=function(_){this.offset=0;for(var D=0;D<this.data.length;D++){var x=this.data[D],N=x.data.source,I=N.length;this.writeUint(x.id,_),this.writeUint(I,_),_||this.source.set(N,this.offset),this.offset+=I}return this.offset},w.prototype.updateByData=function(){var _=this.writeSections("draft");this.source=new Uint8Array(_),this.writeSections()},w.prototype.getSectionById=function(_){for(var D=0;D<this.data.length;D++){var x=this.data[D];if(x.id===_)return x.data}return null};function b(_){w.call(this,"File","File"),this.setSource(_)}i(b,w),b.prototype.fixDuration=function(_,D){var x=D&&D.logger;x===void 0?x=function(V){console.log(V)}:x||(x=function(){});var N=this.getSectionById(139690087);if(!N)return x("[fix-webm-duration] Segment section is missing"),!1;var I=N.getSectionById(88713574);if(!I)return x("[fix-webm-duration] Info section is missing"),!1;var G=I.getSectionById(710577);if(!G)return x("[fix-webm-duration] TimecodeScale section is missing"),!1;var B=I.getSectionById(1161);if(B)if(B.getValue()<=0)x(`[fix-webm-duration] Duration section is present, but the value is ${B.getValue()}`),B.setValue(_);else return x(`[fix-webm-duration] Duration section is present, and the value is ${B.getValue()}`),!1;else x("[fix-webm-duration] Duration section is missing"),B=new o("Duration","Float"),B.setValue(_),I.data.push({id:1161,data:B});return G.setValue(1e6),I.updateByData(),N.updateByData(),this.updateByData(),!0},b.prototype.toBlob=function(_){return new Blob([this.source.buffer],{type:_||"video/webm"})};function M(_,D,x,N){if(typeof x=="object"&&(N=x,x=void 0),!x)return new Promise(function(G){M(_,D,G,N)});try{var I=new FileReader;I.onloadend=function(){try{var G=new b(new Uint8Array(I.result));G.fixDuration(D,N)&&(_=G.toBlob(_.type))}catch{}x(_)},I.readAsArrayBuffer(_)}catch{x(_)}}return M.default=M,M})})(mt);var Gi=mt.exports;const dt=tt(Gi),zi={props:{type:String,path:String,selected_mode:String,stopmotion_slug:String,available_modes:{type:Array,default:()=>["photo","video","stopmotion","audio","vecto","lines"]},origin:{type:String,default:"capture"},return_temp_media:{type:Boolean,default:!1},must_validate_media:{type:Boolean,default:!0}},components:{PickLocationForCaptures:Yt,ModeSelector:Ct,MediaPreviewBeforeValidation:Tt,MediaValidationButtons:ut,StopmotionPanel:zt,CapturePane:ii,CaptureSettings:ui,CaptureEffects:pi,StopmotionList:Si,AudioEqualizer:Ei,VectoMode:Bi,LinesMode:Hi},data(){return{is_sending_image:!1,is_loading_stream:!0,invisible_canvas:void 0,ask_before_leaving_capture:!1,capture_pane_is_small:!1,media_to_validate:!1,media_is_being_sent:!1,media_being_sent_percent:0,capture_button_pressed:!1,mode_just_changed:!1,is_validating_stopmotion_video:!1,video_recording_is_paused:!1,grids:{halfs:[[50,0,50,100],[0,50,100,50]],thirds:[[33,0,33,100],[66,0,66,100],[0,33,100,33],[0,66,100,66]],fourths:[[25,0,25,100],[50,0,50,100],[75,0,75,100],[0,25,100,25],[0,50,100,50],[0,75,100,75]]},current_grid_type:!1,location_to_add_to_medias:void 0,show_position_modal:!1,stream:void 0,stream_type:void 0,audio_output_deviceId:void 0,show_capture_settings:!1,show_effects_pane:!1,enable_audio_recording_in_video:!0,enable_video:!0,is_recording:!1,timer_recording_in_seconds:!1,recording_timer_interval:void 0,stopmotion_frame_rate:4,timelapse_mode_enabled:!1,timelapse_interval:2,timelapse_event:!1,timelapse_time_before_next_picture:!1,delay_mode_enabled:!1,delay_seconds:5,delay_event:!1,delay_remaining_time:!1,recorder:null,actual_camera_resolution:{width:void 0,height:void 0},displayed_video_size:{width:void 0,height:void 0},show_live_feed:!1,show_stopmotion_list:!1,onion_skin_img:!1,onion_skin_opacity:0,last_frame_from_video:void 0,frameGrabber:void 0,show_lines_settings:!1,vecto_number_of_colors:2,lines_angle:108,lines_brightness:1,lines_contrast:1,lines_density:.25,stream_sharing_informations_status:{},stream_access_informations_status:{},enable_effects:!1,update_last_video_imageData:void 0}},created(){try{const d=localStorage.getItem("location_to_add_to_medias");d&&d!=="undefined"&&(this.location_to_add_to_medias=JSON.parse(d))}catch(d){console.error(d),this.location_to_add_to_medias=void 0}},mounted(){this.selected_mode||this.$emit("changeMode",this.available_modes[0]),document.addEventListener("keyup",this.captureKeyListener),this.checkCapturePanelSize(),this.$eventHub.$on("activity_panels_resized",this.checkCapturePanelSize),this.$eventHub.$on("window.resized",this.checkCapturePanelSize),this.$eventHub.$on("stream.newSharingInformations",this.updateStreamSharing),this.$eventHub.$on("stream.newDistantAccessInformations",this.updateDistantStream),this.$eventHub.$on("capture.stopRecording",this.stopRecording),this.$refs.videoElement.volume=0,this.$refs.videoElement.addEventListener("loadedmetadata",this.refreshVideoActualSize)},beforeDestroy(){this.$eventHub.$off("activity_panels_resized",this.checkCapturePanelSize),this.$eventHub.$off("window.resized",this.checkCapturePanelSize),this.$eventHub.$off("stream.newSharingInformations",this.updateStreamSharing),this.$eventHub.$off("stream.newDistantAccessInformations",this.updateDistantStream),this.$eventHub.$off("capture.stopRecording",this.stopRecording),document.removeEventListener("keyup",this.captureKeyListener),this.ask_before_leaving_capture=!1,this.stopFrameGrabber(),this.stopTimelapseInterval(),this.cancelDelay(),this.eraseTimer(),this.update_last_video_imageData&&window.cancelAnimationFrame(this.update_last_video_imageData),this.$refs.videoElement.removeEventListener("loadedmetadata",this.refreshVideoActualSize)},watch:{selected_mode(d,e){if(!d){this.$emit("changeMode",e);return}this.mode_just_changed=!0,window.setTimeout(()=>{this.mode_just_changed=!1},300),this.selected_mode==="audio"?(this.enable_audio=!0,this.enable_video=!1):this.enable_video=!0,this.stopFrameGrabber(),(this.selected_mode==="vecto"||this.selected_mode==="lines")&&this.startFrameGrabber(),this.selected_mode!=="stopmotion"&&(this.show_stopmotion_list=!1)},location_to_add_to_medias(){this.has_location_to_add_to_medias?localStorage.setItem("location_to_add_to_medias",JSON.stringify(this.location_to_add_to_medias)):localStorage.removeItem("location_to_add_to_medias")},is_validating_stopmotion_video(){this.is_validating_stopmotion_video?this.$refs.videoElement.pause():(this.$refs.videoElement.play(),this.show_live_feed=!0)},is_making_stopmotion(){this.is_making_stopmotion&&(this.show_capture_settings=!1)},audio_output_deviceId(){},media_to_validate(){if(console.log(`WATCH • Capture: media_to_validate = ${!!this.media_to_validate}`),this.media_to_validate&&!this.must_validate_media){this.sendMedia();return}this.media_to_validate?(this.$refs.videoElement&&this.$refs.videoElement.pause(),this.$refs.audioElement&&this.$refs.audioElement.pause(),this.ask_before_leaving_capture=!0):(this.$refs.videoElement&&this.$refs.videoElement.play(),this.$refs.audioElement&&this.$refs.audioElement.play(),this.ask_before_leaving_capture=!1)}},computed:{show_mode_selector(){return!this.media_to_validate&&!this.is_recording&&!this.is_making_stopmotion&&!this.delay_event},has_location_to_add_to_medias(){var d,e;return((d=this.location_to_add_to_medias)==null?void 0:d.longitude)&&((e=this.location_to_add_to_medias)==null?void 0:e.latitude)},is_making_stopmotion(){return!!this.stopmotion_slug},validated_media_href_blob(){return this.media_to_validate?window.URL.createObjectURL(this.media_to_validate.rawData):!1},show_videos(){return this.stream&&["photo","video","stopmotion"].includes(this.selected_mode)&&this.show_live_feed&&!(this.must_validate_media&&this.media_to_validate)}},methods:{hasFinishedLoading(){this.is_loading_stream=!1,this.show_live_feed=!0},setStream({stream:d,type:e}){this.stream=d,this.stream_type=e,this.$refs.videoElement.volume=0,this.enable_effects=!1},updateSelectedColor({e:d,type:e}){if(!this.$refs.canvasElement)return;console.log("CaptureView: METHODS • updateSelectedColor");const i=this.getColorInCanvasFromPixelCount(d);this.$eventHub.$emit("captureCanvas.pixelColorUnderMouse",{px_color:i,type:e})},getColorInCanvasFromPixelCount(d){const i=((o,w,b,M)=>{let _,D,x;return w/M>o/b?(_=w/M,D=(o-b*_)/2,x=0):(_=o/b,x=(w-M*_)/2,D=0),{scale:_,offsetX:D,offsetY:x}})(this.actual_camera_resolution.width,this.actual_camera_resolution.height,this.$refs.canvasElement.getBoundingClientRect().width,this.$refs.canvasElement.getBoundingClientRect().height),a=d.offsetX*i.scale+i.offsetX,l=d.offsetY*i.scale+i.offsetY,m=this.$refs.canvasElement.getContext("2d").getImageData(a,l,1,1);return{r:m.data[0],g:m.data[1],b:m.data[2]}},updateStreamSharing(d){this.stream_sharing_informations_status=d},updateDistantStream(d){this.stream_access_informations_status=d},refreshVideoActualSize(){this.getVideoActualSize().then(({width:d,height:e})=>{this.actual_camera_resolution.width=d,this.actual_camera_resolution.height=e}).catch(d=>{this.$root.debug_mode===!0&&console.log("CaptureView • METHODS : refreshVideoActualSize — couldnt get video size: "+d)})},testStopmotion(){this.$eventHub.$emit("stopmotion.test")},getVideoActualSize(){return new Promise((d,e)=>{let i=0;this.$refs.videoElement.videoWidth||(i=500),(l=>new Promise(m=>window.setTimeout(m,l)))(i).then(()=>!this.$refs.videoElement||this.$refs.videoElement.videoWidth*this.$refs.videoElement.videoHeight>0?d({width:this.$refs.videoElement.videoWidth,height:this.$refs.videoElement.videoHeight}):e("couldn’t get video dimensions"))})},loadStopmotion(d){const e=d.substring(d.lastIndexOf("/")+1);this.$emit("openStopmotion",e),this.show_stopmotion_list=!1},checkCapturePanelSize(){var d;((d=this.$el)==null?void 0:d.offsetHeight)<=400?this.capture_pane_is_small=!0:this.capture_pane_is_small=!1},stopStopmotion(){this.closeStopmotionPanel()},startFrameGrabber(){const d=()=>{if(this.$root.debug_mode===!0&&console.log("CaptureView • METHODS : startFrameGrabber"),this.media_to_validate)return;const e=this.actual_camera_resolution.width/this.actual_camera_resolution.height;this.getImageDataFromFeed({width:240*e,height:240}).then(i=>this.last_frame_from_video=i)};d(),this.frameGrabber=window.setInterval(d,300)},stopFrameGrabber(){this.$root.debug_mode===!0&&console.log("CaptureView • METHODS : stopFrameGrabber  "),this.frameGrabber&&window.clearInterval(this.frameGrabber),this.last_frame_from_video=void 0},async addStopmotionImage(){if(this.show_live_feed=!0,this.$refs.videoElement.pause(),this.is_sending_image=!0,!this.stopmotion_slug){this.ask_before_leaving_capture=!0;const e=await this.$api.createFolder({path:`${this.path}/stopmotions`,additional_meta:{name:new Date().getTime(),$admins:"parent_contributors"}});this.$emit("openStopmotion",e)}const d=await this.getImageDataFromFeed();this.$eventHub.$emit("stopmotion.addImage",{imageData:d}),this.media_to_validate={rawData:d,objectURL:URL.createObjectURL(d),type:"image"},setTimeout(()=>{this.media_to_validate=!1},500),this.is_sending_image=!1,this.$refs.videoElement.play()},closeStopmotionPanel(){this.$emit("openStopmotion",void 0),this.media_is_being_sent=!1,this.media_being_sent_percent=100,this.media_to_validate=!1,this.is_recording=!1,this.ask_before_leaving_capture=!1,this.show_live_feed=!0},captureKeyListener(d){if(console.log("METHODS • CaptureView: captureKeyListener"),this.media_to_validate||this.is_validating_stopmotion_video)return!1;if(!(this.$root.modal_is_opened||d.target.tagName.toLowerCase()==="select"||d.target.tagName.toLowerCase()==="input"||d.target.tagName.toLowerCase()==="textarea"||d.target.className.includes("ql-editor")||d.target.hasAttribute("contenteditable")))switch(d.key){case"w":case"z":case"ArrowLeft":this.$eventHub.$emit("mode.set.previous");break;case"s":case"ArrowRight":this.$eventHub.$emit("mode.set.next");break;case"a":case"q":case" ":this.is_recording?this.stopRecording():this.setCaptureInit();break}},setCaptureInit(){this.$root.debug_mode===!0&&console.log("CaptureView / setCaptureInit"),this.ask_before_leaving_capture=!0,this.delay_mode_enabled&&this.delay_event?this.cancelDelay():this.delay_mode_enabled?this.startDelay():this.setCapture()},startDelay(){let d=0;this.delay_remaining_time=this.delay_seconds,this.delay_event=window.setInterval(()=>{d+=1,d===this.delay_seconds?(this.setCapture(),this.cancelDelay()):this.delay_remaining_time=this.delay_seconds-d},1e3)},cancelDelay(){this.delay_remaining_time=!1,window.clearInterval(this.delay_event),this.delay_event=!1},startTimelapseInterval(){let d=0;this.timelapse_time_before_next_picture=this.timelapse_interval,this.timelapse_event=window.setInterval(()=>{d+=1,d===this.timelapse_interval?(this.setCapture(),this.stopTimelapseInterval(),this.startTimelapseInterval()):this.timelapse_time_before_next_picture=this.timelapse_interval-d},1e3)},stopTimelapseInterval(){window.clearInterval(this.timelapse_event),this.timelapse_event=!1,this.timelapse_time_before_next_picture=!1},setCapture(){if(this.capture_button_pressed=!0,window.setTimeout(()=>{this.capture_button_pressed=!1},400),this.show_capture_settings=!1,this.selected_mode==="photo")this.getImageDataFromFeed().then(d=>{this.media_to_validate={rawData:d,objectURL:URL.createObjectURL(d),temp_name:"image.jpeg",type:"image"}});else if(this.selected_mode==="video")this.video_recording_is_paused=!1,this.startRecordFeed({type:"video",mimeType:"video/webm;codecs=vp8,opus",videoBitsPerSecond:4112e3,enable_audio_recording_in_video:this.enable_audio_recording_in_video});else if(this.selected_mode==="audio")this.startRecordFeed({type:"audio"});else if(this.selected_mode==="stopmotion")this.addStopmotionImage(),this.timelapse_mode_enabled&&!this.is_recording&&(this.is_recording=!0,this.startTimelapseInterval());else if(this.selected_mode==="vecto"){const d=this.$refs.vectoElement.svgstr;this.media_to_validate={preview:d,rawData:new Blob([d],{type:"image/svg+xml"}),temp_name:"vecto.svg",type:"svg"}}else if(this.selected_mode==="lines"){const d=this.$refs.vectoElement.$el.querySelector("svg").outerHTML;this.media_to_validate={preview:d,rawData:new Blob([d],{type:"image/svg+xml"}),temp_name:"lines.svg",type:"svg"}}},stopRecording(){if(!this.is_recording)return;const d=this.timer_recording_in_seconds;if(this.selected_mode==="stopmotion"&&this.timelapse_mode_enabled){this.is_recording=!1,this.stopTimelapseInterval();return}this.selected_mode==="video"?this.recorder.stopRecording(()=>{this.is_recording=!1,this.eraseTimer();let e=this.recorder.getBlob();this.recorder.destroy(),this.recorder=null,dt(e,d*1e3,{logger:!1}).then(i=>{this.media_to_validate={rawData:i,objectURL:URL.createObjectURL(i),temp_name:"video.webm",type:"video"}})}):this.selected_mode==="audio"&&this.recorder.stopRecording(()=>{this.is_recording=!1,this.eraseTimer();let e=this.recorder.getBlob();this.recorder.destroy(),this.recorder=null;const i=this.$refs.equalizerElement.$el.querySelector("canvas").toDataURL("image/png");dt(e,d*1e3,{logger:!1}).then(a=>{this.media_to_validate={preview:i,rawData:a,objectURL:URL.createObjectURL(a),temp_name:"audio.wav",type:"audio"}})})},pauseOrResumeCapture(){this.recorder.state!=="paused"?(this.video_recording_is_paused=!0,this.pauseTimer(),this.recorder.pauseRecording()):(this.video_recording_is_paused=!1,this.unpauseTimer(),this.recorder.resumeRecording())},startTimer(){this.recording_timer_interval=window.setInterval(()=>{this.timer_recording_in_seconds=Number(Number(this.timer_recording_in_seconds)+.1).toFixed(1)},100)},pauseTimer(){window.clearInterval(this.recording_timer_interval)},unpauseTimer(){this.startTimer()},eraseTimer(){this.timer_recording_in_seconds=!1,window.clearInterval(this.recording_timer_interval)},getImageDataFromFeed({width:d,height:e}={}){return new Promise((i,a)=>{this.enable_effects&&this.$refs.canvasElement?this.getStaticImageFromVideoElement({width:d,height:e,from_element:this.$refs.canvasElement}).then(i).catch(a):this.getStaticImageFromVideoElement({width:d,height:e}).then(i).catch(a)})},async getStaticImageFromVideoElement({width:d,height:e,from_element:i=this.$refs.videoElement}={}){if(this.$root.debug_mode===!0&&console.log("CaptureView • METHODS : getStaticImageFromVideoElement"),!i)throw new Error("missing video element");let a;return i.tagName==="VIDEO"?(this.invisible_canvas||(this.invisible_canvas=document.createElement("canvas")),a=this.invisible_canvas,a.width=d||i.videoWidth,a.height=e||i.videoHeight,a.getContext("2d").drawImage(i,0,0,a.width,a.height)):i.tagName==="CANVAS"&&(a=i),await new Promise(m=>{a.toBlob(m,"image/jpeg",.95)})},startRecordFeed(d){return new Promise(()=>{const e=new MediaStream;d.type==="video"&&(this.enable_effects&&this.$refs.canvasElement?this.$refs.canvasElement.captureStream():this.stream).getVideoTracks().forEach(a=>{e.addTrack(a)}),((d==null?void 0:d.enable_audio_recording_in_video)===!0||d.type==="audio")&&this.stream.getAudioTracks().forEach(i=>e.addTrack(i)),this.recorder=ji(e,d);try{this.recorder.startRecording(),this.is_recording=!0,this.timer_recording_in_seconds=0,this.$eventHub.$emit("capture.isRecording",d.type),this.startTimer()}catch(i){this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("failed_to_start_record")+"<br>"+i.message)}})},async sendMedia({fav:d=!1}={}){var M;if(console.log(`METHODS • CaptureView: sendMedia with fav=${d}`),this.$root.debug_mode===!0&&console.log("METHODS • CaptureView / sendMedia"),this.return_temp_media){this.$emit("tempMedia",this.media_to_validate);return}const e=+new Date,i=(Math.random().toString(36)+"00000000000000000").slice(2,5),a={image:"jpeg",video:"webm",audio:"wav",svg:"svg"},l=`${this.media_to_validate.type}-${e}-${i}.${a[this.media_to_validate.type]}`,m=this.media_to_validate.rawData;this.media_is_being_sent=!0,this.media_being_sent_percent=0;let o={fav:d,$origin:this.origin};(M=this.connected_as)!=null&&M.$path&&(o.$authors=[this.connected_as.$path]),this.has_location_to_add_to_medias&&(o.$location=this.location_to_add_to_medias);const w=_=>{console.log(`METHODS • CaptureView: onUploadProgress for name = ${l} / ${parseInt(Math.round(_.loaded*100/_.total))}% `),this.media_being_sent_percent=parseInt(Math.round(_.loaded*100/_.total))},{meta_filename:b}=await this.$api.uploadFile({path:this.path,filename:l,file:m,additional_meta:o,onProgress:w}).catch(_=>{throw console.log(`METHODS • sendThisFile: name = ${l} / failed uploading ${_}`),this.media_is_being_sent=!1,this.media_being_sent_percent=0,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("media_couldnt_be_sent")),_});this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("media_was_saved")),this.media_is_being_sent=!1,this.media_being_sent_percent=100,this.media_to_validate=!1,this.$eventHub.$emit("pane.animate","collect"),this.$emit("insertMedia",b)},cancelValidation(){this.media_to_validate=!1}}};var qi=function(){var e=this,i=e._self._c;return i("div",{staticClass:"m_captureview"},[i("CapturePane",{directives:[{name:"show",rawName:"v-show",value:e.show_capture_settings,expression:"show_capture_settings"}],attrs:{label:e.$t("settings"),pane_type:"settings"},on:{close:function(a){e.show_capture_settings=!1}}},[i("CaptureSettings",{attrs:{audio_output_deviceId:e.audio_output_deviceId},on:{"update:audio_output_deviceId":function(a){e.audio_output_deviceId=a},"update:audio_output_device-id":function(a){e.audio_output_deviceId=a},setStream:e.setStream,hasFinishedLoading:e.hasFinishedLoading,show:function(a){e.show_capture_settings=!0}}})],1),i("CapturePane",{directives:[{name:"show",rawName:"v-show",value:e.show_effects_pane,expression:"show_effects_pane"}],attrs:{label:e.$t("effects"),pane_type:"effects"},on:{close:function(a){e.show_effects_pane=!1}}},[i("CaptureEffects",{attrs:{enable_effects:e.enable_effects,videoElement:e.$refs.videoElement,canvasElement:e.$refs.canvasElement,project_path:e.path},on:{"update:enable_effects":function(a){e.enable_effects=a}}})],1),i("div",{staticClass:"m_captureview--videoPane"},[i("transition",{attrs:{name:"slidedown",duration:500}},[e.show_mode_selector?i("ModeSelector",{attrs:{available_modes:e.available_modes,selected_mode:e.selected_mode,disable_change_mode:e.is_recording||e.media_to_validate||e.mode_just_changed||e.is_making_stopmotion},on:{changeMode:function(a){return e.$emit("changeMode",a)}}}):e._e()],1),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.is_validating_stopmotion_video,expression:"!is_validating_stopmotion_video"}],staticClass:"m_captureview--videoPane--top",class:{"is--being_streamed":e.stream_sharing_informations_status&&e.stream_sharing_informations_status.enabled||e.stream_access_informations_status&&e.stream_access_informations_status.enabled}},[i("div",{staticClass:"m_captureview--videoPane--top--videoContainer"},[i("div",{staticClass:"_videoEl",style:`opacity: ${e.show_videos?1:0}`},[i("video",{ref:"videoElement",style:`opacity: ${e.enable_effects?"0":"1"}`,attrs:{autoplay:"",playsinline:"",controls:e.stream_type==="RemoteSources",muted:""},domProps:{srcObject:e.stream,muted:!0}}),i("canvas",{directives:[{name:"show",rawName:"v-show",value:e.enable_effects,expression:"enable_effects"}],ref:"canvasElement",attrs:{width:e.actual_camera_resolution.width,height:e.actual_camera_resolution.height},on:{click:a=>e.updateSelectedColor({e:a,type:"click"})}})]),e.selected_mode==="vecto"&&!e.media_to_validate?i("VectoMode",{ref:"vectoElement",attrs:{last_frame_from_video:e.last_frame_from_video,number_of_colors:e.vecto_number_of_colors}}):e._e(),e.selected_mode==="lines"&&!e.media_to_validate?i("LinesMode",{ref:"vectoElement",attrs:{last_frame_from_video:e.last_frame_from_video,angle:e.lines_angle,boost_brightness:e.lines_brightness,boost_contrast:e.lines_contrast,density:e.lines_density}}):e._e(),e.selected_mode==="audio"&&!e.media_to_validate?i("AudioEqualizer",{ref:"equalizerElement",attrs:{stream:e.stream,is_recording:e.is_recording}}):e._e(),i("transition-group",{staticClass:"_capture_options",attrs:{tag:"div",name:"slideFromTop",mode:"out-in"}},[e.selected_mode!=="stopmotion"&&e.is_recording&&e.timer_recording_in_seconds!==!1?i("div",{key:"duration",staticClass:"_duration_timer",domProps:{innerHTML:e._s(e.timer_recording_in_seconds)}}):e._e(),e.selected_mode==="stopmotion"&&e.timelapse_mode_enabled&&!e.timelapse_event?i("div",{key:"timelapse_interval",staticClass:"record_options"},[i("div",[i("span",[e._v(e._s(e.$t("interval_between_pictures")))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.timelapse_interval,expression:"timelapse_interval",modifiers:{number:!0}}],attrs:{type:"number",min:"1"},domProps:{value:e.timelapse_interval},on:{input:function(a){a.target.composing||(e.timelapse_interval=e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}}),i("span",[e._v(e._s(e.$t("seconds")))])])]):e._e(),e.stream_sharing_informations_status&&e.stream_sharing_informations_status.enabled&&e.stream_type==="LocalSources"?i("div",{key:"stream_share_name-"+e.stream_sharing_informations_status.name},[i("label",{staticClass:"u-label"},[i("span",{domProps:{innerHTML:e._s(e.$t("stream_currently_shared_with_name:"))}}),i("span",[i("strong",[e._v(e._s(e.stream_sharing_informations_status.name))])]),i("br"),e.stream_sharing_informations_status.peers_connected&&e.stream_sharing_informations_status.peers_connected.length>0?i("span",[e._v(" "+e._s(e.$t("other_users_connected"))+" = "+e._s(e.stream_sharing_informations_status.peers_connected.length)+" ")]):e._e()])]):e.stream_access_informations_status&&e.stream_access_informations_status.enabled&&e.stream_type==="RemoteSources"?i("div",{key:"stream_share_name-"+e.stream_access_informations_status.callee},[i("label",{staticClass:"u-label"},[i("span",{domProps:{innerHTML:e._s(e.$t("stream_shown:"))}}),i("span",[i("strong",[e._v(e._s(e.stream_access_informations_status.callee))])])])]):e._e(),e.delay_mode_enabled&&!e.is_recording&&!e.media_to_validate&&!e.delay_event?i("div",{key:"delay_interval",staticClass:"record_options"},[i("div",[i("span",[e._v(e._s(e.$t("delay")))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.delay_seconds,expression:"delay_seconds",modifiers:{number:!0}}],attrs:{type:"number",min:"1",max:"60"},domProps:{value:e.delay_seconds},on:{input:function(a){a.target.composing||(e.delay_seconds=e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}}),i("span",[e._v(e._s(e.$t("seconds")))])])]):e._e()]),i("transition",{attrs:{name:"scaleInFade",mode:"out-in"}},[e.delay_remaining_time?i("label",{key:"delay_before_"+e.delay_remaining_time,staticClass:"_delay_timer",class:{"is--small":e.capture_pane_is_small},domProps:{innerHTML:e._s(e.delay_remaining_time)}}):e.timelapse_time_before_next_picture?i("label",{key:"timelapse_before_"+e.timelapse_time_before_next_picture,staticClass:"_delay_timer is--small is--timelapse",domProps:{innerHTML:e._s(e.timelapse_time_before_next_picture)}}):e._e()]),i("transition",{attrs:{name:"onionSkin",mode:"in-out"}},[e.selected_mode==="stopmotion"&&e.onion_skin_img&&e.stopmotion_slug&&!e.is_validating_stopmotion_video&&!(e.show_live_feed&&e.onion_skin_opacity===0)?i("MediaContent",{key:e.show_live_feed?!1:e.onion_skin_img.$path,staticClass:"_onion_skin",class:{"is--onionskin":e.show_live_feed},style:e.show_live_feed?`--onionskin-opacity: ${e.onion_skin_opacity}`:"",attrs:{file:e.onion_skin_img,resolution:1600}}):e._e()],1),e.current_grid_type&&e.enable_video&&!e.media_to_validate?i("div",{staticClass:"_video_grid_overlay"},[i("svg",{attrs:{width:e.actual_camera_resolution.width,height:e.actual_camera_resolution.height,viewBox:`0 0 ${e.actual_camera_resolution.width} ${e.actual_camera_resolution.height}`}},e._l(e.grids[e.current_grid_type],function([a,l,m,o],w){return i("line",{key:w,attrs:{x1:a+"%",y1:l+"%",x2:m+"%",y2:o+"%","vector-effect":"non-scaling-stroke"}})}),0)]):e._e(),i("transition",{attrs:{name:"fade_fast"}},[e.is_recording?e._e():i("div",{staticClass:"_settingsTag"},[!(e.must_validate_media&&e.media_to_validate)&&e.selected_mode!=="audio"?[e.enable_video?i("button",{staticClass:"u-button u-button_small",attrs:{type:"button"},on:{click:function(a){e.show_capture_settings=!e.show_capture_settings}}},[e._v(" "+e._s(e.actual_camera_resolution.width)+" × "+e._s(e.actual_camera_resolution.height)+" ")]):e._e(),e.enable_video&&e.selected_mode!=="audio"?i("select",{directives:[{name:"model",rawName:"v-model",value:e.current_grid_type,expression:"current_grid_type"}],class:{"is--active":e.current_grid_type!==!1},attrs:{size:"small"},on:{change:function(a){var l=Array.prototype.filter.call(a.target.options,function(m){return m.selected}).map(function(m){var o="_value"in m?m._value:m.value;return o});e.current_grid_type=a.target.multiple?l:l[0]}}},[i("option",{domProps:{value:!1}},[e._v(" --"+e._s(e.$t("grid").toLowerCase())+"-- ")]),e._l(Object.keys(e.grids),function(a){return i("option",{key:a,domProps:{value:a}},[e._v(" "+e._s(e.$t(a).toLowerCase())+" ")])})],2):e._e()]:e._e(),i("button",{staticClass:"u-button u-button_small",class:{"is--active":e.has_location_to_add_to_medias},attrs:{type:"button"},on:{click:function(a){e.show_position_modal=!0}}},[i("b-icon",{attrs:{icon:e.has_location_to_add_to_medias?"pin-map-fill":"pin-map"}})],1),e.show_position_modal?i("PickLocationForCaptures",{attrs:{location_to_add_to_medias:e.location_to_add_to_medias},on:{"update:location_to_add_to_medias":function(a){e.location_to_add_to_medias=a},close:function(a){e.show_position_modal=!1}}}):e._e()],2)]),i("transition",{attrs:{name:"enableMode",duration:800}},[e.mode_just_changed&&!e.is_loading_stream?i("div",{staticClass:"_mode_indicator",domProps:{innerHTML:e._s(e.$t(e.selected_mode))}}):e._e()]),i("transition",{attrs:{name:"justCaptured"}},[e.media_to_validate&&e.must_validate_media?i("MediaPreviewBeforeValidation",{attrs:{media_to_validate:e.media_to_validate,audio_output_deviceId:e.audio_output_deviceId}}):e._e()],1),i("transition",{attrs:{name:"fade_fast"}},[e.is_loading_stream?i("LoaderSpinner",{staticClass:"_loader"}):e._e()],1)],1)]),e.stopmotion_slug?i("StopmotionPanel",{attrs:{current_stopmotion_path:`${e.path}/stopmotions/${e.stopmotion_slug}`,stream:e.stream,show_live_feed:e.show_live_feed,is_validating_stopmotion_video:e.is_validating_stopmotion_video,onion_skin_opacity:e.onion_skin_opacity,stopmotion_frame_rate:e.stopmotion_frame_rate},on:{"update:show_live_feed":function(a){e.show_live_feed=a},"update:is_validating_stopmotion_video":function(a){e.is_validating_stopmotion_video=a},"update:onion_skin_opacity":function(a){e.onion_skin_opacity=a},"update:stopmotion_frame_rate":function(a){e.stopmotion_frame_rate=a},insertMedia:a=>e.$emit("insertMedia",a),close:e.closeStopmotionPanel,showPreviousImage:function(a){e.onion_skin_img=a}}}):e._e(),i("transition",{attrs:{name:"slideup",duration:150,mode:"out-in"}},[i("div",{staticClass:"m_captureview--videoPane--bottom"},[i("transition",{attrs:{name:"fade_fast",duration:150}},[e.is_sending_image?i("LoaderSpinner"):e._e()],1),i("transition",{attrs:{name:"slideup",duration:150,mode:"out-in"}},[!(e.media_to_validate.temp_name&&e.must_validate_media)&&!e.is_validating_stopmotion_video?i("div",{staticClass:"m_captureview--videoPane--bottom--buttons",class:{"is--recording":e.is_recording&&!e.video_recording_is_paused,"is--sending_image":e.is_sending_image}},[i("div",[!e.is_recording&&!e.is_making_stopmotion&&!e.is_recording&&!e.delay_event?[i("button",{staticClass:"u-button u-button_red _settingsBtn",class:{"is--active":e.show_capture_settings},attrs:{type:"button",content:e.$t("settings")},on:{click:function(a){e.show_capture_settings=!e.show_capture_settings}}},[i("svg",{staticClass:"inline-svg inline-svg_larger",attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"15 15 140 140","xml:space":"preserve"}},[i("path",{staticStyle:{fill:"currentColor"},attrs:{d:`M122.7,88.8v-10c0-1.1,0.6-2.1,1.6-2.6l9.6-4.9l-2-5.8l-11,1.6c-1.1,0.2-2.2-0.3-2.9-1.2l-6-8.1
                  c-0.7-0.9-0.8-2.1-0.3-3l4.8-9.6l-5.2-3.6l-7.7,7.5c-0.8,0.8-2,1-3.1,0.7l-9.9-3c-1.1-0.3-1.9-1.3-2.1-2.4L86.8,34h-6.4l-1.7,10.4
                  c-0.2,1.1-0.9,2-2,2.4L66.8,50c-1.1,0.3-2.2,0.1-3.1-0.7L55.9,42l-5.1,3.7l4.9,9.4c0.5,1,0.4,2.1-0.2,3l-6,8.2
                  c-0.6,0.9-1.8,1.4-2.9,1.2L35.8,66L34,71.8l9.7,4.8c1,0.5,1.7,1.5,1.7,2.6v10c0,1.1-0.6,2.1-1.6,2.6l-9.6,4.9l2,5.9l10.9-1.6
                  c1.1-0.2,2.2,0.3,2.9,1.2l6,8.1c0.7,0.9,0.8,2.1,0.3,3l-4.8,9.6l5.1,3.6l7.7-7.5c0.8-0.8,2-1,3.1-0.7l9.9,3
                  c1.1,0.3,1.9,1.3,2.1,2.4l1.9,10.4h6.4l1.7-10.4c0.2-1.1,0.9-2,2-2.4l9.9-3.2c1.1-0.3,2.2-0.1,3.1,0.7l7.8,7.3l5.1-3.7l-4.9-9.4
                  c-0.5-1-0.4-2.1,0.2-3l6-8.1c0.7-0.9,1.8-1.4,2.9-1.2l10.8,1.5l1.8-5.9l-9.7-4.8C123.3,90.9,122.7,89.9,122.7,88.8z M84,104.5
                  c-11.7,0-21.1-9.2-21.1-20.5c0-11.3,9.5-20.5,21.1-20.5s21.1,9.2,21.1,20.5C105.1,95.3,95.7,104.5,84,104.5z`}})])]),e.selected_mode!=="audio"?i("button",{staticClass:"u-button u-button_bleumarine _settingsBtn",class:{"is--active":e.show_effects_pane},attrs:{type:"button",content:e.$t("effects")},on:{click:function(a){e.show_effects_pane=!e.show_effects_pane}}},[i("svg",{staticClass:"inline-svg inline-svg_larger",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 168 168"}},[i("path",{staticStyle:{fill:"#fc4b60",stroke:"#fc4b60","stroke-miterlimit":"10","stroke-width":"2.8346456692913384px"},attrs:{d:"M110.3488,72.0093,114.6377,59.36a4.4236,4.4236,0,0,0-1.07-4.59,4.4946,4.4946,0,0,0-4.59-1.0745L96.3334,57.9846,85.62,50a4.5219,4.5219,0,0,0-4.6965-.4029,4.4316,4.4316,0,0,0-2.4409,4.0388l.1714,13.3577L67.7468,74.7049A4.4686,4.4686,0,0,0,68.9974,82.62L79.2565,85.807,38.1043,126.9546a2.3155,2.3155,0,1,0,3.2745,3.2746L82.5311,89.0769l3.1865,10.2638a4.4571,4.4571,0,0,0,3.5664,3.08c.12.0185.579.0556.704.0556a4.4844,4.4844,0,0,0,3.6451-1.88L101.35,89.6883l13.6078.1621a4.6074,4.6074,0,0,0,3.784-2.4316,4.4328,4.4328,0,0,0-.3983-4.6965ZM100.1869,85.0381a2.5322,2.5322,0,0,0-1.9221.9773L90.039,97.6409,85.8149,84.0423a2.3238,2.3238,0,0,0-1.5192-1.5238l-13.8764-4.03,11.8987-8.42a2.3208,2.3208,0,0,0,.9773-1.9221L82.846,53.71l11.6764,8.7168a2.3569,2.3569,0,0,0,2.1259.3381l13.5986-4.8911L105.56,71.6758a2.3135,2.3135,0,0,0,.3428,2.1259l8.8464,11.417Z"}}),i("path",{staticStyle:{fill:"#fc4b60",stroke:"#fc4b60","stroke-miterlimit":"10","stroke-width":"2.8346456692913384px"},attrs:{d:"M58.9467,42.2277h2.3158v2.3158a2.3159,2.3159,0,1,0,4.6317,0V42.2277H68.21a2.3159,2.3159,0,0,0,0-4.6317H65.8942V35.28a2.3159,2.3159,0,0,0-4.6317,0V37.596H58.9467a2.3159,2.3159,0,0,0,0,4.6317Z"}}),i("path",{staticStyle:{fill:"#fc4b60",stroke:"#fc4b60","stroke-miterlimit":"10","stroke-width":"2.8346456692913384px"},attrs:{d:"M49.6834,65.386h2.3158v2.3158a2.3159,2.3159,0,0,0,4.6317,0V65.386h2.3158a2.3159,2.3159,0,0,0,0-4.6317H56.6309V58.4385a2.3159,2.3159,0,0,0-4.6317,0v2.3158H49.6834a2.3159,2.3159,0,0,0,0,4.6317Z"}}),i("path",{staticStyle:{fill:"#fc4b60",stroke:"#fc4b60","stroke-miterlimit":"10","stroke-width":"2.8346456692913384px"},attrs:{d:"M133.0531,102.4392h-2.3158v-2.3158a2.3159,2.3159,0,0,0-4.6317,0v2.3158H123.79a2.3159,2.3159,0,0,0,0,4.6317h2.3158v2.3158a2.3159,2.3159,0,1,0,4.6317,0v-2.3158h2.3158a2.3159,2.3159,0,0,0,0-4.6317Z"}}),i("path",{staticStyle:{fill:"#fc4b60",stroke:"#fc4b60","stroke-miterlimit":"10","stroke-width":"2.8346456692913384px"},attrs:{d:"M109.8949,111.7026H107.579v-2.3159a2.3158,2.3158,0,1,0-4.6316,0v2.3159h-2.3158a2.3158,2.3158,0,1,0,0,4.6316h2.3158V118.65a2.3158,2.3158,0,1,0,4.6316,0v-2.3158h2.3159a2.3158,2.3158,0,0,0,0-4.6316Z"}}),i("path",{staticStyle:{fill:"#fc4b60",stroke:"#fc4b60","stroke-miterlimit":"10","stroke-width":"2.8346456692913384px"},attrs:{d:"M119.1582,46.8594h2.3158v2.3158a2.3158,2.3158,0,1,0,4.6316,0V46.8594h2.3159a2.3159,2.3159,0,0,0,0-4.6317h-2.3159V39.9119a2.3158,2.3158,0,1,0-4.6316,0v2.3158h-2.3158a2.3159,2.3159,0,1,0,0,4.6317Z"}})])]):e._e()]:e._e(),e.selected_mode==="video"&&e.is_recording?i("button",{key:e.selected_mode+"_pause",staticClass:"u-button u-button_orange u-button_inline _captureButton",attrs:{type:"button"},on:{mousedown:function(a){return a.stopPropagation(),a.preventDefault(),e.pauseOrResumeCapture()},touchstart:function(a){return a.stopPropagation(),a.preventDefault(),e.pauseOrResumeCapture()}}},[e.video_recording_is_paused?[i("svg",{staticClass:"inline-svg inline-svg_larger",staticStyle:{"enable-background":"new 0 0 168 168"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 168 168","xml:space":"preserve"}},[i("path",{staticStyle:{fill:"#ffbe32"},attrs:{id:"FOND_3_",d:`M84,0C37.6,0,0,37.6,0,84c0,46.4,37.6,84,84,84c46.4,0,84-37.6,84-84
			C168,37.6,130.4,0,84,0z`}}),i("polygon",{staticStyle:{fill:"#ff3e51"},attrs:{points:"45 40, 130 84.7, 45 128"}})]),e._v("   "),i("span",[e._v(" "+e._s(e.$t("unpause_recording"))+" ")])]:[i("svg",{staticClass:"inline-svg inline-svg_larger",staticStyle:{"enable-background":"new 0 0 168 168"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 168 168","xml:space":"preserve"}},[i("path",{staticStyle:{fill:"#ffbe32"},attrs:{id:"FOND_3_",d:`M84,0C37.6,0,0,37.6,0,84c0,46.4,37.6,84,84,84c46.4,0,84-37.6,84-84
			C168,37.6,130.4,0,84,0z`}}),i("rect",{staticStyle:{fill:"#ff3e51"},attrs:{id:"CENTRE_3_",x:"35",y:"46.7",width:"38",height:"76"}}),i("rect",{staticStyle:{fill:"#ff3e51"},attrs:{id:"CENTRE_3_",x:"93",y:"46.7",width:"38",height:"76"}})]),e._v("   "),i("span",[e._v(" "+e._s(e.$t("pause_recording"))+" ")])]],2):e._e(),e.selected_mode==="stopmotion"&&e.is_making_stopmotion&&!e.timelapse_event?i("button",{key:e.selected_mode+"_pause",staticClass:"u-button u-button_transparent u-button_inline _captureButton",attrs:{type:"button"},on:{mousedown:function(a){return a.stopPropagation(),a.preventDefault(),e.stopStopmotion()},touchstart:function(a){return a.stopPropagation(),a.preventDefault(),e.stopStopmotion()}}},[e._v(" "+e._s(e.$t("back"))+" ")]):e._e()],2),i("div",[i("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[e.is_recording?e.is_recording?i("button",{key:e.selected_mode+e.is_recording,staticClass:"u-button u-button_orange u-button_inline _captureButton",attrs:{type:"button",disabled:e.is_sending_image},on:{mousedown:function(a){return a.stopPropagation(),a.preventDefault(),e.stopRecording()},touchstart:function(a){return a.stopPropagation(),a.preventDefault(),e.stopRecording()}}},[(e.is_sending_image,[i("img",{staticClass:"inline-svg inline-svg_larger",attrs:{src:`${e.$root.publicPath}images/i_stop.svg`}}),e._v("   "),["video","audio"].includes(e.selected_mode)?i("span",[e._v(" "+e._s(e.$t("stop_recording"))+" ")]):e.selected_mode==="stopmotion"?i("span",[e.timelapse_mode_enabled?[e._v(" "+e._s(e.$t("stop_timelapse"))+" ")]:e._e()],2):i("span",[e._v(" "+e._s(e.$t("stop"))+" ")])])],2):e._e():i("button",{key:e.selected_mode+e.is_recording,staticClass:"u-button u-button_orange _captureButton",class:{"is--active":e.capture_button_pressed},attrs:{type:"button",disabled:e.is_sending_image},on:{mousedown:function(a){return a.stopPropagation(),a.preventDefault(),e.setCaptureInit()},touchstart:function(a){return a.stopPropagation(),a.preventDefault(),e.setCaptureInit()}}},[e.delay_event?i("span",[e._v(" "+e._s(e.$t("cancel"))+" ")]):[i("img",{staticClass:"inline-svg inline-svg_larger",attrs:{src:e.$root.publicPath+"images/i_record.svg"}}),e._v("   "),["photo","vecto","lines"].includes(e.selected_mode)?i("span",{domProps:{innerHTML:e._s(e.$t("take_picture"))}}):e.selected_mode==="video"?i("span",{domProps:{innerHTML:e._s(e.$t("record_video"))}}):e.selected_mode==="audio"?i("span",{domProps:{innerHTML:e._s(e.$t("record_audio"))}}):e.selected_mode==="stopmotion"?i("span",{domProps:{innerHTML:e._s(e.timelapse_mode_enabled?e.$t("start_timelapse"):e.$t("take_picture"))}}):e._e()]],2)]),i("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[e.selected_mode==="stopmotion"&&!e.timelapse_event&&!e.delay_event?i("button",{staticClass:"_enable_timelapse_button",class:{"is--active":e.timelapse_mode_enabled},attrs:{type:"button",content:e.$t("timelapse")},on:{click:function(a){e.timelapse_mode_enabled=!e.timelapse_mode_enabled}}},[i("svg",{staticClass:"inline-svg margin-right-verysmall",staticStyle:{"enable-background":"new 0 0 81 81"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"81px",height:"81px",viewBox:"0 0 81 81","xml:space":"preserve"}},[i("path",{attrs:{d:`M69.6,20.8c-0.9,0.6-1.7,1.1-2.6,1.7c-6-8.8-15.9-14-26.5-14c-17.6,0-32,14.4-32,32s14.4,32,32,32
                  c3.1,0,6.2-0.4,9.1-1.3l-1.7-5.8c-2.4,0.7-4.9,1.1-7.4,1.1c-14.3,0-26-11.7-26-26s11.7-26,26-26c8.6,0,16.6,4.2,21.5,11.4
                  c-0.8,0.5-1.6,1.1-2.4,1.6c-0.7,0.4-0.9,1.1-0.8,1.7c0,0.7,0.4,1.4,1.2,1.6c0.2,0.1,0.3,0.1,0.5,0.1c2.7,0.5,5.3,1.1,8,1.6
                  c1,0.2,2-0.4,2.3-1.4c0.6-2.8,1.1-5.5,1.7-8.3C72.8,21.3,71,19.9,69.6,20.8z`}}),i("path",{attrs:{d:`M23,49.4c-1.3,0-2.4-0.8-2.9-2.1c-0.5-1.6,0.4-3.3,1.9-3.8L39,38.3V27.2c0-1.7,1.3-3,3-3s3,1.3,3,3v13.3
                  c0,1.3-0.8,2.5-2.1,2.9l-19,5.9C23.6,49.4,23.3,49.4,23,49.4z`}})])]):e._e()]),i("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[!e.is_recording&&!e.delay_event?i("button",{staticClass:"_enable_timelapse_button",class:{"is--active":e.delay_mode_enabled},attrs:{type:"button",content:e.$t("delay")},on:{click:function(a){e.delay_mode_enabled=!e.delay_mode_enabled}}},[i("svg",{staticClass:"inline-svg margin-right-verysmall",staticStyle:{"enable-background":"new 0 0 81 81"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"81px",height:"81px",viewBox:"0 0 81 81","xml:space":"preserve"}},[i("path",{attrs:{d:`M40.5,72.3c-15,0-27.1-12.2-27.1-27.1c0-15,12.2-27.1,27.1-27.1s27.1,12.2,27.1,27.1C67.6,60.2,55.5,72.3,40.5,72.3z
	 M40.5,23.7C28.7,23.7,19,33.4,19,45.2s9.6,21.5,21.5,21.5S62,57,62,45.2S52.3,23.7,40.5,23.7z`}}),i("path",{attrs:{d:"M40.5,48c-1.6,0-2.8-1.3-2.8-2.8l0-16.8c0-1.6,1.3-2.8,2.8-2.8s2.8,1.3,2.8,2.8l0,16.8C43.3,46.8,42.1,48,40.5,48z"}}),i("rect",{attrs:{x:"32.1",y:"10.7",width:"16.8",height:"5.7"}}),i("rect",{attrs:{x:"57.9",y:"22.4",transform:"matrix(0.7069 -0.7073 0.7073 0.7069 2.864400e-02 50.6141)",width:"6.3",height:"5.7"}})])]):e._e()])],1),i("div",[e.selected_mode==="video"?i("div",{staticClass:"_videoEq"},[e.enable_audio_recording_in_video?i("div",{staticClass:"_tiny_equalizer"},[i("AudioEqualizer",{attrs:{stream:e.stream,is_recording:e.is_recording,type:"Tiny"}})],1):e._e(),e.is_recording?e._e():i("span",{staticClass:"u-switch u-switch-xs"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.enable_audio_recording_in_video,expression:"enable_audio_recording_in_video"}],staticClass:"switch",attrs:{id:"recordVideoWithAudio",type:"checkbox",disabled:e.is_recording},domProps:{checked:Array.isArray(e.enable_audio_recording_in_video)?e._i(e.enable_audio_recording_in_video,null)>-1:e.enable_audio_recording_in_video},on:{change:function(a){var l=e.enable_audio_recording_in_video,m=a.target,o=!!m.checked;if(Array.isArray(l)){var w=null,b=e._i(l,w);m.checked?b<0&&(e.enable_audio_recording_in_video=l.concat([w])):b>-1&&(e.enable_audio_recording_in_video=l.slice(0,b).concat(l.slice(b+1)))}else e.enable_audio_recording_in_video=o}}}),i("label",{staticClass:"u-label",attrs:{for:"recordVideoWithAudio"}},[e._v(e._s(e.$t("with_sound")))])])]):e._e(),e.selected_mode==="stopmotion"?[e.is_making_stopmotion?i("div",{staticClass:"_stopmotionValidation"},[i("div",{staticClass:"_stopmotionValidation--fpscounter"},[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("img_per_second")))]),i("select",{directives:[{name:"model",rawName:"v-model.number",value:e.stopmotion_frame_rate,expression:"stopmotion_frame_rate",modifiers:{number:!0}}],attrs:{size:"small"},on:{change:function(a){var l=Array.prototype.filter.call(a.target.options,function(m){return m.selected}).map(function(m){var o="_value"in m?m._value:m.value;return e._n(o)});e.stopmotion_frame_rate=a.target.multiple?l:l[0]}}},[i("option",[e._v("2")]),i("option",[e._v("4")]),i("option",[e._v("8")]),i("option",[e._v("15")]),i("option",[e._v("24")]),i("option",[e._v("30")])])]),i("div",{},[i("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:e.testStopmotion}},[i("img",{attrs:{src:`${e.$root.publicPath}images/i_play.svg`,width:"48",height:"48",draggable:"false"}}),e._v(" "+e._s(e.$t("assemble"))+" ")])])]):i("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(a){e.show_stopmotion_list=!e.show_stopmotion_list}}},[i("span",{},[e._v(e._s(e.$t("stopmotion_list")))])])]:e._e(),e.selected_mode==="vecto"?i("div",{staticClass:"_mode_accessory_range"},[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("number_of_colors"))+" = "+e._s(e.vecto_number_of_colors))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.vecto_number_of_colors,expression:"vecto_number_of_colors",modifiers:{number:!0}}],attrs:{type:"range",min:"2",max:"7",step:"1"},domProps:{value:e.vecto_number_of_colors},on:{__r:function(a){e.vecto_number_of_colors=e._n(a.target.value)},blur:function(a){return e.$forceUpdate()}}})]):e._e(),e.selected_mode==="lines"?i("button",{staticClass:"u-buttonLink",class:{"is--active":e.show_lines_settings},attrs:{type:"button"},on:{click:function(a){e.show_lines_settings=!e.show_lines_settings}}},[e._v(" "+e._s(e.$t("advanced_options"))+" ")]):e._e(),e.show_lines_settings?[e.selected_mode==="lines"?i("div",{staticClass:"_mode_accessory_range"},[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("lines_angle"))+" = "+e._s(e.lines_angle))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.lines_angle,expression:"lines_angle",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"359",step:"1"},domProps:{value:e.lines_angle},on:{__r:function(a){e.lines_angle=e._n(a.target.value)},blur:function(a){return e.$forceUpdate()}}})]):e._e(),e.selected_mode==="lines"?i("div",{staticClass:"_mode_accessory_range"},[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("brightness"))+" = "+e._s(e.lines_brightness))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.lines_brightness,expression:"lines_brightness",modifiers:{number:!0}}],staticClass:"margin-none",attrs:{type:"range",min:".1",max:"5",step:".1"},domProps:{value:e.lines_brightness},on:{__r:function(a){e.lines_brightness=e._n(a.target.value)},blur:function(a){return e.$forceUpdate()}}})]):e._e(),e.selected_mode==="lines"?i("div",{staticClass:"_mode_accessory_range"},[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("contrast"))+" = "+e._s(e.lines_contrast))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.lines_contrast,expression:"lines_contrast",modifiers:{number:!0}}],staticClass:"margin-none",attrs:{type:"range",min:".1",max:"5",step:".1"},domProps:{value:e.lines_contrast},on:{__r:function(a){e.lines_contrast=e._n(a.target.value)},blur:function(a){return e.$forceUpdate()}}})]):e._e(),e.selected_mode==="lines"?i("div",{staticClass:"_mode_accessory_range"},[i("label",{staticClass:"u-label"},[e._v(e._s(e.$t("lines_density"))+" = "+e._s(e.lines_density))]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.lines_density,expression:"lines_density",modifiers:{number:!0}}],staticClass:"margin-none",attrs:{type:"range",min:"0.2",max:"0.3",step:".01"},domProps:{value:e.lines_density},on:{__r:function(a){e.lines_density=e._n(a.target.value)},blur:function(a){return e.$forceUpdate()}}})]):e._e()]:e._e()],2)]):e.media_to_validate&&e.must_validate_media?i("div",{key:"validation"},[i("MediaValidationButtons",{attrs:{media_is_being_sent:e.media_is_being_sent,media_being_sent_percent:e.media_being_sent_percent,can_add_to_fav:!0},on:{cancel:function(a){return e.cancelValidation()},save:function(a){return e.sendMedia()},save_and_fav:function(a){return e.sendMedia({fav:!0})}}}),i("div",{staticClass:"_download_media_without_validation"},[i("small",[i("a",{ref:"",attrs:{href:e.validated_media_href_blob,download:e.media_to_validate.temp_name,target:"_blank"}},[e._v(" "+e._s(e.$t("or_download_media_on_device"))+" "),e.media_to_validate.rawData?[e._v(" — "+e._s(e.formatBytes(e.media_to_validate.rawData.size))+" ")]:e._e()],2)])])],1):e._e()])],1)])],1),e.show_stopmotion_list&&!e.is_making_stopmotion?i("StopmotionList",{attrs:{project_path:e.path},on:{loadStopmotion:e.loadStopmotion}}):e._e()],1)},Ki=[],Xi=he(zi,qi,Ki,!1,null,"fe8769c0");const Yi=Xi.exports;export{Yi as default};
