import{M as r}from"./ModuleCreator-DHhY8Geu.js";import{n}from"../build.js";import{E as m}from"./ExportSaveMakeModal2-BfrtYTmN.js";import"./MediaPicker-CZryquB9.js";import"./PublicationTopbar-WR8htxPc.js";const l={props:{index:Number,makemodule:Object,number_of_modules:Number,imposed_ratio:Number,module_position:String},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{first_media(){return this.firstMedia(this.makemodule)}},methods:{async removeModule(){await this.$api.deleteItem({path:this.makemodule.$path}).catch(o=>{throw this.$alertify.delay(4e3).error(o),o}),this.$emit("remove",this.makemodule.$path)}}};var _=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stopmotionModule"},[e("div",{staticClass:"_mediaContainer",style:{"--aspectRatio":t.imposed_ratio}},[e("MediaContent",{attrs:{file:t.first_media,resolution:440}})],1),e("div",{staticClass:"_bottomBar"},[e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button",disabled:t.module_position==="alone"||t.module_position==="first"},on:{click:function(i){return t.$emit("moveUp")}}},[e("b-icon",{attrs:{icon:"chevron-left"}})],1),e("select",{attrs:{size:"small"},domProps:{value:t.index+1},on:{change:function(i){return t.$emit("moveTo",{path:t.makemodule.$path,new_position:+i.target.value-1})}}},t._l(t.number_of_modules,function(i){return e("option",{key:i,domProps:{value:i}},[t._v(" "+t._s(i)+" ")])}),0),e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button",disabled:t.module_position==="alone"||t.module_position==="last"},on:{click:function(i){return t.$emit("moveDown")}}},[e("b-icon",{attrs:{icon:"chevron-right"}})],1),e("div",{staticClass:"_options"},[e("RemoveMenu",{attrs:{path:t.makemodule.$path,modal_title:t.$t("remove_this_image"),show_button_text:!1},on:{remove:t.removeModule},scopedSlots:t._u([{key:"content",fn:function(){return[e("MediaContent",{attrs:{file:t.first_media,resolution:440}})]},proxy:!0}])})],1)])])},u=[],d=n(l,_,u,!1,null,"9dde0619");const c=d.exports,p={props:{make:Object},components:{ModuleCreator:r,StopmotionModule:c,ExportSaveMakeModal2:m},data(){return{show_render_modal:!1,is_exporting:!1,created_video:!1,export_href:void 0,frame_rate:this.make.frame_rate||4,custom_resolution_width:1920,custom_resolution_height:1080,resolution_preset_picked:"original"}},async created(){(!this.sections||this.sections.length===0)&&await this.createSection2({publication:this.make,additional_meta:{section_title:"stopmotion"}})},mounted(){},beforeDestroy(){},watch:{first_media:{handler(){var e;if(!((e=this.first_media)!=null&&e.$infos))return;const{width:o,height:t}=this.first_media.$infos;o&&t&&(this.custom_resolution_width=o,this.custom_resolution_height=t)},immediate:!0},"make.frame_rate":{handler(){this.frame_rate=this.make.frame_rate},immediate:!0}},computed:{possible_formats(){return[{key:"mp4",text:this.$t("video_mp4")},{key:"gif",text:this.$t("video_gif")}]},export_is_available(){return this.section_modules_list.length>1},sections(){return this.getSectionsWithProps({publication:this.make,group:"sections_list"})},first_section(){return this.sections.at(0)},first_media(){if(this.section_modules_list.length>0){const o=this.section_modules_list.at(0);return this.firstMedia(o)}},section_modules_list(){return this.getModulesForSection({publication:this.make,section:this.first_section}).map(({_module:o})=>o)},first_media_ratio(){var o,t;return((t=(o=this.first_media)==null?void 0:o.$infos)==null?void 0:t.ratio)||void 0},base_instructions(){const o="stopmotion_animation",t=this.section_modules_list.reduce((e,i)=>{var a;const s=(a=i.source_medias[0])==null?void 0:a.meta_filename_in_project;return s&&e.push({m:s,d:1}),e},[]);return{recipe:o,images_meta:t,frame_rate:this.frame_rate}}},methods:{async addModules({meta_filenames:o}){await this.insertModuleMetaFilenamesToList2({publication:this.make,section:this.first_section,meta_filenames:o})},async insertModules({meta_filenames:o,index:t}){await this.insertModuleMetaFilenamesToList2({publication:this.make,section:this.first_section,index:t,meta_filenames:o})},async moveModuleTo({path:o,new_position:t}){await this.moveModuleTo2({publication:this.make,section:this.first_section,meta_filename:this.getFilename(o),new_position:t})},async removeModule(o){await this.removeModule2({publication:this.make,section:this.first_section,path:o})},updateFrameRate(o){this.$api.updateMeta({path:this.make.$path,new_meta:{frame_rate:o}})}}};var h=function(){var t=this,e=t._self._c;return e("div",[e("transition-group",{staticClass:"_listOfModules",attrs:{tag:"div",name:"StoryModules",appear:""}},[t._l(t.section_modules_list,function(i,s){return e("div",{key:i.$path},[e("StopmotionModule",{attrs:{index:s,makemodule:i,number_of_modules:t.section_modules_list.length,imposed_ratio:t.first_media_ratio,module_position:t.section_modules_list.length===1?"alone":s===0?"first":s===t.section_modules_list.length-1?"last":"inbetween"},on:{moveTo:t.moveModuleTo,moveUp:function(a){return t.moveModuleTo({path:i.$path,new_position:s-1})},moveDown:function(a){return t.moveModuleTo({path:i.$path,new_position:s+1})},remove:t.removeModule}})],1)}),e("ModuleCreator",{key:"mc_0",attrs:{publication_path:t.make.$path,start_collapsed:!1,types_available:["capture","import"],pick_from_types:["image"],context:"montage"},on:{addModules:t.addModules}})],2),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.section_modules_list.length>0?e("div",{staticClass:"_bottomRow"},[e("div",{staticClass:"_equationIcon"},[e("b-icon",{attrs:{icon:"chevron-double-down"}})],1),e("div",[e("div",{staticClass:"_create"},[e("div",{staticClass:"_fpsPick"},[e("RangeValueInput",{attrs:{can_toggle:!1,label:t.$t("img_per_second"),value:t.frame_rate,min:2,max:30,step:1,ticks:[2,4,8,15,24,30],default_value:4},on:{save:t.updateFrameRate}})],1),e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button",disabled:!t.export_is_available},on:{click:function(i){t.show_render_modal=!0}}},[e("b-icon",{attrs:{icon:"check"}}),t._v(" "+t._s(t.$t("make"))+" ")],1)])])]):t._e()]),t.show_render_modal?e("ExportSaveMakeModal2",{attrs:{base_instructions:t.base_instructions,make_path:t.make.$path,reference_media:t.first_media,possible_formats:t.possible_formats,default_resolution_preset:"high"},on:{close:function(i){t.show_render_modal=!1}}}):t._e()],1)},f=[],v=n(p,h,f,!1,null,"9fa22958");const w=v.exports;export{w as default};
