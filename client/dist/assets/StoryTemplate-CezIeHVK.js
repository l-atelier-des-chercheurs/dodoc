import{M as n}from"./ModuleCreator-BpPhIBwJ.js";import{P as l}from"./PublicationModule-BNkmMrZP.js";import{n as r}from"../build.js";import"./MediaPicker-BkCMiT_E.js";import"./CaptionCreditsPage-B7Fq5xCj.js";const u={props:{publication:Object,can_edit:Boolean},components:{ModuleCreator:n,PublicationModule:l},data(){return{medias:[],fetch_publication_error:null}},created(){},async mounted(){},beforeDestroy(){},watch:{},computed:{story_styles(){const i=(this.publication.story_width||800)+"px";return this.publication.story_is_not_responsive===!0?{width:i,maxWidth:"none"}:{maxWidth:i}},modules_list(){return this.publication.modules_list&&Array.isArray(this.publication.modules_list)?this.publication.modules_list.reduce((t,e)=>(this.findModuleFromMetaFilename({files:this.publication.$files,meta_filename:e})&&t.push(e),t),[]):[]}},methods:{async appendModuleMetaFilenameToList({meta_filenames:i}){const t=i.at(-1),e=this.modules_list.slice();e.push(t),await this.updateMeta({new_meta:{modules_list:e}}),this.toggleNewModuleEdit({meta_filename:t})},async insertModuleMetaFilenamesToList({meta_filenames:i,index:t}){const e=i.at(-1),s=this.modules_list.slice();s.splice(t,0,e),await this.updateMeta({new_meta:{modules_list:s}}),this.toggleNewModuleEdit({meta_filename:e})},async updatePubliMeta(i){return await this.$api.updateMeta({path:this.publication.$path,new_meta:i})},async updateMeta({new_meta:i}){this.fetch_status="pending",this.fetch_error=null;try{this.response=await this.$api.updateMeta({path:this.publication.$path,new_meta:i}),this.fetch_status="success"}catch(t){this.fetch_status="error",this.fetch_error=t.response.data}},async moveTo({meta_filename:i,dir:t}){let e=this.modules_list.slice();const s=e.findIndex(o=>o===i);if(s+t<0)return!1;if(s+t>e.length-1)return!1;e.move(s,s+t),this.response=await this.updatePubliMeta({modules_list:e})},async duplicatePublicationMedia({source_meta_filename:i,copy_meta_filename:t}){let e=this.modules_list.slice();const s=e.findIndex(o=>o===i);e.splice(s+1,0,t),this.response=await this.updatePubliMeta({modules_list:e})},async removeModuleFromList(i){let t=this.modules_list.slice();t=t.filter(e=>e!==i),this.response=await this.updatePubliMeta({modules_list:t})},toggleNewModuleEdit({meta_filename:i}){setTimeout(()=>{console.log(`emit module.enable_edit.${i}`),this.$eventHub.$emit(`module.enable_edit.${i}`)},50)}}};var d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_storyTemplate"},[t.can_edit?e("div",{staticClass:"_settings"},[e("details",[e("summary",[t._v(t._s(t.$t("settings")))]),e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("story_width"),value:t.publication.story_width,min:0,max:2400,step:1,ticks:[320,480,800,1200,2400],default_value:800,suffix:"px"},on:{save:function(s){return t.updatePubliMeta({story_width:s})}}}),e("ToggleInput",{attrs:{content:t.publication.story_is_not_responsive!==!0,label:t.$t("responsive"),options:{true:t.$t("responsive_instr"),false:t.$t("not_responsive_instr")}},on:{"update:content":function(s){return t.updatePubliMeta({story_is_not_responsive:!s})}}})],1)]):t._e(),e("div",{staticClass:"_storyContainer"},[e("div",{staticClass:"_storyContent",style:t.story_styles},[e("transition-group",{attrs:{tag:"div",name:"StoryModules",appear:"",duration:700}},[t._l(t.modules_list,function(s,o){return[e("PublicationModule",{key:s,staticClass:"_mediaPublication",attrs:{publimodule:t.findModuleFromMetaFilename({files:t.publication.$files,meta_filename:s}),module_position:t.modules_list.length===1?"alone":o===0?"first":o===t.modules_list.length-1?"last":"inbetween",can_edit:t.can_edit},on:{resize:function(a){return t.resize({meta_filename:s,new_size:a})},moveUp:function(a){return t.moveTo({meta_filename:s,dir:-1})},moveDown:function(a){return t.moveTo({meta_filename:s,dir:1})},duplicate:function(a){return t.duplicatePublicationMedia({source_meta_filename:s,copy_meta_filename:a})},remove:function(a){return t.removeModuleFromList(s)}}}),e("div",{key:"mc_"+o,staticClass:"_spacer"},[t.can_edit?e("ModuleCreator",{attrs:{publication_path:t.publication.$path,types_available:["capture","import","write","embed","table"]},on:{addModules:({meta_filenames:a})=>t.insertModuleMetaFilenamesToList({meta_filenames:a,index:o+1})}}):t._e()],1)]})],2)],1)]),t.can_edit&&(!t.modules_list||t.modules_list.length===0)?e("ModuleCreator",{attrs:{publication_path:t.publication.$path,types_available:["capture","import","write","embed","table"]},on:{addModules:t.appendModuleMetaFilenameToList}}):t._e()],1)},c=[],p=r(u,d,c,!1,null,"d901a20d");const M=p.exports;export{M as default};
