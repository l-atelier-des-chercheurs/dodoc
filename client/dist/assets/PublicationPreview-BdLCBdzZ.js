import{n as o}from"../build.js";const r={props:{publication:Object,template_options:Array,can_edit:Boolean},components:{},data(){return{is_making_preview:!1,preview_progress:0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{cover_thumb(){return this.makeRelativeURLFromThumbs({$thumbs:this.publication.$cover,$type:"image",$path:this.publication.$path,resolution:640})},template_icon(){const i=this.template_options.find(t=>t.key===this.publication.template);return i?i.icon:!1}},methods:{async removePublication(){await this.$api.deleteItem({path:this.publication.$path})},async generatePreview(){this.is_making_preview=!0;const i={recipe:"png",page:1,page_width:this.publication.page_width,page_height:this.publication.page_height,layout_mode:this.publication.layout_mode||"print",make_preview:!0},t=await this.$api.generatePreviewForPublication({path:this.publication.$path,instructions:i});this.$api.join({room:"task_"+t});const e=({task_id:a,progress:n})=>{a===t&&(this.preview_progress=+n)};this.$eventHub.$on("task.status",e);const s=({task_id:a})=>{a===t&&(this.preview_progress=100,setTimeout(()=>{this.is_making_preview=!1,this.preview_progress=0},2e3),this.$eventHub.$off("task.ended",s),this.$eventHub.$off("task.status",e),this.$api.leave({room:"task_"+t}))};this.$eventHub.$on("task.ended",s)}}};var p=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_publicationPreview"},[e("div",{staticClass:"_publicationPreview--cover"},[t.cover_thumb?[e("img",{attrs:{src:t.cover_thumb}}),(t.template_icon,t._e())]:[e("div",{staticClass:"_noPreview"},[t.template_icon?e("span",{domProps:{innerHTML:t._s(t.template_icon)}}):t._e()])],e("transition",{attrs:{name:"toggleLock",mode:"out-in"}},[t.publication.$status==="finished"||t.publication.$status==="private"?e("StatusTag",{key:t.publication.$status,staticClass:"_icon",attrs:{show_label:!1,status:t.publication.$status,can_edit:!1,mode:"inactive"}}):t._e()],1),e("transition",{attrs:{name:"fade_fast"}},[t.is_making_preview?e("div",{staticClass:"_previewProgress"},[e("AnimatedCounter",{attrs:{value:t.preview_progress}})],1):t._e()]),e("div",{staticClass:"_generatePreviewBtn"},[t.can_edit&&!t.is_making_preview?e("EditBtn",{attrs:{btn_type:"regenerate_thumbs",style_type:"black",label_position:"left"},on:{click:t.generatePreview}}):t._e()],1)],2),e("header",{staticClass:"_header",on:{click:function(s){return t.$emit("open")}}},[t.publication.template?e("small",{domProps:{innerHTML:t._s(t.$t(t.publication.template))}}):t._e(),e("h3",[t._v(" "+t._s(t.publication.title)+" ")])]),e("button",{staticClass:"js--showCursor _openPublication",attrs:{type:"button",title:t.$t("open")+" "+t.publication.title},on:{click:function(s){return t.$emit("open")}}})])},c=[],_=o(r,p,c,!1,null,"b9d3022c");const u=_.exports;export{u as P};
