import{S as o}from"./SingleBaseMediaPicker--PcxP4Ot.js";import{E as d}from"./ExportSaveMakeModal2-D-Qit5Bf.js";import s from"./CaptureView-1d9PVlJV.js";import{n}from"../build.js";import"./PublicationTopbar-ClzGLCPm.js";const _={props:{make:Object},components:{SingleBaseMediaPicker:o,ExportSaveMakeModal2:d,CaptureView:s},data(){return{show_render_modal:!1,is_exporting:!1,created_video:!1,export_href:void 0,record_audio_live:!1,stop_recording_with_video:!0}},created(){},mounted(){this.$eventHub.$on("capture.isRecording",this.onRecording),this.$eventHub.$on("capture.isRecordingStopped",this.onRecordingStopped)},beforeDestroy(){this.$eventHub.$off("capture.isRecording",this.onRecording),this.$eventHub.$off("capture.isRecordingStopped",this.onRecordingStopped)},watch:{},computed:{project_path(){let{space_slug:i,project_slug:e}=this.decomposePath(this.make.$path);return this.createPath({space_slug:i,project_slug:e})},export_is_available(){return this.make.type==="mix_audio_and_image"?this.make.base_audio_filename&&this.make.base_image_filename:this.make.type==="mix_audio_and_video"?this.make.base_audio_filename&&this.make.base_video_filename:!1},selected_audio_media(){return this.getMediaFromFilename(this.make.base_audio_filename)},selected_video_media(){return this.getMediaFromFilename(this.make.base_video_filename)},selected_image_media(){return this.getMediaFromFilename(this.make.base_image_filename)},reference_media(){if(this.make.type==="mix_audio_and_image")return this.selected_image_media;if(this.make.type==="mix_audio_and_video")return this.selected_video_media},base_instructions(){var e,t;let i={recipe:this.make.type,suggested_file_name:this.make.type};return this.selected_audio_media&&(i.base_audio_path=this.makeMediaFilePath({$path:this.selected_audio_media.$path,$media_filename:this.selected_audio_media.$media_filename})),this.selected_image_media&&(i.base_image_path=this.makeMediaFilePath({$path:this.selected_image_media.$path,$media_filename:this.selected_image_media.$media_filename})),this.selected_video_media&&(i.base_video_path=this.makeMediaFilePath({$path:this.selected_video_media.$path,$media_filename:this.selected_video_media.$media_filename})),this.make.type==="mix_audio_and_video"&&this.selected_video_media&&this.selected_audio_media&&(i.duration=this.getMaxDuration((e=this.selected_video_media.$infos)==null?void 0:e.duration,(t=this.selected_audio_media.$infos)==null?void 0:t.duration)),i}},methods:{async setAudioMetaFilename(i){const e={base_audio_filename:i};await this.$api.updateMeta({path:this.make.$path,new_meta:e}),this.record_audio_live=!1},getMediaFromFilename(i){if(i)return this.getSourceMedia({source_media:{meta_filename_in_project:i},folder_path:this.make.$path})},getMaxDuration(){return Array.prototype.slice.call(arguments).reduce((i,e)=>(typeof e=="number"&&e>i&&(i=e),i),0)},onRecording(i){i==="audio"&&this.rewindAndPlayVideo()},videoWasPaused(){this.stop_recording_with_video&&this.$eventHub.$emit("capture.stopRecording")},videoWasEnded(){this.stop_recording_with_video&&this.$eventHub.$emit("capture.stopRecording")},onRecordingStopped(){this.pauseVideo()},playBoth(){this.rewindAndPlayVideo(),this.rewindAndPlayAudio()},rewindAndPlayAudio(){var e;const i=(e=this.$refs.audioMedia)==null?void 0:e.player;i&&(i.currentTime=0,i.muted=!1,i.volume=1,i.play())},rewindAndPlayVideo(){const i=this.$el.querySelector("._videoOrImage video");i&&(i.currentTime=0,i.muted=!0,i.play())},pauseVideo(){const i=this.$el.querySelector("._videoOrImage video");i&&i.pause()}}};var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_mixAudioAndImage"},[t("div",{staticClass:"_topRow"},[t("div",{staticClass:"_videoOrImage"},[e.make.type==="mix_audio_and_image"?t("SingleBaseMediaPicker",{attrs:{title:e.$t("pick_image"),context:"full",field_name:"base_image_filename",content:e.make.base_image_filename,path:e.make.$path,media_type_to_pick:"image"}}):e.make.type==="mix_audio_and_video"?t("SingleBaseMediaPicker",{attrs:{title:e.$t("pick_video"),context:"full",field_name:"base_video_filename",content:e.make.base_video_filename,path:e.make.$path,media_type_to_pick:"video"},on:{videoPaused:e.videoWasPaused,videoEnded:e.videoWasEnded}}):e._e()],1),t("div",{staticClass:"_equationIcon"},[t("b-icon",{attrs:{icon:"plus-circle-dotted"}})],1),t("div",{staticClass:"_audioMedia"},[e.make.base_audio_filename?[e.selected_audio_media?t("MediaContent",{ref:"audioMedia",attrs:{file:e.selected_audio_media,resolution:440,context:"full"}}):t("span",[e._v(" "+e._s(e.$t("media_not_found"))+" ")]),t("button",{staticClass:"u-button u-button_small u-button_red",attrs:{type:"button"},on:{click:function(a){return e.setAudioMetaFilename("")}}},[t("b-icon",{attrs:{icon:"arrow-left-right"}}),e._v(" "+e._s(e.$t("change"))+" ")],1)]:[e.record_audio_live?t("div",{staticClass:"_recordAudioLive"},[t("button",{staticClass:"u-button u-button_red u-button_small",attrs:{type:"button"},on:{click:function(a){e.record_audio_live=!1}}},[t("b-icon",{attrs:{icon:"x-circle"}}),e._v(" "+e._s(e.$t("cancel"))+" ")],1),t("div",{staticClass:"_captureView"},[t("CaptureView",{attrs:{path:e.project_path,selected_mode:"audio",available_modes:[],must_validate_media:!1,origin:"make"},on:{insertMedia:a=>e.setAudioMetaFilename(a)}})],1),e.make.type==="mix_audio_and_video"?t("ToggleInput",{attrs:{label:e.$t("stop_recording_with_video"),content:e.stop_recording_with_video},on:{"update:content":function(a){e.stop_recording_with_video=a}}}):e._e()],1):[t("SingleBaseMediaPicker",{attrs:{title:e.$t("pick_audio"),context:"full",field_name:"base_audio_filename",content:e.make.base_audio_filename,path:e.make.$path,media_type_to_pick:"audio"}}),e._v(" "+e._s(e.$t("or"))+" "),t("div",{staticClass:"_liveDubbingBtn"},[t("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:function(a){e.record_audio_live=!0}}},[t("b-icon",{attrs:{icon:"record-circle-fill"}}),e._v(" "+e._s(e.$t("live_dubbing"))+" ")],1)])]]],2)]),t("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e.export_is_available?t("div",{staticClass:"_bottomRow"},[t("div",{staticClass:"_equationIcon"},[t("b-icon",{attrs:{icon:"chevron-double-down"}})],1),t("div",{staticClass:"_exportPlayButtons"},[e.make.type==="mix_audio_and_video"?t("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:e.playBoth}},[t("b-icon",{attrs:{icon:"play-circle-fill"}}),e._v(" "+e._s(e.$t("play_both"))+" ")],1):e._e(),t("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(a){e.show_render_modal=!0}}},[t("b-icon",{attrs:{icon:"check"}}),e._v(" "+e._s(e.$t("create"))+" ")],1)])]):e._e()]),e.show_render_modal?t("ExportSaveMakeModal2",{attrs:{base_instructions:e.base_instructions,make_path:e.make.$path,reference_media:e.reference_media},on:{close:function(a){e.show_render_modal=!1}}}):e._e()],1)},u=[],c=n(_,r,u,!1,null,"c935dfed");const v=c.exports;export{v as default};
