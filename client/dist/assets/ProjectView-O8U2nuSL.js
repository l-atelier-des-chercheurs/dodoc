import{P as l,a as c}from"./ProjectPresentation-BDKDqB0P.js";import{n,S as p,a as _,H as h,_ as o,M as d}from"../build.js";import{S as u,s as m,p as f}from"./SingleBaseMediaPicker-C6eWf6Eb.js";import{P as v}from"./PublicationTopbar-WR8htxPc.js";const g={props:{panes:Array,project:Object,can_edit:Boolean},components:{SlickItem:p,SlickList:_},directives:{handle:h},data(){return{show_panelist:!1,is_stickied_to_top:!1,project_panes:[],possible_project_panes:[{type:"capture"},{type:"collect"},{type:"make"},{type:"publish"}],animate_pane:!1,animate_pane_timeout:null}},created(){},mounted(){this.$eventHub.$on("pane.animate",this.animatePane),this.$eventHub.$on("pane.replacePane",this.replacePane),document.addEventListener("scroll",this.detectTopOfWindow)},beforeDestroy(){this.$eventHub.$off("pane.animate",this.animatePane),this.$eventHub.$off("pane.replacePane",this.replacePane),document.removeEventListener("scroll",this.detectTopOfWindow)},watch:{panes:{handler(){this.project_panes=this.panes.slice()},deep:!0,immediate:!0},project_panes:{handler(){if(JSON.stringify(this.project_panes)===JSON.stringify(this.panes))return!1;this.project_panes=this.project_panes.map(s=>(s.size===0&&(s.size=20),s)),this.$emit("update:panes",this.project_panes)},deep:!0}},computed:{cover_thumb(){return this.makeRelativeURLFromThumbs({$thumbs:this.project.$cover,$type:"image",$path:this.project.$path,resolution:50})}},methods:{detectTopOfWindow(){this.$el.getBoundingClientRect().y<=10?this.is_stickied_to_top=!0:this.is_stickied_to_top=!1},scrollToTop(){document.body.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},removePane(s){this.project_panes=this.project_panes.filter(t=>t.type!==s)},paneIsEnabled(s){return this.project_panes.some(t=>t.type===s)},replacePane(s){this.project_panes=[],this.addPane(s)},togglePane(s){this.paneIsEnabled(s.type)?this.removePane(s.type):this.replacePane(s)},addPane(s){console.log("PaneList2 / addPane"),this.$nextTick(()=>{this.$el.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})});let t=JSON.parse(JSON.stringify(this.project_panes));t.push(s);const e=this.possible_project_panes.map(i=>i.type);t.sort((i,a)=>e.indexOf(i.type)-e.indexOf(a.type)),t=t.map(i=>(i.size=100/t.length,i)),this.project_panes=t},getIcon(s){return s==="capture"?this.dodoc_icon_capture:s==="collect"?this.dodoc_icon_collect:s==="make"?this.dodoc_icon_make:s==="publish"?this.dodoc_icon_publish:!1},animatePane(s){this.animate_pane=s,this.animate_pane_timeout&&clearTimeout(this.animate_pane_timeout),this.animate_pane_timeout=setTimeout(()=>{this.animate_pane=!1,this.animate_pane_timeout=null},2e3)}}};var y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_paneList",class:{"is--mobile":t.$root.is_mobile_view,"has--noPanes":t.project_panes.length===0}},[e("span",{staticClass:"_paneList2",attrs:{label:"Panneaux"}},[t.$root.is_mobile_view?t._e():e("div",{staticClass:"_projectTitle",class:{"is--shown":t.is_stickied_to_top}},[e("button",{staticClass:"u-button u-button_transparent",attrs:{type:"button"},on:{click:t.scrollToTop}},[e("b-icon",{attrs:{icon:"arrow-up"}}),e("span",[t._v(" "+t._s(t.project.title)+" ")])],1)]),e("span",{ref:"drawer",staticClass:"_projectPanes",attrs:{placement:"top"}},[t.can_edit?e("SlickList",{staticClass:"_paneList--list",attrs:{axis:"x",useDragHandle:!0},model:{value:t.project_panes,callback:function(i){t.project_panes=i},expression:"project_panes"}},t._l(t.possible_project_panes,function(i,a){return e("SlickItem",{key:i.type,staticClass:"_paneItem",class:{"is--enabled":t.paneIsEnabled(i.type),"is--animating":t.animate_pane===i.type},style:`--color-active: var(--color-${i.type});`,attrs:{index:a}},[e("div",{ref:`pane_${i.type}`,refInFor:!0,staticClass:"_btn",on:{click:function(r){return t.togglePane(i)}}},[t.getIcon(i.type)?e("span",{staticClass:"u-icon",domProps:{innerHTML:t._s(t.getIcon(i.type))}}):t._e(),t.paneIsEnabled(i.type)||!t.$root.is_mobile_view?e("span",{key:"'name'",staticClass:"_name"},[t._v(" "+t._s(a+1)+" • "+t._s(t.$t(i.type))+" ")]):t._e(),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.animate_pane===i.type?e("span",{key:"'count+'",staticClass:"_count"},[t._v(" +1 ")]):t.project_panes.some(r=>r.type===i.type)?e("div",{staticClass:"_inlineBtn _removePaneBtn"},[e("b-icon",{attrs:{icon:"x-circle-fill",label:t.$t("close")},on:{click:function(r){return r.stopPropagation(),t.removePane(i.type)}}})],1):t.project_panes.length>0&&!t.$root.is_mobile_view?e("div",{staticClass:"_inlineBtn _addPaneBtn"},[e("b-icon",{attrs:{icon:"plus-circle-fill",label:t.$t("add")},on:{click:function(r){return r.stopPropagation(),t.addPane(i)}}})],1):t._e()])],1)])}),1):t._e()],1),t.$root.is_mobile_view?t._e():e("span")])])},b=[],w=n(g,y,b,!1,null,"d4a1e032");const $=w.exports,k={props:{project:Object,selected_mode:String,stopmotion_slug:String},components:{CaptureView:()=>o(()=>import("./CaptureView-CWjJc3NI.js"),[])},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var x=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_capturePane"},[e("CaptureView",{attrs:{path:t.project.$path,selected_mode:t.selected_mode,stopmotion_slug:t.stopmotion_slug},on:{changeMode:function(i){return t.$emit("update:selected_mode",i)},openStopmotion:function(i){return t.$emit("update:stopmotion_slug",i)}}})],1)},j=[],P=n(k,x,j,!1,null,"9dcefbac");const C=P.exports,M={props:{project_path:String,can_edit:Boolean},components:{},data(){return{path:`${this.project_path}/makes`,makes:[]}},created(){},async mounted(){this.makes=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{sorted_makes(){return this.makes.slice().filter(s=>s.$path&&s.type&&typeof s.type=="string").sort((s,t)=>+new Date(t.$date_created)-+new Date(s.$date_created))}},methods:{getMakeType(s){return typeof s=="string"?this.$t(s).toLowerCase():!1}}};var L=function(){var t=this,e=t._self._c;return e("section",{staticClass:"_makesList"},[e("label",{staticClass:"u-label u-colorWhite"},[t._v(" "+t._s(t.$t("makes_list"))+" ")]),e("div",{staticClass:"_makes"},[t.sorted_makes.length===0?e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("none_f"))+" ")]):t._l(t.sorted_makes,function(i){return e("div",{key:i.$path,staticClass:"_makes--item"},[e("span",[e("b",[t._v(" "+t._s(i.title)+" ")]),e("br"),t.getMakeType(i.type)?e("span",[i.type?e("i",[t._v(" "+t._s(t.getMakeType(i.type))+" ")]):t._e()]):t._e()]),e("DateDisplay",{attrs:{title:t.$t("date_created"),date:i.$date_created}}),i.$path?e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(a){t.$emit("open",i.$path.split("/").at(-1))}}},[t._v(" "+t._s(t.$t("open"))+" ")]):t._e()],1)})],2)])},T=[],O=n(M,L,T,!1,null,"ade90146");const S=O.exports,H={props:{project_path:String,make_slug:String,can_edit:Boolean},components:{SingleBaseMediaPicker:u,ImageAndVideoMontage:()=>o(()=>import("./ImageAndVideoMontage-C-oZjQ1L.js"),[]),VideoEffects:()=>o(()=>import("./VideoEffects-BrWIwO0V.js"),[]),MakeStopmotionAnimation:()=>o(()=>import("./MakeStopmotionAnimation-B3szBw35.js"),[]),MixAudioAndImageOrVideo:()=>o(()=>import("./MixAudioAndImageOrVideo-Be69O8uU.js"),[]),QrCode:()=>o(()=>import("./QrCode-ORT2WEf_.js"),[])},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{make:null,fetch_make_error:!1}},created(){},async mounted(){await this.listMake(),this.$eventHub.$on("folder.removed",this.closeOnRemove),this.$api.join({room:this.make.$path})},beforeDestroy(){this.$eventHub.$off("folder.removed",this.closeOnRemove),this.$api.leave({room:this.make.$path})},watch:{},computed:{base_media(){const s=this.make.base_media_filename;return s?this.getSourceMedia({source_media:{meta_filename_in_project:s},folder_path:this.make.$path}):!1},meta_filenames_already_present(){if(["stopmotion_animation","video_assemblage"].includes(this.make.type)){const t=this.getSectionsWithProps({publication:this.make,group:"sections_list"}),{other:e}=this.getMediasAlreadyPresentInPublication({publication:this.make,sections:t});return[{label:this.$t("in_this_make"),medias:e,color:"var(--c-bleumarine)"}]}let s=[];return this.make.base_media_filename&&s.push(this.make.base_media_filename),this.make.base_image_filename&&s.push(this.make.base_image_filename),this.make.base_video_filename&&s.push(this.make.base_video_filename),this.make.base_audio_filename&&s.push(this.make.base_audio_filename),s.length>0?[{label:this.$t("in_this_make"),medias:s,color:"var(--c-bleumarine)"}]:[]}},methods:{async listMake(){const s=await this.$api.getFolder({path:`${this.project_path}/makes/${this.make_slug}`}).catch(t=>{this.fetch_make_error=t.response});this.make=s},closeOnRemove({path:s}){s===this.make.$path&&(this.$alertify.closeLogOnClick(!0).delay(4e3).log(this.$t("make_was_removed")),this.$emit("close"))},async removeMake(){this.fetch_status="pending",this.fetch_error=null;try{const s=await this.$api.deleteItem({path:this.make.$path});this.response=s.data,this.fetch_status="success"}catch(s){this.fetch_status="error",this.fetch_error=s.response.data}}}};var V=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_make"},[e("button",{staticClass:"u-buttonLink u-buttonLink_white",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back_to_makes_list"))+" ")],1),t.fetch_make_error?e("div",[t._v(" "+t._s(t.fetch_make_error)+" ")]):t._e(),t.make?e("div",[e("div",{staticClass:"_topbar"},[e("TitleField",{attrs:{field_name:"title",tag:"h2",content:t.make.title,path:t.make.$path,required:!0,minlength:3,maxlength:40,can_edit:t.can_edit}}),t.can_edit?e("RemoveMenu",{on:{remove:t.removeMake}}):t._e()],1),t.make.type==="video_effects"?e("div",[e("div",{staticClass:"_mediaPicker"},[e("SingleBaseMediaPicker",{attrs:{title:t.$t("video_to_rework"),field_name:"base_media_filename",open_modal_if_empty:!0,content:t.make.base_media_filename,path:t.make.$path,media_type_to_pick:"video"}})],1),t.base_media?e("div",{key:t.base_media.$path},[e("VideoEffects",{attrs:{make:t.make,project_path:t.project_path,base_media:t.base_media}})],1):t._e()]):t.make.type==="stopmotion_animation"?e("MakeStopmotionAnimation",{attrs:{make:t.make}}):["mix_audio_and_image","mix_audio_and_video"].includes(t.make.type)?e("MixAudioAndImageOrVideo",{attrs:{make:t.make}}):t.make.type==="video_assemblage"?e("ImageAndVideoMontage",{attrs:{make:t.make}}):t.make.type==="qr_code"?e("QrCode",{attrs:{make:t.make}}):t._e()],1):t._e()])},F=[],I=n(H,V,F,!1,null,"0c28b954");const R=I.exports,D={props:{can_edit:Boolean,opened_make_slug:String,project:Object},components:{MakesList:S,MakeOpen:R},data(){return{current_view:"create",recipes:[{key:"video_assemblage",summary:"video_assemblage_summary",show_instructions:!1,instructions:"video_assemblage_instructions",icon:`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 201 201">
                  <g id="Calque_6" data-name="Calque 6">
                    <g>
                      <g>
                        <rect x="68.73" y="12.93" width="63.54" height="72" style="fill: #fff"/>
                        <rect x="73.23" y="17.52" width="53.94" height="43.04" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.161211202864444px"/>
                        <rect x="72.36" y="66.15" width="31.66" height="4.99" style="fill: #353535"/>
                        <rect x="72.36" y="73.43" width="23.67" height="4.99" style="fill: #353535"/>
                        <path d="M94.24,47.59c-.7.45-1.28.14-1.28-.69V31.19c0-.83.58-1.14,1.28-.69l11.92,7.72a.91.91,0,0,1,0,1.65Z" style="fill: #353535"/>
                      </g>
                      <g>
                        <rect x="68.73" y="114.16" width="63.54" height="72" style="fill: #fff"/>
                        <rect x="73.23" y="118.76" width="53.94" height="43.04" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.161211202864444px"/>
                        <rect x="72.36" y="167.38" width="31.66" height="4.99" style="fill: #353535"/>
                        <rect x="72.36" y="174.66" width="23.67" height="4.99" style="fill: #353535"/>
                        <path d="M94.24,148.82c-.7.46-1.28.14-1.28-.69v-15.7c0-.84.58-1.15,1.28-.7l11.92,7.72a.91.91,0,0,1,0,1.65Z" style="fill: #353535"/>
                      </g>
                      <path d="M101.87,98.27h4.24v2.54h-4.24v4.33H99.11v-4.33H94.89V98.27h4.22V94h2.76Z" style="fill: #fff"/>
                    </g>
                  </g>
                </svg>
              `},{key:"video_effects",summary:"video_effects_summary",show_instructions:!1,instructions:"video_effects_instructions",icon:`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 201 201">
                  <g id="Calque_6" data-name="Calque 6">
                    <rect y="0.53" width="201" height="201" style="fill: none"/>
                    <g>
                      <g>
                        <rect x="107.44" y="30.53" width="63.54" height="72" style="fill: #fff"/>
                        <rect x="111.93" y="35.12" width="53.94" height="43.04" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.16121px"/>
                        <rect x="111.07" y="83.75" width="31.66" height="4.99" style="fill: #353535"/>
                        <rect x="111.07" y="91.03" width="23.67" height="4.99" style="fill: #353535"/>
                        <path d="M132.94,65.19c-.7.45-1.27.14-1.27-.69V48.79c0-.83.57-1.14,1.27-.69l11.92,7.72a.91.91,0,0,1,0,1.65Z" style="fill: #353535"/>
                      </g>
                      <g>
                        <path d="M79.06,120.65,66.93,132.77,27.07,172.64l5.46,5.46,52-52Z"/>
                        <path d="M79.15,116.75a1.29,1.29,0,0,0,1.29-1.28v-9a1.29,1.29,0,0,0-2.58,0v9A1.29,1.29,0,0,0,79.15,116.75Z"/>
                        <path d="M79.15,134.8a1.29,1.29,0,0,0-1.29,1.29v9a1.29,1.29,0,1,0,2.58,0v-9A1.29,1.29,0,0,0,79.15,134.8Z"/>
                        <path d="M98.48,124.49h-9a1.29,1.29,0,0,0,0,2.58h9a1.29,1.29,0,0,0,0-2.58Z"/>
                        <path d="M59.81,127.07h9a1.29,1.29,0,0,0,0-2.58h-9a1.29,1.29,0,0,0,0,2.58Z"/>
                        <path d="M86.88,119.33a1.35,1.35,0,0,0,.92-.37l6.38-6.38a1.29,1.29,0,1,0-1.82-1.82L86,117.14a1.28,1.28,0,0,0,.9,2.19Z"/>
                        <path d="M87.8,132.59A1.29,1.29,0,0,0,86,134.41l6.38,6.38a1.26,1.26,0,0,0,.91.38,1.31,1.31,0,0,0,.92-.38,1.29,1.29,0,0,0,0-1.82Z"/>
                        <path d="M70.51,119a1.26,1.26,0,0,0,.92.37,1.34,1.34,0,0,0,.91-.37,1.27,1.27,0,0,0,0-1.82L66,110.76a1.28,1.28,0,0,0-1.81,1.82Z"/>
                      </g>
                    </g>
                    <rect x="23.93" y="153.7" width="52.51" height="2.57" transform="translate(-94.89 80.88) rotate(-45)" style="fill: #fff"/>
                    <rect x="68.62" y="128.62" width="13.29" height="2.57" transform="translate(-69.81 91.27) rotate(-45)" style="fill: #fff"/>
                    <rect width="201" height="201" style="fill: none"/>
                  </g>
                </svg>
              `},{key:"stopmotion_animation",summary:"stopmotion_animation_summary",show_instructions:!1,instructions:"stopmotion_animation_instructions",icon:`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 201 201">
                  <g id="Calque_6" data-name="Calque 6">
                    <g>
                      <g>
                        <g>
                          <g>
                            <rect x="25.5" y="9.92" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="29.04" y="13.24" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(46.15 33.42)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">1</text>
                        </g>
                        <g>
                          <g>
                            <rect x="75.5" y="9.92" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="79.04" y="13.24" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(96.15 33.42)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">2</text>
                        </g>
                        <g>
                          <g>
                            <rect x="125.5" y="9.92" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="129.04" y="13.24" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(146.15 33.42)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">3</text>
                        </g>
                      </g>
                      <g>
                        <g>
                          <g>
                            <rect x="25.5" y="77.48" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="29.04" y="80.81" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(46.15 100.99)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">5</text>
                        </g>
                        <g>
                          <g>
                            <rect x="75.5" y="77.48" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="79.04" y="80.81" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(96.15 100.99)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">6</text>
                        </g>
                        <g>
                          <g>
                            <rect x="125.5" y="77.48" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="129.04" y="80.81" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(146.15 100.99)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">7</text>
                        </g>
                      </g>
                      <g>
                        <g>
                          <g>
                            <rect x="25.5" y="145.05" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="29.04" y="148.38" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(46.15 168.55)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">9</text>
                        </g>
                        <g>
                          <g>
                            <rect x="75.5" y="145.05" width="50" height="46.04" style="fill: #fff"/>
                            <rect x="79.04" y="148.38" width="42.45" height="31.19" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.6319287679171661px"/>
                          </g>
                          <text transform="translate(91.81 168.55)" style="font-size: 14.490870475769043px;font-family: FiraCode-Medium, Fira Code;font-weight: 500">10</text>
                        </g>
                      </g>
                    </g>
                  </g>
                </svg>
          `},{key:"mix_audio_and_video",summary:"mix_audio_and_video_summary",show_instructions:!1,instructions:"mix_audio_and_video_instructions",icon:`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 201 201">
                  <g id="Calque_6" data-name="Calque 6">
                    <g>
                      <g>
                        <rect x="68.88" y="30.28" width="63.54" height="72" style="fill: #fff"/>
                        <rect x="73.38" y="34.87" width="53.94" height="43.04" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.161211202864444px"/>
                        <rect x="72.52" y="83.5" width="31.66" height="4.99" style="fill: #353535"/>
                        <rect x="72.52" y="90.78" width="23.67" height="4.99" style="fill: #353535"/>
                        <path d="M94.39,64.94c-.7.45-1.28.14-1.28-.69V48.54c0-.83.58-1.14,1.28-.69l11.92,7.72a.91.91,0,0,1,0,1.65Z" style="fill: #353535"/>
                      </g>
                      <g>
                        <rect x="68.58" y="134.72" width="63.54" height="36" style="fill: #fff"/>
                        <rect x="72.21" y="153.34" width="31.66" height="4.99" style="fill: #353535"/>
                        <rect x="72.21" y="160.62" width="23.67" height="4.99" style="fill: #353535"/>
                        <g>
                          <line x1="73.38" y1="143.52" x2="127.32" y2="143.52" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.161211202864444px"/>
                          <g>
                            <path d="M94.69,151c-.28.18-.51.06-.51-.28V137c0-.34.23-.46.51-.28l10.56,6.84a.36.36,0,0,1,0,.66Z" style="fill: #353535"/>
                            <path d="M94.69,151c-.28.18-.51.06-.51-.28V137c0-.34.23-.46.51-.28l10.56,6.84a.36.36,0,0,1,0,.66Z" style="fill: none;stroke: #fff;stroke-miterlimit: 10;stroke-width: 2px"/>
                          </g>
                          <circle cx="74.38" cy="143.52" r="2.58" style="fill: #353535"/>
                          <circle cx="126.32" cy="143.52" r="2.58" style="fill: #353535"/>
                        </g>
                      </g>
                      <path d="M102,117.63h4.24v2.54H102v4.32H99.27v-4.32H95v-2.54h4.23V113.3H102Z" style="fill: #fff"/>
                    </g>
                  </g>
                </svg>
              `},{key:"mix_audio_and_image",summary:"mix_audio_and_image_summary",show_instructions:!1,instructions:"mix_audio_and_image_instructions",icon:`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 201 201">
                  <g id="Calque_6" data-name="Calque 6">
                    <g>
                      <g>
                        <rect x="68.88" y="30.28" width="63.54" height="62" style="fill: #fff"/>
                        <rect x="73.38" y="34.87" width="53.94" height="43.04" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.16121120286444px"/>
                      </g>
                      <g>
                        <rect x="68.58" y="124.72" width="63.54" height="36" style="fill: #fff"/>
                        <rect x="72.21" y="143.34" width="31.66" height="4.99" style="fill: #353535"/>
                        <rect x="72.21" y="150.62" width="23.67" height="4.99" style="fill: #353535"/>
                        <g>
                          <line x1="73.38" y1="133.52" x2="127.32" y2="133.52" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.16121120286444px"/>
                          <g>
                            <path d="M94.69,141c-.28.18-.51.06-.51-.28V127c0-.34.23-.46.51-.28l10.56,6.84a.36.36,0,0,1,0,.66Z" style="fill: #353535"/>
                            <path d="M94.69,141c-.28.18-.51.06-.51-.28V127c0-.34.23-.46.51-.28l10.56,6.84a.36.36,0,0,1,0,.66Z" style="fill: none;stroke: #fff;stroke-miterlimit: 10;stroke-width: 2px"/>
                          </g>
                          <circle cx="74.38" cy="133.52" r="2.58" style="fill: #353535"/>
                          <circle cx="126.32" cy="133.52" r="2.58" style="fill: #353535"/>
                        </g>
                      </g>
                      <path d="M102,107.63h4.24v2.54H102v4.32H99.27v-4.32H95v-2.54h4.23V103.3H102Z" style="fill: #fff"/>
                    </g>
                  </g>
                </svg>
              `},{key:"qr_code",summary:"qr_code_summary",show_instructions:!1,icon:`
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="-8 -8 32 32"
            >
              <rect x="-2" y="-2" width="20" height="20" fill="white"></rect>
              <path d="M2 2h2v2H2V2Z"></path>
              <path d="M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"></path>
              <path d="M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"></path>
              <path
                d="M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"
              ></path>
              <path d="M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"></path>
            </svg>
          `}]}},created(){this.$eventHub.$on("make.open",this.openMake)},mounted(){},beforeDestroy(){this.$eventHub.$off("make.open",this.openMake)},watch:{},computed:{},methods:{async createMake(s){const t=(Math.random().toString(36)+"00000000000000000").slice(2,5),e=this.$t(s)+" - "+t,i=await this.$api.createFolder({path:`${this.project.$path}/makes`,additional_meta:{type:s,title:e,requested_slug:e,$admins:"parent_contributors"}});this.openMake(i)},openMake(s){this.$emit("update:opened_make_slug",s)},removeMake(s){}}};var Z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_makePane"},[e("div",{staticClass:"_makePane--content"},[t.opened_make_slug?e("div",[e("MakeOpen",{attrs:{project_path:t.project.$path,make_slug:t.opened_make_slug,can_edit:t.can_edit},on:{remove:t.removeMake,close:function(i){return t.$emit("update:opened_make_slug",!1)}}})],1):e("div",[t.can_edit?e("RadioSwitch",{attrs:{content:t.current_view,options:[{label:t.$t("create"),value:"create"},{label:t.$t("existing"),value:"existing"}]},on:{"update:content":function(i){t.current_view=i}}}):t._e(),e("div",{staticClass:"u-spacingBottom"}),t.current_view==="create"?e("section",[e("div",{staticClass:"m_recipes--type--grid"},t._l(t.recipes,function(i){return e("div",{key:i.key,staticClass:"u-card2 m_recipe"},[e("div",{staticClass:"m_recipe--icon",domProps:{innerHTML:t._s(i.icon)}}),e("div",{staticClass:"m_recipe--text"},[e("h2",{},[t._v(t._s(t.$t(i.key)))]),e("p",{staticClass:"margin-vert-small"},[e("span",{staticClass:"margin-vert-verysmall",domProps:{innerHTML:t._s(t.$t(i.summary))}}),e("br")]),i.instructions?e("button",{staticClass:"u-buttonLink",class:{"is--active":i.show_instructions},attrs:{type:"button"},on:{click:function(a){i.show_instructions=!i.show_instructions}}},[t._v(" "+t._s(t.$t("more_informations"))+" ")]):t._e(),i.show_instructions?[e("p",[e("span",{domProps:{innerHTML:t._s(t.$t(i.instructions))}})])]:t._e()],2),e("div",{staticClass:"m_recipe--buttons"},[e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(a){return t.createMake(i.key)}}},[e("svg",{staticStyle:{"enable-background":"new 0 0 168 168"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 168 168","xml:space":"preserve"}},[e("polygon",{staticStyle:{fill:"white"},attrs:{points:`132.3,73.4 132.3,94.4 94.6,94.4 94.6,132.1 73.6,132.1 73.6,94.4 35.9,94.4 35.9,73.4 
		73.6,73.4 73.6,35.7 94.6,35.7 94.6,73.4 		`}})]),e("span",[t._v(t._s(t.$t("create")))])])])])}),0)]):t.current_view==="existing"?e("section",[e("MakesList",{attrs:{project_path:t.project.$path,can_edit:t.can_edit},on:{open:t.openMake}})],1):t._e()],1)])])},E=[],B=n(D,Z,E,!1,null,"7fd3889d");const A=B.exports,z={props:{project_path:String,template_options:Array},components:{},data(){return{new_publication_title:"",new_publication_is_private:!1,new_publication_template:"page_by_page",is_creating_publication:!1,allow_save:!1,error_msg:""}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{async createPublication(){this.is_creating_publication=!0,this.new_publication_title=this.cleanUpString(this.new_publication_title);let s={title:this.new_publication_title,template:this.new_publication_template,requested_slug:this.new_publication_title,$status:this.new_publication_is_private===!0?"private":"public",$admins:"parent_contributors"};this.new_publication_template==="page_by_page"?(s.layout_mode="print",s.page_width=210,s.page_height=297,s.pages=[{id:"first_page"}]):this.new_publication_template==="edition"&&(s.page_width=210,s.page_height=297);try{const t=await this.$api.createFolder({path:`${this.project_path}/publications`,additional_meta:s});this.$emit("openPubli",t)}catch({code:t}){t==="unique_field_taken"&&(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()),this.is_creating_publication=!1}}}};var q=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.$t("create_a_publication")},on:{close:function(i){return t.$emit("close")}}},[e("form",{staticClass:"input-validation-required",on:{submit:function(i){return i.preventDefault(),t.createPublication.apply(null,arguments)}}},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_publication_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(i){t.new_publication_title=i},toggleValidity:i=>t.allow_save=i}}),e("br"),e("div",{},[e("ToggleInput",{attrs:{content:t.new_publication_is_private,label:t.$t("private"),options:{true:t.$t("private_status_explanations"),false:t.$t("public_status_explanations")}},on:{"update:content":function(i){t.new_publication_is_private=i}}})],1),e("br"),e("div",{staticClass:"_templates"},t._l(t.template_options,function(i){return e("div",{key:i.key,staticClass:"_templates--item",class:{"is--active":t.new_publication_template===i.key}},[e("strong",[t._v(t._s(i.label))]),e("div",{domProps:{innerHTML:t._s(i.icon)}}),e("button",{staticClass:"u-button u-button_bleuvert_fonce",attrs:{type:"submit",name:"action",disabled:i.disabled===!0},on:{click:function(a){t.new_publication_template=i.key}}},[e("svg",{staticStyle:{"enable-background":"new 0 0 168 168"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 168 168","xml:space":"preserve"}},[e("polygon",{staticStyle:{fill:"white"},attrs:{points:`132.3,73.4 132.3,94.4 94.6,94.4 94.6,132.1 73.6,132.1 73.6,94.4 35.9,94.4 35.9,73.4 
		73.6,73.4 73.6,35.7 94.6,35.7 94.6,73.4 		`}})]),e("span",[t._v(" "+t._s(t.$t("create"))+" ")])])])}),0),t.error_msg?[e("br"),e("br"),e("div",{staticClass:"u-errorMsg",domProps:{textContent:t._s(t.error_msg)}})]:t._e()],2)])},N=[],J=n(z,q,N,!1,null,"5a78afef");const W=J.exports,Q={props:{publication:Object,template_options:Array,can_edit:Boolean},components:{},data(){return{is_making_preview:!1,preview_progress:0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{cover_thumb(){return this.makeRelativeURLFromThumbs({$thumbs:this.publication.$cover,$type:"image",$path:this.publication.$path,resolution:640})},template_icon(){const s=this.template_options.find(t=>t.key===this.publication.template);return s?s.icon:!1}},methods:{async removePublication(){await this.$api.deleteItem({path:this.publication.$path})},async generatePreview(){this.is_making_preview=!0;const s={recipe:"png",page:1,page_width:this.publication.page_width,page_height:this.publication.page_height,layout_mode:this.publication.layout_mode||"print",make_preview:!0},t=await this.$api.generatePreviewForPublication({path:this.publication.$path,instructions:s});this.$api.join({room:"task_"+t});const e=({task_id:a,progress:r})=>{a===t&&(this.preview_progress=+r)};this.$eventHub.$on("task.status",e);const i=({task_id:a})=>{a===t&&(this.preview_progress=100,setTimeout(()=>{this.is_making_preview=!1,this.preview_progress=0},2e3),this.$eventHub.$off("task.ended",i),this.$eventHub.$off("task.status",e),this.$api.leave({room:"task_"+t}))};this.$eventHub.$on("task.ended",i)}}};var U=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-card2 _publicationPreview"},[e("div",{staticClass:"_publicationPreview--cover"},[t.cover_thumb?e("div",[e("img",{attrs:{src:t.cover_thumb}}),(t.template_icon,t._e())]):e("div",{staticClass:"_noPreview"},[t.template_icon?e("span",{domProps:{innerHTML:t._s(t.template_icon)}}):t._e()]),e("transition",{attrs:{name:"toggleLock",mode:"out-in"}},[t.publication.$status==="finished"||t.publication.$status==="private"?e("StatusTag",{key:t.publication.$status,staticClass:"_icon",attrs:{show_label:!1,status:t.publication.$status,can_edit:!1,mode:"inactive"}}):t._e()],1),e("transition",{attrs:{name:"fade_fast"}},[t.is_making_preview?e("div",{staticClass:"_previewProgress"},[e("AnimatedCounter",{attrs:{value:t.preview_progress}})],1):t._e()]),e("div",{staticClass:"_generatePreviewBtn"},[t.can_edit&&!t.is_making_preview?e("EditBtn",{attrs:{btn_type:"regenerate_thumbs",style_type:"black",label_position:"left"},on:{click:t.generatePreview}}):t._e()],1)],1),e("header",{staticClass:"_header",on:{click:function(i){return t.$emit("open")}}},[t.publication.template?e("small",{domProps:{innerHTML:t._s(t.$t(t.publication.template))}}):t._e(),e("h3",[t._v(" "+t._s(t.publication.title)+" ")])]),e("button",{staticClass:"js--showCursor _openPublication",attrs:{type:"button",title:t.$t("open")+" "+t.publication.title},on:{click:function(i){return t.$emit("open")}}})])},G=[],K=n(Q,U,G,!1,null,"f7469aa8");const X=K.exports,Y={props:{project:Object,can_edit:Boolean},components:{CreatePublication:W,PublicationPreview:X,PinnedNonpinnedFolder:l},data(){return{path:`${this.project.$path}/publications`,show_create_publication:!1,publications:[],template_options:[{key:"page_by_page",label:this.$t("page_by_page"),icon:`
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="201px" height="201px" viewBox="0 0 201 201" style="overflow:visible;enable-background:new 0 0 201 201;" xml:space="preserve">
          <rect x="35.68" y="8.83" width="129.64" height="183.35" style="fill: #fff"/>
          <rect x="46.15" y="31.82" width="39.07" height="27.55" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.0944702326735385px"/>
          <rect x="118.95" y="68.62" width="35.9" height="53.44" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.9170289512680598px"/>
          <rect x="46.15" y="68.62" width="63.37" height="53.44" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 2.161211202864444px"/>
          <rect x="73.36" y="136.54" width="54.27" height="4.99" style="fill: #353535"/>
          <rect x="73.36" y="153.02" width="54.27" height="4.99" style="fill: #353535"/>
          <rect x="73.36" y="144.78" width="54.27" height="4.99" style="fill: #353535"/>
          <rect x="73.36" y="161.26" width="54.27" height="4.99" style="fill: #353535"/>
          <line x1="46.15" y1="22.57" x2="154.85" y2="22.57" style="fill: none;stroke: #353535;stroke-miterlimit: 10;stroke-width: 1.8953584524134504px"/>
        </svg>
        `},{key:"story_with_sections",label:this.$t("story_with_sections"),icon:`
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="201px" height="201px" viewBox="0 0 201 201" style="overflow:visible;enable-background:new 0 0 201 201;" xml:space="preserve">
            <rect x="35.7" y="8.8" class="st1" width="129.6" height="183.4" style="fill: #fff;" />
            <rect x="64.9" y="46.8" width="71.2" height="53.6" style="fill:none;stroke:#353535;stroke-width:1.917;stroke-miterlimit:10;" />
            <rect x="64.9" y="145.2" width="71.2" height="39.8" style="fill:none;stroke:#353535;stroke-width:1.917;stroke-miterlimit:10;" />
            <rect x="65" y="108" width="71.1" height="5" style="fill:#353535;" />
            <rect x="65" y="124.5" class="st3" width="71.1" height="5"  style="fill:#353535;"/>
            <rect x="65" y="116.2" class="st3" width="71.1" height="5" style="fill:#353535;"/>
            <rect x="65" y="132.7" class="st3" width="71.1" height="5" style="fill:#353535;"/>
            <rect x="64.9" y="25.9" class="st3" width="71.1" height="5" style="fill:#353535;"/>
            <rect x="64.9" y="17.6" class="st3" width="71.1" height="5" style="fill:#353535;"/>
            <rect x="64.9" y="34.1" class="st3" width="71.1" height="5" style="fill:#353535;"/>
          </svg>
          `},{key:"cartography",label:this.$t("cartography"),icon:`
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 100 100" style="overflow:visible;enable-background:new 0 0 101 101;" xml:space="preserve">
            <path fill="white" fill-rule="evenodd" clip-rule="evenodd" d="M79.257,21.725c2.267,3.934,3.667,8.167,4.2,12.7  c0.567,4.767,0.133,9.583-1.3,14.45c-1.767,5.967-4.6,12.167-8.5,18.6c-5.133,8.5-11.35,16.7-18.65,24.601  c-1.7,1.833-3.367,2.75-5,2.75c-1.6,0-3.25-0.917-4.95-2.75c-5.434-5.967-10.05-11.667-13.85-17.101  c-4.433-6.366-8.05-12.75-10.85-19.149c-2.8-6.5-4.15-12.567-4.05-18.2c0.133-8.133,3-15.316,8.6-21.55  c3.8-4.233,8.183-7.267,13.15-9.101c0.4-0.166,0.816-0.316,1.25-0.449c6.7-1.801,13.767-1.801,21.2,0  c3.667,1.166,7.05,2.967,10.15,5.399C74.157,14.625,77.024,17.892,79.257,21.725z M50.107,16.075c-6.2,0-11.517,2.183-15.95,6.55  c-4.4,4.367-6.6,9.633-6.6,15.8c-0.033,6.2,2.133,11.517,6.5,15.95c4.367,4.4,9.633,6.617,15.8,6.65  c6.233,0.033,11.567-2.134,16-6.5c4.4-4.4,6.617-9.717,6.65-15.95c0-6.2-2.183-11.5-6.55-15.9  C61.557,18.309,56.274,16.108,50.107,16.075z M57.907,46.525c-2.233,2.199-4.9,3.283-8,3.25c-3.034,0-5.65-1.101-7.85-3.301  c-2.167-2.199-3.25-4.833-3.25-7.899c0-3.101,1.1-5.75,3.3-7.95c2.2-2.2,4.85-3.3,7.95-3.3c3.066,0,5.7,1.1,7.9,3.3  c2.2,2.233,3.3,4.9,3.3,8C61.224,41.725,60.107,44.358,57.907,46.525z"/>
          </svg>
          `},{key:"edition",label:this.$t("edition"),icon:`
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 100 100" style="overflow:visible;enable-background:new 0 0 100 100;" xml:space="preserve">
            <rect x="30.68" y="30" width="40" height="40" style="fill: #fff"/>
          </svg>
          `}]}},created(){},async mounted(){this.publications=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{sorted_publications(){return this.publications.slice().filter(s=>!!(this.can_edit||s.$status!=="invisible"&&s.$status!=="private")).sort((s,t)=>+new Date(t.$date_created)-+new Date(s.$date_created))},can_edit_project(){return this.canLoggedinEditFolder({folder:this.project.$path})}},methods:{openEntry(s){const t=s.split("/").at(-1);this.$emit("togglePubli",t)},closeEntry(){this.$emit("togglePubli",!1)}}};var tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_publicationsList"},[e("div",{staticClass:"u-sameRow _topBtn"},[e("DLabel",{attrs:{str:t.$t("publications"),tag:"h2"}}),t.can_edit?e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(i){t.show_create_publication=!0}}},[e("svg",{staticStyle:{"enable-background":"new 0 0 168 168"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 168 168","xml:space":"preserve"}},[e("path",{staticStyle:{fill:"var(--color-publish)"},attrs:{d:`M24.6,24.4c-32.8,32.8-32.8,86.1,0,119c32.8,32.8,85.9,32.8,118.7,0c32.8-32.8,32.8-85.9,0-118.7
		C110.5-8.2,57.5-8.2,24.6,24.4z`}}),e("polygon",{staticStyle:{fill:"#ffffff"},attrs:{points:`132.3,73.4 132.3,94.4 94.6,94.4 94.6,132.1 73.6,132.1 73.6,94.4 35.9,94.4 35.9,73.4 
		73.6,73.4 73.6,35.7 94.6,35.7 94.6,73.4 		`}})]),t._v("   "+t._s(t.$t("create"))+" ")]):t._e()],1),t.show_create_publication?e("CreatePublication",{attrs:{project_path:t.project.$path,template_options:t.template_options},on:{close:function(i){t.show_create_publication=!1},openPubli:function(i){return t.$emit("togglePubli",i)}}}):t._e(),e("br"),e("div",{staticClass:"_publications"},[t.sorted_publications.length===0?e("div",{key:"nopublis",staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("no_publications"))+" ")]):e("PinnedNonpinnedFolder",{attrs:{field_name:"publications_pinned",label:t.$t("publications_pinned"),content:t.project.publications_pinned,path:t.project.$path,folders:t.sorted_publications,can_edit:t.can_edit_project},scopedSlots:t._u([{key:"default",fn:function(i){return[e("PublicationPreview",{attrs:{publication:i.item,template_options:t.template_options,can_edit:t.can_edit},on:{open:function(a){return t.openEntry(i.item.$path)}}})]}}])})],1)],1)},et=[],it=n(Y,tt,et,!1,null,"626a3b5c");const st=it.exports,at={props:{project_path:String,publication_slug:String,pane_infos:Object,can_edit:Boolean},components:{PublicationTopbar:v,StoryTemplate:()=>o(()=>import("./StoryTemplate-C-PoQUYJ.js"),[]),StorySectionTemplate:()=>o(()=>import("./StorySectionTemplate-BMGtRsGq.js"),[]),PageTemplate:()=>o(()=>import("./PageTemplate-BucccSLh.js"),[]),MapTemplate:()=>o(()=>import("./MapTemplate-B9Ee_L0d.js"),[]),EditionTemplate:()=>o(()=>import("./EditionTemplate-B9Noprx8.js"),[])},data(){return{publication:null,fetch_publication_error:null}},created(){},async mounted(){await this.listPublication(),this.$eventHub.$on("folder.removed",this.closeOnRemove),this.$api.join({room:this.publication.$path})},beforeDestroy(){this.$eventHub.$off("folder.removed",this.closeOnRemove),this.$api.leave({room:this.publication.$path})},watch:{},computed:{},methods:{async listPublication(){const s=await this.$api.getFolder({path:`${this.project_path}/publications/${this.publication_slug}`}).catch(t=>{this.fetch_publication_error=t.response});this.publication=s},closeOnRemove({path:s}){s===this.publication.$path&&(this.$alertify.closeLogOnClick(!0).delay(4e3).log(this.$t("publication_was_removed")),this.$emit("close"))}}};var nt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_publicationOpen"},[t.publication?t.fetch_publication_error?e("div",[t._v(" "+t._s(t.fetch_publication_error)+" ")]):t.publication?[e("PublicationTopbar",{staticClass:"_publicationOpen--topbar",attrs:{publication:t.publication,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{close:function(i){return t.$emit("close")}}}),t.publication.template==="story"?e("StoryTemplate",{staticClass:"_publicationOpen--content",attrs:{publication:t.publication,can_edit:t.can_edit}}):t.publication.template==="story_with_sections"?e("StorySectionTemplate",{staticClass:"_publicationOpen--content",attrs:{publication:t.publication,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(i){return t.$emit("updatePane",i)}}}):t.publication.template==="page_by_page"?e("PageTemplate",{staticClass:"_publicationOpen--content",attrs:{publication:t.publication,can_edit:t.can_edit,pane_infos:t.pane_infos},on:{updatePane:function(i){return t.$emit("updatePane",i)}}}):t.publication.template==="cartography"?e("MapTemplate",{staticClass:"_publicationOpen--content",attrs:{publication:t.publication,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(i){return t.$emit("updatePane",i)}}}):t.publication.template==="edition"?e("EditionTemplate",{staticClass:"_publicationOpen--content",attrs:{publication:t.publication,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(i){return t.$emit("updatePane",i)}}}):e("div",{staticClass:"u-instructions _noTemplateNotice"},[t._v(" Ce template n’existe pas : "+t._s(t.publication.template)+" ")])]:t._e():e("LoaderSpinner")],2)},ot=[],rt=n(at,nt,ot,!1,null,"6106a6c9");const lt=rt.exports,ct={props:{project:Object,pane_infos:Object,can_edit:Boolean},components:{PublicationsList:st,PublicationOpen:lt},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{publication_opened(){return this.pane_infos.folder}},methods:{}};var pt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_publierPane",class:{"is--editable":t.can_edit}},[t.publication_opened?e("PublicationOpen",{attrs:{project_path:t.project.$path,publication_slug:t.publication_opened,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(i){return t.$emit("updatePane",i)},close:function(i){t.$emit("updatePane",{key:"folder",value:!1}),t.$emit("updatePane",{key:"page_id",value:!1})}}}):e("PublicationsList",{attrs:{project:t.project,can_edit:t.can_edit},on:{togglePubli:function(i){return t.$emit("updatePane",{key:"folder",value:i})}}})],1)},_t=[],ht=n(ct,pt,_t,!1,null,"938f3cfc");const dt=ht.exports,ut={props:{type:String,path:String},components:{},data(){return{show_instructions:!0,local_storage_path:this.path+"/instructions_shown_for_"+this.type}},created(){localStorage.getItem(this.local_storage_path)==="true"&&(this.show_instructions=!1)},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{closeInstructions(){this.show_instructions=!1,localStorage.setItem(this.local_storage_path,"true"),this.$emit("close")}}};var mt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[t.show_instructions?e("div",{key:`${t.type}`,staticClass:"_floatingMsg",on:{click:function(i){return i.target!==i.currentTarget?null:t.closeInstructions.apply(null,arguments)}}},[e("div",[e("span",{domProps:{innerHTML:t._s(t.$t(`instructions.pane.${t.type}`))}}),e("b-icon",{attrs:{icon:"x-circle-fill",label:"Fermer"},on:{click:function(i){return i.stopPropagation(),t.closeInstructions.apply(null,arguments)}}})],1)]):t._e()])},ft=[],vt=n(ut,mt,ft,!1,null,"fba1e1b2");const gt=vt.exports,yt={props:{projectpanes:Array,project:Object,can_edit_project:Boolean},components:{Splitpanes:m,Pane:f,PublierPane:dt,MediaLibrary:d,MakePane:A,CapturePane:C,InstructionsWindow:gt},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{project_path_wrappable(){return this.project.$path.replaceAll("/","/<wbr>")}},methods:{scrollToPanes(){this.$route.name==="Projet"&&this.can_edit_project&&this.$el.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},setItem(s,t,e){Object.prototype.hasOwnProperty.call(s,t)&&s[t]===e||!e?this.$delete(s,t):this.$set(s,t,e)},resized(s){console.log("Project / methods: resized");let t=this.projectpanes.slice();t.map((e,i)=>(e.size=Number(s[i].size.toFixed(1)),e)),this.$emit("update:projectpanes",t)}}};var bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_projetPanes",class:{"has--multiplePanes":t.can_edit_project,"is--editable":t.can_edit_project},on:{click:t.scrollToPanes}},[e("splitpanes",{attrs:{"watch-slots":"","dbl-click-splitter":!1},on:{resized:t.resized}},[t.projectpanes.length===0?[e("pane",[e("div",{staticClass:"_msg"},[e("div",{staticClass:"u-sameRow u-instructions"},[e("b-icon",{attrs:{icon:"arrow-up-short"}}),t._v(" "+t._s(t.$t("choose_a_pane"))+" "),e("b-icon",{attrs:{icon:"arrow-up-short"}})],1),e("br"),e("br"),e("br"),e("div",{staticClass:"u-spacingBottom"},[e("DateDisplay",{attrs:{title:t.$t("date_created"),date:t.project.$date_created}}),e("DateDisplay",{attrs:{title:t.$t("date_modified"),date:t.project.$date_modified}})],1),t.$root.app_infos.is_electron&&t.is_instance_admin?e("div",{},[e("div",{staticClass:"u-spacingBottom"}),e("DLabel",{attrs:{str:t.$t("open_in_finder")}}),e("button",{staticClass:"u-button u-button_bleumarine u-button_small",attrs:{type:"button"},domProps:{innerHTML:t._s(t.project_path_wrappable)},on:{click:function(i){return t.openInFinder({path:t.project.$path})}}})],1):t._e(),e("br"),e("DLabel",{attrs:{str:t.$t("latest_changes_to_project")}}),e("div",{staticClass:"u-instructions"},[e("small",[t._v(" "+t._s(t.$t("waiting"))+" ")])])],1)])]:t._e(),t._l(t.projectpanes,function(i){return e("pane",{key:i.type,staticClass:"_pane",style:`--color-type: var(--color-${i.type});`,attrs:{"min-size":"5",size:i.size,"data-size":i.size}},[(t.can_edit_project,t._e()),i.type==="capture"?e("CapturePane",{attrs:{project:t.project,selected_mode:i.mode,stopmotion_slug:i.stopmotion},on:{"update:selected_mode":function(a){return t.setItem(i,"mode",a)},"update:stopmotion_slug":function(a){return t.setItem(i,"stopmotion",a)}}}):i.type==="collect"?e("MediaLibrary",{key:i.key,attrs:{project:t.project,media_focused:i.focus},on:{"update:media_focused":function(a){return t.setItem(i,"focus",a)}}}):t._e(),i.type==="make"?e("MakePane",{attrs:{project:t.project,opened_make_slug:i.make,can_edit:t.can_edit_project},on:{"update:opened_make_slug":function(a){return t.setItem(i,"make",a)}}}):t._e(),i.type==="publish"?e("PublierPane",{attrs:{project:t.project,pane_infos:i,can_edit:t.can_edit_project},on:{updatePane:a=>t.setItem(i,a.key,a.value)}}):t._e()],1)})],2)],1)},wt=[],$t=n(yt,bt,wt,!1,null,"3a973bfe");const kt=$t.exports,xt={props:{},components:{ProjectPresentation:c,PaneList2:$,ProjectPanes:kt},data(){return{is_loading:!0,fetch_project_error_message:null,project:null,display_as_public:!1,projectpanes:[]}},async created(){this.$api.updateSelfPath(this.project_path),await this.listProject(),await this.getSpace(),this.can_edit_project||(this.projectpanes=[{type:"publish",size:100}]),this.$eventHub.$emit("received.project",this.project),this.$eventHub.$on("folder.removed",this.closeOnRemove),this.$api.join({room:this.project.$path})},mounted(){},beforeDestroy(){this.$eventHub.$off("folder.removed",this.closeOnRemove),this.$api.leave({room:this.project.$path})},watch:{$route:{handler(){var t;let s=(t=this.$route.query)==null?void 0:t.projectpanes;s&&(this.projectpanes=JSON.parse(s))},immediate:!0},projectpanes:{handler(){this.updateQueryPanes()},deep:!0},display_as_public:{handler(){this.display_as_public&&(this.projectpanes.length!==1||this.projectpanes.some(s=>s.type!=="publish"))&&(this.projectpanes=[{type:"publish",size:100}])}}},computed:{project_path(){return this.createPath({space_slug:this.$route.params.space_slug,project_slug:this.$route.params.project_slug})},can_edit_project(){return this.canLoggedinEditFolder({folder:this.project})},can_contribute_to_project(){return this.canLoggedinContributeToFolder({folder:this.project})}},methods:{async listProject(){const s=await this.$api.getFolder({path:this.project_path}).catch(t=>{t.code==="folder_private"?this.fetch_project_error_message=this.$t("project_is_private"):this.fetch_project_error_message=t.code,this.is_loading=!1});this.is_loading=!1,this.project=s},async getSpace(){const s=this.createPath({space_slug:this.$route.params.space_slug}),t=await this.$api.getFolder({path:s}).catch(()=>{});this.$eventHub.$emit("received.space",t)},updateQueryPanes(){let s={};if(this.projectpanes&&(s.projectpanes=JSON.stringify(this.projectpanes)),this.$route.query&&JSON.stringify(this.$route.query)===JSON.stringify(s))return!1;this.$router.replace({query:s})},closeOnRemove({path:s}){s===this.project.$path&&(this.$alertify.closeLogOnClick(!0).delay(4e3).log(this.$t("project_was_removed")),this.$router.push(this.getParent(this.createURLFromPath(this.project.$path))))}}};var jt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_projectView"},[e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.is_loading?e("div",{key:"loader",staticClass:"u-divCentered"},[e("LoaderSpinner")],1):t.fetch_project_error_message?e("div",{key:"err"},[e("div",{staticClass:"u-instructions _errNotice"},[t._v(" "+t._s(t.fetch_project_error_message)+" ")])]):e("div",{key:"project"},[e("div",{staticClass:"_topContent"},[t.can_contribute_to_project?e("div",{staticClass:"u-displayAsPublic"},[e("div",{staticClass:"_sticky"},[e("div",{staticClass:"_content"},[e("ToggleInput",{attrs:{content:t.display_as_public,label:t.$t("display_as_public")},on:{"update:content":function(i){t.display_as_public=i}}})],1)])]):t._e(),e("ProjectPresentation",{attrs:{project:t.project,context:"full",can_edit:t.can_edit_project&&!t.display_as_public}})],1),e("div",{staticClass:"_projectPanesAndList"},[t.can_contribute_to_project&&!t.display_as_public?e("PaneList2",{staticClass:"_paneList",attrs:{can_edit:t.can_contribute_to_project&&!t.display_as_public,project:t.project,panes:t.projectpanes},on:{"update:panes":function(i){t.projectpanes=i}}}):e("hr",{staticClass:"_separator"}),e("div",{staticClass:"_panes"},[e("ProjectPanes",{attrs:{projectpanes:t.projectpanes,project:t.project,can_edit_project:t.can_contribute_to_project&&!t.display_as_public},on:{"update:projectpanes":function(i){t.projectpanes=i}}})],1)],1)])])],1)},Pt=[],Ct=n(xt,jt,Pt,!1,null,"c5335b1b");const St=Ct.exports;export{St as default};
