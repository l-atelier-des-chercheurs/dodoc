import{s as C,p as k}from"./SingleBaseMediaPicker--PcxP4Ot.js";import{M as g}from"./MediaPicker-CHRElu4W.js";import{n as d,_ as x}from"../build.js";import{M as S,m as M,H as y,d as f,V as P}from"./ViewContent-d8y2DHBb.js";/* empty css               */import{P as F}from"./PublicationSettings-DIeHMtor.js";import{W as T}from"./WidthHeightField-CIgRrgzN.js";import"./ResourcesPicker-BIwBUyUG.js";import"./agent.esm-BHqsbQuq.js";const A={props:{publication:{type:Object,required:!0}},components:{MediaPicker:g},data(){return{show_cover_picker:!1,cover_layout_mode_options:[{key:"",text:this.$t("normal")},{key:"full_page",text:this.$t("full_page")},{key:"text_top_image_down",text:this.$t("text_top_image_down")},{key:"image_top_text_down",text:this.$t("image_top_text_down")}]}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{cover_media(){var i;return(i=this.publication.$files)==null?void 0:i.find(t=>t.cover_type==="front")},cover_image_media(){var e,s;const i=(s=(e=this.cover_media)==null?void 0:e.source_medias)==null?void 0:s[0];if(!i)return!1;const t=this.getSourceMedia({source_media:i,folder_path:this.publication.$path});return t||!1}},methods:{async createCover(){await this.$api.uploadText({path:this.publication.$path,filename:"frontcover.txt",content:this.$t("title"),additional_meta:{cover_type:"front"}})},async removeCover(){this.$api.deleteItem({path:this.cover_media.$path})},async pickCover(i){const t=i[0],e=await this.prepareMediaForPublication({path_to_source_media_meta:t.$path,publication_path:this.publication.$path});this.$api.updateMeta({path:this.cover_media.$path,new_meta:{source_medias:[e]}})},async removeImage(){this.$api.updateMeta({path:this.cover_media.$path,new_meta:{source_medias:[]}})}}};var L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_cover"},[t.cover_media?t._e():e("div",{},[e("DLabel",{attrs:{str:t.$t("cover")}}),e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:t.createCover}},[t._v(" "+t._s(t.$t("create"))+" ")])],1),t.cover_media?[e("div",{staticClass:"u-spacingBottom"},[e("CollaborativeEditor3",{attrs:{label:t.$t("title"),content:t.cover_media.$content,path:t.cover_media.$path,custom_formats:[],save_format:"raw",can_edit:!0}})],1),e("div",{staticClass:"_cover--pickCover"},[t.cover_image_media?[e("div",{staticClass:"_cover--pickCover--img"},[e("MediaContent",{attrs:{file:t.cover_image_media,resolution:1600}}),e("div",{staticClass:"_cover--pickCover--img--buttons"},[e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(s){t.show_cover_picker=!0}}},[t._v(" "+t._s(t.$t("change"))+" ")]),e("button",{staticClass:"u-button u-button_red u-button_small",attrs:{type:"button"},on:{click:t.removeImage}},[t._v(" "+t._s(t.$t("remove"))+" ")])])],1)]:[e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(s){t.show_cover_picker=!0}}},[t._v(" "+t._s(t.$t("pick_cover"))+" ")])],t.show_cover_picker?e("MediaPicker",{attrs:{publication_path:t.publication.$path,select_mode:"single",pick_from_types:["image"]},on:{pickMedias:t.pickCover,close:function(s){t.show_cover_picker=!1}}}):t._e()],2),e("div",{staticClass:"u-spacingBottom"}),e("DLabel",{attrs:{str:t.$t("text_image_layout")}}),e("SelectField2",{attrs:{field_name:"cover_layout_mode",value:t.cover_media.cover_layout_mode,path:t.cover_media.$path,hide_validation:!0,can_edit:!0,options:t.cover_layout_mode_options}}),e("RemoveMenu",{on:{remove:t.removeCover}})]:t._e()],2)},B=[],R=d(A,L,B,!1,null,"cde1dde5");const j=R.exports,O={props:{section:{type:Object,required:!0},index:Number,number_of_sections:Number,view_mode:String,chapters_positions:Array,pages_positions:Object},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{gallery_medias(){var i;return this.section.section_type!=="gallery"||!this.section.source_medias?[]:(i=this.section.source_medias)==null?void 0:i.map(t=>this.getSourceMedia({source_media:t,folder_path:this.getParent(this.section.$path)}))}},methods:{previewContent(i){var e;const t=(e=i._main_text)==null?void 0:e.$content;return t?t.substring(0,200)+"...":!1}}};var E=function(){var s;var t=this,e=t._self._c;return e("div",{staticClass:"_chapterPreview"},[e("div",{staticClass:"_selects"},[e("select",{staticClass:"_selects--order",attrs:{size:"small"},domProps:{value:t.index},on:{change:function(a){return t.$emit("moveSection",{old_position:t.index,new_position:+a.target.value})}}},t._l(t.number_of_sections,function(a){return e("option",{key:a-1,domProps:{value:a-1,textContent:t._s(a)}})}),0),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.view_mode==="book"&&((s=t.pages_positions)!=null&&s.first_page)?e("div",{key:t.pages_positions.first_page,staticClass:"_selects--pageRange"},[t._v(" p."+t._s(t.pages_positions.first_page)+" "),t.pages_positions.first_page!==t.pages_positions.last_page?[e("b-icon",{attrs:{icon:"arrow-right-short"}}),t._v(" p."+t._s(t.pages_positions.last_page)+" ")]:t._e()],2):t._e()])],1),e("div",{staticClass:"u-card2 _chapterPreview--card"},[e("div",{staticClass:"_topRow"},[e("h2",{staticClass:"_item--title"},[t.section.section_title?[t._v(" "+t._s(t.section.section_title)+" ")]:[e("i",[t._v(t._s(t.$t("untitled")))])],e("small",{staticClass:"_item--title--icon"},[t.section.section_type==="text"?e("b-icon",{attrs:{icon:"markdown"}}):t.section.section_type==="gallery"?e("b-icon",{attrs:{icon:"image"}}):t._e()],1)],2)]),e("div",{staticClass:"_item--content"},[t.section.section_type==="text"&&t.previewContent(t.section)?e("div",{staticClass:"_item--content--text"},[e("CollaborativeEditor3",{attrs:{content:t.previewContent(t.section)}})],1):t.section.section_type==="gallery"&&t.gallery_medias.length>0?e("div",{staticClass:"_item--content--gallery"},t._l(t.gallery_medias,function(a){return e("div",{key:a.$path},[e("MediaContent",{attrs:{file:a}})],1)}),0):e("div",{staticClass:"u-instructions"},[t._v(t._s(t.$t("no_content")))])]),e("button",{staticClass:"_openButton",attrs:{type:"button",title:t.$t("open")},on:{click:function(a){return t.$emit("open")}}})])])},D=[],z=d(O,E,D,!1,null,"05da1b7b");const I=z.exports,G={props:{publication:Object,sections:Array,opened_section_meta_filename:String,view_mode:String,chapters_positions:Object},components:{ChapterPreview:I,SetCover:j},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{opened_section_meta_filename(){}},computed:{is_associated_to_map(){return this.$getMapOptions},new_section_index(){let i=this.sections.length+1;const t=s=>" "+s;let e=t(i);for(;this.sections.some(s=>s.section_title.endsWith(e));)i++,e=t(i);return e},opened_section(){return this.sections.find(i=>this.getFilename(i.$path)===this.opened_section_meta_filename)}},methods:{openSection(i){this.$emit("toggleSection",this.getFilename(i))},async createSection({type:i="text"}={}){let t={section_starts_on_page:"right"};if(i==="text"){const s=this.new_section_title+" text.txt",{meta_filename:a}=await this.$api.uploadText({path:this.publication.$path,filename:s,content:"",additional_meta:{content_type:"markdown"}});t.section_title=this.$t("section")+" "+this.new_section_index,t.section_type="text",t.main_text_meta=a}else i==="gallery"?(t.section_title=this.$t("gallery")+" "+this.new_section_index,t.section_type="gallery"):i==="grid"?(t.section_title=this.$t("grid")+" "+this.new_section_index,t.section_type="grid"):i==="story"&&(t.section_title=this.$t("story")+" "+this.new_section_index,t.section_type="story");const e=await this.createSection2({publication:this.publication,additional_meta:t});setTimeout(()=>{this.$emit("toggleSection",e)},100)},async moveSection({old_position:i,new_position:t}){const e=this.getFilename(this.sections[i].$path);let s=this.sections.map(n=>({meta_filename:this.getFilename(n.$path)}));function a(n,o,r){if(r>=n.length)for(var c=r-n.length+1;c--;)n.push(void 0);return n.splice(r,0,n.splice(o,1)[0]),n}a(s,i,t),await this.$api.updateMeta({path:this.publication.$path,new_meta:{sections_list:s}}),setTimeout(()=>{this.$eventHub.$emit("edition.zoomToSection",e)},500)},getPagesPositions(i){const t=this.getFilename(i);return this.chapters_positions[t]}}};var H=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_chaptersSummary"},[e("div",{staticClass:"_content"},[e("transition-group",{key:"allpages",staticClass:"_allChapters",attrs:{tag:"div",name:"listComplete",appear:""}},[e("SetCover",{key:"cover",attrs:{publication:t.publication}}),t._l(t.sections,function(s,a){return e("ChapterPreview",{key:s.$path,attrs:{section:s,index:a,number_of_sections:t.sections.length,view_mode:t.view_mode,pages_positions:t.getPagesPositions(s.$path)},on:{open:function(n){return t.openSection(s.$path)},moveSection:t.moveSection}})}),e("div",{key:"'add'",staticClass:"_addSection"},[e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(s){return t.createSection({type:"text"})}}},[e("b-icon",{attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("text"))+" ")],1),e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(s){return t.createSection({type:"gallery"})}}},[e("b-icon",{attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("gallery"))+" ")],1),e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(s){return t.createSection({type:"grid"})}}},[e("b-icon",{attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("grid"))+" ")],1),e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(s){return t.createSection({type:"story"})}}},[e("b-icon",{attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("story"))+" ")],1)])],2)],1)])},W=[],V=d(G,H,W,!1,null,"be18ebde");const q=V.exports,N={name:"PickMediaForMarkdown",components:{MediaPicker:g},props:{publication_path:String},data(){return{show_media_picker:!1,medias_were_picked:!1,isCopied:!1,pick_medias_list:[],pick_medias_text:"",medias_on_new_line:!1}},watch:{medias_on_new_line(i){this.pick_medias_text=this.makeStringFromMedias(this.pick_medias_list,this.medias_on_new_line)}},methods:{async pickMedias(i){this.medias_were_picked=!0;let t=[];for(const e of i){const s=this.$root.publication_include_mode,a=await this.prepareMediaForPublication({path_to_source_media_meta:e.$path,publication_path:this.publication_path,import_mode:s});a.$type=e.$type,a.$content=e.$content,a.caption=e.caption,t.push(a)}this.pick_medias_list=t,this.pick_medias_text=this.makeStringFromMedias(this.pick_medias_list,this.medias_on_new_line)},makeStringFromMedias(i,t){let e=[];return i.map(s=>{if(s.$type==="text"){const r=this.turnHtmlToMarkdown(s.$content);e.push(r);return}let a="(",n;s.hasOwnProperty("meta_filename_in_project")?n="../"+s.meta_filename_in_project:s.hasOwnProperty("meta_filename")&&(n="./"+s.meta_filename);let o;if(s.$type==="image")o="image";else if(s.$type==="video")o="video";else if(s.$type==="audio")o="audio";else throw new Error("Unknown media type");if(a+=`${o}: ${n}`,s.caption){const r=this.turnHtmlToMarkdown(s.caption);r&&r.trim()!==""&&(a+=` caption: ${r}`)}a+=")",e.push(a)}),t?e.join(`

`):e.join(" ")},turnHtmlToMarkdown(i){const t=document.createElement("div");t.innerHTML=i;let e="";const s=t.querySelectorAll("p");return s.forEach((a,n)=>{let o=a.textContent;a.querySelectorAll("a").forEach(c=>{const u=c.textContent,_=c.getAttribute("href");if(_){const l=`[${u}](${_})`;o=o.replace(u,l)}}),e+=o+(n<s.length-1?`
`:"")}),e},copyToClipboard(){this.isCopied=!1;var i=this.$refs.urlToCopy;i.select(),i.setSelectionRange(0,99999),navigator.clipboard.writeText(i.value),this.isCopied=!0},closePickModal(){this.medias_were_picked=!1,this.isCopied=!1,this.$emit("close")},insertToText(){this.$emit("insertToText",this.pick_medias_text),this.closePickModal()}}};var X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pick-media-for-markdown"},[e("BaseModal2",{attrs:{title:t.$t("add_media")},on:{close:t.closePickModal},scopedSlots:t._u([t.medias_were_picked?{key:"footer",fn:function(){return[e("div"),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.insertToText}},[t._v(" "+t._s(t.$t("add"))+" ")])]},proxy:!0}:null],null,!0)},[t.pick_medias_text?t._e():e("div",{staticClass:"u-spacingBottom"},[t._v(" "+t._s(t.$t("from_project"))+" "),e("b-icon",{attrs:{icon:"arrow-right"}}),t._v("  "),e("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:function(s){t.show_media_picker=!0}}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"image"}}),t._v(" "+t._s(t.$t("import"))+" ")],1)],1),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication_path,select_mode:"multiple",pick_from_types:["image","video","audio","text"]},on:{pickMedias:t.pickMedias,close:function(s){t.show_media_picker=!1}}}):t._e(),t.pick_medias_text?[e("div",{staticClass:"u-spacingBottom u-inputGroup"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.pick_medias_text,expression:"pick_medias_text"}],ref:"urlToCopy",staticClass:"_textField",domProps:{value:t.pick_medias_text},on:{input:function(s){s.target.composing||(t.pick_medias_text=s.target.value)}}}),t._v(" "),e("button",{staticClass:"u-button u-button_icon u-suffix _clipboardBtn",attrs:{type:"button"},on:{click:t.copyToClipboard}},[t.isCopied?e("b-icon",{attrs:{icon:"clipboard-check"}}):e("b-icon",{attrs:{icon:"clipboard"}})],1)]),t.pick_medias_list.length>1?e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("layout")}}),e("label",{staticClass:"u-switch u-switch-xs u-switch_twoway"},[e("label",{staticClass:"_switchLabel",attrs:{for:"medias_on_new_line"}},[t._v(" "+t._s(t.$t("side_by_side"))+" "),e("b-icon",{attrs:{icon:"three-dots"}})],1),e("input",{directives:[{name:"model",rawName:"v-model",value:t.medias_on_new_line,expression:"medias_on_new_line"}],attrs:{id:"medias_on_new_line",type:"checkbox"},domProps:{checked:Array.isArray(t.medias_on_new_line)?t._i(t.medias_on_new_line,null)>-1:t.medias_on_new_line},on:{change:function(s){var a=t.medias_on_new_line,n=s.target,o=!!n.checked;if(Array.isArray(a)){var r=null,c=t._i(a,r);n.checked?c<0&&(t.medias_on_new_line=a.concat([r])):c>-1&&(t.medias_on_new_line=a.slice(0,c).concat(a.slice(c+1)))}else t.medias_on_new_line=o}}}),e("label",{staticClass:"_switchLabel",attrs:{for:"medias_on_new_line"}},[t._v(" "+t._s(t.$t("new_line"))+" "),e("b-icon",{attrs:{icon:"three-dots-vertical"}})],1)])],1):t._e()]:e("div",{staticClass:"u-spacingBottom"},[e("hr"),t._v(" "+t._s(t.$t("multisupport_embed_img_instr"))+" "),e("ul",[e("li",[e("code",[t._v("(image: https://www.example.com/url-vers-l-image.jpeg) ")])]),e("li",[e("code",[t._v("(video: https://www.example.com/url-vers-la-video.mp4) ")])]),e("li",[e("code",[t._v("(audio: https://www.example.com/url-vers-la-musique.mp3) ")])]),e("li",[e("code",[t._v("(embed: https://peertube.fr/w/wB6M6CHdfpWXpozVnqjbde) ")])]),e("li",[e("code",[t._v("(embed: https://www.youtube.com/watch?v=Bn6zdyCAwJs) ")])]),e("li",[e("code",[t._v("(embed: https://scratch.mit.edu/projects/1061783643) ")])])])]),e("DetailsPane",{attrs:{header:t.$t("advanced_options"),icon:"rulers",has_items:!1}},[e("div",{staticClass:"u-spacingBottom"},[t._v(" "+t._s(t.$t("attributes_for_embeds"))+" "),e("ul",[e("li",[e("code",[t._v("caption: Ma légende")])]),e("li",[e("code",[t._v("class: nomDeLaClasse")])]),e("li",[e("code",[t._v("float: left")])]),e("li",[e("code",[t._v("float: right")])])])]),e("div",[t._v(" "+t._s(t.$t("for_example"))+" "),e("div",[e("code",[t._v("(embed: https://peertube.fr/w/wB6M6CHdfpWXpozVnqjbde caption: Voici une vidéo de PeerTube class: maClass)")])])])]),e("div",{staticClass:"u-spacingBottom"}),t.medias_were_picked?e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("copy_paste_to_include_media_or_click_to_add_at_cursor"))+" ")]):t._e()],2)],1)},Y=[],J=d(N,X,Y,!1,null,"f346d29a");const U=J.exports,Z={props:{chapter:Object,publication:Object},components:{MediaPicker:g},data(){return{show_media_picker:!1}},computed:{gallery_medias(){const i=[];if(this.chapter.section_type!=="gallery"||!this.chapter.source_medias)return[];for(const t of this.chapter.source_medias){const e=this.getParent(this.chapter.$path),s=this.getSourceMedia({source_media:t,folder_path:e});s&&i.push(s)}return i}},methods:{async pickMediasForGallery(i){const t=[];for(const a of i){const n=this.$root.publication_include_mode,o=await this.prepareMediaForPublication({path_to_source_media_meta:a.$path,publication_path:this.publication.$path,import_mode:n});t.push(o)}const s=[...this.chapter.source_medias||[],...t];this.$api.updateMeta({path:this.chapter.$path,new_meta:{source_medias:s}})},removeMedia(i){const t=this.chapter.source_medias.filter(e=>e.meta_filename_in_project!==this.getFilename(i.$path));this.$api.updateMeta({path:this.chapter.$path,new_meta:{source_medias:t}})}}};var K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_galleryChapter"},[e("transition-group",{staticClass:"_gallery",attrs:{tag:"div",name:"StoryModules",appear:""}},[t._l(t.gallery_medias,function(s){return e("div",{key:s.$path,staticClass:"_gallery--item"},[e("MediaContent",{attrs:{file:s,context:"full"}}),e("div",{staticClass:"_remove_media"},[e("RemoveMenu",{attrs:{show_button_text:!1},on:{remove:function(a){return t.removeMedia(s)}}})],1)],1)}),e("div",{key:"add_medias",staticClass:"_add_medias"},[e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(s){t.show_media_picker=!0}}},[t._v(" "+t._s(t.$t("add_medias"))+" ")])])],2),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication.$path,select_mode:"multiple",pick_from_types:["image"]},on:{pickMedias:t.pickMediasForGallery,close:function(s){t.show_media_picker=!1}}}):t._e()],1)},Q=[],tt=d(Z,K,Q,!1,null,"a9c65ddf");const et=tt.exports,st={props:{chapter:{type:Object,required:!0}},components:{},data(){return{selected_area_id:null,resizing_area_id:null,dragging_area_id:null,drag_start_pos:null,resize_start_pos:null,initial_area_position:null}},computed:{column_count(){return this.chapter.column_count||6},row_count(){return this.chapter.row_count||6},grid_areas(){return this.chapter.grid_areas||[]}},methods:{generateNextLetterId(){const i=this.grid_areas.map(s=>s.id);let t=0,e=this.getAreaLetter(t);for(;i.includes(e);)t++,e=this.getAreaLetter(t);return e},updateChapter(i){this.$api.updateMeta({path:this.chapter.$path,new_meta:i})},deleteArea(i){const t=this.grid_areas.filter(e=>e.id!==i);this.updateChapter({grid_areas:t})},selectArea(i){this.selected_area_id=i},findAreaById(i){return this.grid_areas.find(t=>t.id===i)},getAreaLetter(i){let t="",e=i;for(;e>=0;)t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26)-1;return t},getCellPosition(i){const t=Math.ceil(i/this.column_count);return{col:(i-1)%this.column_count+1,row:t}},isCellOccupied(i){const{col:t,row:e}=this.getCellPosition(i);return this.grid_areas.some(s=>t>=s.column_start&&t<s.column_end&&e>=s.row_start&&e<s.row_end)},addAreaAtCell(i){if(this.isCellOccupied(i))return;const{col:t,row:e}=this.getCellPosition(i),s={id:this.generateNextLetterId(),column_start:t,column_end:t+1,row_start:e,row_end:e+1},a=[...this.grid_areas,s];this.updateChapter({grid_areas:a})},startDrag(i,t){this.dragging_area_id=i,this.drag_start_pos={x:t.clientX,y:t.clientY};const e=this.findAreaById(i);this.initial_area_position={column_start:e.column_start,row_start:e.row_start},document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.stopDrag)},handleDrag(i){if(this.dragging_area_id===null)return;const t=this.$el.querySelector("._gridOverlay"),e=t.getBoundingClientRect(),s=parseFloat(getComputedStyle(t).gap.replace("px","")),a=(e.width-s*(this.column_count-1))/this.column_count,n=(e.height-s*(this.row_count-1))/this.row_count,o=i.clientX-this.drag_start_pos.x,r=i.clientY-this.drag_start_pos.y,c=Math.round(o/(a+s)),u=Math.round(r/(n+s)),_=this.findAreaById(this.dragging_area_id),l=_.column_end-_.column_start,p=_.row_end-_.row_start;let h=this.initial_area_position.column_start+c,m=this.initial_area_position.row_start+u;h=Math.max(1,Math.min(h,this.column_count-l+1)),m=Math.max(1,Math.min(m,this.row_count-p+1));const b=h+l,$=m+p;if(h!==_.column_start||m!==_.row_start){const w=this.grid_areas.map(v=>v.id===this.dragging_area_id?{...v,column_start:h,column_end:b,row_start:m,row_end:$}:v);this.updateChapter({grid_areas:w})}},stopDrag(){this.dragging_area_id=null,this.drag_start_pos=null,this.initial_area_position=null,document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag)},startResize(i,t){this.resizing_area_id=i,this.resize_start_pos={x:t.clientX,y:t.clientY};const e=this.findAreaById(i);this.initial_area_position={column_end:e.column_end,row_end:e.row_end},document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize)},handleResize(i){if(this.resizing_area_id===null)return;const t=this.$el.querySelector("._gridOverlay"),e=t.getBoundingClientRect(),s=parseFloat(getComputedStyle(t).gap.replace("px","")),a=(e.width-s*(this.column_count-1))/this.column_count,n=(e.height-s*(this.row_count-1))/this.row_count,o=i.clientX-this.resize_start_pos.x,r=i.clientY-this.resize_start_pos.y,c=Math.round(o/(a+s)),u=Math.round(r/(n+s)),_=this.findAreaById(this.resizing_area_id);let l=this.initial_area_position.column_end+c,p=this.initial_area_position.row_end+u;if(l=Math.max(_.column_start+1,Math.min(l,this.column_count+1)),p=Math.max(_.row_start+1,Math.min(p,this.row_count+1)),l!==_.column_end||p!==_.row_end){const h=this.grid_areas.map(m=>m.id===this.resizing_area_id?{...m,column_end:l,row_end:p}:m);this.updateChapter({grid_areas:h})}},stopResize(){this.resizing_area_id=null,this.resize_start_pos=null,this.initial_area_position=null,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize)}},beforeDestroy(){document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag)}};var it=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_grid"},[e("div",{staticClass:"_gridWrapper"},[e("div",{staticClass:"_gridBackground",style:{display:"grid",gridTemplateColumns:`repeat(${t.column_count}, 1fr)`,gridTemplateRows:`repeat(${t.row_count}, 1fr)`,gap:"calc(var(--spacing) / 2)"}},t._l(t.column_count*t.row_count,function(s){return e("div",{key:"bg-"+s,staticClass:"_gridCell--background",class:{"_gridCell--occupied":t.isCellOccupied(s)},on:{click:function(a){return t.addAreaAtCell(s)}}},[t.isCellOccupied(s)?t._e():e("div",{staticClass:"_gridCell--addIcon"},[e("b-icon",{attrs:{icon:"plus-lg"}})],1)])}),0),e("div",{staticClass:"_gridOverlay",style:{display:"grid",gridTemplateColumns:`repeat(${t.column_count||1}, 1fr)`,gridTemplateRows:`repeat(${t.row_count||1}, 1fr)`,gap:"calc(var(--spacing) / 2)"}},t._l(t.grid_areas,function(s,a){return e("div",{key:s.id,staticClass:"_gridArea",class:{"_gridArea--selected":t.selected_area_id===s.id,"_gridArea--dragging":t.dragging_area_id===s.id},style:{gridColumnStart:s.column_start,gridColumnEnd:s.column_end,gridRowStart:s.row_start,gridRowEnd:s.row_end},on:{click:function(n){return t.selectArea(s.id)},mousedown:function(n){return t.startDrag(s.id,n)}}},[e("div",{staticClass:"_gridArea--label"},[t._v(" "+t._s(s.id)+" ")]),e("div",{staticClass:"_resizeHandle",on:{mousedown:function(n){return n.stopPropagation(),t.startResize(s.id,n)}}},[e("svg",{attrs:{width:"12",height:"12",viewBox:"0 0 12 12"}},[e("path",{attrs:{d:"M12 0 L12 12 L0 12 Z",fill:"currentColor"}})])]),e("button",{staticClass:"_deleteArea",attrs:{type:"button",title:t.$t("delete")},on:{click:function(n){return n.stopPropagation(),t.deleteArea(s.id)}}},[t._v(" × ")])])}),0)]),t.grid_areas.length===0?e("div",{staticClass:"_addAreaButton"},[e("p",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("click_empty_cell_to_add_area"))+" ")])]):t._e()])},at=[],nt=d(st,it,at,!1,null,"adb294b4");const ot=nt.exports,rt={props:{area:{type:Object,required:!0},area_text_meta:{type:Object}},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var ct=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_gridItem"},[e("div",{staticClass:"_gridItem--header"},[t._v(t._s(t.area.id))]),e("div",{staticClass:"_gridItem--content"},[t.area_text_meta?e("div",[e("CollaborativeEditor3",{ref:"collaborativeEditor",attrs:{content:t.area_text_meta.$content,path:t.area_text_meta.$path,custom_formats:[],save_format:"raw",content_type:"markdown",can_edit:!0,mode:"always_active"},scopedSlots:t._u([{key:"custom_buttons",fn:function(){return[e("button",{staticClass:"u-button u-button_bleumarine _customBtn",attrs:{type:"button"},on:{click:function(s){t.show_media_picker=!t.show_media_picker}}},[t._v(" "+t._s(t.$t("import_medias"))+" ")])]},proxy:!0}])})],1):e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(s){return t.$emit("createText",t.area.id)}}},[t._v(" "+t._s(t.$t("add_text"))+" ")])])])},_t=[],lt=d(rt,ct,_t,!1,null,"5e171d4f");const ut=lt.exports,dt={props:{chapter:Object,publication:Object},components:{GridAreas:ot,GridItem:ut},data(){return{}},computed:{},methods:{updateChapter(i){this.$api.updateMeta({path:this.chapter.$path,new_meta:i})},async createText(i){const t=i+"_text.md";await this.$api.uploadText({path:this.publication.$path,filename:t,content:"",additional_meta:{content_type:"markdown",grid_area_id:i}})},getAreaTextMeta(i){return this.publication.$files.find(t=>t.grid_area_id===i.id)}}};var pt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_gridChapter"},[e("div",{staticClass:"_gridAreas"},[e("div",{staticClass:"_gridInputs"},[e("NumberInput",{attrs:{label:t.$t("column_count"),value:t.chapter.column_count||6,suffix:t.$t("columns"),size:"medium",min:1,max:12},on:{save:function(s){return t.updateChapter({column_count:s})}}}),e("NumberInput",{attrs:{label:t.$t("row_count"),value:t.chapter.row_count||6,suffix:t.$t("rows"),size:"medium",min:1,max:12},on:{save:function(s){return t.updateChapter({row_count:s})}}})],1),e("GridAreas",{attrs:{chapter:t.chapter}})],1),e("hr"),e("div",{staticClass:"_gridItems"},t._l(t.chapter.grid_areas,function(s){return e("GridItem",{key:s.id,attrs:{area:s,area_text_meta:t.getAreaTextMeta(s)},on:{createText:t.createText}})}),1)])},mt=[],ht=d(dt,pt,mt,!1,null,"ee0da98b");const ft=ht.exports,vt={props:{chapter:Object,chapters:Array,prev_section:Object,next_section:Object,publication:Object,chapter_position:Object,view_mode:String},components:{PickMediaForMarkdown:U,GalleryChapter:et,GridChapter:ft,SingleSection:()=>x(()=>import("./SingleSection-CW77nqIh.js"),[])},data(){return{show_media_picker:!1}},created(){},mounted(){},beforeDestroy(){},watch:{main_text_content:{handler(i){i&&this.listAllEmbeddedMedias(i)},deep:!0}},computed:{content_type(){var i;return((i=this.chapter._main_text)==null?void 0:i.content_type)||"html"},custom_formats(){if(this.content_type==="markdown")return[]},save_format(){return this.content_type==="html"?"html":this.content_type==="markdown"?"raw":"html"},main_text_content(){var i;return(i=this.chapter._main_text)==null?void 0:i.$content},starts_on_page_options(){return this.chapter.section_type==="gallery"?[{key:"page",text:this.$t("next_page")},{key:"left",text:this.$t("next_left_page")},{key:"right",text:this.$t("next_right_page")}]:[{key:"",text:this.$t("in_flow")},{key:"page",text:this.$t("next_page")},{key:"left",text:this.$t("next_left_page")},{key:"right",text:this.$t("next_right_page")}]}},methods:{listAllEmbeddedMedias(i){let t=[];const e=new S;e.use(M,{getMediaSrc:n=>{const o=this.getParent(this.chapter.$path);let r=this.transformMediaSrc(n);return this.getSourceMedia({source_media:r,folder_path:o})},vue_instance:this});const s=e.renderer.rules.image||function(n,o,r,c,u){return u.renderToken(n,o,r)};e.renderer.rules.image=(n,o,r,c,u)=>{const _=n[o],l=_.attrIndex("src");if(l>=0){const p=_.attrs[l][1],h=this.getParent(this.chapter.$path);this.getSourceMedia({source_media:{meta_filename_in_project:p},folder_path:h})&&t.push({meta_filename_in_project:p})}return s(n,o,r,c,u)};const a=e.renderer.rules.csc;e.renderer.rules.csc=(n,o)=>{const r=n[o];if(["image","video","audio"].includes(r.tag)&&r.content){const c=r.content,u=this.getParent(this.chapter.$path),_=this.transformMediaSrc(c);this.getSourceMedia({source_media:_,folder_path:u})&&t.push(_)}return a?a(n,o):""},e.render(i),t=t.filter((n,o,r)=>o===r.findIndex(c=>c.meta_filename_in_project===n.meta_filename_in_project||c.meta_filename===n.meta_filename)),JSON.stringify(t)!==JSON.stringify(this.chapter.source_medias)&&this.$api.updateMeta({path:this.chapter.$path,new_meta:{source_medias:t}})},closePickModal(){this.show_media_picker=!1},insertToText(i){const t=this.$refs.collaborativeEditor;t&&t.insertAtCursor(i)},transformMediaSrc(i){return i.startsWith("./")?{meta_filename:i.substring(2)}:i.startsWith("../")?{meta_filename_in_project:i.substring(3)}:{meta_filename_in_project:i}}}};var gt=function(){var s;var t=this,e=t._self._c;return e("div",{staticClass:"_openChapter"},[e("div",{staticClass:"_navBtns"},[e("div",{staticClass:"_navBtns--content"},[e("div",{}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.next_section||t.prev_section,expression:"next_section || prev_section"}],staticClass:"_navBtns--content--buttons"},[e("span",[t.prev_section?e("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:function(a){return t.$emit("prev")}}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),e("span",[t._v(" "+t._s(t.prev_section.section_title)+" ")])],1):e("span",[t._v("–")])]),e("span",{staticClass:"_separator"},[t._v("|")]),e("span",[t.next_section?e("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:function(a){return t.$emit("next")}}},[e("span",[t._v(" "+t._s(t.next_section.section_title)+" ")]),e("b-icon",{attrs:{icon:"arrow-right-short"}})],1):e("span",[t._v("–")])])]),e("div",[e("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:function(a){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x",label:t.$t("close")}}),t._v(" "+t._s(t.$t("close"))+" ")],1)])])]),e("div",{staticClass:"_openChapter--content"},[e("div",{staticClass:"_topButtons"},[e("TitleField",{attrs:{field_name:"section_title",content:t.chapter.section_title,maxlength:100,tag:"h1",path:t.chapter.$path,can_edit:!0}}),e("DropDown",{attrs:{right:!0,show_label:!1}},[e("RemoveMenu",{on:{remove:function(a){return t.$emit("remove")}}})],1)],1),e("div",{staticClass:"_infos"},[e("div",{staticClass:"_content--type"},[t.chapter.section_type==="text"?[e("b-icon",{attrs:{icon:"markdown"}}),t._v(" "+t._s(t.$t("text"))+" ")]:t.chapter.section_type==="gallery"?[e("b-icon",{attrs:{icon:"image"}}),t._v(" "+t._s(t.$t("gallery"))+" ")]:t.chapter.section_type==="grid"?[e("b-icon",{attrs:{icon:"grid-fill"}}),t._v(" "+t._s(t.$t("grid"))+" ")]:t.chapter.section_type==="story"?[e("b-icon",{attrs:{icon:"list"}}),t._v(" "+t._s(t.$t("story"))+" ")]:t._e()],2),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.view_mode==="book"&&((s=t.chapter_position)!=null&&s.first_page)?e("div",[e("div",{key:t.chapter_position.first_page,staticClass:"_selects--pageRange"},[t._v(" p."+t._s(t.chapter_position.first_page)+" "),t.chapter_position.first_page!==t.chapter_position.last_page?[e("b-icon",{attrs:{icon:"arrow-right-short"}}),t._v(" p."+t._s(t.chapter_position.last_page)+" ")]:t._e()],2)]):t._e()])],1),t.chapter.section_type==="text"&&t.view_mode==="book"?e("fieldset",{staticClass:"u-spacingBottom _layout"},[e("legend",[t._v(t._s(t.$t("layout")))]),e("div",{staticClass:"_optionsRow"},[e("div",{staticClass:"_colCount"},[e("DLabel",{attrs:{str:t.$t("column_count")}}),e("div",{},[e("SelectField2",{attrs:{field_name:"column_count",value:t.chapter.column_count||1,path:t.chapter.$path,size:"small",hide_validation:!0,can_edit:!0,options:[{key:1,text:"1"},{key:2,text:"2"},{key:3,text:"3"}]}})],1)],1),e("div",{staticClass:"_selects--starts_on_page"},[e("DLabel",{attrs:{str:t.$t("starts_on_page")}}),e("SelectField2",{attrs:{field_name:"section_starts_on_page",value:t.chapter.section_starts_on_page||"",path:t.chapter.$path,size:"small",hide_validation:!0,can_edit:!0,options:t.starts_on_page_options}})],1)])]):t._e(),e("div",{staticClass:"_content"},[t.chapter.section_type==="text"?[t.chapter._main_text?[e("DLabel",{attrs:{str:t.$t("content")}}),e("CollaborativeEditor3",{ref:"collaborativeEditor",attrs:{content:t.main_text_content,path:t.chapter._main_text.$path,custom_formats:t.custom_formats,save_format:t.save_format,content_type:"markdown",can_edit:!0,mode:"always_active"},scopedSlots:t._u([{key:"custom_buttons",fn:function(){return[e("button",{staticClass:"u-button u-button_bleumarine _customBtn",attrs:{type:"button"},on:{click:function(a){t.show_media_picker=!t.show_media_picker}}},[t._v(" "+t._s(t.$t("import_medias"))+" ")])]},proxy:!0}],null,!1,2050969443)}),t.show_media_picker?e("PickMediaForMarkdown",{attrs:{publication_path:t.publication.$path},on:{insertToText:t.insertToText,close:t.closePickModal}}):t._e()]:[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("no_content"))+" ")])]]:t._e(),t.chapter.section_type==="gallery"?[e("GalleryChapter",{attrs:{chapter:t.chapter,publication:t.publication}})]:t._e(),t.chapter.section_type==="grid"?[e("GridChapter",{attrs:{chapter:t.chapter,publication:t.publication}})]:t._e(),t.chapter.section_type==="story"?[e("SingleSection",{staticClass:"_singleSection",attrs:{publication:t.publication,section:t.chapter,can_edit:!0}})]:t._e()],2)])])},yt=[],bt=d(vt,gt,yt,!1,null,"f347cdb1");const $t=bt.exports,wt={props:{style_file:Object,default_styles:String,show_source_html:Boolean},components:{},data(){return{show_reset_modal:!1,show_remove_modal:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{pretty_default_styles(){return y.highlight(this.default_styles,{language:"css"}).value}},methods:{async resetCustom(){this.$refs.styleEditor.restoreVersion(this.default_styles),this.show_reset_modal=!1}}};var Ct=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openedStyleFile"},[t.style_file.$path==="default"?[e("h2",[t._v(t._s(t.$t("default_styles")))])]:[e("TitleField",{attrs:{label:t.$t("name"),show_label:!1,field_name:"css_title",tag:"h2",content:t.style_file.css_title,path:t.style_file.$path,maxlength:40,can_edit:!0}})],e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"_topBtns"},[e("ToggleInput",{attrs:{content:t.show_source_html,label:t.$t("show_source_html")},on:{"update:content":function(s){return t.$emit("update:show_source_html",s)}}}),t.style_file.$path!=="default"?[e("button",{key:"resetCustom",staticClass:"u-buttonLink u-buttonLink_red",attrs:{type:"button"},on:{click:function(s){t.show_reset_modal=!0}}},[t._v(" "+t._s(t.$t("back_to_default_styles"))+" ")]),t.show_reset_modal?e("BaseModal2",{attrs:{title:t.$t("back_to_default_styles")},on:{close:function(s){t.show_reset_modal=!1},save:t.resetCustom}},[e("div",{staticClass:"defaultCode"},[e("pre",{domProps:{innerHTML:t._s(t.pretty_default_styles)}})]),e("template",{slot:"footer"},[e("SaveCancelButtons",{attrs:{cancel_text:t.$t("cancel"),save_text:t.$t("reset")},on:{save:t.resetCustom,cancel:function(s){t.show_reset_modal=!1}}})],1)],2):t._e(),e("button",{staticClass:"u-buttonLink u-buttonLink_red",attrs:{type:"button"},on:{click:function(s){t.show_remove_modal=!0}}},[e("b-icon",{attrs:{icon:"trash"}}),t._v(" "+t._s(t.$t("remove"))+" ")],1),t.show_remove_modal?e("RemoveMenu2",{attrs:{modal_title:t.$t("remove_css_file",{name:t.style_file.css_title}),path:t.style_file.$path},on:{removedSuccessfully:function(s){return t.$emit("close")},close:function(s){t.show_remove_modal=!1}}}):t._e()]:t._e()],2),t.style_file.$path!=="default"?e("CollaborativeEditor3",{key:t.style_file.$path,ref:"styleEditor",attrs:{content:t.style_file.$content,path:t.style_file.$path,custom_formats:[],save_format:"raw",mode:"always_active",can_edit:!0}}):e("div",{staticClass:"defaultCode"},[e("pre",{domProps:{innerHTML:t._s(t.pretty_default_styles)}})]),e("div",{staticClass:"u-spacingBottom"})],2)},kt=[],xt=d(wt,Ct,kt,!1,null,"e0c28339");const St=xt.exports,Mt={props:{publication:Object,opened_style_file_meta:String,show_source_html:Boolean},components:{OpenedGraphicStyles:St},data(){return{default_styles:f,show_create_css_modal:!1,new_css_title:""}},created(){},mounted(){},beforeDestroy(){this.$emit("update:show_source_html",!1)},watch:{},computed:{pretty_default_styles(){return y.highlight(this.default_styles,{language:"css"}).value},style_files(){var i;return(i=this.publication.$files)==null?void 0:i.filter(t=>t.is_css_styles===!0).sort((t,e)=>{const s=t.css_title||this.getFilename(t.$path),a=e.css_title||this.getFilename(e.$path);if(s<a)return-1;if(s>a)return 1})},opened_style_file(){return this.opened_style_file_meta==="default"||this.style_files.length===0?{$path:"default",css_title:this.$t("default_styles"),$content:f,is_default:!0}:this.style_files.find(i=>this.getFilename(i.$path)===this.opened_style_file_meta)}},methods:{async createCustomStylesheet(){const i=this.new_css_title+".css",{meta_filename:t}=await this.$api.uploadText({path:this.publication.$path,filename:i,content:f,additional_meta:{$type:"text",css_title:this.new_css_title,is_css_styles:!0}});this.new_css_title="",this.show_create_css_modal=!1,this.$emit("setStyleFile",t)},async resetCustom(){this.$refs.styleEditor.restoreVersion(f)},openStyleFile(i){this.$emit("setStyleFile",this.getFilename(i))},openDefaultStyles(){this.$emit("setStyleFile","default")}}};var Pt=function(){var s;var t=this,e=t._self._c;return e("div",{staticClass:"_editGraphicStyles"},[e("div",{staticClass:"_close_button"},[e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button"},on:{click:function(a){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("div",{staticClass:"_topTabs"},[t._l(t.style_files,function(a){var n;return e("button",{key:a.$path,staticClass:"u-button",class:{"is--active":((n=t.opened_style_file)==null?void 0:n.$path)===a.$path},attrs:{type:"button"},on:{click:function(o){return t.openStyleFile(a.$path)}}},[t._v(" "+t._s(a.css_title||t.getFilename(a.$path))+" ")])}),e("button",{staticClass:"u-button",class:{"is--active":((s=t.opened_style_file)==null?void 0:s.$path)==="default"},attrs:{type:"button"},on:{click:t.openDefaultStyles}},[t._v(" "+t._s(t.$t("default_styles"))+" ")]),e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(a){t.show_create_css_modal=!0}}},[t._v(" "+t._s(t.$t("create_custom_stylesheet"))+" ")]),t.show_create_css_modal?e("BaseModal2",{attrs:{title:t.$t("create_custom_stylesheet")},on:{close:function(a){t.show_create_css_modal=!1},save:t.createCustomStylesheet},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div"),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.createCustomStylesheet}},[e("b-icon",{attrs:{icon:"plus-circle"}}),t._v(" "+t._s(t.$t("create_and_open"))+" ")],1)]},proxy:!0}],null,!1,4091224930)},[e("DLabel",{attrs:{str:t.$t("name")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_css_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(a){t.new_css_title=a},toggleValidity:a=>t.allow_save=a,onEnter:t.createCustomStylesheet}})],1):t._e()],2),e("div",{staticClass:"_openedStyleFile"},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.opened_style_file?e("OpenedGraphicStyles",{key:t.opened_style_file.$path,attrs:{style_file:t.opened_style_file,default_styles:t.default_styles,show_source_html:t.show_source_html},on:{"update:show_source_html":function(a){return t.$emit("update:show_source_html",a)},close:t.openDefaultStyles}}):t._e()],1)],1)])},Ft=[],Tt=d(Mt,Pt,Ft,!1,null,"089891c9");const At=Tt.exports,Lt={props:{publication:Object,pane_infos:Object,can_edit:Boolean},components:{Splitpanes:C,Pane:k,ChaptersSummary:q,OpenChapter:$t,ViewContent:P,GraphicStyles:At,PublicationSettings:F,WidthHeightField:T},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{show_edit_pane:!0,show_preview_pane:!0,show_source_html:!1,chapters_positions:{}}},created(){},mounted(){},beforeDestroy(){this.$emit("updatePane",{key:"chapter",value:!1})},watch:{},computed:{view_mode(){var i;return((i=this.pane_infos)==null?void 0:i.view_mode)||"book"},all_chapters(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"}).map(i=>(i.main_text_meta&&(i._main_text=this.publication.$files.find(t=>t.$path.endsWith("/"+i.main_text_meta))),i.section_type||(i.section_type="text"),i))},opened_section_meta_filename(){return this.pane_infos.chapter},opened_chapter(){return this.opened_section_meta_filename?this.all_chapters.find(i=>i.$path.endsWith(this.opened_section_meta_filename)):!1},prev_section(){if(!this.opened_chapter)return!1;const i=this.all_chapters.findIndex(t=>t.$path.endsWith(this.opened_section_meta_filename));return this.all_chapters[i-1]},next_section(){if(!this.opened_chapter)return!1;const i=this.all_chapters.findIndex(t=>t.$path.endsWith(this.opened_section_meta_filename));return this.all_chapters[i+1]},show_graphic_styles(){var i;return((i=this.pane_infos)==null?void 0:i.edit_graphics)===!0},opened_style_file_meta(){var i;return((i=this.pane_infos)==null?void 0:i.style)||"first"},meta_filenames_already_present(){let i=[],t=[];return this.all_chapters.forEach(e=>{Array.isArray(e.source_medias)&&e.source_medias.forEach(s=>{this.getFilename(e.$path)===this.opened_section_meta_filename?i.push(s.meta_filename_in_project):t.push(s.meta_filename_in_project)})}),[{label:this.$t("in_this_section"),medias:i,color:"var(--c-orange)"},{label:this.$t("in_another_section"),medias:t,color:"var(--c-bleuvert)"}]}},methods:{openChapter(i){const e=this.all_chapters.findIndex(s=>s.$path.endsWith(this.opened_section_meta_filename))+i;if(e>=0&&e<=this.all_chapters.length-1){const s=this.getFilename(this.all_chapters[e].$path);this.$emit("updatePane",{key:"chapter",value:s})}},async removeChapter(i){i._main_text&&await this.$api.deleteItem({path:i._main_text.$path}),await this.$api.deleteItem({path:i.$path})},getChapterPosition(i){const t=this.getFilename(i);return this.chapters_positions[t]}}};var Bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_editionTemplate"},[t.can_edit?e("splitpanes",{staticClass:"_splitpanes"},[t.show_edit_pane?e("pane",[e("div",{staticClass:"_chapterSummary"},[e("div",{staticClass:"_chapterSummary--content"},[e("div",{staticClass:"_showPreviewBtn"},[e("ToggleInput",{attrs:{content:t.show_preview_pane,label:t.$t("show_preview")+" ➵"},on:{"update:content":function(s){t.show_preview_pane=s}}})],1),e("ChaptersSummary",{attrs:{publication:t.publication,sections:t.all_chapters,opened_section_meta_filename:t.opened_section_meta_filename,view_mode:t.view_mode,chapters_positions:t.chapters_positions},on:{toggleSection:function(s){return t.$emit("updatePane",{key:"chapter",value:s})}}})],1)]),e("div",{staticClass:"_editGraphics"},[e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(s){return t.$emit("updatePane",{key:"edit_graphics",value:!0})}}},[e("b-icon",{attrs:{icon:"file-code"}}),t._v(" "+t._s(t.$t("graphic_styles"))+" ")],1)]),e("transition",{attrs:{name:"pagechange",mode:"in-out"}},[t.show_graphic_styles?e("GraphicStyles",{key:"edit_graphics",attrs:{publication:t.publication,opened_style_file_meta:t.opened_style_file_meta,show_source_html:t.show_source_html},on:{"update:show_source_html":function(s){t.show_source_html=s},close:function(s){return t.$emit("updatePane",{key:"edit_graphics",value:!1})},setStyleFile:function(s){return t.$emit("updatePane",{key:"style",value:s})}}}):t.opened_chapter?e("OpenChapter",{key:t.opened_chapter.$path,attrs:{chapter:t.opened_chapter,chapters:t.all_chapters,prev_section:t.prev_section,next_section:t.next_section,publication:t.publication,chapter_position:t.getChapterPosition(t.opened_chapter.$path),view_mode:t.view_mode},on:{remove:function(s){return t.removeChapter(t.opened_chapter)},close:function(s){return t.$emit("updatePane",{key:"chapter",value:!1})},prev:function(s){return t.openChapter(-1)},next:function(s){return t.openChapter(1)}}}):t._e()],1)],1):t._e(),t.show_preview_pane?e("pane",[e("div",{staticClass:"_viewer"},[e("ViewContent",{attrs:{publication:t.publication,opened_chapter_meta_filename:t.opened_section_meta_filename,view_mode:t.view_mode,opened_style_file_meta:t.opened_style_file_meta,show_source_html:t.show_source_html,show_source_html_toggle:t.can_edit&&t.view_mode==="book",can_edit:t.can_edit},on:{"update:show_source_html":function(s){t.show_source_html=s},openChapter:function(s){return t.$emit("updatePane",{key:"chapter",value:s})},changeView:function(s){return t.$emit("updatePane",{key:"view_mode",value:s})},setStyleFile:function(s){return t.$emit("updatePane",{key:"style",value:s})},updateChaptersPositions:function(s){t.chapters_positions=s}}})],1)]):t._e()],1):t._e(),t.can_edit?e("PublicationSettings",[e("WidthHeightField",{attrs:{publication:t.publication,force_layout_mode:"print"}})],1):e("div",{staticClass:"_previewMode"},[e("ViewContent",{attrs:{publication:t.publication,opened_chapter_meta_filename:t.opened_section_meta_filename,view_mode:t.view_mode,opened_style_file_meta:t.opened_style_file_meta,viewer_type:"div",can_edit:!1},on:{openChapter:function(s){return t.$emit("updatePane",{key:"chapter",value:s})},changeView:function(s){return t.$emit("updatePane",{key:"view_mode",value:s})},setStyleFile:function(s){return t.$emit("updatePane",{key:"style",value:s})}}})],1)],1)},Rt=[],jt=d(Lt,Bt,Rt,!1,null,"e597b355");const qt=jt.exports;export{qt as default};
