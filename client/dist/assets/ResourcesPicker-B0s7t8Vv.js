import{n as a,f as c}from"../build.js";const l={props:{files:{type:Array,required:!0},downloading:{type:Array,default:()=>[]},resources_base_url:{type:String,required:!0},selected_project_path:{type:String,required:!0}},methods:{makeMediaFileURL(r){return this.resources_base_url+"/"+this.selected_project_path+"/"+r.$media_filename}}};var n=function(){var e=this,s=e._self._c;return s("div",{staticClass:"_filesGrid"},e._l(e.files,function(t){return s("div",{key:t.$path,staticClass:"u-card2 _fileCard"},[e.downloading.includes(t.$media_url)?s("div",{staticClass:"_downloading"},[s("LoaderSpinner"),s("p",[e._v(e._s(e.$t("downloading")))])],1):[s("div",{staticClass:"_preview"},[t.$type==="image"?s("img",{attrs:{src:e.makeMediaFileURL(t),alt:t.$title||t.$media_filename,loading:"lazy"}}):t.$type==="video"?s("video",{attrs:{src:e.makeMediaFileURL(t),preload:"metadata"}}):t.$type==="audio"?s("audio",{attrs:{src:e.makeMediaFileURL(t),controls:""}}):s("div",{staticClass:"_filePlaceholder"},[e._v(" "+e._s(t.$type||"FILE")+" ")])]),s("div",{staticClass:"_info"},[s("p",{staticClass:"_fileTitle"},[e._v(" "+e._s(t.$title||t.$media_filename)+" ")]),s("button",{staticClass:"u-button u-button--small",on:{click:function(i){return e.$emit("download",t)}}},[e._v(" "+e._s(e.$t("download"))+" ")])])]],2)}),0)},_=[],d=a(l,n,_,!1,null,"4f540b23");const u=d.exports,p={components:{ResourceFilesGrid:u},mixins:[c],props:{project_path:{type:String,required:!0},select_mode:{type:String,default:"single"},pick_from_types:{type:[String,Array],default:()=>["image","video","audio"]}},data(){return{resources_projects_list:[],selected_project:null,project_files:[],is_loading:!1,is_loading_files:!1,error:null,downloading:[],resources_api_url:"https://ressources.dodoc.fr/_api2",resources_base_url:"https://ressources.dodoc.fr"}},created(){this.loadResources()},methods:{async loadResources(){this.is_loading=!0,this.error=null;try{const r=await fetch(this.resources_api_url+"/spaces/espace-ressource/projects");if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const e=await r.json();this.resources_projects_list=e}catch(r){console.error("Error loading resources:",r),this.error=this.$t("failed_to_load_resources")}finally{this.is_loading=!1}},async selectProject(r){this.selected_project=r,this.is_loading_files=!0,this.project_files=[];try{const e=await fetch(this.resources_api_url+"/"+r.$path);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=(await e.json()).$files,i=Array.isArray(this.pick_from_types)?this.pick_from_types:[this.pick_from_types];this.project_files=t.filter(o=>o.$type?i.includes(o.$type):!1)}catch(e){console.error("Error loading project files:",e),this.$alertify.delay(4e3).error(this.$t("failed_to_load_files"))}finally{this.is_loading_files=!1}},backToProjects(){this.selected_project=null,this.project_files=[]},async downloadProjectFile(r){const e=this.resources_base_url+"/"+this.selected_project.$path+"/"+r.$media_filename;if(!this.downloading.includes(e)){this.downloading.push(e);try{const s={url:e,$credits:r.$credits||r.$authors||"",$origin:"resources_picker",$authors:[this.connected_as.$path],requested_slug:r.$media_filename},{uploaded_meta:t}=await this.$api.uploadFile({path:this.project_path,additional_meta:s});t&&(this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("resource_imported_successfully")),setTimeout(()=>{this.$emit("pickResources",[t])},200))}catch(s){console.error("Error downloading resource:",s),this.$alertify.delay(4e3).error(this.$t("failed_to_import_resource"))}finally{const s=this.downloading.indexOf(e);s>-1&&this.downloading.splice(s,1)}}}}};var f=function(){var e=this,s=e._self._c;return s("div",[s("BaseModal2",{attrs:{title:e.$t("free_resources"),size:"large"},on:{close:function(t){return e.$emit("close")}}},[s("div",{staticClass:"u-instructions"},[e._v(" "+e._s(e.$t("free_resources_description"))+" ")]),e.is_loading?s("div",{staticClass:"_loading"},[s("LoaderSpinner"),s("p",[e._v(e._s(e.$t("loading_resources")))])],1):e.error?s("div",{staticClass:"_error"},[s("div",{staticClass:"_errorIcon"},[e._v("⚠")]),s("p",[e._v(e._s(e.error))]),s("button",{staticClass:"u-button",on:{click:e.loadResources}},[e._v(" "+e._s(e.$t("retry"))+" ")])]):s("div",{staticClass:"_content"},[e.selected_project?s("div",{staticClass:"_filesView"},[s("div",{staticClass:"_header"},[s("button",{staticClass:"u-buttonLink",on:{click:e.backToProjects}},[e._v(" ← "+e._s(e.$t("back"))+" ")]),s("div",{staticClass:"_projectHeader"},[s("h2",[e._v(e._s(e.selected_project.title))]),e.selected_project.description?s("p",{domProps:{innerHTML:e._s(e.selected_project.description)}}):e._e()])]),e.is_loading_files?s("div",{staticClass:"_loading"},[s("LoaderSpinner"),s("p",[e._v(e._s(e.$t("loading"))+"...")])],1):e._e(),e.project_files&&e.project_files.length>0?s("ResourceFilesGrid",{attrs:{files:e.project_files,downloading:e.downloading,resources_base_url:e.resources_base_url,selected_project_path:e.selected_project.$path},on:{download:e.downloadProjectFile}}):s("div",{staticClass:"_noFiles"},[s("p",[e._v(e._s(e.$t("no_files_found")))])])],1):s("div",{staticClass:"_projectsList"},e._l(e.resources_projects_list,function(t){return s("div",{key:t.$path,staticClass:"_projectCard",on:{click:function(i){return e.selectProject(t)}}},[s("div",{staticClass:"_projectInfo"},[s("h3",{staticClass:"_projectTitle"},[e._v(" "+e._s(t.title)+" ")]),t.description?s("p",{staticClass:"_projectDescription",domProps:{innerHTML:e._s(t.description)}}):e._e()]),s("div",{staticClass:"_projectArrow"},[e._v("→")])])}),0)])])],1)},h=[],$=a(p,f,h,!1,null,"480fec69");const m=$.exports;export{m as R};
