import{n as o,S as n,_}from"../build.js";import{S as l}from"./SingleKeyword-D_nk-e8t.js";import d from"./AdminLumaSettings-DqmWcmBn.js";import{S as c}from"./StackDisplay-BD51uIrb.js";import"./KeywordsField-gGqCqc3v.js";const u={props:{shared_files:Array,group_mode:String,sort_order:String,search_str:String,filetype_filter:String,author_path_filter:String,available_keywords:Array,keywords_filter:Array,fav_filter:Boolean,view_mode:String},components:{SingleKeyword:l,SearchInput2:n},data(){return{show_filter_sort_pane:!1,all_authors:[],show_all_keywords:!1,kw_search:"",group_options:[{key:"day",label:this.$t("day")},{key:"month",label:this.$t("month")},{key:"year",label:this.$t("year")}],type_of_media_to_display:"all",types_of_medias:[{key:"all",label:this.$t("all_medias_types")},{key:"image",label:this.$t("image")},{key:"video",label:this.$t("video")},{key:"audio",label:this.$t("audio")},{key:"text",label:this.$t("text")},{key:"pdf",label:this.$t("pdf")},{key:"stl",label:this.$t("stl")},{key:"other",label:this.$t("other")}]}},i18n:{messages:{fr:{search_fields:"Rechercher dans les champs titre et description des documents."},en:{search_fields:"Search in titles or descriptions of documents."}}},async created(){this.all_authors=await this.$api.getFolders({path:"authors"})},async mounted(){},beforeDestroy(){},watch:{},computed:{available_keywords_except_active(){return this.available_keywords.filter(t=>this.keywords_filter.includes(t.title)?!1:this.kw_search?this.twoStringsSearch(t.title,this.kw_search):!0)},collapsable_keywords(){return this.show_all_keywords?this.available_keywords_except_active:this.available_keywords_except_active.slice(0,10)},can_be_reset(){return this.group_mode!=="year"||this.sort_order!=="date_modified"||this.search_str!==""||this.author_path_filter!==""||this.filetype_filter!=="all"||this.keywords_filter.length>0}},methods:{resetFilters(){this.$emit("update:group_mode","year"),this.$emit("update:sort_order","date_modified"),this.$emit("update:search_str",""),this.$emit("update:author_path_filter",""),this.$emit("update:filetype_filter","all"),this.$emit("update:keywords_filter",[])},filterByKeyword(a){let t=this.keywords_filter.slice();this.keywords_filter.includes(a)?t=t.filter(e=>e!==a):t.push(a),this.$emit("update:keywords_filter",t)}}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_filterBar"},[e("div",{staticClass:"_topBtn"},[e("div",{},[e("button",{staticClass:"u-buttonLink",class:{"is--active":t.show_filter_sort_pane},attrs:{type:"button"},on:{click:function(s){t.show_filter_sort_pane=!t.show_filter_sort_pane}}},[e("b-icon",{attrs:{icon:"filter"}}),t._v(" "+t._s(t.$t("filters"))+" ")],1)]),e("div",{staticClass:"_searchField"},[e("SearchInput2",{attrs:{value:t.search_str,search_placeholder:t.$t("search_fields")},on:{input:function(s){return t.$emit("update:search_str",s)}}})],1),e("div",{staticClass:"u-sameRow"},[e("div",[e("button",{staticClass:"u-button u-button_icon u-button_transparent",class:{"is--active":t.fav_filter===!0},attrs:{type:"button"},on:{click:function(s){return t.$emit("update:fav_filter",!t.fav_filter)}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("button",{staticClass:"u-button u-button_icon",class:{"is--active":t.view_mode==="list"},attrs:{type:"button"},on:{click:function(s){return t.$emit("update:view_mode","list")}}},[e("b-icon",{attrs:{icon:"grid3x3"}})],1),e("button",{staticClass:"u-button u-button_icon",class:{"is--active":t.view_mode==="map"},attrs:{type:"button"},on:{click:function(s){return t.$emit("update:view_mode","map")}}},[e("b-icon",{attrs:{icon:"map-fill"}})],1)])]),e("transition",{attrs:{name:"pagechange"}},[t.show_filter_sort_pane?e("div",{staticClass:"_filterPane"},[e("div",{staticClass:"_filterPane--row"},[e("select",{staticClass:"_selectField",domProps:{value:t.sort_order},on:{change:function(s){return t.$emit("update:sort_order",s.target.value)}}},[e("option",{attrs:{value:"date_modified"},domProps:{textContent:t._s(t.$t("date_modified"))}}),e("option",{attrs:{value:"date_created"},domProps:{textContent:t._s(t.$t("date_created"))}})]),e("select",{staticClass:"_selectField",domProps:{value:t.group_mode},on:{change:function(s){return t.$emit("update:group_mode",s.target.value)}}},t._l(t.group_options,function(s){return e("option",{key:s.key,domProps:{value:s.key,textContent:t._s(s.label)}})}),0),e("select",{staticClass:"_selectField",domProps:{value:t.author_path_filter},on:{change:function(s){return t.$emit("update:author_path_filter",s.target.value)}}},[e("option",{attrs:{value:""},domProps:{textContent:t._s(t.$t("none"))}}),t._l(t.all_authors,function(s){return e("option",{key:s.$path,domProps:{value:s.$path,textContent:t._s(s.name)}})})],2),e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.can_be_reset?e("button",{staticClass:"u-buttonLink _resetFilters",attrs:{type:"button"},on:{click:t.resetFilters}},[t._v(" "+t._s(t.$t("reset"))+" ")]):t._e()])],1),e("div",{staticClass:"_filterPane--row"},[e("div",{staticClass:"_tag"},[e("DLabel",{attrs:{str:t.$t("filter_by_keyword")}}),e("div",{staticClass:"_searchKW"},[e("SearchInput2",{attrs:{search_placeholder:t.$t("search")},model:{value:t.kw_search,callback:function(s){t.kw_search=s},expression:"kw_search"}})],1),t.keywords_filter.length>0?e("div",{staticClass:"u-keywords _usedKw"},t._l(t.keywords_filter,function(s){return e("SingleKeyword",{key:s,attrs:{keyword:s,can_remove:!0},on:{remove:function(i){return t.filterByKeyword(s)}}})}),1):t._e(),e("div",{staticClass:"u-keywords"},[t._l(t.collapsable_keywords,function(s){return e("SingleKeyword",{key:s.title,attrs:{keyword:s.title,count:s.count,can_add:!0},on:{add:function(i){return t.filterByKeyword(s.title)}}})}),t.available_keywords_except_active.length>10?e("button",{staticClass:"u-buttonLink",class:{"is--active":t.show_all_keywords},attrs:{type:"button"},on:{click:function(s){t.show_all_keywords=!t.show_all_keywords}}},[t._v(" "+t._s(t.$t("show_all_keywords"))+" ")]):t._e()],2)],1)])]):t._e()])],1)},f=[],p=o(u,h,f,!1,null,"6326a6ed");const v=p.exports,m={props:{stack:Object,is_selected:Boolean,is_favorite:Boolean,can_be_added_to_fav:Boolean},components:{},data(){return{start_slide:!1,stack_files:void 0,index_of_slide_file_to_show:void 0}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{number_of_medias_in_stack(){var a;return((a=this.stack.stack_files_metas)==null?void 0:a.length)||0},slide_file_to_show(){return this.stack_files&&this.index_of_slide_file_to_show!==void 0?this.stack_files[this.index_of_slide_file_to_show]:!1}},methods:{openStack(){const a=this.getFilename(this.stack.$path);this.$emit("openStack",a)},async startSlide(a){this.start_slide=!0,setTimeout(async()=>{if(this.start_slide){const t=await this.loadFiles();this.stack_files=t,this.updateMousePos(a)}},200)},updateMousePos(a){if(!this.stack_files)return;const{pageX:t}=a,{x:e,width:s}=this.$el.getBoundingClientRect(),i=(t-e)/s;this.index_of_slide_file_to_show=Math.floor(i*this.number_of_medias_in_stack)},endSlide(){this.start_slide=!1,this.stack_files=void 0,this.index_of_slide_file_to_show=void 0},async loadFiles(){const a=await this.$api.getFolder({path:this.stack.$path});return this.getStackFilesInOrder({stack:a})}}};var k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackPreview",on:{mouseenter:t.startSlide,mousemove:t.updateMousePos,mouseleave:t.endSlide}},[e("button",{staticClass:"_stackPreview--content",class:{"is--slider":t.start_slide,"is--selected":t.is_selected},attrs:{type:"button"},on:{click:t.openStack}},[e("div",{staticClass:"_preview"},[e("div",{key:"preview",staticClass:"_mainPreview",class:{"is--showingSlides":t.slide_file_to_show}},[t.stack.$preview?e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:t.stack.$preview}}):e("b-icon",{attrs:{icon:"eye-slash"}})],1),t._l(t.stack_files,function(s){var i;return e("div",{key:s.$path,staticClass:"_slide",class:{"is--shown":s.$path===((i=t.slide_file_to_show)==null?void 0:i.$path)}},[e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:s}})],1)}),e("transition-group",{staticClass:"_count",attrs:{name:"projectsList"}},[t.index_of_slide_file_to_show!==void 0?[e("div",{key:"slide"},[t._v(" "+t._s(t.index_of_slide_file_to_show+1)+" ")]),e("div",{key:"slash"},[t._v("/")])]:t._e(),e("div",{key:"preview"},[t._v(" "+t._s(t.number_of_medias_in_stack)+" ")])],2)],2),e("div",{staticClass:"_title"},[t._v(" "+t._s(t.stack.title)+" ")])]),e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.can_be_added_to_fav&&(t.is_favorite||t.start_slide)?e("div",[e("button",{staticClass:"u-button u-button_icon u-button_transparent _addToFav",attrs:{type:"button","data-isfav":t.is_favorite},on:{click:function(s){return s.stopPropagation(),t.$emit("toggleFav")}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):t._e()])],1)},y=[],w=o(m,k,y,!1,null,"0785e8a6");const g=w.exports,$={props:{shared_folder_path:String},components:{FilterBar:v,StackPreview:g,AdminLumaSettings:d,StackDisplay:c,MediaMap:()=>_(()=>import("./MediaMap-AaL8issn.js"),[])},data(){return{all_stacks:[],is_loading_folder:!0,failed_loading_folder:!1,show_admin_settings:!1,last_selected_stack_path:void 0,view_mode:"list",sort_order:localStorage.getItem("archive.sort_order")||"date_modified",search_str:"",filetype_filter:"all",author_path_filter:"",keywords_filter:[],group_mode:"year",fav_filter:!1}},i18n:{messages:{fr:{only_my_fav:"Que les favoris"},en:{only_my_fav:"Favourites"}}},async created(){},async mounted(){this.all_stacks=await this.$api.getFolders({path:this.stack_shared_folder_path}).catch(a=>{console.error(a),this.failed_loading_folder=a}),this.$api.join({room:this.stack_shared_folder_path}),this.is_loading_folder=!1},beforeDestroy(){this.$api.leave({room:this.stack_shared_folder_path})},watch:{opened_stack(){this.opened_stack&&(this.last_selected_stack_path=this.opened_stack.$path)},sort_order(){localStorage.setItem("archive.sort_order",this.sort_order)}},computed:{stack_shared_folder_path(){return this.shared_folder_path+"/stacks"},can_be_added_to_fav(){var a;return this.connected_as&&((a=this.connected_as)==null?void 0:a.$path)!==void 0},sorted_stacks(){return this.all_stacks.slice().sort((a,t)=>+new Date(t.$date_modified)-+new Date(a.$date_modified))},filtered_stacks(){return this.sorted_stacks.filter(a=>{var t;return this.fav_filter&&!this.isFavorite(a.$path)||this.author_path_filter&&!((t=a.$authors)!=null&&t.includes(this.author_path_filter))||this.keywords_filter.length>0&&(!a.keywords||!Array.isArray(a.keywords)||this.keywords_filter.some(e=>!a.keywords.includes(e)))?!1:this.search_str?!!(a.title&&a.title.toLowerCase().includes(this.search_str.toLowerCase())||a.description&&a.description.toLowerCase().includes(this.search_str.toLowerCase())):!0})},grouped_stacks(){let a=["$date_modified"];return this.sort_order==="date_created"?a=["date_created_corrected","$date_created","$date_uploaded"]:this.sort_order==="date_modified"&&(a=["$date_modified"]),this.groupFilesBy(this.filtered_stacks,a,this.group_mode)},available_keywords(){return this.filtered_stacks.reduce((t,e)=>(e.keywords&&Array.isArray(e.keywords)&&e.keywords.map(s=>{const i=t.find(r=>r.title===s);i?i.count+=1:t.push({title:s,count:1})}),t),[]).sort((t,e)=>e.count-t.count)},opened_stack(){var a;return(a=this.$route.query)!=null&&a.stack?this.all_stacks.find(t=>this.getFilename(t.$path)===this.$route.query.stack):!1}},methods:{toggleMediaFocus(a){const t=this.getFilename(a);this.openStack(t)},openStack(a){let t=Object.assign({},this.$route.query)||{};t.stack=a,this.$router.push({query:t})},isFavorite(a){var t;return!((t=this.connected_as)!=null&&t.favorites)||this.connected_as.favorites.length===0?!1:this.connected_as.favorites.some(e=>e.stack_path===a)},async toggleFav(a){var e;let t=(e=this.connected_as)!=null&&e.favorites?this.connected_as.favorites.slice():[];this.isFavorite(a)?t=t.filter(s=>s.stack_path!==a):t.push({stack_path:a,added:+new Date}),await this.$api.updateMeta({path:this.connected_as.$path,new_meta:{favorites:t}})},closeStack(){let a=Object.assign({},this.$route.query)||{};delete a.stack,this.$router.push({query:a})}}};var b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_sharedFolder"},[e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.opened_stack?e("StackDisplay",{key:t.opened_stack.$path,staticClass:"_stackModal",attrs:{stack_path:t.opened_stack.$path,context:"archive",can_be_added_to_fav:t.can_be_added_to_fav,is_favorite:t.isFavorite(t.opened_stack.$path)},on:{toggleFav:function(s){return t.toggleFav(t.opened_stack.$path)},prevMedia:function(s){return t.navMedia(-1)},nextMedia:function(s){return t.navMedia(1)},close:t.closeStack}}):t._e()],1),e("div",{staticClass:"_sharedFolder--content"},[e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.is_loading_folder?e("div",{staticClass:"_loader"},[e("LoaderSpinner")],1):t.failed_loading_folder?e("div",[e("div",{staticClass:"u-instructions _error"},[t._v(" "+t._s(t.$t("error_loading_folder")+" / "+t.stack_shared_folder_path)+" : "+t._s(t.failed_loading_folder)+" ")])]):e("div",[e("FilterBar",{attrs:{group_mode:t.group_mode,sort_order:t.sort_order,search_str:t.search_str,filetype_filter:t.filetype_filter,author_path_filter:t.author_path_filter,available_keywords:t.available_keywords,keywords_filter:t.keywords_filter,fav_filter:t.fav_filter,view_mode:t.view_mode},on:{"update:group_mode":function(s){t.group_mode=s},"update:sort_order":function(s){t.sort_order=s},"update:search_str":function(s){t.search_str=s},"update:filetype_filter":function(s){t.filetype_filter=s},"update:author_path_filter":function(s){t.author_path_filter=s},"update:keywords_filter":function(s){t.keywords_filter=s},"update:fav_filter":function(s){t.fav_filter=s},"update:view_mode":function(s){t.view_mode=s}}}),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("transition-group",{key:t.sort_order+"-"+t.group_mode,attrs:{tag:"div",name:"projectsList",appear:""}},[t.grouped_stacks.length===0?e("div",{key:"nocontent",staticClass:"u-instructions _noContent"},[t._v(" "+t._s(t.$t("no_content"))+" ")]):[t.view_mode==="list"?t._l(t.grouped_stacks,function({label:s,files:i}){return e("div",{key:s,staticClass:"_dayFileSection"},[e("div",{staticClass:"_label"},[t._v(" "+t._s(s)+" ")]),e("transition-group",{staticClass:"_itemGrid",attrs:{tag:"div",name:"listComplete",appear:""}},t._l(i,function(r){return e("StackPreview",{key:r.$path,attrs:{stack:r,is_selected:r.$path===t.last_selected_stack_path,can_be_added_to_fav:t.can_be_added_to_fav,is_favorite:t.isFavorite(r.$path)},on:{toggleFav:function(B){return t.toggleFav(r.$path)},openStack:t.openStack}})}),1)],1)}):t.view_mode==="map"?e("div",{key:"mediaMap",staticClass:"_mediamapContainer"},[e("MediaMap",{attrs:{medias:t.filtered_stacks},on:{toggleMediaFocus:t.toggleMediaFocus}})],1):t._e()]],2)],1)],1)]),e("footer",{staticClass:"_footer"},[e("small",[e("a",{attrs:{href:"mailto:"+t.$root.app_infos.instance_meta.contactmail,target:"_blank"}},[t._v(" "+t._s(t.$t("help_contact"))+" ")]),e("br"),t._v(" "+t._s(t.$t("version"))+" "+t._s(t.$root.app_infos.version)+" "),t.is_instance_admin?e("button",{staticClass:"u-buttonLink _adminBtn",attrs:{type:"button"},on:{click:function(s){t.show_admin_settings=!0}}},[t._v(" "+t._s(t.$t("admin_settings"))+" ")]):t._e(),t.show_admin_settings?e("AdminLumaSettings",{on:{close:function(s){t.show_admin_settings=!1}}}):t._e()],1)])],1)],1)},C=[],F=o($,b,C,!1,null,"d25cb52f");const S=F.exports,x={props:{},components:{SharedFolder2:S},data(){return{folders:void 0,path_to_folders:"folders"}},created(){},mounted(){this.initFolders();debugger},beforeDestroy(){},watch:{},computed:{opened_folder_path(){return this.$route.params.folder_slug?"folders/"+this.$route.params.folder_slug:!1}},methods:{async initFolders(){this.folders=await this.$api.getFolders({path:this.path_to_folders}),this.opened_folder_path||this.openFolder(this.folders[0].$path)},openFolder(a){const t=this.getFilename(a);this.$router.push("/archives/"+t)}}};var L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mainContent"},[t.opened_folder_path?t._e():e("div",[t._v(" Espaces archives disponibles "),e("ol",t._l(t.folders,function(s){return e("li",{key:s.$path},[e("button",{attrs:{type:"button"},on:{click:function(i){return t.openFolder(s.$path)}}},[t._v(" "+t._s(s.title||t.$t("untitled"))+" ")])])}),0)]),t.opened_folder_path?e("SharedFolder2",{attrs:{shared_folder_path:t.opened_folder_path}}):t._e()],1)},P=[],M=o(x,L,P,!1,null,"2e7e25a1");const I=M.exports;export{I as default};
