import{n as c}from"../build.js";import{M as l}from"./ModuleCreator-DTdP3Bhr.js";import{P as _}from"./PublicationModule-CHS9_dYP.js";const r={props:{publication:Object,sections:Array,opened_section_meta_filename:String,can_edit:Boolean},components:{},inject:{$getMapOptions:{default:!1}},data(){return{}},created(){},mounted(){this.can_edit&&this.sections.length===0&&this.createSection(),this.openFirstSectionIfNoneOpened(),this.openExistingSectionIfNotExisting()},beforeDestroy(){},watch:{opened_section_meta_filename(){this.openFirstSectionIfNoneOpened()}},computed:{is_associated_to_map(){return this.$getMapOptions},default_view_color(){return this.$getMapOptions().default_view_color},story_styles(){return this.makeStoryStyles({publication:this.publication})},new_section_title(){let i=this.sections.length+1;const t=n=>this.$t("section")+" "+n;let e=t(i);for(;this.sections.some(n=>n.section_title===e);)i++,e=t(i);return e},opened_section(){return this.sections.find(i=>this.getFilename(i.$path)===this.opened_section_meta_filename)}},methods:{openSection(i){this.$emit("toggleSection",this.getFilename(i))},openFirstSectionIfNoneOpened(){this.sections.length>0&&!this.opened_section_meta_filename&&this.$emit("openFirstSection")},openExistingSectionIfNotExisting(){this.opened_section_meta_filename&&!this.opened_section&&this.$emit("openFirstSection")},async createSection(){const i=await this.createSection2({publication:this.publication,additional_meta:{section_title:this.new_section_title}});this.$emit("toggleSection",i)}}};var d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_sectionsSummary",style:t.story_styles},[e("ReorderedList",{attrs:{field_name:"sections_list",items:t.sections,path:t.publication.$path,active_item_meta:t.opened_section_meta_filename,can_edit:t.can_edit},on:{openItem:t.openSection,createItem:t.createSection},scopedSlots:t._u([{key:"default",fn:function(n){return[n.item.section_title?[t._v(" "+t._s(n.item.section_title)+" ")]:[e("i",[t._v(t._s(t.$t("untitled")))])]]}}])})],1)},u=[],p=c(r,d,u,!1,null,"b22b64d7");const h=p.exports,m={props:{publication:Object,section:Object,can_edit:Boolean},components:{ModuleCreator:l,PublicationModule:_},data(){return{medias:[],module_being_edited:void 0}},created(){this.$eventHub.$on("module.none_edited",this.unselectModuleEdited)},async mounted(){},beforeDestroy(){this.$eventHub.$off("module.none_edited",this.unselectModuleEdited)},watch:{},computed:{section_modules_list(){return this.getModulesForSection({publication:this.publication,section:this.section}).map(({_module:i})=>i)},story_styles(){return this.makeStoryStyles({publication:this.publication})},title_is_visible(){return this.section.section_title_is_visible!==!1}},methods:{async addModules({meta_filenames:i}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.section,meta_filenames:i});const t=i.at(-1);this.toggleNewModuleEdit({meta_filename:t})},async insertModules({meta_filenames:i,index:t}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.section,index:t,meta_filenames:i});const e=i.at(-1);this.toggleNewModuleEdit({meta_filename:e})},toggleNewModuleEdit({meta_filename:i}){const t=this.publication.$path+"/"+i;setTimeout(()=>{this.$eventHub.$emit(`module.enable_edit.${i}`),this.$eventHub.$emit("publication.map.openPin",t)},150)},async toggleSectionVisibility(){await this.$api.updateMeta({path:this.section.$path,new_meta:{section_title_is_visible:!this.title_is_visible}})},async duplicateSection(){await this.duplicateSection2({publication:this.publication,og_modules:this.section_modules_list,section:this.section}),this.$emit("nextSection")},async removeSection(){this.$emit("prevSection"),this.removeSection2({publication:this.publication,group:"sections_list",section:this.section})},async moveModuleTo({path:i,new_position:t}){await this.moveModuleTo2({publication:this.publication,section:this.section,meta_filename:this.getFilename(i),new_position:t})},async duplicatePublicationMedia({source_module_path:i,copy_meta_filename:t}){const e=this.getFilename(i);await this.duplicatePublicationMedia2({publication:this.publication,section:this.section,source_meta_filename:e,copy_meta_filename:t})},unselectModuleEdited(){this.module_being_edited=void 0},async removeModule(i){await this.removeModule2({publication:this.publication,section:this.section,path:i})}}};var f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_singleSection"},[e("div",{staticClass:"_storyContainer"},[t.section?e("div",{staticClass:"_storyContent",style:t.story_styles},[t.can_edit||t.section.section_title||t.section.section_description?e("div",{staticClass:"_topbar"},[e("div",{staticClass:"_text"},[t.can_edit||t.title_is_visible?e("div",{staticClass:"_sectionTitle",class:{"is--hidden":!t.title_is_visible}},[e("TitleField",{attrs:{field_name:"section_title",content:t.section.section_title||t.$t("untitled"),path:t.section.$path,required:!0,maxlength:60,tag:"h1",can_edit:t.can_edit}}),t.can_edit?e("EditBtn",{attrs:{btn_type:t.title_is_visible?"show":"hide",label:t.$t("show_title")},on:{click:t.toggleSectionVisibility}}):t._e()],1):t._e(),t.section.section_description?e("div",[e("div",{domProps:{textContent:t._s(t.section.section_description)}})]):t._e()]),t.can_edit?e("div",{staticClass:"_buttons"},[t.can_edit?e("DropDown",{attrs:{show_label:!1,right:!0}},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.duplicateSection}},[e("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("duplicate"))+" ")],1),e("RemoveMenu",{attrs:{modal_title:t.$t("remove_section")},on:{remove:t.removeSection}})],1):t._e()],1):t._e()]):t._e(),e("transition-group",{staticClass:"_storyModules",attrs:{tag:"div",name:"StoryModules",appear:"",duration:700}},[t._l(t.section_modules_list,function(n,s){return[e("div",{key:"mc_"+s,staticClass:"_spacer"},[t.can_edit?e("ModuleCreator",{attrs:{publication_path:t.publication.$path,types_available:["capture","import","write","embed","table"]},on:{addModules:({meta_filenames:o})=>t.insertModules({meta_filenames:o,index:s})}}):t._e()],1),e("PublicationModule",{key:n.$path,staticClass:"_mediaPublication",attrs:{publimodule:n,module_being_edited:t.module_being_edited,module_position:t.section_modules_list.length===1?"alone":s===0?"first":s===t.section_modules_list.length-1?"last":"inbetween",can_edit:t.can_edit},on:{"update:module_being_edited":function(o){t.module_being_edited=o},moveUp:function(o){return t.moveModuleTo({path:n.$path,new_position:s-1})},moveDown:function(o){return t.moveModuleTo({path:n.$path,new_position:s+1})},duplicate:function(o){return t.duplicatePublicationMedia({source_module_path:n.$path,copy_meta_filename:o})},changeSectionForModule:function(o){return t.$emit("changeSectionForModule",n.$path)},remove:function(o){return t.removeModule(n.$path)}}})]})],2),t.can_edit?e("ModuleCreator",{staticClass:"_lastModule",attrs:{start_collapsed:!1,publication_path:t.publication.$path,types_available:["capture","import","write","embed","table"]},on:{addModules:t.addModules}}):t._e()],1):t._e()])])},b=[],v=c(m,f,b,!1,null,"854d7a2f");const g=v.exports,$={props:{module_path:String,sections:Array},components:{},data(){return{section_path_to_move_to:void 0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{module_meta_filename(){return this.getFilename(this.module_path)},all_sections_in_select(){return this.sections.map(i=>({key:i.$path,text:i.section_title}))},current_section_path(){var i;return(i=this.sections.find(t=>t.modules_list.includes(this.module_meta_filename)))==null?void 0:i.$path}},methods:{setNewSection(i){this.section_path_to_move_to=i},async submit(){await this.appendModuleToSection(),await this.removeModuleFromSection()},async appendModuleToSection(){var e;let t=((e=this.sections.find(n=>n.$path===this.section_path_to_move_to).modules_list)==null?void 0:e.slice())||[];t.push(this.module_meta_filename),await this.$api.updateMeta({path:this.section_path_to_move_to,new_meta:{modules_list:t}})},async removeModuleFromSection(){var e;let t=((e=this.sections.find(n=>n.$path===this.current_section_path).modules_list)==null?void 0:e.slice())||[];t=t.filter(n=>n!==this.module_meta_filename),await this.$api.updateMeta({path:this.current_section_path,new_meta:{modules_list:t}}),this.$emit("close")}}};var S=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.$t("change_section")},on:{close:function(n){return t.$emit("close")}}},[e("div",{},[e("SelectField2",{attrs:{value:t.current_section_path,options:t.all_sections_in_select,can_edit:!0,hide_validation:!0},on:{change:t.setNewSection}})],1),e("template",{slot:"footer"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(n){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-circle"}}),t._v(" "+t._s(t.$t("cancel"))+" ")],1),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button",autofocus:"",disabled:!t.section_path_to_move_to||t.section_path_to_move_to===t.current_section_path},on:{click:t.submit}},[t._v(" "+t._s(t.$t("move"))+" ")])])],2)},y=[],M=c($,S,y,!1,null,"5c2e5079");const w=M.exports,F={props:{publication:Object,sections:Array,opened_section_meta_filename:String,can_edit:Boolean},components:{SingleSection:g,ChangeSectionForModule:w},data(){return{change_section_for_module:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{opened_section(){return this.sections.find(i=>this.getFilename(i.$path)===this.opened_section_meta_filename)},opened_section_index(){return this.sections.findIndex(i=>{var t;return i.$path===((t=this.opened_section)==null?void 0:t.$path)})},next_section(){return this.opened_section_index<this.sections.length-1?this.sections[this.opened_section_index+1]:!1},prev_section(){return this.opened_section_index>0?this.sections[this.opened_section_index-1]:!1}},methods:{nextSection(){var i;this.scrollToTop(),(i=this.next_section)!=null&&i.$path&&this.$emit("toggleSection",this.getFilename(this.next_section.$path))},prevSection(){var i;this.scrollToTop(),(i=this.prev_section)!=null&&i.$path&&this.$emit("toggleSection",this.getFilename(this.prev_section.$path))},async scrollToTop(){const i=function(n){const s=n.scrollHeight>n.clientHeight,a=window.getComputedStyle(n).overflowY.indexOf("hidden")!==-1;return s&&!a},t=function(n){return!n||n===document.body?document.body:i(n)?n:t(n.parentNode)};t(this.$el).scrollTo({top:0,left:0,behavior:"smooth"})}}};var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openedSection"},[e("SingleSection",{ref:"section",attrs:{publication:t.publication,section:t.opened_section,can_edit:t.can_edit},on:{prevSection:t.prevSection,nextSection:t.nextSection,changeSectionForModule:function(n){t.change_section_for_module=n}}}),t.change_section_for_module?e("ChangeSectionForModule",{attrs:{module_path:t.change_section_for_module,sections:t.sections},on:{close:function(n){t.change_section_for_module=!1}}}):t._e(),e("div",{staticClass:"_navBtns"},[e("div",{staticClass:"_navBtns--content"},[t.prev_section?e("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:t.prevSection}},[e("b-icon",{attrs:{icon:"arrow-left-square"}}),e("span",[t._v(" "+t._s(t.prev_section.section_title)+" ")])],1):t._e(),t.next_section?e("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:t.nextSection}},[e("span",[t._v(" "+t._s(t.next_section.section_title)+" ")]),e("b-icon",{attrs:{icon:"arrow-right-square"}})],1):t._e()])])],1)},x=[],T=c(F,C,x,!1,null,"37f01819");const k=T.exports,O={props:{publication:Object,opened_section_meta_filename:String,can_edit:Boolean},components:{SectionsSummary:h,OpenedSection:k},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{sections(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"})},meta_filenames_already_present(){const{current:i,other:t}=this.getMediasAlreadyPresentInPublication({publication:this.publication,sections:this.sections,opened_section_meta_filename:this.opened_section_meta_filename});return[{label:this.$t("in_this_section"),medias:i,color:"var(--c-orange)"},{label:this.$t("in_another_section"),medias:t,color:"var(--c-bleuvert)"}]}},methods:{openFirstSection(){const i=this.getFilename(this.sections[0].$path);this.$emit("toggleSection",i)},unselectModule(){this.$eventHub.$emit("module.none_edited")}}};var P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_sectionsList"},[e("SectionsSummary",{directives:[{name:"show",rawName:"v-show",value:t.can_edit||t.sections.length>1,expression:"can_edit || sections.length > 1"}],attrs:{publication:t.publication,sections:t.sections,opened_section_meta_filename:t.opened_section_meta_filename,can_edit:t.can_edit},on:{toggleSection:function(n){return t.$emit("toggleSection",n)},openFirstSection:t.openFirstSection}}),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.opened_section_meta_filename?e("OpenedSection",{key:t.opened_section_meta_filename,attrs:{publication:t.publication,sections:t.sections,opened_section_meta_filename:t.opened_section_meta_filename,can_edit:t.can_edit},on:{toggleSection:function(n){return t.$emit("toggleSection",n)}}}):t._e()],1)],1)},N=[],E=c(O,P,N,!1,null,"f29a92d4");const H=E.exports;export{H as S,g as a};
