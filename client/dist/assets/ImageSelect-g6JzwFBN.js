import{n as a,_ as s}from"../build.js";import{C as r}from"./CropMedia-DFbRHxnS.js";const o={props:{existing_preview:[Boolean,String],label:String,path:String,project_path:String,ratio:String,instructions:String,preview_format:String,available_options:Array},components:{CropMedia:r,PickImage:()=>s(()=>import("./PickImage-CrDOWXv5.js"),[])},data(){return{picked_image:this.existing_preview,crop_mode:!1,allow_save:!0,is_saving:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{modal_size(){return this.crop_mode?"x-large":""}},methods:{async setNewPreview(t){if(!t){this.$emit("newPreview","");return}let e=null;e=t.data,this.ratio&&(this.crop_mode=!0),this.picked_image=URL.createObjectURL(e)},async fetchURLToFile(t){return await fetch(t).then(e=>e.blob())},updateCrop(t){this.picked_image=t,this.crop_mode=!1},removeImage:function(){this.picked_image="",this.$emit("newPreview","")},async updateCover(){this.is_saving=!0;let t="";if(this.picked_image&&(t=await(await fetch(this.picked_image)).blob()),!this.path)return this.$emit("close"),this.$emit("newPreview",t);try{await this.$api.updateCover({path:this.path,new_cover_data:t}),this.is_saving=!1,this.$emit("close")}catch(e){this.is_saving=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldntbesaved")),this.$alertify.closeLogOnClick(!0).error(e.response)}},cancel(){this.$emit("close")}}};var n=function(){var e=this,i=e._self._c;return i("BaseModal2",{attrs:{title:e.label,size:e.modal_size},on:{close:function(_){return e.$emit("close")}}},[i("div",{staticClass:"_imageselect"},[e.picked_image?[e.crop_mode?i("div",{staticClass:"_imageselect--crop"},[i("CropMedia",{attrs:{blob:e.picked_image,preview_format:e.preview_format,forced_ratio:e.ratio},on:{updateCrop:e.updateCrop}})],1):i("div",{staticClass:"_imageselect--image"},[i("img",{attrs:{"data-format":e.preview_format,src:e.picked_image,draggable:"false"}}),i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:e.removeImage}},[e._v(" "+e._s(e.$t("replace_remove_image"))+" ")])])]:i("PickImage",{attrs:{path:e.project_path||e.path,instructions:e.instructions,available_options:e.available_options},on:{newPreview:e.setNewPreview}})],2),e.crop_mode?e._e():i("template",{slot:"footer"},[i("div"),i("SaveCancelButtons",{attrs:{is_saving:e.is_saving,allow_save:e.allow_save},on:{save:e.updateCover,cancel:e.cancel}})],1)],2)},c=[],l=a(o,n,c,!1,null,"2e3d737a");const d=l.exports;export{d as default};
