import{S as p}from"./SinglePage-DwH-jTGp.js";import{n as o,s as n}from"../build.js";import"./PublicationModule-CKhYvlOl.js";import"./MediaPicker-BkCMiT_E.js";import"./CaptionCreditsPage-1K0UUM48.js";import"./FlickityCarousel-BRYWTejq.js";const _={props:{publication:Object,is_serversidepreview:Boolean},components:{SinglePage:p},data(){return{display_mode:"print",page_zoom:100,night_mode:!1}},created(){this.$eventHub.$on("publication.togglePage",this.togglePage)},async mounted(){var s;this.publication.layout_mode==="screen"?document.body.style=`
          --page-width: ${this.publication.page_width}px;
          --page-height: ${this.publication.page_height}px;
        `:this.publication.layout_mode==="print"&&(document.body.style=`
          --page-width: ${this.publication.page_width}mm;
          --page-height: calc(${this.publication.page_height}mm - 0.4mm);
        `),document.addEventListener("keydown",this.keyPressed),(((s=this.$route.query)==null?void 0:s.display)==="slides"||window.app_infos.page_is_standalone_html)&&(this.display_mode="slides"),this.display_mode==="slides"&&(this.fitZoomToPage(),window.addEventListener("resize",()=>{this.fitZoomToPage()}))},beforeDestroy(){this.$eventHub.$off("publication.togglePage",this.togglePage),document.removeEventListener("keydown",this.keyPressed)},watch:{},computed:{page_dimensions_to_px(){return this.publication.layout_mode==="print"?{width:this.publication.page_width*3.7952,height:this.publication.page_height*3.7952}:{width:this.publication.page_width,height:this.publication.page_height}},pagination(){return this.setPaginationFromPublication(this.publication)},pages_style(){return{"--page-zoom":this.page_zoom/100}},slides_current_page_or_spread_index(){var s;return(s=this.$route.query)!=null&&s.page?+this.$route.query.page:1},slide_current_page(){return this.pages?this.pages[this.slides_current_page_or_spread_index-1]:!1},slide_current_spread(){return this.spreads?this.spreads[this.slides_current_page_or_spread_index-1]:!1},pages_to_show(){var e;const s=(e=this.$route.query)==null?void 0:e.page;if(s&&s.includes("-")){const[t,i]=s.split("-");return this.pages.slice(t-1,i)}else if(s&&!s.includes("-"))return this.pages.slice(+s-1,+s);return this.pages},has_multiple_pages(){return this.is_spread?this.spreads.length>1:this.pages.length>1},modules(){return this.publication.$files||[]},pages(){return this.publication.pages?this.publication.pages:[]},is_spread(){return this.publication.page_spreads===!0},spreads(){return this.is_spread?this.makeSpread({pages:this.pages}):!1},spreads_to_show(){var e;const s=(e=this.$route.query)==null?void 0:e.page;if(s&&s.includes("-")){const[t,i]=s.split("-");return this.spreads.slice(t-1,i)}else if(s)return this.spreads.slice(+s-1,+s);return this.spreads}},methods:{fitZoomToPage(){let e=this.page_dimensions_to_px.width;this.is_spread&&(e*=2);let t=window.innerWidth/(e+70),i=window.innerHeight/(this.page_dimensions_to_px.height+70);this.page_zoom=Math.min(t,i)*100},keyPressed(s){if(!(this.$root.modal_is_opened||s.target.tagName.toLowerCase()==="select"||s.target.tagName.toLowerCase()==="input"||s.target.tagName.toLowerCase()==="textarea"||s.target.className.includes("ql-editor")||s.target.hasAttribute("contenteditable"))&&this.display_mode==="slides")switch(s.key){case"w":case"z":case"ArrowLeft":this.slides_current_page_or_spread_index>1&&this.updatePageQuery({prop:"page",val:this.slides_current_page_or_spread_index-1});break;case"s":case"ArrowRight":this.slides_current_page_or_spread_index<(this.is_spread?this.spreads.length:this.pages.length)&&this.updatePageQuery({prop:"page",val:this.slides_current_page_or_spread_index+1});break;case"p":this.page_zoom+=6;break;case"m":this.page_zoom-=6;break;case"r":this.fitZoomToPage();break;case"f":this.$emit("toggleFs");break;case"n":this.night_mode=!this.night_mode;break}},togglePage(s){const e=this.pages.findIndex(t=>t.id===s);e!==-1?this.updatePageQuery({prop:"page",val:e+1}):this.$alertify.error(this.$t("page_not_found"))},getCorrectPageNumber(s){return this.pages.findIndex(t=>t.id===s)}}};var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_pageSlides",class:{"is--slides":e.display_mode==="slides","is--serversidepreview":e.is_serversidepreview,"is--nightmode":e.night_mode}},[t("div",{staticClass:"_pages",style:e.pages_style},[e.is_spread?[e.display_mode!=="slides"?e._l(e.spreads_to_show,function(i,a){return t("div",{key:a,staticClass:"_spread"},e._l(i,function(r,d){return t("div",{key:r.id?r.id:d,staticClass:"_spread--page"},[r?[t("SinglePage",{attrs:{context:"full",page_modules:e.getModulesForPage({modules:e.modules,page_id:r.id}),page_color:r.page_color,layout_mode:e.publication.layout_mode,hide_pagination:r.hide_pagination===!0,page_number:e.getCorrectPageNumber(r.id),pagination:e.pagination,can_edit:!1}})]:t("div",{staticClass:"_noPage"})],2)}),0)}):[t("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[e.slide_current_spread?t("div",{key:"spread-"+e.slides_current_page_or_spread_index,staticClass:"_spread"},e._l(e.slide_current_spread,function(i,a){return t("div",{key:i.id?i.id:a,staticClass:"_spread--page"},[i?[t("SinglePage",{attrs:{context:"full",page_modules:e.getModulesForPage({modules:e.modules,page_id:i.id}),page_color:i.page_color,layout_mode:e.publication.layout_mode,hide_pagination:i.hide_pagination===!0,page_number:e.getCorrectPageNumber(i.id),pagination:e.pagination,can_edit:!1}})]:t("div",{staticClass:"_noPage"})],2)}),0):e._e()])]]:[e.display_mode!=="slides"?e._l(e.pages_to_show,function(i){return t("div",{key:"page-"+i.id,staticClass:"_page"},[t("SinglePage",{attrs:{context:"full",page_modules:e.getModulesForPage({modules:e.modules,page_id:i.id}),page_color:i.page_color,layout_mode:e.publication.layout_mode,hide_pagination:i.hide_pagination===!0,page_number:e.getCorrectPageNumber(i.id),pagination:e.pagination,can_edit:!1}})],1)}):[t("transition",{attrs:{name:"fade_fast",mode:"in-out"}},[e.slide_current_page?t("div",{key:"page-"+e.slide_current_page.id,staticClass:"_page"},[t("SinglePage",{attrs:{context:"full",page_modules:e.getModulesForPage({modules:e.modules,page_id:e.slide_current_page.id}),page_color:e.slide_current_page.page_color,layout_mode:e.publication.layout_mode,hide_pagination:e.slide_current_page.hide_pagination===!0,page_number:e.getCorrectPageNumber(e.slide_current_page.id),pagination:e.pagination,can_edit:!1}})],1):e._e()])]]],2),e.display_mode==="slides"&&e.has_multiple_pages?t("div",{staticClass:"_navBtns"},[t("span",[t("button",{staticClass:"u-button u-button_transparent u-button_small",attrs:{type:"button",disabled:e.slides_current_page_or_spread_index<=1},on:{click:function(i){return e.updatePageQuery({prop:"page",val:e.slides_current_page_or_spread_index-1})}}},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 168 168"}},[t("path",{attrs:{d:"M87.46,49.46,73.39,64.77a65.3,65.3,0,0,1-6.15,6.15A47.8,47.8,0,0,1,61,75.29H131.6V91.14H61A39.1,39.1,0,0,1,67,95.51q2.81,2.46,6.36,6.15L87.46,117,74.48,128,34.17,83.21,74.48,38.39Z"}})])])]),t("span",{staticClass:"_pageInd"},[t("b",[t("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t("select",{key:e.slides_current_page_or_spread_index,domProps:{value:e.slides_current_page_or_spread_index},on:{change:function(i){return e.updatePageQuery({prop:"page",val:i.target.value})}}},e._l(e.is_spread?e.spreads.length:e.pages.length,function(i,a){return t("option",{key:a,domProps:{value:a+1,textContent:e._s(a+1)}})}),0)]),e._l(e.is_spread?e.spreads.length:e.pages.length,function(i,a){return t("div",{key:a,attrs:{"v-text":a}})})],2),e._v(" / "+e._s(e.is_spread?e.spreads.length:e.pages.length))]),t("span",[t("button",{staticClass:"u-button u-button_transparent u-button_small",attrs:{type:"button",disabled:e.slides_current_page_or_spread_index>=(e.is_spread?e.spreads.length:e.pages.length)},on:{click:function(i){return e.updatePageQuery({prop:"page",val:e.slides_current_page_or_spread_index+1})}}},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 168 168"}},[t("path",{attrs:{d:"M78.31,117l14.07-15.31a65.3,65.3,0,0,1,6.15-6.15,47.52,47.52,0,0,1,6.29-4.37H34.17V75.29h70.65a39.1,39.1,0,0,1-6.08-4.37q-2.8-2.46-6.36-6.15L78.31,49.46l13-11.07L131.6,83.21,91.29,128Z"}})])])])]):e._e()])},g=[],u=o(_,l,g,!1,null,"a149ffea");const c=u.exports,h={props:{publication:Object,is_serversidepreview:Boolean},components:{PageSlides:c},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{async toggleFs(){this.is_fullscreen?this.closeFs():this.openFs()},async openFs(){await n.request(this.$refs.fsContainer),this.is_fullscreen=!0,n.onchange(()=>{n.isFullscreen||(this.is_fullscreen=!1)})},async closeFs(){await n.exit(),this.is_fullscreen=!1}}};var m=function(){var e=this,t=e._self._c;return t("div",[t("PageSlides",{attrs:{publication:e.publication,is_serversidepreview:e.is_serversidepreview},on:{toggleFs:e.toggleFs}})],1)},f=[],y=o(h,m,f,!1,null,"789239e7");const C=y.exports;export{C as default};
