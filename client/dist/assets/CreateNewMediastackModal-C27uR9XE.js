import{K as c,a as _}from"./KeywordsField-B8AZHPAc.js";import{C as d}from"./ContributeView-DaYqLNyu.js";import{D as u}from"./DestinationCorpusSelector-D9gmIUpK.js";import{n as l}from"../build.js";import"./EmbedPicker-CQwq9A1Z.js";import"./FileShown-CvQXdy3a.js";const p={props:{selected_items:Array},components:{KeywordsFieldEditor:_,KeywordsField:c,ChutierItem:d,DestinationCorpusSelector:u},i18n:{messages:{fr:{destination_corpus:"Corpus de destination",create_document:"Nouveau document",add_title_to_continue:"Indiquez un titre pour continuer",add_keywords_to_continue:"Ajoutez des mots-clÃ©s pour continuer",add_authors_to_continue:"Ajoutez des auteurs pour continuer"},en:{destination_corpus:"Destination corpus",create_document:"New document",add_title_to_continue:"Add title to continue",add_keywords_to_continue:"Add keywords to continue",add_authors_to_continue:"Add authors to continue"}}},data(){return{current_step:0,steps:[{label:this.$t("title")},{label:this.$t("keywords")},{label:this.$t("team")},{label:this.$t("review")}],stack_title:"",has_valid_title:!1,stack_description:"",stack_tags:[],stack_authors:[],status:"idle",selected_destination_folder_path:void 0}},created(){this.connected_as.$path&&this.stack_authors.push(this.connected_as.$path)},mounted(){},beforeDestroy(){},watch:{},computed:{modal_name(){return this.$t("create_document")+" ("+(this.current_step+1)+"/"+this.steps.length+")"},allow_next_step(){return this.current_step===0?this.has_valid_title:this.current_step===1?this.stack_tags.length>0:!0}},methods:{backStep(){this.current_step>0?this.current_step--:this.$emit("close")},nextStep(){this.current_step++},async publishMediastack(){this.status="publishing";const n=this.selected_destination_folder_path+"/stacks";let t={$status:"public",requested_slug:"stack",$admins:this.stack_authors,title:this.stack_title,description:this.stack_description,keywords:this.stack_tags};const e=await this.$api.createFolder({path:n,additional_meta:t}),s=n+"/"+e;let a=[];for(const i of this.selected_items){const r=await this.$api.copyFile({path:i.$path,path_to_destination_folder:s,new_meta:{}});a.push(r),await this.$api.deleteItem({path:i.$path})}let o={stack_files_metas:a};a.length>=1&&(o.$preview=a[0]),await this.$api.updateMeta({path:s,new_meta:o}),await new Promise(i=>setTimeout(i,250)),this.status="completed",this.$emit("stackPosted",e),await new Promise(i=>setTimeout(i,1e3)),this.$emit("close")}}};var h=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{size:"",title:t.modal_name,is_closable:!1},on:{close:function(s){return t.$emit("close")}},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div",[t.status==="idle"?e("button",{staticClass:"u-button u-button_white",on:{click:t.backStep}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1):t._e()]),t.current_step<t.steps.length-1?e("button",{staticClass:"u-button u-button_primary u-button_pill",attrs:{disabled:!t.allow_next_step},on:{click:t.nextStep}},[t._v(" "+t._s(t.$t("next"))+" "),e("b-icon",{attrs:{icon:"arrow-right"}})],1):t.current_step===t.steps.length-1&&t.status==="idle"?e("button",{staticClass:"u-button u-button_primary",attrs:{disabled:!t.selected_destination_folder_path},on:{click:t.publishMediastack}},[t._v(" "+t._s(t.$t("publish"))+" ")]):t.status==="publishing"?e("span",[t._v(" "+t._s(t.$t("publishing"))+" ")]):t.status==="completed"?e("span",[t._v(" "+t._s(t.$t("completed"))+" ")]):t._e(),t.allow_next_step?t._e():e("div",{staticClass:"u-instructions _cantNextInstr"},[t.current_step===0?[t._v(" "+t._s(t.$t("add_title_to_continue"))+" ")]:t._e(),t.current_step===1?[t._v(" "+t._s(t.$t("add_keywords_to_continue"))+" ")]:t._e(),t.current_step===2?[t._v(" "+t._s(t.$t("add_authors_to_continue"))+" ")]:t._e()],2)]},proxy:!0}])},[e("div",{staticClass:"_createNewMediastackModal"},[e("portal-target",{attrs:{name:"largemedia",multiple:""}}),e("div",{staticClass:"_content"},[e("div",{staticClass:"_breadcrumb"},t._l(t.steps,function(s,a){return e("button",{key:s.label,staticClass:"step",class:t.current_step===a?"active":t.current_step>a?"completed":"",attrs:{type:"button"},on:{click:function(o){t.current_step=a}}},[a>0?e("div",{staticClass:"step-line"}):t._e(),e("div",{staticClass:"step-circle"},[t.current_step>=a?e("div",{staticClass:"step-label"},[t._v(" "+t._s(s.label)+" ")]):t._e()])])}),0),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{key:t.current_step,staticClass:"_form"},[t._e(),e("div",{staticClass:"u-spacingBottom _form-review-items"},t._l(t.selected_items,function(s){return e("ChutierItem",{key:s.$path,attrs:{file:s,is_selected:!0}})}),1),t.current_step===0?[e("div",{staticClass:"_form-title"},[e("div",{staticClass:"u-spacingBottom"},[e("h1",[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{attrs:{content:t.stack_title,required:!0,autofocus:!0,can_edit:!0},on:{"update:content":function(s){t.stack_title=s},toggleValidity:s=>t.has_valid_title=s,onEnter:t.nextStep}})],1)]),e("div",{staticClass:"u-spacingBottom _description"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("TextInput",{attrs:{content:t.stack_description,input_type:"editor",can_edit:!0},on:{"update:content":function(s){t.stack_description=s},onEnter:t.nextStep}})],1)])]:t._e(),t.current_step===1?[e("div",{staticClass:"u-spacingBottom _form-tags"},[e("KeywordsFieldEditor",{attrs:{keywords:t.stack_tags},on:{"update:keywords":function(s){t.stack_tags=s}}})],1)]:t._e(),t.current_step===2?[e("div",{staticClass:"u-spacingBottom _form-team"},[e("AuthorField",{attrs:{label:t.$t("authors"),instructions:t.$t("media_editing_instructions"),authors_paths:t.stack_authors,can_edit:!0},on:{save:s=>{t.stack_authors=s}}})],1)]:t._e(),t.current_step===3?[e("div",{staticClass:"_form-review"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title")}}),e("h2",[t._v(" "+t._s(t.stack_title||t.$t("none"))+" ")])],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("div",{domProps:{innerHTML:t._s(t.stack_description||t.$t("none_f"))}})],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("keywords")}}),t.stack_tags.length>0?e("div",[e("KeywordsField",{attrs:{keywords:t.stack_tags,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1),e("div",{},[e("DLabel",{attrs:{str:t.$t("destination_corpus")}}),e("DestinationCorpusSelector",{attrs:{selected_destination_folder_path:t.selected_destination_folder_path},on:{"update:selected_destination_folder_path":function(s){t.selected_destination_folder_path=s}}})],1)])]:t._e()],2)])],1)],1)])},m=[],f=l(p,h,m,!1,null,"8b59d35c");const C=f.exports;export{C as default};
