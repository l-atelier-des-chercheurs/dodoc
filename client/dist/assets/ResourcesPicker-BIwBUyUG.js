import{n as l,f as n}from"../build.js";const c={mixins:[n],props:{project_path:{type:String,required:!0},select_mode:{type:String,default:"single"},pick_from_types:{type:[String,Array],default:()=>["image","video","audio"]}},components:{},data(){return{resources:{images:[],videos:[],sons:[]},is_loading:!1,error:null,downloading:[],base_url:"https://latelier-des-chercheurs.fr/content/bibli-libre/",fullscreen_media:null}},created(){this.loadResources()},mounted(){},beforeDestroy(){},watch:{},computed:{normalizedPickFromTypes(){return typeof this.pick_from_types=="string"?[this.pick_from_types]:Array.isArray(this.pick_from_types)?this.pick_from_types:["image","video","audio"]},resourceSections(){return[{type:"image",key:"images",label:this.$t("images"),items:this.resources.images,tag:"img"},{type:"video",key:"videos",label:this.$t("videos"),items:this.resources.videos,tag:"video"},{type:"audio",key:"sons",label:this.$t("audio"),items:this.resources.sons,tag:"audio"}].filter(t=>this.normalizedPickFromTypes.includes(t.type)&&t.items&&t.items.length>0)}},methods:{getDownloadButtonText(t){return this.downloading.includes(t)?this.$t("downloading"):this.$t("download")},openFullscreen(t,e){this.fullscreen_media={src:this.getFullUrl(t),tag:e}},closeFullscreen(){this.fullscreen_media=null},async loadResources(){this.is_loading=!0,this.error=null;try{const t=await fetch("https://latelier-des-chercheurs.fr/bibli-libre");if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();this.resources=this.transformApiData(e)}catch(t){console.error("Error loading resources:",t),this.error=this.$t("failed_to_load_resources")}finally{this.is_loading=!1}},transformApiData(t){const e={images:[],videos:[],sons:[]};return t.medias&&Array.isArray(t.medias)&&t.medias.forEach(s=>{const r={src:s.src,filename:s.filename,size:s.size,mime:s.mime,modified:s.modified,credits:s.filename};switch(s.$type){case"image":this.normalizedPickFromTypes.includes("image")&&e.images.push(r);break;case"video":this.normalizedPickFromTypes.includes("video")&&e.videos.push(r);break;case"audio":this.normalizedPickFromTypes.includes("audio")&&e.sons.push(r);break}}),e},getFullUrl(t){return t},handleImageError(t){t.target.style.display="none"},async downloadResource(t,e){if(!this.downloading.includes(t)){this.downloading.push(t);try{const s=this.getFullUrl(t),r=this.getFilenameForResource(t),i={url:s,$credits:this.getCreditsForResource(t),$origin:"resources_picker",$authors:[this.connected_as.$path],requested_slug:r},{uploaded_meta:o}=await this.$api.uploadFile({path:this.project_path,additional_meta:i});o&&(this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("resource_imported_successfully")),setTimeout(()=>{this.$emit("pickResources",[o])},200))}catch(s){console.error("Error downloading resource:",s),this.$alertify.delay(4e3).error(this.$t("failed_to_import_resource"))}finally{const s=this.downloading.indexOf(t);s>-1&&this.downloading.splice(s,1)}}},getFilenameForResource(t){const s=[...this.resources.images||[],...this.resources.videos||[],...this.resources.sons||[]].find(r=>r.src===t);return(s==null?void 0:s.filename)||this.extractFilenameFromUrl(t)},extractFilenameFromUrl(t){try{return new URL(t).pathname.split("/").pop()||"downloaded-resource"}catch{return"downloaded-resource"}},getCreditsForResource(t){const s=[...this.resources.images||[],...this.resources.videos||[],...this.resources.sons||[]].find(r=>r.src===t);return(s==null?void 0:s.credits)||t}}};var d=function(){var e=this,s=e._self._c;return s("div",[s("BaseModal2",{attrs:{title:e.$t("free_resources"),size:"large"},on:{close:function(r){return e.$emit("close")}}},[e.is_loading?s("div",{staticClass:"_loading"},[s("LoaderSpinner"),s("p",[e._v(e._s(e.$t("loading_resources")))])],1):e.error?s("div",{staticClass:"_error"},[s("div",{staticClass:"_errorIcon"},[e._v("âš ")]),s("p",[e._v(e._s(e.error))]),s("button",{staticClass:"u-button",on:{click:e.loadResources}},[e._v(" "+e._s(e.$t("retry"))+" ")])]):s("div",{staticClass:"_resourcesGrid"},e._l(e.resourceSections,function(r){return s("div",{key:r.key,staticClass:"_section"},[s("div",{staticClass:"_sectionHeader"},[s("h3",[e._v(e._s(r.label))]),s("span",{staticClass:"_count"},[e._v(e._s(r.items.length))])]),s("div",{staticClass:"_grid"},e._l(r.items,function(i,o){return s("div",{key:`${r.key}-${o}`,staticClass:"u-card2 _resourceCard",class:{_isDownloading:e.downloading.includes(i.src)}},[s("div",{staticClass:"_preview",on:{click:function(a){return e.openFullscreen(i.src,r.tag)}}},[s(r.tag,{tag:"component",attrs:{src:e.getFullUrl(i.src),alt:r.tag==="img"?i.credits||r.label:null,controls:r.tag!=="img",preload:r.tag!=="img"?"metadata":null},on:{error:function(a){r.tag==="img"&&e.handleImageError}}})],1),s("div",{staticClass:"_info"},[s("p",{staticClass:"_credits",attrs:{title:i.credits}},[e._v(" "+e._s(i.credits)+" ")]),s("button",{staticClass:"_downloadBtn",attrs:{disabled:e.downloading.includes(i.src),title:e.getDownloadButtonText(i.src)},on:{click:function(a){return e.downloadResource(i.src,r.type)}}},[s("b-icon",{attrs:{icon:e.downloading.includes(i.src)?"loader":"download"}})],1)])])}),0)])}),0)]),s("transition",{attrs:{name:"fade"}},[e.fullscreen_media?s("div",{staticClass:"_fullscreenModal",on:{click:e.closeFullscreen}},[s("button",{staticClass:"_closeBtn",on:{click:e.closeFullscreen}},[s("b-icon",{attrs:{icon:"close"}})],1),s("div",{staticClass:"_fullscreenContent",on:{click:function(r){r.stopPropagation()}}},[s(e.fullscreen_media.tag,{tag:"component",attrs:{src:e.fullscreen_media.src,controls:e.fullscreen_media.tag!=="img",autoplay:e.fullscreen_media.tag!=="img"}})],1)]):e._e()])],1)},u=[],m=l(c,d,u,!1,null,"26d88acc");const h=m.exports;export{h as R};
