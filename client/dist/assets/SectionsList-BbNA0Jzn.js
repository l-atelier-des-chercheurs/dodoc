import{n as o}from"../build.js";import a from"./SingleSection-G-R-OKMS.js";const _={props:{publication:Object,sections:Array,opened_section_meta_filename:String,can_edit:Boolean},components:{},inject:{$getMapOptions:{default:!1}},data(){return{}},created(){},mounted(){this.can_edit&&this.sections.length===0&&this.createSection(),this.openFirstSectionIfNoneOpened(),this.openExistingSectionIfNotExisting()},beforeDestroy(){},watch:{opened_section_meta_filename(){this.openFirstSectionIfNoneOpened()}},computed:{is_associated_to_map(){return this.$getMapOptions},default_view_color(){return this.$getMapOptions().default_view_color},story_styles(){return this.makeStoryStyles({publication:this.publication})},new_section_title(){let t=this.sections.length+1;const e=i=>this.$t("section")+" "+i;let n=e(t);for(;this.sections.some(i=>i.section_title===n);)t++,n=e(t);return n},opened_section(){return this.sections.find(t=>this.getFilename(t.$path)===this.opened_section_meta_filename)}},methods:{openSection(t){this.$emit("toggleSection",this.getFilename(t))},openFirstSectionIfNoneOpened(){this.sections.length>0&&!this.opened_section_meta_filename&&this.$emit("openFirstSection")},openExistingSectionIfNotExisting(){this.opened_section_meta_filename&&!this.opened_section&&this.$emit("openFirstSection")},async createSection(){const t=await this.createSection2({publication:this.publication,additional_meta:{section_title:this.new_section_title}});this.$emit("toggleSection",t)}}};var r=function(){var e=this,n=e._self._c;return n("div",{staticClass:"_sectionsSummary",style:e.story_styles},[n("ReorderedList",{attrs:{field_name:"sections_list",items:e.sections,path:e.publication.$path,active_item_meta:e.opened_section_meta_filename,can_edit:e.can_edit},on:{openItem:e.openSection,createItem:e.createSection},scopedSlots:e._u([{key:"default",fn:function(i){return[i.item.section_title?[e._v(" "+e._s(i.item.section_title)+" ")]:[n("i",[e._v(e._s(e.$t("untitled")))])]]}}])})],1)},l=[],d=o(_,r,l,!1,null,"b22b64d7");const m=d.exports,p={props:{module_path:String,sections:Array},components:{},data(){return{section_path_to_move_to:void 0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{module_meta_filename(){return this.getFilename(this.module_path)},all_sections_in_select(){return this.sections.map(t=>({key:t.$path,text:t.section_title}))},current_section_path(){var t;return(t=this.sections.find(e=>e.modules_list.includes(this.module_meta_filename)))==null?void 0:t.$path}},methods:{setNewSection(t){this.section_path_to_move_to=t},async submit(){await this.appendModuleToSection(),await this.removeModuleFromSection()},async appendModuleToSection(){var n;let e=((n=this.sections.find(i=>i.$path===this.section_path_to_move_to).modules_list)==null?void 0:n.slice())||[];e.push(this.module_meta_filename),await this.$api.updateMeta({path:this.section_path_to_move_to,new_meta:{modules_list:e}})},async removeModuleFromSection(){var n;let e=((n=this.sections.find(i=>i.$path===this.current_section_path).modules_list)==null?void 0:n.slice())||[];e=e.filter(i=>i!==this.module_meta_filename),await this.$api.updateMeta({path:this.current_section_path,new_meta:{modules_list:e}}),this.$emit("close")}}};var h=function(){var e=this,n=e._self._c;return n("BaseModal2",{attrs:{title:e.$t("change_section")},on:{close:function(i){return e.$emit("close")}}},[n("div",{},[n("SelectField2",{attrs:{value:e.current_section_path,options:e.all_sections_in_select,can_edit:!0,hide_validation:!0},on:{change:e.setNewSection}})],1),n("template",{slot:"footer"},[n("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(i){return e.$emit("close")}}},[n("b-icon",{attrs:{icon:"x-circle"}}),e._v(" "+e._s(e.$t("cancel"))+" ")],1),n("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button",autofocus:"",disabled:!e.section_path_to_move_to||e.section_path_to_move_to===e.current_section_path},on:{click:e.submit}},[e._v(" "+e._s(e.$t("move"))+" ")])])],2)},u=[],f=o(p,h,u,!1,null,"5c2e5079");const v=f.exports,S={props:{publication:Object,sections:Array,opened_section_meta_filename:String,can_edit:Boolean},components:{SingleSection:a,ChangeSectionForModule:v},data(){return{change_section_for_module:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{opened_section(){return this.sections.find(t=>this.getFilename(t.$path)===this.opened_section_meta_filename)},opened_section_index(){return this.sections.findIndex(t=>{var e;return t.$path===((e=this.opened_section)==null?void 0:e.$path)})},next_section(){return this.opened_section_index<this.sections.length-1?this.sections[this.opened_section_index+1]:!1},prev_section(){return this.opened_section_index>0?this.sections[this.opened_section_index-1]:!1}},methods:{nextSection(){var t;this.scrollToTop(),(t=this.next_section)!=null&&t.$path&&this.$emit("toggleSection",this.getFilename(this.next_section.$path))},prevSection(){var t;this.scrollToTop(),(t=this.prev_section)!=null&&t.$path&&this.$emit("toggleSection",this.getFilename(this.prev_section.$path))},async scrollToTop(){const t=function(i){const s=i.scrollHeight>i.clientHeight,c=window.getComputedStyle(i).overflowY.indexOf("hidden")!==-1;return s&&!c},e=function(i){return!i||i===document.body?document.body:t(i)?i:e(i.parentNode)};e(this.$el).scrollTo({top:0,left:0,behavior:"smooth"})}}};var g=function(){var e=this,n=e._self._c;return n("div",{staticClass:"_openedSection"},[n("SingleSection",{ref:"section",attrs:{publication:e.publication,section:e.opened_section,can_edit:e.can_edit},on:{prevSection:e.prevSection,nextSection:e.nextSection,changeSectionForModule:function(i){e.change_section_for_module=i}}}),e.change_section_for_module?n("ChangeSectionForModule",{attrs:{module_path:e.change_section_for_module,sections:e.sections},on:{close:function(i){e.change_section_for_module=!1}}}):e._e(),n("div",{staticClass:"_navBtns"},[n("div",{staticClass:"_navBtns--content"},[e.prev_section?n("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:e.prevSection}},[n("b-icon",{attrs:{icon:"arrow-left-square"}}),n("span",[e._v(" "+e._s(e.prev_section.section_title)+" ")])],1):e._e(),e.next_section?n("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:e.nextSection}},[n("span",[e._v(" "+e._s(e.next_section.section_title)+" ")]),n("b-icon",{attrs:{icon:"arrow-right-square"}})],1):e._e()])])],1)},b=[],$=o(S,g,b,!1,null,"37f01819");const y=$.exports,w={props:{publication:Object,opened_section_meta_filename:String,can_edit:Boolean},components:{SectionsSummary:m,OpenedSection:y},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{sections(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"})},meta_filenames_already_present(){const{current:t,other:e}=this.getMediasAlreadyPresentInPublication({publication:this.publication,sections:this.sections,opened_section_meta_filename:this.opened_section_meta_filename});return[{label:this.$t("in_this_section"),medias:t,color:"var(--c-orange)"},{label:this.$t("in_another_section"),medias:e,color:"var(--c-bleuvert)"}]}},methods:{openFirstSection(){const t=this.getFilename(this.sections[0].$path);this.$emit("toggleSection",t)},unselectModule(){this.$eventHub.$emit("module.none_edited")}}};var x=function(){var e=this,n=e._self._c;return n("div",{staticClass:"_sectionsList"},[n("SectionsSummary",{directives:[{name:"show",rawName:"v-show",value:e.can_edit||e.sections.length>1,expression:"can_edit || sections.length > 1"}],attrs:{publication:e.publication,sections:e.sections,opened_section_meta_filename:e.opened_section_meta_filename,can_edit:e.can_edit},on:{toggleSection:function(i){return e.$emit("toggleSection",i)},openFirstSection:e.openFirstSection}}),n("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e.opened_section_meta_filename?n("OpenedSection",{key:e.opened_section_meta_filename,attrs:{publication:e.publication,sections:e.sections,opened_section_meta_filename:e.opened_section_meta_filename,can_edit:e.can_edit},on:{toggleSection:function(i){return e.$emit("toggleSection",i)}}}):e._e()],1)],1)},F=[],M=o(w,x,F,!1,null,"f29a92d4");const T=M.exports;export{T as S};
