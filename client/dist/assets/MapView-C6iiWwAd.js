import{S as f,s as w,p as b}from"./SingleBaseMediaPicker-C6eWf6Eb.js";import g from"./DisplayOnMap-C8axtBMk.js";import{S as y}from"./SectionsList-LRkko2DZ.js";import{n as s}from"../build.js";import{M as $}from"./ModuleCreator-DTdP3Bhr.js";const k={props:{publication:Object,pins:Array,opened_view_meta_filename:String,default_view_color:String,opened_pin_path:String,can_edit:Boolean},components:{SectionsList:y},provide(){return{$getMapOptions:()=>({opened_pin_path:this.opened_pin_path,pins_infos:this.pins.map(({path:i,index:e,color:t,pin_preview:a,pin_preview_src:n})=>({path:i,index:e,color:t,pin_preview:a,pin_preview_src:n})),default_view_color:this.default_view_color})}},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var M=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_viewPane"},[t("SectionsList",{attrs:{publication:e.publication,opened_section_meta_filename:e.opened_view_meta_filename,can_edit:e.can_edit},on:{toggleSection:function(a){return e.$emit("toggleView",a)}}})],1)},x=[],C=s(k,M,x,!1,null,"28357630");const V=C.exports,S={props:{view:Object,default_view_color:String},components:{SingleBaseMediaPicker:f},data(){return{icon_options:[{key:"",label:this.$t("icon")},{key:"media_preview",label:this.$t("media_preview")}],map_baselayer_options:[{key:"OSM",text:this.$t("OSM")},{key:"stadia_alidade_smooth",text:this.$t("alidade_smooth"),instructions:this.$t("provided_by_stadiamaps")},{key:"stadia_alidade_smooth_dark",text:this.$t("alidade_smooth_dark"),instructions:this.$t("provided_by_stadiamaps")},{key:"stadia_toner",text:this.$t("STAMEN_toner"),instructions:this.$t("provided_by_stadiamaps")},{key:"stadia_watercolor",text:this.$t("STAMEN_watercolor"),instructions:this.$t("provided_by_stadiamaps")},{key:"IGN_SAT",text:this.$t("IGN_SAT"),instructions:this.$t("IGN_max_zoom_limits")},{key:"IGN_MAP",text:this.$t("IGN_MAP"),instructions:this.$t("IGN_max_zoom_limits")},{key:"---",text:"---",disabled:!0},{key:"image",text:this.$t("image_or_drawing")},{key:"---2",text:"---",disabled:!0},{key:"color",text:this.$t("color")}]}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{map_mode(){var i;return((i=this.view)==null?void 0:i.map_mode)||"gps"},publication_path(){return this.getParent(this.view.$path)}},methods:{async updateView({field:i,value:e}){await this.$api.updateMeta({path:this.view.$path,new_meta:{[i]:e}})}}};var P=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_viewOptions"},[t("div",{staticClass:"_viewOptions--content"},[t("DetailsPane",{staticClass:"_detailsInfo",attrs:{header:e.view.section_title,icon:"gear"}},[t("div",{staticClass:"u-spacingBottom"},[t("ColorInput",{attrs:{label:e.$t("pins_color"),can_toggle:!1,default_value:e.default_view_color,default_colors:["#b9b9b9","#ffffff","#B0BDED","#52c5b9","#ffbe32","#fc4b60"],value:e.view.section_color},on:{save:function(a){return e.updateView({field:"section_color",value:a})}}})],1),t("div",{staticClass:"u-spacingBottom"},[t("ToggleInput",{attrs:{label:e.$t("link_pins"),content:e.view.link_pins},on:{"update:content":function(a){return e.updateView({field:"link_pins",value:a})}}})],1),t("div",{staticClass:"u-spacingBottom"},[t("RadioCheckboxField",{attrs:{label:e.$t("pin_icons"),field_name:"all_pins_icon",input_type:"radio",content:e.view.all_pins_icon||"",path:e.view.$path,options:e.icon_options,can_edit:!0}})],1),t("div",{staticClass:"u-spacingBottom"},[t("DLabel",{attrs:{str:e.$t("map_baselayer")}}),t("SelectField2",{attrs:{value:e.view.map_baselayer||"OSM",options:e.map_baselayer_options,can_edit:!0,hide_validation:!1},on:{update:function(a){return e.updateView({field:"map_baselayer",value:a})}}})],1),e.view.map_baselayer==="image"?t("div",{staticClass:"u-spacingBottom"},[t("DLabel",{attrs:{str:e.$t("image_basemap")}}),t("SingleBaseMediaPicker",{attrs:{title:e.$t("choose_image_basemap"),field_name:"map_base_media_filename",content:e.view.map_base_media_filename,path:e.view.$path,selected_media_path:e.publication_path,media_type_to_pick:"image"}})],1):e._e(),t("div",{staticClass:"u-spacingBottom"},[t("ColorInput",{attrs:{label:e.$t("background_color"),value:e.view.map_baselayer_color,default_value:"#F6F8F8"},on:{save:function(a){return e.updateView({field:"map_baselayer_color",value:a})}}})],1),t("div",{staticClass:"u-spacingBottom"},[t("RangeValueInput",{attrs:{label:e.$t("opacity"),value:e.view.map_baselayer_opacity,min:0,max:1,step:.01,default_value:1},on:{save:function(a){return e.updateView({field:"map_baselayer_opacity",value:a})}}})],1),t("div",{staticClass:"u-spacingBottom"},[t("ToggleInput",{attrs:{label:e.$t("bw_filter"),content:e.view.map_baselayer_bw},on:{"update:content":function(a){return e.updateView({field:"map_baselayer_bw",value:a})}}})],1),t("div",{staticClass:"u-spacingBottom"},[t("RangeValueInput",{attrs:{label:e.$t("zoom_animation"),value:e.view.zoom_animation,min:0,max:5,step:.1,default_value:0},on:{save:function(a){return e.updateView({field:"zoom_animation",value:a})}}})],1)])],1)])},F=[],O=s(S,P,F,!1,null,"60ac3941");const B=O.exports,I={props:{publication:Object,opened_view_meta_filename:String,display:{type:String,default:"adjacent"},can_edit:Boolean},components:{Splitpanes:w,Pane:b,DisplayOnMap:g,ViewPane:V,ViewOptions:B,ModuleCreator:$},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{latest_click:{latitude:void 0,longitude:void 0},opened_pin_path:void 0,default_view_color:"#fc4b60"}},created(){},mounted(){},beforeDestroy(){},watch:{opened_view_meta_filename(){this.opened_pin_path=void 0},opened_pin_path(){if(this.opened_pin_path){const i=this.views.find(e=>{var t;return(t=e.modules_list)==null?void 0:t.includes(this.getFilename(this.opened_pin_path))});if(i){const e=this.getFilename(i.$path);this.opened_view_meta_filename!==e&&this.$emit("toggleView",e)}}}},computed:{views(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"})},opened_view(){return this.opened_view_meta_filename?this.views.find(i=>this.getFilename(i.$path)===this.opened_view_meta_filename):!1},base_media(){var e,t;if((e=this.opened_view)!=null&&e._map_base_media)return this.opened_view._map_base_media;const i=(t=this.opened_view)==null?void 0:t.map_base_media_filename;if(i)return this.getSourceMedia({source_media:{meta_filename_in_project:i},folder_path:this.publication.$path})},views_to_display(){return this.views.filter(i=>!this.opened_view_meta_filename||this.getFilename(i.$path)===this.opened_view_meta_filename)},pins(){return this.views_to_display.reduce((i,e)=>{const t=this.getModulesForSection({publication:this.publication,section:e}).map(({_module:n})=>n);let a=0;return t.map(n=>{var r,d;if(!((r=n.location)!=null&&r.longitude)||!((d=n.location)!=null&&d.latitude))return;let o=[];e.link_pins&&o.push(a+1),n.pin_name&&o.push(n.pin_name);const m=o.length>0?o.join(" â€¢ "):!1,_=this.getViewColor(e),u=n.zoom_level||"undefined";let l="icon";const h=`
              <svg enable-background="new 0 0 100 100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="30" height="30">
                <path
                  d="m78.527 5h-57.054c-4.104 0-7.431 3.324-7.431 7.428v57.059c0 4.106 3.326 7.433 7.431 7.433h11.965l16.501 18.08 16.5-18.085h12.088c4.104 0 7.431-3.322 7.431-7.429v-57.058c-.001-4.104-3.327-7.428-7.431-7.428z"
                  fill="${_}"
                  stroke="#000"
                  stroke-width="4px"
                />
                <text x="50" y="55" fill="#000000" text-anchor="middle" font-size="48px" font-weight="500" font-family="Fira Mono">
                  ${a+1}
                </text>
              </svg>`;let v=`data:image/svg+xml;base64, ${btoa(unescape(encodeURIComponent(h)))}`,p;if(e.all_pins_icon==="media_preview"){const c=this.getFirstThumbURLForMedia({file:this.firstMedia(n),resolution:50});c&&(l="media_preview",p=c)}i.push({longitude:n.location.longitude,latitude:n.location.latitude,label:m,index:a+1,path:n.$path,belongs_to_view:e.$path,link_pins:e.link_pins||!1,color:_,pin_zoom_level:u,pin_preview:l,pin_preview_src:v,first_media_thumb:p,file:this.firstMedia(n),module:n}),a++}),i},[])},lines(){return this.pins.length===0?{}:this.pins.reduce((i,e)=>{if(e.link_pins){const t=e.belongs_to_view;Object.prototype.hasOwnProperty.call(i,t)||(i[t]={color:e.color,coordinates:[]}),i[t].coordinates.push([e.longitude,e.latitude])}return i},{})},geometries(){return this.views_to_display.reduce((i,e)=>(!e.map_geom_features||!Array.isArray(e.map_geom_features)||e.map_geom_features.map(t=>{i.push(t)}),i),[])},new_module_meta(){return{location:{longitude:this.latest_click.longitude,latitude:this.latest_click.latitude}}},meta_filenames_already_present(){const{current:i,other:e}=this.getMediasAlreadyPresentInPublication({publication:this.publication,sections:this.views,opened_section_meta_filename:this.opened_view_meta_filename});return[{label:this.$t("in_this_section"),medias:i,color:"var(--c-orange)"},{label:this.$t("in_another_section"),medias:e,color:"var(--c-bleuvert)"}]}},methods:{newPositionClicked({longitude:i,latitude:e}){this.latest_click.longitude=i,this.latest_click.latitude=e},toggleView(i){this.$emit("toggleView",i)},getViewColor(i){return(i==null?void 0:i.section_color)||this.default_view_color},async addModules({meta_filenames:i}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.opened_view,meta_filenames:i});const e=i.at(-1),t=this.publication.$path+"/"+e;setTimeout(()=>{this.$eventHub.$emit("publication.map.openPin",t),this.$eventHub.$emit(`module.enable_edit.${e}`)},150)},async updateOpenedView({field:i,value:e}){await this.$api.updateMeta({path:this.opened_view.$path,new_meta:{[i]:e}})}}};var z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_mapView",attrs:{"data-display":e.display}},[t(e.display==="adjacent"?"splitpanes":"div",{tag:"component"},[t(e.display==="adjacent"?"pane":"div",{tag:"component",attrs:{"min-size":"5"}},[t("DisplayOnMap",{key:e.opened_view_meta_filename,staticClass:"_mapContainer",attrs:{map_baselayer:e.opened_view?e.opened_view.map_baselayer:void 0,map_baselayer_bw:e.opened_view?e.opened_view.map_baselayer_bw:void 0,map_baselayer_opacity:e.opened_view?e.opened_view.map_baselayer_opacity:void 0,map_baselayer_color:e.opened_view?e.opened_view.map_baselayer_color:void 0,zoom_animation:e.opened_view?e.opened_view.zoom_animation:void 0,map_base_media:e.base_media,pins:e.pins,lines:e.lines,geometries:e.geometries,is_small:!1,opened_view_color:e.getViewColor(e.opened_view),opened_pin_path:e.opened_pin_path,can_edit:e.can_edit&&!!e.opened_view_meta_filename},on:{"update:opened_pin_path":function(a){e.opened_pin_path=a},newPositionClicked:e.newPositionClicked,saveGeom:function(a){return e.updateOpenedView({field:"map_geom_features",value:a})}}},[e.can_edit?t("div",{attrs:{slot:"popup_message"},slot:"popup_message"},[e.opened_view_meta_filename?t("div",[t("ModuleCreator",{attrs:{publication_path:e.publication.$path,start_collapsed:!1,select_mode:"single",types_available:["capture","import","write","embed","table"],post_addtl_meta:e.new_module_meta},on:{addModules:e.addModules}})],1):t("div",[e._v(" "+e._s(e.$t("to_add_media_here_open_matching_layer"))+" ")])]):e._e()]),t("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e.opened_view&&e.can_edit?t("ViewOptions",{key:e.opened_view.$path,attrs:{view:e.opened_view,default_view_color:e.default_view_color}}):e._e()],1)],1),t(e.display==="adjacent"?"pane":"div",{tag:"component",attrs:{"min-size":"5"}},[t("ViewPane",{attrs:{publication:e.publication,opened_view_meta_filename:e.opened_view_meta_filename,default_view_color:e.default_view_color,opened_pin_path:e.opened_pin_path,pins:e.pins,can_edit:e.can_edit},on:{toggleView:e.toggleView,togglePin:function(a){e.opened_pin_path=a}}})],1)],1)],1)},A=[],j=s(I,z,A,!1,null,"12a0bf83");const E=j.exports;export{E as M};
