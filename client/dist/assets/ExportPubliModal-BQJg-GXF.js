import{n}from"../build.js";const _={props:{file:Object},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var p=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"u-metaField"},[e("DLabel",{attrs:{str:t.$t("filename")}}),e("div",{staticClass:"u-filename"},[t._v(t._s(t.file.$media_filename))])],1),t.file.$infos.hasOwnProperty("size")?e("SizeDisplay",{attrs:{size:t.file.$infos.size}}):t._e(),t.file.$infos.hasOwnProperty("width")||t.file.$infos.hasOwnProperty("height")?e("ResolutionDisplay",{attrs:{width:t.file.$infos.width,height:t.file.$infos.height}}):t._e(),t.file.$infos.hasOwnProperty("duration")?e("DurationDisplay",{attrs:{title:t.$t("duration"),duration:t.file.$infos.duration}}):t._e()],1)},l=[],c=n(_,p,l,!1,null,"6acd4e9c");const d=c.exports,u={props:{publication_path:String,instructions:Object},components:{ShowExportedFileInfos:d},data(){return{is_exporting:!1,created_doc:void 0,task_progress:0,fail_message:void 0}},i18n:{messages:{fr:{}}},created(){},async mounted(){await this.startExport()},beforeDestroy(){},watch:{},computed:{export_href(){return this.created_doc?this.makeMediaFileURL({$path:this.created_doc.$path,$media_filename:this.created_doc.$media_filename}):!1}},methods:{async startExport(){const i=await this.$api.exportFolder({path:this.publication_path,instructions:this.instructions});this.$api.join({room:"task_"+i}),this.$alertify.delay(4e3).log(this.$t("compilation_started")),this.is_exporting=!0;const t=({task_id:a,progress:s})=>{a===i&&(this.task_progress=s)};this.$eventHub.$on("task.status",t);const e=({task_id:a,message:s})=>{a===i&&(this.$eventHub.$off("task.ended",e),this.$api.leave({room:"task_"+i}),s.event==="completed"?this.created_doc=s.file:s.event==="aborted"?this.fail_message=this.$t("failed_to_export"):s.event==="failed"&&(this.fail_message=this.$t("failed_to_export")+" : "+s.info),this.is_exporting=!1)};this.$eventHub.$on("task.ended",e)},async saveToProject(){this.$eventHub.$emit("pane.animate","collect"),this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("media_was_saved_to_project")),this.$emit("close")},removeAndCloseModal(){this.created_doc&&this.$api.deleteItem({path:this.created_doc.$path}),this.$emit("close")}}};var f=function(){var t=this,e=t._self._c;return e("BaseModal2",{on:{close:t.removeAndCloseModal}},[t.is_exporting?[e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.$t("export_in_progress"))+" ")]),e("div",[e("div"),e("div",[e("AnimatedCounter",{attrs:{value:t.task_progress}})],1)])]:[t.fail_message?[e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.fail_message)+" ")])]:t._e(),t.created_doc?[t.instructions.recipe==="webpage"?e("div",{staticClass:"u-instructions",domProps:{innerHTML:t._s(t.$t("webpage_export_instructions"))}}):e("MediaContent",{staticClass:"_preview",attrs:{file:t.created_doc,resolution:1600,context:"full"}}),e("div",{staticClass:"u-spacingBottom"}),e("ShowExportedFileInfos",{attrs:{file:t.created_doc}}),e("a",{staticClass:"u-buttonLink",attrs:{disabled:!t.export_href,download:t.created_doc.$media_filename,href:t.export_href,target:"_blank"}},[t._v(" "+t._s(t.$t("download"))+" ")])]:t._e(),e("template",{slot:"footer"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:t.removeAndCloseModal}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),e("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:t.saveToProject}},[e("span",{staticClass:"u-icon",domProps:{innerHTML:t._s(t.dodoc_icon_collect)}}),t._v(" "+t._s(t.$t("save_to_project"))+" ")])])]],2)},m=[],h=n(u,f,m,!1,null,"6295f481");const g=h.exports,b={props:{modal_title:String,publication:Object,pane_infos:Object},components:{ExportItemAndSaveOrDownload:g},data(){return{task_instructions:!1,page_to_export_as_image:1,pdf_pages_to_export_mode:"all",specific_pdf_page_or_spread_to_export:"",page_width:this.publication.page_width||210,page_height:this.publication.page_height||297,export_mode:"pdf",export_options:[{key:"pdf",label:this.$t("pdf")},{key:"png",label:this.$t("image")}]}},i18n:{messages:{fr:{}}},created(){this.publication_ratio=this.page_height/this.page_width,this.page_to_export_as_image=this.current_page_number||1},mounted(){},beforeDestroy(){},watch:{},computed:{page_count(){return this.publication.pages.length},is_spread(){return this.publication.page_spreads===!0},export_mode_icon(){if(this.export_mode==="pdf")return"file-pdf";if(this.export_mode==="png")return"file-earmark-image";if(this.export_mode==="webpage")return"window"},current_page_number(){var i;return(i=this.pane_infos)!=null&&i.page_id&&this.publication.pages?this.publication.pages.findIndex(e=>e.id===this.pane_infos.page_id)+1:!1},total_number_of_pages(){return this.publication.pages?this.publication.pages.length:!1},total_number_of_spreads(){return this.total_number_of_pages?Math.floor(this.total_number_of_pages/2)+1:!1},current_spread_number(){var i;if((i=this.pane_infos)!=null&&i.page_id&&this.publication.page_spreads){const t=this.publication.pages.findIndex(e=>e.id===this.pane_infos.page_id);return Math.floor((t+1)/2)+1}return!1},custom_resolution_unit(){return this.publication.layout_mode==="print"||this.publication.template==="edition"?"mm":"px"},url_to_print_from(){const i=this.$router.resolve({path:this.createURLFromPath(this.publication.$path)});return window.location.origin+i.href},current_info(){let i=this.$t("current_f")+" (";return i+=this.is_spread?this.$t("spread").toLowerCase():this.$t("page").toLowerCase(),i+=" "+(this.is_spread?this.current_spread_number:this.current_page_number)+")",i}},methods:{makePageNumber(i){return this.current_page_number===i?`â€¢ ${i}`:i},async exportPublication(i){var a;const t={};t.$origin="publish",t.$credits=this.$t("created_by_publication",{publication_title:this.publication.title}),(a=this.connected_as)!=null&&a.$path&&(t.$authors=[this.connected_as.$path]);let e={recipe:i,page_width:this.page_width,page_height:this.page_height,layout_mode:this.publication.layout_mode||"print",suggested_file_name:this.publication.title,additional_meta:t};this.publication.template==="page_by_page"&&(e.page=this.page_to_export_as_image),this.export_mode==="pdf"&&(this.pdf_pages_to_export_mode==="current"?e.page=this.is_spread?this.current_spread_number:this.current_page_number:this.pdf_pages_to_export_mode==="custom"&&(e.page=this.specific_pdf_page_or_spread_to_export)),this.is_spread&&(e.page_width*=2),this.task_instructions=e}}};var v=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.modal_title},on:{close:function(a){return t.$emit("close")}}},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("document_type")}}),e("RadioCheckboxInput",{attrs:{value:t.export_mode,options:t.export_options,can_edit:!0},on:{"update:value":function(a){t.export_mode=a}}})],1),t.export_mode==="pdf"&&["page_by_page","edition"].includes(t.publication.template)?[e("DLabel",{attrs:{str:t.is_spread?t.$t("spreads_to_export"):t.$t("pages_to_export")}}),e("div",{staticClass:"u-inputGroup"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.pdf_pages_to_export_mode,expression:"pdf_pages_to_export_mode"}],on:{change:function(a){var s=Array.prototype.filter.call(a.target.options,function(o){return o.selected}).map(function(o){var r="_value"in o?o._value:o.value;return r});t.pdf_pages_to_export_mode=a.target.multiple?s:s[0]}}},[e("option",{attrs:{value:"all"}},[t._v(" "+t._s(t.is_spread?t.$t("all_spreads"):t.$t("all_pages"))+" ")]),!t.is_spread&&t.current_page_number!==!1||t.is_spread&&t.current_spread_number!==!1?e("option",{attrs:{value:"current"}},[t._v(" "+t._s(t.current_info)+" ")]):t._e(),e("option",{attrs:{value:"custom"}},[t._v(t._s(t.$t("custom")))])]),t.pdf_pages_to_export_mode==="custom"?e("input",{directives:[{name:"model",rawName:"v-model",value:t.specific_pdf_page_or_spread_to_export,expression:"specific_pdf_page_or_spread_to_export"}],attrs:{size:"large",type:"text",placeholder:t.is_spread?t.$t("spread_number_or_interval"):t.$t("page_number_or_interval")},domProps:{value:t.specific_pdf_page_or_spread_to_export},on:{input:function(a){a.target.composing||(t.specific_pdf_page_or_spread_to_export=a.target.value)}}}):t._e()]),t.pdf_pages_to_export_mode==="custom"&&t.total_number_of_pages?e("div",{staticClass:"u-instructions"},[t.is_spread?[t._v(" "+t._s(t.$t("total_number_of_spreads_in_publication",{total:t.total_number_of_spreads}))+" ")]:[t._v(" "+t._s(t.$t("total_number_of_pages_in_publication",{total:t.total_number_of_pages}))+" ")]],2):t._e()]:t._e(),t.export_mode==="png"?[t.publication.template==="page_by_page"?[e("div",{staticClass:"u-spacingBottom"}),e("div",{},[e("DLabel",{attrs:{str:t.$t("page_to_export")}}),e("select",{directives:[{name:"model",rawName:"v-model",value:t.page_to_export_as_image,expression:"page_to_export_as_image"}],on:{change:function(a){var s=Array.prototype.filter.call(a.target.options,function(o){return o.selected}).map(function(o){var r="_value"in o?o._value:o.value;return r});t.page_to_export_as_image=a.target.multiple?s:s[0]}}},t._l(new Array(t.page_count),function(a,s){return e("option",{key:s+1,domProps:{value:s+1,textContent:t._s(t.makePageNumber(s+1))}})}),0)],1)]:t._e()]:t._e(),e("template",{slot:"footer"},[e("div"),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(a){return t.exportPublication(t.export_mode)}}},[e("b-icon",{attrs:{icon:t.export_mode_icon}}),t._v(" "+t._s(t.$t("create"))+" ")],1)]),t.task_instructions?e("ExportItemAndSaveOrDownload",{attrs:{publication_path:t.publication.$path,instructions:t.task_instructions},on:{close:function(a){t.task_instructions=!1}}}):t._e()],2)},$=[],x=n(b,v,$,!1,null,"023b381c");const y=x.exports;export{y as default};
