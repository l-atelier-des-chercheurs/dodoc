import{P as d}from"./PublicationSettings-DIeHMtor.js";import{W as c}from"./WidthHeightField-B_EX3ZVn.js";import{n as _,I as p}from"../build.js";import{S as l}from"./SinglePage-BxYeej-E.js";import{M as g}from"./ModuleCreator-DTdP3Bhr.js";import{_ as m}from"./infinite-viewer.esm-ZcF8ddEx.js";import"./PublicationModule-BeWX9BP3.js";import"./MediaPicker-CZryquB9.js";import"./CaptionCreditsPage-B7Fq5xCj.js";import"./flickity-ByXwvD2H.js";const h={props:{publication:Object,is_spread:Boolean},components:{},data(){return{edit_mode:!1,is_saving:!1,can_edit:!0,top:this.publication.page_margin_top||0,bottom:this.publication.page_margin_bottom||0,left:this.publication.page_margin_left||0,right:this.publication.page_margin_right||0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{unit(){return this.publication.layout_mode==="screen"?"px":"mm"}},methods:{enableEditMode(){this.edit_mode=!0},cancel(){this.edit_mode=!1,this.is_saving=!1},async updateMargins(){this.is_saving=!0;try{const i={page_margin_top:this.top,page_margin_bottom:this.bottom,page_margin_left:this.left,page_margin_right:this.right};await this.$api.updateMeta({path:this.publication.$path,new_meta:i}),this.edit_mode=!1,this.is_saving=!1}catch(i){this.is_saving=!1,this.edit_mode=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldntbesaved")),this.$alertify.closeLogOnClick(!0).error(i.response.data)}}}};var v=function(){var t=this,e=t._self._c;return e("div",[e("fieldset",[e("legend",{staticClass:"u-label"},[t._v(t._s(t.$t("margins")))]),e("div",{staticClass:"u-instructions"},[e("small",[t._v(t._s(t.$t("margins_instructions")))])]),e("br"),e("div",{staticClass:"u-sameRow"},[e("div",{},[e("DLabel",{attrs:{str:t.$t("top")}}),e("div",{staticClass:"u-inputGroup"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.top,expression:"top",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.top},on:{input:function(a){a.target.composing||(t.top=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}}),e("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1),e("div",{},[e("DLabel",{attrs:{str:t.$t("bottom")}}),e("div",{staticClass:"u-inputGroup"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.bottom,expression:"bottom",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.bottom},on:{input:function(a){a.target.composing||(t.bottom=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}}),e("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1)]),e("br"),e("div",{staticClass:"u-sameRow"},[e("div",{},[e("DLabel",{attrs:{str:t.is_spread?t.$t("margins_inside"):t.$t("left")}}),e("div",{staticClass:"u-inputGroup"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.left,expression:"left",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.left},on:{input:function(a){a.target.composing||(t.left=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}}),e("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1),e("br"),e("div",{},[e("DLabel",{attrs:{str:t.is_spread?t.$t("margins_outside"):t.$t("right")}}),e("div",{staticClass:"u-inputGroup"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.right,expression:"right",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.right},on:{input:function(a){a.target.composing||(t.right=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}}),e("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1)]),e("br"),t.can_edit&&!t.edit_mode?e("EditBtn",{on:{click:t.enableEditMode}}):t._e(),t.edit_mode?e("div",{staticClass:"_footer"},[e("SaveCancelButtons",{staticClass:"_scb",attrs:{is_saving:t.is_saving},on:{save:t.updateMargins,cancel:t.cancel}})],1):t._e()],1)])},f=[],b=_(h,v,f,!1,null,"46ecccdd");const $=b.exports,w={props:{publication:Object,is_spread:Boolean},components:{},data(){return{edit_mode:!1,is_saving:!1,can_edit:!0,enable_pagination:this.publication.enable_pagination||!1,pagn_starts_on_page:this.publication.pagn_starts_on_page||1,right:this.publication.pagn_right||2,bottom:this.publication.pagn_bottom||2}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{unit(){return this.publication.layout_mode==="screen"?"px":"mm"}},methods:{enableEditMode(){this.edit_mode=!0},cancel(){this.edit_mode=!1,this.is_saving=!1,this.enable_pagination=this.publication.enable_pagination,this.pagn_starts_on_page=this.publication.pagn_starts_on_page,this.right=this.publication.pagn_right||2,this.bottom=this.publication.pagn_bottom||2},async updatePagination(){this.is_saving=!0;try{const i={enable_pagination:this.enable_pagination,pagn_starts_on_page:this.pagn_starts_on_page,pagn_right:this.right,pagn_bottom:this.bottom};await this.$api.updateMeta({path:this.publication.$path,new_meta:i}),this.edit_mode=!1,this.is_saving=!1}catch(i){this.is_saving=!1,this.edit_mode=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldntbesaved")),this.$alertify.closeLogOnClick(!0).error(i.response.data)}}}};var y=function(){var t=this,e=t._self._c;return e("div",[e("fieldset",[e("legend",{staticClass:"u-label"},[t._v(t._s(t.$t("pagination")))]),e("div",{staticClass:"u-instructions"},[e("small",[t._v(t._s(t.$t("pagination_instructions")))]),t.is_spread?e("small",[t._v(" "+t._s(t.$t("pagination_instructions_spread")))]):t._e()]),e("div",{staticClass:"u-sameRow"},[e("ToggleInput",{attrs:{content:t.enable_pagination,label:t.$t("enable"),disabled:!t.edit_mode},on:{"update:content":function(a){t.enable_pagination=a}}})],1),e("br"),e("div",{},[e("DLabel",{attrs:{str:t.$t("pagn_starts_on_page")}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.pagn_starts_on_page,expression:"pagn_starts_on_page",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.pagn_starts_on_page},on:{input:function(a){a.target.composing||(t.pagn_starts_on_page=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}})],1),e("br"),e("div",{staticClass:"u-sameRow"},[e("div",{},[e("DLabel",{attrs:{str:t.is_spread?t.$t("distance_to_outside"):t.$t("distance_to_right")}}),e("div",{staticClass:"u-inputGroup"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.right,expression:"right",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.right},on:{input:function(a){a.target.composing||(t.right=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}}),e("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1),e("div",{},[e("DLabel",{attrs:{str:t.$t("distance_to_bottom")}}),e("div",{staticClass:"u-inputGroup"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.bottom,expression:"bottom",modifiers:{number:!0}}],attrs:{type:"number",disabled:!t.edit_mode},domProps:{value:t.bottom},on:{input:function(a){a.target.composing||(t.bottom=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}}),e("span",{staticClass:"u-suffix",domProps:{textContent:t._s(t.unit)}})])],1)]),e("br"),t.can_edit&&!t.edit_mode?e("EditBtn",{on:{click:t.enableEditMode}}):t._e(),t.edit_mode?e("div",{staticClass:"_footer"},[e("SaveCancelButtons",{staticClass:"_scb",attrs:{is_saving:t.is_saving},on:{save:t.updatePagination,cancel:t.cancel}})],1):t._e()],1)])},P=[],x=_(w,y,P,!1,null,"e789b930");const C=x.exports,k={props:{publication:Object},components:{WidthHeightField:c,SetMargins:$,PaginationOption:C},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_pageSettings"},[e("WidthHeightField",{attrs:{publication:t.publication}}),e("br"),e("ToggleField",{attrs:{label:t.$t("page_spreads"),field_name:"page_spreads",content:t.publication.page_spreads,path:t.publication.$path,can_edit:!0}}),e("br"),e("SetMargins",{attrs:{publication:t.publication,is_spread:t.publication.page_spreads===!0}}),e("br"),e("PaginationOption",{attrs:{publication:t.publication,is_spread:t.publication.page_spreads===!0}})],1)},S=[],z=_(k,M,S,!1,null,"a6299bd3");const T=z.exports,B={props:{label:String,value:Number,page_modules:Array},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{list_all_z_index(){return this.page_modules.map(i=>i.z_index||0)},max_z_index(){return Math.max(...this.list_all_z_index)},min_z_index(){return Math.min(...this.list_all_z_index)}},methods:{moveToBack(){this.$emit("save",this.min_z_index-1)},moveToFront(){this.$emit("save",this.max_z_index+1)}}};var A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_depthInput"},[t.label?e("DLabel",{attrs:{str:t.label,for:t.label}}):t._e(),e("div",{staticClass:"u-sameRow"},[e("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:t.value===t.max_z_index},on:{click:t.moveToFront}},[e("b-icon",{attrs:{icon:"front"}}),t._v(" "+t._s(t.$t("move_to_front"))+" ")],1),e("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:t.value===t.min_z_index},on:{click:t.moveToBack}},[e("b-icon",{attrs:{icon:"back"}}),t._v(" "+t._s(t.$t("move_to_back"))+" ")],1)])],1)},R=[],I=_(B,A,R,!1,null,"162ecdfc");const L=I.exports,O={props:{pages:Array,current_page_id:String},components:{},data(){return{page_id_to_move_to:void 0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{all_pages_in_select(){return this.pages.map((i,t)=>({key:i.id,text:t+1}))}},methods:{setNewPage(i){this.page_id_to_move_to=i},submit(){this.$emit("submit",this.page_id_to_move_to),this.$emit("close")}}};var N=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.$t("move_to_page")},on:{close:function(a){return t.$emit("close")}}},[e("div",{},[e("SelectField2",{attrs:{value:t.current_page_id,options:t.all_pages_in_select,can_edit:!0,hide_validation:!0},on:{change:t.setNewPage}})],1),e("template",{slot:"footer"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(a){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-circle"}}),t._v(" "+t._s(t.$t("cancel"))+" ")],1),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button",autofocus:"",disabled:!t.page_id_to_move_to||t.page_id_to_move_to===t.current_page_id},on:{click:t.submit}},[t._v(" "+t._s(t.$t("move"))+" ")])])],2)},F=[],D=_(O,N,F,!1,null,"897dc9dc");const u=D.exports,H={props:{on_click:Object,pages:Array,current_page_id:String,path:String},components:{SelectPage:u},data(){var i,t,e;return{type_of_link:((i=this.on_click)==null?void 0:i.type)||"",content_url:((t=this.on_click)==null?void 0:t.url)||"",content_page_id:((e=this.on_click)==null?void 0:e.page_id)||"",show_page_select:!1,options:[{key:"",label:this.$t("do_nothing")},{key:"url",label:this.$t("open_webpage")},{key:"page",label:this.$t("navigate_to_page")}]}},created(){},mounted(){},beforeDestroy(){},watch:{type_of_link:{handler(i,t){i==="page"&&t!=="page"&&!this.content_page_id&&(this.show_page_select=!0)}}},computed:{selected_page_id(){return this.pages.findIndex(i=>i.id===this.content_page_id)+1},active_page_number(){return this.pages.findIndex(i=>i.id===this.current_page_id)+1},allow_save(){return this.type_of_link==="page"?this.content_page_id.length>0:this.type_of_link==="url"?this.content_url.length>0:this.type_of_link===""}},methods:{linkToPage(i){this.content_page_id=i,this.show_page_select=!1},save(){let i;this.type_of_link==="url"?i={type:this.type_of_link,url:this.content_url}:this.type_of_link==="page"?i={type:this.type_of_link,page_id:this.content_page_id}:i={},this.$emit("save",{on_click:i}),this.$emit("close")}}};var E=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.$t("on_click")},on:{close:function(a){return t.$emit("close")}}},[e("div",{staticClass:"u-spacingBottom"},[e("RadioCheckboxInput",{attrs:{value:t.type_of_link,options:t.options,can_edit:!0},on:{"update:value":function(a){t.type_of_link=a}}})],1),t.type_of_link==="url"?e("div",{staticClass:"_options"},[e("TextInput",{attrs:{content:t.content_url,input_type:"url",placeholder:t.$t("url_to_open")},on:{"update:content":function(a){t.content_url=a}}})],1):t.type_of_link==="page"?e("div",{staticClass:"_options"},[t._v(" "+t._s(t.$t("page_number"))+" = "),e("b",[t.selected_page_id?[t._v(" "+t._s(t.selected_page_id)+" ")]:[t._v(" "+t._s(t.$t("no_page_selected"))+" ")]],2),e("EditBtn",{attrs:{label_position:"right"},on:{click:function(a){t.show_page_select=!0}}}),t.show_page_select?e("SelectPage",{attrs:{pages:t.pages,current_page_id:t.current_page_id,allow_save:t.allow_save},on:{submit:t.linkToPage,close:function(a){t.show_page_select=!1}}}):t._e()],1):t._e(),e("SaveCancelButtons",{attrs:{slot:"footer"},on:{save:t.save,cancel:function(a){return t.$emit("close")}},slot:"footer"})],1)},j=[],V=_(H,E,j,!1,null,"4cb80713");const q=V.exports,U={props:{can_edit:Boolean,pages:Array,active_page_number:Number,active_spread_index:[Boolean,Number],page_width:Number,page_height:Number,scale:Number,show_grid:Boolean,snap_to_grid:Boolean,grid_z_index:String,gridstep_in_mm:Number,layout_mode:{type:String,default:"print"},page_color:String,pagination:[Boolean,Object],publication_path:String,page_modules:Array,page_opened_id:String,active_module:[Boolean,Object],display_as_public:Boolean},components:{DepthInput:L,ModuleCreator:g,SelectPage:u,LinkToPageOrURL:q,ImportFileZone:p},data(){return{show_page_options:!1,show_move_to_page_modal:!1,show_edit_link_modal:!1,show_all_medias:!1,has_editor_toolbar:!1}},created(){},mounted(){this.$eventHub.$on("module.text_editing_enabled",this.displayToolbarAndToolTip),this.$eventHub.$on("module.text_editing_disabled",this.removeToolbar),this.$eventHub.$on("module.open_remove_modal",this.openRemoveModal)},beforeDestroy(){this.$eventHub.$off("module.text_editing_enabled",this.displayToolbarAndToolTip),this.$eventHub.$off("module.text_editing_disabled",this.removeToolbar),this.$eventHub.$off("module.open_remove_modal",this.openRemoveModal)},watch:{},computed:{module_meta_filename(){return this.active_module?this.active_module.$path.substring(this.active_module.$path.lastIndexOf("/")+1):""},active_module_first_media(){return this.firstMedia(this.active_module)},first_media_ratio(){var i,t;return(t=(i=this.active_module_first_media)==null?void 0:i.$infos)==null?void 0:t.ratio},is_shape(){return this.getModuleType(this.active_module.module_type)==="shape"},unit(){return this.layout_mode==="screen"?"px":"mm"},magnification(){return this.layout_mode==="screen"?1:this.$root.page_magnification},show_caption(){return!(this.active_module.module_type==="text"||this.is_shape)},has_pagination(){return this.active_page_number-this.pagination.pagination_start_on_page>=0},active_page(){return this.pages[this.active_page_number]},hide_pagination(){return this.pages[this.active_page_number].hide_pagination===!0},new_module_meta(){const i=Math.max(...this.page_modules.map(s=>s.z_index||0))+1;let t=this.$root.default_new_module_left,e=this.$root.default_new_module_top;this.$root.set_new_module_offset_left&&(t=(this.$root.set_new_module_offset_left+this.$root.zoom_offset)/this.magnification),this.$root.set_new_module_offset_top&&(e=(this.$root.set_new_module_offset_top+this.$root.zoom_offset)/this.magnification);const a=Math.max(this.$root.default_new_module_width,this.$root.default_new_module_width/this.scale)/this.magnification,n=Math.max(this.$root.default_new_module_height,this.$root.default_new_module_height/this.scale)/this.magnification;return this.gridstep_in_mm,{page_id:this.page_opened_id,x:t,y:e,width:a,height:n,rotation:0,margins:0,opacity:1,outline_width:0,z_index:i}}},methods:{moveToAnotherPage(i){this.show_move_to_page_modal=!1,this.updateMediaPubliMeta({page_id:i}),this.setActive(!1)},displayToolbarAndToolTip({$toolbar:i,$tooltip:t}){this.has_editor_toolbar=!0,this.$nextTick(()=>{this.$refs.editor_toolbar&&this.$refs.editor_toolbar.append(i),this.$refs.editor_tooltip&&this.$refs.editor_tooltip.append(t)})},removeToolbar(){this.has_editor_toolbar=!1},openRemoveModal(){this.$refs.removeMenu.show_confirm_delete=!0},getPageNumberFromId(i){return this.pages.findIndex(t=>t.id===i)+1},enableModuleEdit({meta_filenames:i}){const t=i.at(-1);setTimeout(()=>{this.$eventHub.$emit(`module.enable_edit.${t}`),this.$eventHub.$emit(`module.panTo.${t}`)},150)},async setRealSize(){const i=this.active_module.width*this.first_media_ratio;await this.updateMediaPubliMeta({height:i})},async setSize(i){i==="full"?await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height,x:0,y:0}):i==="half_left"?await this.updateMediaPubliMeta({width:this.page_width/2,height:this.page_height,x:0,y:0}):i==="half_right"?await this.updateMediaPubliMeta({width:this.page_width/2,height:this.page_height,x:this.page_width/2,y:0}):i==="half_top"?await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height/2,x:0,y:0}):i==="half_bottom"&&await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height/2,x:0,y:this.page_height/2})},changeModulePage(){this.$eventHub.$emit(`module.move.${this.module_meta_filename}`)},duplicateModule(){this.$eventHub.$emit(`module.duplicate.${this.module_meta_filename}`)},removeModule(){this.$eventHub.$emit(`module.remove.${this.module_meta_filename}`),this.$eventHub.$emit("module.setActive",!1)},setActive(i){this.$eventHub.$emit("module.setActive",i),i&&this.$nextTick(()=>{const t=this.getFilename(i);this.$eventHub.$emit(`module.panTo.${t}`)})},async updateMediaPubliMeta(i){this.active_module&&await this.$api.updateMeta({path:this.active_module.$path,new_meta:i}).catch(t=>{throw this.$alertify.delay(4e3).error(t),t})}}};var Z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_pageMenu"},[e("div",{staticClass:"_pageMenu--pane"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(a){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"grid-fill"}}),t.active_spread_index?[t._v(t._s(t.$t("list_of_spreads")))]:[t._v(t._s(t.$t("list_of_pages")))]],2),e("div",{staticClass:"_titleRow"},[e("button",{staticClass:"u-button u-button_transparent u-button_icon",attrs:{type:"button",disabled:t.active_page_number<=0},on:{click:function(a){return t.$emit("prevPage")}}},[e("b-icon",{attrs:{icon:"arrow-left-square"}})],1),e("div",[e("transition",{attrs:{name:"slideupFade",mode:"out-in"}},[e("div",[e("b",{key:t.active_page_number},[t._v(t._s(t.$t("page"))+" "+t._s(t.active_page_number+1))])])]),t.active_spread_index!==!1?e("transition",{attrs:{name:"slideupFade",mode:"out-in"}},[e("span",{key:t.active_spread_index},[t.active_page_number===0?[t._v(" ("+t._s(t.$t("cover"))+") ")]:[t._v(" ("+t._s(t.$t("spread").toLowerCase())+" "+t._s(t.active_spread_index)+") ")]],2)]):t._e()],1),e("button",{staticClass:"u-button u-button_transparent u-button_icon",attrs:{type:"button",disabled:t.active_page_number>=t.pages.length-1},on:{click:function(a){return t.$emit("nextPage")}}},[e("b-icon",{attrs:{icon:"arrow-right-square"}})],1)]),e("div",{staticClass:"_scale"},[e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{can_toggle:!1,label:t.$t("scale"),value:Math.round(t.scale*100),min:10,max:200,step:1,ticks:[10,25,50,100,200],default_value:100,suffix:"%"},on:{save:function(a){return t.$emit("update:scale",a/100)}}})],1),t.can_edit?e("div",{},[e("ToggleInput",{attrs:{content:t.display_as_public,label:t.$t("preview")},on:{"update:content":function(a){return t.$emit("update:display_as_public",a)}}})],1):t._e()]),t.can_edit&&!t.display_as_public?[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.has_editor_toolbar&&!t.active_module,expression:"!has_editor_toolbar && !active_module"}],staticClass:"_pageMenu--pane"},[e("div",{},[e("DLabel",{attrs:{str:t.$t("add_on_page")}}),e("ModuleCreator",{attrs:{publication_path:t.publication_path,pre_addtl_meta:t.new_module_meta,context:"page_by_page",start_collapsed:!1,enable_clipboard_paste:!0},on:{addModules:t.enableModuleEdit}})],1),t.can_edit&&!t.active_module?[e("div",{staticClass:"u-spacingBottom"}),e("div",{},[t.can_edit?e("ToggledSection",{staticClass:"u-spacingBottom",attrs:{label:t.$t("show_grid"),show_toggle:t.show_grid},on:{"update:show_toggle":function(a){return t.$emit("update:show_grid",a)}}},[e("RadioCheckboxInput",{attrs:{value:t.grid_z_index,options:[{label:t.$t("over"),key:"over"},{label:t.$t("under"),key:"under"}],can_edit:!0},on:{"update:value":function(a){return t.$emit("update:grid_z_index",a)}}}),e("div",{staticClass:"u-spacingBottom"}),e("RangeValueInput",{attrs:{label:t.$t("gridstep"),can_toggle:!1,value:t.gridstep_in_mm,min:1,max:20,step:1,ticks:[5,10,20,50],default_value:10,suffix:t.unit},on:{save:function(a){return t.$emit("update:gridstep_in_mm",a)}}}),e("div",{staticClass:"u-spacingBottom"}),e("ToggleInput",{staticClass:"u-spacingBottom",attrs:{content:t.snap_to_grid,label:t.$t("snap_to_grid")},on:{"update:content":function(a){return t.$emit("update:snap_to_grid",a)}}})],1):t._e()],1),e("div",{},[e("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("page_color"),value:t.page_color},on:{save:function(a){return t.$emit("updatePageOptions",{page_number:t.active_page_number,value:{page_color:a}})}}}),e("DLabel",{attrs:{str:t.$t("format,margins,pagination")}}),e("div",{},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(a){return t.$eventHub.$emit("publication.settings.toggle")}}},[e("b-icon",{attrs:{slot:"prefix",icon:"gear","aria-label":t.$t("settings")},slot:"prefix"}),t._v(" "+t._s(t.$t("settings"))+" ")],1)]),t.has_pagination?[e("div",{staticClass:"u-spacingBottom"}),e("ToggleInput",{attrs:{content:t.hide_pagination,label:t.$t("hide_pagination")},on:{"update:content":function(a){return t.$emit("updatePageOptions",{page_number:t.active_page_number,value:{hide_pagination:a}})}}})]:t._e()],2)]:t._e()],2),!t.has_editor_toolbar&&!t.active_module?e("div",{staticClass:"_pageMenu--pane"},[e("DetailsPane",{attrs:{header:t.$t("on_this_page"),icon:"images",has_items:t.page_modules.length,is_open_initially:!1,can_be_toggled:!0}},[e("div",{staticClass:"_mediaList"},t._l(t.page_modules,function(a){return e("div",{key:a.$path,staticClass:"u-sameRow",on:{click:function(n){return t.setActive(a.$path)}}},[t.getModuleType(a.module_type)==="shape"?[t._v(" "+t._s(t.$t(a.module_type))+" ")]:t.firstMedia(a)?e("MediaContent",{staticClass:"_preview",attrs:{file:t.firstMedia(a),resolution:50,context:"preview"}}):[t._v(" – ")]],2)}),0)])],1):t._e(),!t.has_editor_toolbar&&t.active_module?e("div",{key:"media-"+t.active_module.$path,staticClass:"_pageMenu--pane"},[e("DLabel",{attrs:{str:t.$t("media"),instructions:t.$t("active_media_instr")}}),t.active_module.module_type==="mosaic"&&t.active_module_first_media?e("MediaContent",{staticClass:"_activeModulePreview",attrs:{file:t.active_module_first_media,resolution:50,context:"preview"}}):t.active_module.module_type==="text"&&t.active_module_first_media?e("span",{staticClass:"u-textEllipsis u-textEllipsis_3 _textExtract"},[e("CollaborativeEditor2",{ref:"textBloc",attrs:{path:t.active_module_first_media.$path,content:t.active_module_first_media.$content,can_edit:!1}})],1):e("span",[t._v(" "+t._s(t.$t(t.active_module.module_type))+" ")]),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"u-mediaOptions"},[e("div",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(a){t.show_move_to_page_modal=!0}}},[e("b-icon",{attrs:{icon:"arrow-left-right"}}),t._v(" "+t._s(t.$t("move_to_page"))+" ")],1)]),t.show_move_to_page_modal?e("SelectPage",{attrs:{pages:t.pages,current_page_id:t.active_page.id},on:{submit:t.moveToAnotherPage,close:function(a){t.show_move_to_page_modal=!1}}}):t._e(),e("div",{},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.duplicateModule}},[e("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("duplicate"))+" ")],1)]),e("div",{},[t.active_module.locked===!0?e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(a){return t.updateMediaPubliMeta({locked:!1})}}},[e("b-icon",{attrs:{icon:"unlock"}}),t._v(" "+t._s(t.$t("unlock"))+" ")],1):e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(a){return t.updateMediaPubliMeta({locked:!0})}}},[e("b-icon",{attrs:{icon:"lock"}}),t._v(" "+t._s(t.$t("lock"))+" ")],1)]),e("div",{},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(a){return t.setActive(!1)}}},[e("b-icon",{attrs:{icon:"dash-square-dotted"}}),t._v(" "+t._s(t.$t("unselect"))+" ")],1)]),e("RemoveMenu",{ref:"removeMenu",attrs:{modal_title:t.$t("withdraw_from_page")},on:{remove:t.removeModule}})],1),e("div",{staticClass:"u-spacingBottom"}),t.show_caption?[e("TitleField",{attrs:{label:t.active_module.caption?t.$t("caption"):t.$t("add_caption"),field_name:"caption",input_type:"editor",custom_formats:["bold","italic","link"],content:t.active_module.caption,path:t.active_module.$path,maxlength:640,can_edit:t.can_edit}}),e("div",{staticClass:"u-spacingBottom"}),t.active_module_first_media&&t.active_module_first_media.caption&&!t.active_module.caption?e("div",{},[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("copy_first_media_caption"))+" ")]),e("button",{staticClass:"u-buttonLink _firstMediaCaption",attrs:{type:"button"},on:{click:function(a){return t.updateMediaPubliMeta({caption:t.active_module_first_media.caption})}}},[t._v(" "+t._s(t.active_module_first_media.caption)+" ")])]):t._e(),e("div",{staticClass:"u-spacingBottom"})]:t._e(),e("div",[e("DLabel",{attrs:{str:t.$t("on_click")}}),e("div",[t.active_module.on_click&&t.active_module.on_click.type==="url"&&t.active_module.on_click.url?[t._v(" "+t._s(t.$t("open_webpage"))+" "),e("br"),e("b",[t._v(t._s(t.active_module.on_click.url))])]:t.active_module.on_click&&t.active_module.on_click.type==="page"&&t.active_module.on_click.page_id?[t._v(" "+t._s(t.$t("navigate_to_page"))+" "),e("br"),e("b",[t._v(t._s(t.getPageNumberFromId(t.active_module.on_click.page_id)))])]:[t._v(" "+t._s(t.$t("do_nothing"))+" ")],e("EditBtn",{attrs:{label_position:"left"},on:{click:function(a){t.show_edit_link_modal=!0}}})],2),t.show_edit_link_modal?e("LinkToPageOrURL",{attrs:{path:t.active_module.$path,on_click:t.active_module.on_click,pages:t.pages,current_page_id:t.active_page.id},on:{save:t.updateMediaPubliMeta,close:function(a){t.show_edit_link_modal=!1}}}):t._e()],1),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"u-sameRow"},[e("NumberInput",{attrs:{label:t.$t("position")+" →",value:t.active_module.x,suffix:t.unit},on:{save:function(a){return t.updateMediaPubliMeta({x:a})}}}),e("NumberInput",{attrs:{label:t.$t("position")+" ↓",value:t.active_module.y,suffix:t.unit},on:{save:function(a){return t.updateMediaPubliMeta({y:a})}}})],1),e("div",{staticClass:"u-sameRow"},[e("NumberInput",{attrs:{label:t.$t("width")+" ↔",value:t.active_module.width,min:0,suffix:t.unit},on:{save:function(a){return t.updateMediaPubliMeta({width:a})}}}),e("NumberInput",{attrs:{label:t.$t("height")+" ↕",value:t.active_module.height,min:0,suffix:t.unit},on:{save:function(a){return t.updateMediaPubliMeta({height:a})}}})],1),e("div",{staticClass:"_setSizeBtn"},[t.first_media_ratio?e("button",{staticClass:"u-button_icon",attrs:{type:"button",title:t.$t("real_size")},on:{click:t.setRealSize}},[e("b-icon",{attrs:{icon:"slash-square-fill",rotate:"90","aria-label":t.$t("real_size")}})],1):t._e(),e("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(a){return t.setSize("full")}}},[e("b-icon",{attrs:{icon:"square-fill","aria-label":t.$t("full_page")}})],1),e("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(a){return t.setSize("half_left")}}},[e("b-icon",{attrs:{icon:"square-half"}})],1),e("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(a){return t.setSize("half_right")}}},[e("b-icon",{attrs:{icon:"square-half",rotate:"180"}})],1),e("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(a){return t.setSize("half_top")}}},[e("b-icon",{attrs:{icon:"square-half",rotate:"90"}})],1),e("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(a){return t.setSize("half_bottom")}}},[e("b-icon",{attrs:{icon:"square-half",rotate:"270"}})],1)]),e("div",{staticClass:"u-spacingBottom"}),e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("angle"),value:t.active_module.rotation,min:0,max:360,step:1,ticks:[0,90,180,270,360],default_value:0,suffix:"°"},on:{save:function(a){return t.updateMediaPubliMeta({rotation:a})}}}),e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("margins"),value:t.active_module.margins,min:0,max:50,step:1,default_value:0,suffix:t.unit},on:{save:function(a){return t.updateMediaPubliMeta({margins:a})}}}),t.active_module.module_type!=="ellipsis"?e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("border_radius"),value:t.active_module.border_radius,min:0,max:50,step:1,default_value:0,suffix:t.unit},on:{save:function(a){return t.updateMediaPubliMeta({border_radius:a})}}}):t._e(),e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("drop_shadow"),value:t.active_module.drop_shadow?t.active_module.drop_shadow*100:void 0,min:0,max:100,step:1,ticks:[0,25,50,75,100],default_value:0,suffix:"%"},on:{save:function(a){return t.updateMediaPubliMeta({drop_shadow:a/100})}}}),e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("opacity"),value:Math.round(t.active_module.opacity*100),min:1,max:100,step:1,ticks:[1,100],default_value:100,suffix:"%"},on:{save:function(a){return t.updateMediaPubliMeta({opacity:a/100})}}}),e("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("background_color"),value:t.active_module.background_color,allow_transparent:!0,default_value:t.is_shape?"transparent":""},on:{save:function(a){return t.updateMediaPubliMeta({background_color:a})}}}),e("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("outline_width"),value:t.active_module.outline_width,min:0,max:20,step:1,ticks:[0,10,20],default_value:0,suffix:t.unit},on:{save:function(a){return t.updateMediaPubliMeta({outline_width:a})}}}),t.active_module.outline_width>0?e("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:t.$t("outline_color"),value:t.active_module.outline_color,allow_transparent:!0,default_value:"#000000"},on:{save:function(a){return t.updateMediaPubliMeta({outline_color:a})}}}):t._e(),t.active_module_first_media&&t.active_module_first_media.$type==="image"?e("ToggleInput",{staticClass:"u-spacingBottom",attrs:{content:t.active_module.show_fs_button,label:t.$t("show_fs_button")},on:{"update:content":function(a){return t.updateMediaPubliMeta({show_fs_button:a})}}}):t._e(),e("DepthInput",{attrs:{label:t.$t("z_index"),value:t.active_module.z_index,page_modules:t.page_modules},on:{save:function(a){return t.updateMediaPubliMeta({z_index:a})}}})],2):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.has_editor_toolbar,expression:"has_editor_toolbar"}],key:"text-toolbar-"+t.active_page_number,staticClass:"_pageMenu--pane"},[e("div",{ref:"editor_toolbar",staticClass:"_editorToolbar"}),e("div",{ref:"editor_tooltip",staticClass:"_editorToolbar"})])]:t._e()],2)},W=[],G=_(U,Z,W,!1,null,"1cf21185");const J=G.exports,X={props:{scale:Number},components:{VueInfiniteViewer:m},data(){return{viewerOptions:{},scroll_left:void 0,scroll_top:void 0,debounce_zoom:void 0,debounce_scroll:void 0}},created(){this.viewerOptions={useMouseDrag:!0,useWheelScroll:!0,useAutoZoom:!0,zoomRange:[.4,10],maxPinchWheel:10,displayVerticalScroll:!0,displayHorizontalScroll:!0}},mounted(){this.$nextTick(()=>{this.scrollToCorner({animate:!1})}),this.$eventHub.$on("panzoom.panTo",this.panTo)},beforeDestroy(){this.$eventHub.$off("panzoom.panTo",this.panTo),this.$root.set_new_module_offset_left=0,this.$root.set_new_module_offset_top=0},watch:{scale(){this.updateScale(this.scale)}},computed:{panzoom_rangex(){const i=this.$root.window.innerWidth-100;return[-i,i]},panzoom_rangey(){const i=this.$root.window.innerHeight-100;return[-i,i]}},methods:{onScroll(){this.debounce_scroll&&clearTimeout(this.debounce_scroll),this.debounce_scroll=setTimeout(async()=>{this.$root.set_new_module_offset_left=Math.max(0,this.$refs.viewer.getScrollLeft()),this.$root.set_new_module_offset_top=Math.max(0,this.$refs.viewer.getScrollTop())},500)},dragStart(i){console.log("dragStart"),i.inputEvent.target.classList.contains("panzoom-exclude")&&i.stop()},dragEnd(i){console.log("dragEnd"),i.isDrag||this.disableActiveModule()},pinchStart(){console.log("pinchStart")},abortPinch(){console.log("abortPinch")},pinch(){this.debounce_zoom&&clearTimeout(this.debounce_zoom),this.debounce_zoom=setTimeout(async()=>{const i=this.$refs.viewer.getZoom();i!==this.scale&&this.$emit("update:scale",i)},500)},panTo({x:i,y:t}){this.scrollToCorner({x:i,y:t,animate:!0})},scrollToCorner({x:i,y:t,animate:e}){const a=e?{duration:200}:void 0,n=80;let s=(i||0)+-(0+n)/this.scale,o=(t||0)+-n/this.scale;this.$refs.viewer.scrollTo(s,o,a)},updateScale(i){i!==this.$refs.viewer.getZoom()&&this.$refs.viewer.setZoom(i,{duration:200,zoomBase:"viewport",zoomOffsetX:this.$root.zoom_offset,zoomOffsetY:this.$root.zoom_offset})},disableActiveModule(){this.$eventHub.$emit("module.setActive",!1)}}};var Y=function(){var t=this,e=t._self._c;return e("vue-infinite-viewer",t._b({ref:"viewer",staticClass:"viewer",on:{scroll:t.onScroll,dragStart:t.dragStart,dragEnd:t.dragEnd,pinchStart:t.pinchStart,abortPinch:t.abortPinch,pinch:t.pinch}},"vue-infinite-viewer",t.viewerOptions,!1),[e("div",{staticClass:"_pzViewport"},[t._t("default")],2)])},K=[],Q=_(X,Y,K,!1,null,"a986f5ca");const tt=Q.exports,et={props:{page_opened_id:String,publication_path:String,publication_title:String,pages:Array,spreads:[Boolean,Array],modules:Array,is_spread:Boolean,page_width:Number,page_height:Number,layout_mode:String,margins:Object,pagination:[Boolean,Object],can_edit:Boolean},components:{PageMenu:J,SinglePage:l,PanZoom2:tt},data(){return{scale:1,page_settings:{show_grid:!1,snap_to_grid:!1,grid_z_index:"under",gridstep_in_mm:10},display_as_public:!1,active_module_path:!1}},created(){this.$eventHub.$on("module.setActive",this.setActiveModule),document.addEventListener("keydown",this.keyPressed),this.loadSettings()},mounted(){},beforeDestroy(){this.$eventHub.$off("module.setActive",this.setActiveModule),document.removeEventListener("keydown",this.keyPressed)},watch:{page_opened_id(){this.$nextTick(()=>{})},page_settings:{handler(){this.saveSettings()},deep:!0}},computed:{active_module(){return this.active_module_path?this.modules.find(i=>i.$path===this.active_module_path):!1},active_module_first_media(){return this.firstMedia(this.active_module)},active_module_meta_filename(){return this.active_module.$path.substring(this.active_module.$path.lastIndexOf("/")+1)},active_page_number(){return this.pages.findIndex(i=>i.id===this.page_opened_id)},current_page(){return this.pages.find(i=>i.id===this.page_opened_id)},previous_page(){return this.pages[this.active_page_number-1]},next_page(){return this.pages[this.active_page_number+1]},active_spread(){return this.spreads[this.active_spread_index]},active_spread_index(){return this.is_spread&&this.spreads.findIndex(i=>i.find(t=>t&&t.id===this.page_opened_id))}},methods:{loadSettings(){const i=localStorage.getItem(`publication.page_settings.${this.publication_path}`);i&&(this.page_settings=JSON.parse(i))},saveSettings(){localStorage.setItem(`publication.page_settings.${this.publication_path}`,JSON.stringify(this.page_settings))},keyPressed(i){if(this.$root.modal_is_opened||i.target.tagName.toLowerCase()==="input"||i.target.tagName.toLowerCase()==="textarea"||i.target.className.includes("ql-editor")||i.target.hasAttribute("contenteditable"))return;let t="";(i.key==="Backspace"||i.key==="Delete")&&(t="remove",this.$eventHub.$emit("module.open_remove_modal")),t&&i.preventDefault()},setActiveModule(i){this.active_module_path=i},prevPage(){const i=this.active_page_number-1;this.setPageActive(this.pages[i].id)},nextPage(){const i=this.active_page_number+1;this.setPageActive(this.pages[i].id)},setPageActive(i){this.setActiveModule(!1),this.$emit("togglePage",i)},prevSpread(){const t=this.spreads[this.active_spread_index-1][1].id;this.setPageActive(t)},nextSpread(){const t=this.spreads[this.active_spread_index+1][0].id;this.setPageActive(t)}}};var at=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openedPage",class:{"is--editable":t.can_edit&&!t.display_as_public}},[e("div",{staticClass:"_spreadNavigator"},[e("div",{staticClass:"_spreadNavigator--content",on:{click:function(a){return a.target!==a.currentTarget?null:t.setActiveModule(!1)}}},[e("div",{staticClass:"_sideCont"},[e("div",{staticClass:"_content"},[e("PageMenu",{attrs:{can_edit:t.can_edit,pages:t.pages,active_page_number:t.active_page_number,active_spread_index:t.active_spread_index,page_width:t.page_width,page_height:t.page_height,scale:t.scale,show_grid:t.page_settings.show_grid,snap_to_grid:t.page_settings.snap_to_grid,grid_z_index:t.page_settings.grid_z_index,gridstep_in_mm:t.page_settings.gridstep_in_mm,layout_mode:t.layout_mode,page_color:t.current_page.page_color,pagination:t.pagination,publication_path:t.publication_path,page_opened_id:t.page_opened_id,page_modules:t.getModulesForPage({modules:t.modules,page_id:t.page_opened_id}),active_module:t.active_module,display_as_public:t.display_as_public},on:{"update:show_grid":function(a){return t.$set(t.page_settings,"show_grid",a)},"update:snap_to_grid":function(a){return t.$set(t.page_settings,"snap_to_grid",a)},"update:grid_z_index":function(a){return t.$set(t.page_settings,"grid_z_index",a)},"update:gridstep_in_mm":function(a){return t.$set(t.page_settings,"gridstep_in_mm",a)},"update:display_as_public":function(a){t.display_as_public=a},updatePageOptions:function(a){return t.$emit("updatePageOptions",a)},"update:scale":function(a){t.scale=a},prevPage:function(a){return t.prevPage()},nextPage:function(a){return t.nextPage()},close:function(a){return t.setPageActive(!1)}}})],1)]),e("div",{staticClass:"_pagePan"},[e("PanZoom2",{attrs:{scale:t.scale},on:{"update:scale":function(a){t.scale=a}}},[e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("div",{key:t.is_spread?"spread-"+JSON.stringify(t.active_spread.map(a=>a.id)):"page-"+t.page_opened_id,staticClass:"_pageCont",on:{click:function(a){return a.target!==a.currentTarget?null:t.setActiveModule(!1)}}},[t.is_spread?t._l(t.active_spread,function(a,n){return e("div",{key:a.id?a.id:n,staticClass:"_spreadNavigator--page",class:{"is--active":a.id===t.page_opened_id}},[a?[e("SinglePage",{attrs:{context:"full",page_modules:t.getModulesForPage({modules:t.modules,page_id:a.id}),page_width:t.page_width,page_height:t.page_height,layout_mode:t.layout_mode,page_color:a.page_color,scale:t.scale,show_grid:t.page_settings.show_grid,snap_to_grid:t.page_settings.snap_to_grid,grid_z_index:t.page_settings.grid_z_index,gridstep_in_mm:t.page_settings.gridstep_in_mm,margins:t.margins,page_number:t.active_spread_index*2+n,pagination:t.pagination,hide_pagination:t.current_page.hide_pagination===!0,active_module:t.active_module,page_is_left:n===0,can_edit:t.can_edit&&a.id===t.page_opened_id&&!t.display_as_public},on:{close:function(s){return t.setPageActive(!1)}}}),a.id!==t.page_opened_id?[e("button",{staticClass:"_openAdjacentPageBtn",attrs:{type:"button"},on:{mousedown:function(s){return s.target!==s.currentTarget?null:t.setPageActive(a.id)}}})]:t._e()]:e("div",{staticClass:"_noPage"})],2)}):e("SinglePage",{staticClass:"_spreadNavigator--page is--active",attrs:{context:"full",page_modules:t.getModulesForPage({modules:t.modules,page_id:t.page_opened_id}),page_width:t.page_width,page_height:t.page_height,layout_mode:t.layout_mode,page_color:t.current_page.page_color,scale:t.scale,show_grid:t.page_settings.show_grid,snap_to_grid:t.page_settings.snap_to_grid,grid_z_index:t.page_settings.grid_z_index,gridstep_in_mm:t.page_settings.gridstep_in_mm,margins:t.margins,page_number:t.active_page_number,pagination:t.pagination,hide_pagination:t.current_page.hide_pagination===!0,active_module:t.active_module,can_edit:t.can_edit&&!t.display_as_public},on:{close:function(a){return t.setPageActive(!1)}}})],2)])],1)],1)])])])},it=[],st=_(et,at,it,!1,null,"f4876e4e");const nt=st.exports,ot={props:{index:Number,number_of_pages:Number,can_edit:Boolean},components:{},data(){return{edit_mode:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_label"},[e("div",{staticClass:"u-sameRow u-label"},[t._v(" "+t._s(t.$t("page"))+" "),t.edit_mode?[e("select",{domProps:{value:t.index},on:{change:function(a){t.$emit("movePage",{old_position:t.index,new_position:+a.target.value}),t.edit_mode=!1}}},t._l(t.number_of_pages,function(a){return e("option",{key:a-1,domProps:{value:a-1,textContent:t._s(a)}})}),0)]:[t._v(" "+t._s(t.index+1)+" ")],t.can_edit?e("EditBtn",{on:{click:function(a){t.edit_mode=!t.edit_mode}}}):t._e()],2),t.edit_mode?e("div",{staticClass:"u-sameRow"},[e("div",{},[e("EditBtn",{attrs:{btn_type:"duplicate"},on:{click:function(a){t.$emit("duplicatePage"),t.edit_mode=!1}}})],1),t.can_edit?e("RemoveMenu",{attrs:{modal_title:t.$t("remove_page_and_content")},on:{remove:function(a){return t.$emit("removePage")}}},[e("template",{slot:"trigger"},[e("EditBtn",{attrs:{btn_type:"remove"}})],1)],2):t._e()],1):t._e()])},_t=[],lt=_(ot,rt,_t,!1,null,"04815a5b");const ut=lt.exports,dt={props:{publication:Object,page_opened_id:String,can_edit:Boolean},components:{SinglePage:l,OpenedPageOrSpread:nt,PageLabel:ut},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{is_creating_page:!1,previews_size:200}},created(){this.$eventHub.$on("publication.togglePage",this.togglePage)},mounted(){},beforeDestroy(){this.$eventHub.$off("publication.togglePage",this.togglePage)},watch:{},computed:{pages(){return this.publication.pages},modules(){return this.publication.$files||[]},is_spread(){return this.publication.page_spreads===!0},page_preview_zoom(){return this.calculateZoomToFit({width:this.publication.page_width,height:this.publication.page_height,desired_largest_dimension:this.previews_size,magnification:this.publication.layout_mode==="screen"?1:this.$root.page_magnification})},spreads(){return this.is_spread?this.makeSpread({pages:this.pages}):!1},margins(){return{left:this.publication.page_margin_left||0,right:this.publication.page_margin_right||0,top:this.publication.page_margin_top||0,bottom:this.publication.page_margin_bottom||0}},pagination(){return this.setPaginationFromPublication(this.publication)},meta_filenames_already_present(){const i=[],t=[];return this.pages.map(e=>{const a=e.id,n=a===this.page_opened_id;this.getModulesForPage({modules:this.modules,page_id:a}).map(o=>{o!=null&&o.source_medias&&Array.isArray(o.source_medias)&&o.source_medias.map(r=>{r.meta_filename_in_project&&(n?i.push(r.meta_filename_in_project):t.push(r.meta_filename_in_project))})})}),[{label:this.$t("on_this_page"),medias:i,color:"var(--c-orange)"},{label:this.$t("on_other_pages"),medias:t,color:"var(--c-bleuvert)"}]}},methods:{async createPage(i){this.is_creating_page=!0;const t=this.generatePageID();let e=this.publication.pages?this.publication.pages.slice():[];const a={id:t,page_color:"white"};typeof i!="number"?e.push(a):e.splice(i,0,a),await this.updatePubliMeta({pages:e}),await new Promise(n=>setTimeout(n,500)),this.is_creating_page=!1},removePage(i){let t=this.publication.pages.slice();t=t.filter(e=>e.id!==i),this.updatePubliMeta({pages:t})},async duplicatePage(i){let t=this.generatePageID();const e=this.publication.pages.reduce((s,o)=>{if(s.push(o),o.id===i){const r=JSON.parse(JSON.stringify(o));r.id=t,s.push(r)}return s},[]);await this.updatePubliMeta({pages:e});const a=this.getModulesForPage({modules:this.modules,page_id:i});if(a.length===0)return;const n={page_id:t};for(const s of a)await this.duplicateModuleWithSourceMedias({og_module:s,addtl_meta_to_module:n})},movePage({old_position:i,new_position:t}){let e=this.publication.pages.slice();function a(n,s,o){if(o>=n.length)for(var r=o-n.length+1;r--;)n.push(void 0);return n.splice(o,0,n.splice(s,1)[0]),n}a(e,i,t),this.updatePubliMeta({pages:e})},generatePageID(){return(Math.random().toString(36)+"00000000000000000").slice(2,8)},togglePage(i){this.$emit("togglePage",i)},async updatePageOptions({page_number:i,value:t}){let e=this.publication.pages.slice();Object.assign(e[i],t),this.updatePubliMeta({pages:e})},async updatePubliMeta(i){return await this.$api.updateMeta({path:this.publication.$path,new_meta:i})}}};var ct=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"slideup"}},[t.page_opened_id?e("OpenedPageOrSpread",{key:"openedpage",attrs:{page_opened_id:t.page_opened_id,publication_title:t.publication.title,publication_path:t.publication.$path,pages:t.pages,spreads:t.spreads,modules:t.modules,is_spread:t.is_spread,page_width:t.publication.page_width,page_height:t.publication.page_height,layout_mode:t.publication.layout_mode,margins:t.margins,pagination:t.pagination,can_edit:t.can_edit},on:{togglePage:function(a){return t.$emit("togglePage",a)},updatePageOptions:t.updatePageOptions}}):e("div",[e("div",{staticClass:"_setPreviewSize"},[e("h2",[t.is_spread?[t._v(t._s(t.$t("list_of_spreads")))]:[t._v(t._s(t.$t("list_of_pages")))]],2),e("div",{staticClass:"u-spacingBottom"}),e("RangeValueInput",{attrs:{label:t.$t("previews_size"),value:t.previews_size,can_toggle:!1,min:20,max:600,step:1,ticks:[20,50,100,200,400,600],default_value:200},on:{save:function(a){t.previews_size=a}}})],1),e("transition-group",{key:"allpages",staticClass:"_allPages",attrs:{tag:"div",name:"listComplete"}},[t.is_spread?[t._l(t.spreads,function(a,n){return[t._l(a,function(s,o){return[t.can_edit&&o===0?e("EditBtn",{key:"createPage-"+Math.max(0,n*2+o-1),staticClass:"_createPage",style:t.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;",attrs:{btn_type:"create_page"},on:{click:function(r){t.createPage(Math.max(0,n*2+o-1))}}}):t._e(),e("div",{key:s?s.id:o,attrs:{"data-pageposition":o===0?"left":"right"}},[s&&s.id?[e("div",{staticClass:"_preview"},[e("SinglePage",{attrs:{context:"preview",zoom:t.page_preview_zoom,page_modules:t.getModulesForPage({modules:t.modules,page_id:s.id}),page_width:t.publication.page_width,page_height:t.publication.page_height,layout_mode:t.publication.layout_mode,page_color:s.page_color,page_number:n*2+o,pagination:t.pagination,hide_pagination:s.hide_pagination===!0,page_is_left:o===0,can_edit:!1}}),e("button",{staticClass:"u-button _openPage",attrs:{type:"button"},domProps:{innerHTML:t._s(t.$t("open"))},on:{click:function(r){return t.$emit("togglePage",s.id)}}})],1),e("PageLabel",{attrs:{index:n*2+o-1,number_of_pages:t.pages.length,can_edit:t.can_edit},on:{movePage:function(r){return t.movePage({old_position:r.old_position,new_position:r.new_position})},duplicatePage:function(r){return t.duplicatePage(s.id)},removePage:function(r){return t.removePage(s.id)}}})]:t._e()],2)]})]})]:t._l(t.pages,function(a,n){return e("div",{key:"page-"+a.id,staticClass:"u-sameRow _singlePage"},[e("div",{staticClass:"_createPageBtn"},[t.can_edit?e("EditBtn",{key:"createPage"+n,style:t.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;",attrs:{btn_type:"create_page"},on:{click:function(s){return t.createPage(n)}}}):t._e()],1),e("div",{staticClass:"_page"},[e("div",{staticClass:"_preview"},[e("SinglePage",{attrs:{context:"preview",zoom:t.page_preview_zoom,page_modules:t.getModulesForPage({modules:t.modules,page_id:a.id}),page_width:t.publication.page_width,page_height:t.publication.page_height,layout_mode:t.publication.layout_mode,page_color:a.page_color,page_number:n,pagination:t.pagination,hide_pagination:a.hide_pagination===!0,can_edit:!1}}),e("button",{staticClass:"u-button _openPage",attrs:{type:"button"},domProps:{innerHTML:t._s(t.$t("open"))},on:{click:function(s){return t.$emit("togglePage",a.id)}}})],1),e("PageLabel",{staticClass:"_pageLabel",attrs:{index:n,number_of_pages:t.pages.length,can_edit:t.can_edit},on:{movePage:function(s){return t.movePage({old_position:s.old_position,new_position:s.new_position})},duplicatePage:function(s){return t.duplicatePage(a.id)},removePage:function(s){return t.removePage(a.id)}}})],1)])}),t.can_edit?e("span",{key:"createPage",style:t.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;"},[e("EditBtn",{attrs:{btn_type:"create_page",is_unfolded:!0},on:{click:t.createPage}})],1):t._e()],2)],1)],1)},pt=[],gt=_(dt,ct,pt,!1,null,"c7dfb16e");const mt=gt.exports,ht={props:{publication:Object,page_opened_id:String,can_edit:Boolean},components:{PublicationSettings:d,PageSettings:T,PagesList:mt},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var vt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_pageTemplate"},[e("PagesList",{attrs:{publication:t.publication,page_opened_id:t.page_opened_id,can_edit:t.can_edit},on:{togglePage:function(a){return t.$emit("togglePage",a)}}}),t.can_edit?e("PublicationSettings",[e("PageSettings",{attrs:{publication:t.publication}})],1):t._e()],1)},ft=[],bt=_(ht,vt,ft,!1,null,"b438b873");const Tt=bt.exports;export{Tt as default};
