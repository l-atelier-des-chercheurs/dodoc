import{n as c,L as d,I as u}from"../build.js";import{S as h,F as m}from"./StackDisplay-DW5elpAC.js";import{E as p}from"./EmbedPicker-CDumOL1-.js";import f from"./AdminLumaSettings-CLkPOEKM.js";import{K as g,a as v}from"./KeywordsField-BbeEipvy.js";import"./SingleKeyword-CwdZpRcD.js";const $={props:{index:Number,author_stacks_path:String,selected_items:Array,mode:String,stack:Object},components:{StackDisplay:h},data(){return{is_draggedOn:!1,show_mediastack_modal:!1,is_adding_to_stack:!1}},created(){},async mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{dragEnter(a){var e;((e=a.dataTransfer)==null?void 0:e.types[0])==="text/plain"&&(this.is_draggedOn=!0)},dragOver(a){a.preventDefault()},dragLeave(){this.is_draggedOn=!1},async drop(a){var t;if(this.$alertify.delay(4e3).success("dropped item"),a.preventDefault(),this.is_draggedOn=!1,this.selected_items.length>0)await this.addSelectedToStack();else{const e=(t=a.dataTransfer)==null?void 0:t.getData("text/plain");if(e){const s=[JSON.parse(e)];await this.createOrAppendToStack(s)}}},async addSelectedToStack(){const a=this.selected_items.map(t=>t.$path);await this.createOrAppendToStack(a)},async openOrAddToStack(){this.selected_items.length>0?await this.addSelectedToStack():this.openStack()},openStack(){this.stack&&(this.show_mediastack_modal=!0)},async createOrAppendToStack(a){var s,i;this.is_adding_to_stack=!0;let t;if((s=this.stack)!=null&&s.$path)t=(i=this.stack)==null?void 0:i.$path;else{let n={requested_slug:"stack",stack_spot:this.index,$authors:[this.connected_as.$path],$admins:[this.connected_as.$path]};const o=await this.$api.createFolder({path:this.author_stacks_path,additional_meta:n}).catch(r=>{throw this.$alertify.delay(4e3).error(r),r});t=this.author_stacks_path+"/"+o}await new Promise(n=>setTimeout(n,250));let e=[];this.stack&&this.stack.stack_files_metas&&Array.isArray(this.stack.stack_files_metas)&&(e=this.stack.stack_files_metas.slice());for(const n of a){const o=await this.$api.copyFile({path:n,path_to_destination_folder:t,new_meta:{}});await this.$api.deleteItem({path:n}),e.push(o);let r={stack_files_metas:e};e.length===1&&(r.$preview=o),await this.$api.updateMeta({path:t,new_meta:r})}await new Promise(n=>setTimeout(n,300)),this.is_adding_to_stack=!1}}};var k=function(){var t=this,e=t._self._c;return e("div",{},[e("div",{staticClass:"_documentSpot",class:{"is--draggedOn":t.is_draggedOn,"has--content":t.stack,"is--expectingDrag":t.mode==="add","is--expectingClick":t.selected_items&&t.selected_items.length>0},on:{dragenter:t.dragEnter,dragover:t.dragOver,dragleave:t.dragLeave,click:t.openOrAddToStack,drop:t.drop}},[e("div",{staticClass:"_topContent"},[t.stack?[t.stack.$preview?e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:t.stack.$preview}}):e("div",{staticClass:"_mediaPreview _noPreview"},[t._v(" "+t._s(t.$t("no_preview_to_show"))+" ")]),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.stack&&t.stack.stack_files_metas?e("div",{key:t.stack.stack_files_metas.length+"_"+t.mode,staticClass:"_count"},[t.mode==="add"?[t._v("+")]:t._e(),t._v(" "+t._s(t.stack.stack_files_metas.length)+" ")],2):t._e()])]:e("div",{staticClass:"_plus"},[t._v("+")]),e("transition",{attrs:{name:"slideupFade",mode:"out-in"}},[t.mode==="add"?e("div",{},[e("div",{key:t.mode,staticClass:"anim_backgroundPosition"})]):t._e()]),t.is_adding_to_stack?e("LoaderSpinner",{staticClass:"_loader"}):t._e()],2),t.stack&&t.stack.title?e("div",{staticClass:"_stackTitle"},[t._v(" "+t._s(t.stack.title)+" ")]):t._e()]),e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.show_mediastack_modal?e("StackDisplay",{staticClass:"_stackModal",attrs:{stack_path:t.stack.$path,context:"chutier"},on:{close:function(s){t.show_mediastack_modal=!1}}}):t._e()],1)],1)},b=[],C=c($,k,b,!1,null,"f827fdb2");const w=C.exports,y={props:{author_stacks_path:String,selected_items:Array},components:{DocumentSpot:w},data(){return{is_loading:!0,fetch_stack_err:void 0,all_stacks:[],is_expecting_drag:!1}},i18n:{messages:{fr:{}}},async created(){await this.listStacks(),this.$api.join({room:this.author_stacks_path}),this.is_loading=!1,this.$eventHub.$on("chutierItem.startDrag",this.startDragItem),this.$eventHub.$on("chutierItem.endDrag",this.endDragItem)},mounted(){},beforeDestroy(){this.$api.leave({room:this.author_stacks_path}),this.$eventHub.$off("chutierItem.startDrag",this.startDragItem),this.$eventHub.$off("chutierItem.endDrag",this.endDragItem)},watch:{},computed:{spot_mode(){var a;return this.is_expecting_drag||((a=this.selected_items)==null?void 0:a.length)>0?"add":"open"},sorted_stacks(){return this.all_stacks.slice().sort((a,t)=>+new Date(a.$date_created)-+new Date(t.$date_created))}},methods:{startDragItem(){this.is_expecting_drag=!0},endDragItem(){this.is_expecting_drag=!1},async listStacks(){const a=await this.$api.getFolders({path:this.author_stacks_path}).catch(t=>{this.fetch_stack_err=t.response,this.is_loading=!1});this.all_stacks=a}}};var S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_documentsCreator"},[e("transition-group",{attrs:{tag:"div",name:"projectsList"}},[t._l(t.sorted_stacks,function(s){return e("DocumentSpot",{key:s.$path,attrs:{selected_items:t.selected_items,author_stacks_path:t.author_stacks_path,mode:t.spot_mode,stack_path:s.$path,stack:s}})}),e("div",{key:"empty"},[e("transition",{attrs:{name:"slideupFade"}},[t.spot_mode==="add"?e("DocumentSpot",{attrs:{author_stacks_path:t.author_stacks_path,selected_items:t.selected_items,mode:"add"}}):t._e()],1)],1)],2)],1)},D=[],x=c(y,S,D,!1,null,"ed2716f5");const I=x.exports,T={props:{file:Object,is_selected:Boolean,is_clicked:Boolean,draggable:Boolean,context:{type:String,default:"list"}},components:{FileShown:m},data(){return{show_large:!1,is_mousedown:!1,is_dragged:!1,id:`select_chutier_item_${(Math.random().toString(36)+"00000000000000000").slice(2,5)}`,date_created_corrected:this.datetimeLocal(this.file.date_created_corrected||this.file.$date_created||this.file.$date_uploaded||new Date),description:this.file.description||"",keywords:this.file.keywords||[]}},created(){},mounted(){this.$eventHub.$on("chutierItem.editText",this.editText),this.$eventHub.$on("chutierItem.startDrag",this.itemDragged),this.$eventHub.$on("chutierItem.endDrag",this.itemStoppedDrag)},beforeDestroy(){this.$eventHub.$off("chutierItem.editText",this.editText),this.$eventHub.$off("chutierItem.startDrag",this.itemDragged),this.$eventHub.$off("chutierItem.endDrag",this.itemStoppedDrag)},watch:{},computed:{},methods:{cleanFilename(){return this.file.$media_filename.substring(0,this.file.$media_filename.lastIndexOf("."))},editText(a){this.getFilename(this.file.$path)===a&&(this.show_large=!0,this.$nextTick(()=>{}))},dragStart(a){this.is_dragged=!0,this.is_selected||this.$emit("toggleSelect"),this.$eventHub.$emit("chutierItem.startDrag"),a.dataTransfer.effectAllowed="move";var t=document.createElement("img");const e=this.makeURLFromThumbs({$thumbs:this.file.$thumbs,$type:this.file.$type,$path:this.getParent(this.file.$path),resolution:180});e&&(t.src=e,a.dataTransfer.setDragImage(t,0,0,50,50)),a.dataTransfer.setData("text/plain",JSON.stringify(this.file.$path))},dragEnd(){this.is_dragged=!1,this.$eventHub.$emit("chutierItem.endDrag")},itemDragged(){this.is_selected&&(this.is_dragged=!0)},itemStoppedDrag(){this.is_dragged=!1}}};var L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_chutierRow",class:{"can--toggleSelect":t.$listeners.toggleSelect,"is--clicked":t.is_clicked,"is--selected":t.is_selected,"is--dragged":t.is_dragged},attrs:{draggable:t.draggable},on:{dragstart:t.dragStart,dragend:t.dragEnd,click:function(s){return t.$emit("toggleSelect")}}},[e("div",{staticClass:"_chutierRow--rows"},[e("div",{staticClass:"_infos"},[e("div",{staticClass:"_chutierRow--openLarge",on:{click:function(s){s.stopPropagation(),t.show_large=!0}}},[e("MediaContent",{staticClass:"_chutierRow--preview",attrs:{file:t.file,context:"preview"}})],1),e("div",{staticClass:"_titleDateField"},[e("div",[e("div",{},[e("small",[t._v(" "+t._s(t.context==="stack"?t.formatDateTimeToPrecise(t.date_created_corrected):t.formatTime(t.date_created_corrected,{hour:"2-digit",minute:"2-digit"}))+" ")])]),e("div",{staticClass:"_infos2"},[t.file.caption?e("b-icon",{attrs:{icon:"text-left","aria-label":t.$t("caption")}}):t._e(),t.file.$credits?e("b-icon",{attrs:{icon:"info-circle","aria-label":t.$t("credit/reference")}}):t._e(),e("small",{staticClass:"_filename"},[t._v(t._s(t.file.$media_filename))])],1)])]),t.draggable?e("button",{staticClass:"u-button_icon _dragBtn",attrs:{type:"button"}},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9.01864 7.20446C9.25889 7.20446 9.48929 7.29963 9.65918 7.46904C9.82906 7.63845 9.9245 7.86822 9.9245 8.1078V10.3644C9.9245 10.5241 9.98812 10.6773 10.1014 10.7902C10.2146 10.9031 10.3682 10.9666 10.5284 10.9666C10.6886 10.9666 10.8422 10.9031 10.9554 10.7902C11.0687 10.6773 11.1323 10.5241 11.1323 10.3644V7.82812C11.1323 7.25029 11.8264 7.14482 12.3513 7.25029C12.5131 7.28281 12.641 7.33835 12.7849 7.46904C12.8532 7.53111 12.944 7.73743 12.944 7.93858V10.3644C12.944 10.5241 13.0077 10.6773 13.1209 10.7902C13.2342 10.9031 13.3878 10.9666 13.5479 10.9666C13.7081 10.9666 13.8617 10.9031 13.975 10.7902C14.0882 10.6773 14.1518 10.5241 14.1518 10.3644V8.47938C14.1945 8.4749 14.2372 8.47089 14.2799 8.46733C14.6615 8.43843 14.9852 8.45529 15.135 8.51551C15.2775 8.57092 15.4974 8.76484 15.722 9.03343C15.8198 9.14906 15.9032 9.26228 15.9636 9.34538V10.9666C15.9636 11.1263 16.0272 11.2795 16.1405 11.3924C16.2537 11.5054 16.4073 11.5688 16.5675 11.5688C16.7276 11.5688 16.8813 11.5054 16.9945 11.3924C17.1078 11.2795 17.1714 11.1263 17.1714 10.9666V9.76212H17.5845C17.7533 9.76212 17.9202 9.7974 18.0745 9.86569C18.2288 9.93398 18.367 10.0338 18.4802 10.1586C18.5934 10.2834 18.6792 10.4306 18.7319 10.5905C18.7846 10.7504 18.8031 10.9195 18.7862 11.087L18.4589 14.3571C18.4166 14.7774 18.2862 15.184 18.076 15.5507L16.3911 18.492C16.3383 18.5842 16.262 18.6608 16.17 18.7141C16.0779 18.7674 15.9734 18.7955 15.8669 18.7955H8.15505C8.05559 18.7955 7.95769 18.7709 7.87004 18.7241C7.78239 18.6772 7.70769 18.6095 7.6526 18.5269L5.9218 15.9374C5.7611 15.6972 5.66045 15.4221 5.6283 15.1352L5.2116 11.3954C5.19476 11.2455 5.23493 11.0948 5.32417 10.973C5.4134 10.8512 5.54521 10.7673 5.69352 10.7377L6.90496 10.4968V11.5688C6.90496 11.7285 6.96859 11.8817 7.08184 11.9946C7.19509 12.1076 7.3487 12.171 7.50887 12.171C7.66903 12.171 7.82264 12.1076 7.93589 11.9946C8.04915 11.8817 8.11277 11.7285 8.11277 11.5688V8.1078C8.11277 7.86822 8.20821 7.63845 8.3781 7.46904C8.54798 7.29963 8.77839 7.20446 9.01864 7.20446ZM10.5284 6.75C10.132 6.35471 9.57922 6 9.01864 6C8.45805 6 7.92043 6.22207 7.52404 6.61736C7.12765 7.01265 6.90496 7.54878 6.90496 8.1078V9.2683L5.45558 9.55737C5.01132 9.64619 4.61656 9.89779 4.34915 10.2626C4.08175 10.6273 3.96111 11.0788 4.01103 11.5279L4.42773 15.2689C4.48132 15.7471 4.64906 16.2056 4.9169 16.6058L6.6477 19.1954C6.81312 19.4429 7.03726 19.6458 7.30021 19.7862C7.56317 19.9265 7.8568 20 8.15505 20H15.8669C16.1863 19.9999 16.4999 19.9156 16.7761 19.7557C17.0523 19.5958 17.2811 19.366 17.4395 19.0894L19.1244 16.1494C19.419 15.6354 19.6017 15.0654 19.6607 14.4764L19.988 11.2063C20.0216 10.8714 19.9844 10.5332 19.8789 10.2135C19.7734 9.89385 19.6019 9.59976 19.3755 9.35022C19.149 9.10068 18.8726 8.90123 18.5642 8.76472C18.2557 8.62821 17.9219 8.55768 17.5845 8.55767H16.8827C16.8073 8.45571 16.7288 8.35609 16.6472 8.25896C16.4165 7.98314 16.0312 7.57483 15.5843 7.39657C15.1447 7.22072 14.5625 7.23758 14.1857 7.26649L14.0262 7.28095C13.7453 6.56393 13.1227 6 12.0662 6C10.8923 6 10.5284 6.75 10.5284 6.75Z",fill:"#77758E"}})])]):t._e(),t.$listeners.toggleSelect?e("input",{directives:[{name:"model",rawName:"v-model",value:t.is_selected,expression:"is_selected"}],staticClass:"_checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.is_selected)?t._i(t.is_selected,null)>-1:t.is_selected},on:{change:function(s){var i=t.is_selected,n=s.target,o=!!n.checked;if(Array.isArray(i)){var r=null,l=t._i(i,r);n.checked?l<0&&(t.is_selected=i.concat([r])):l>-1&&(t.is_selected=i.slice(0,l).concat(i.slice(l+1)))}else t.is_selected=o}}}):t._e()])]),t.show_large?[e("portal",{attrs:{to:"largemedia"}},[e("div",{staticClass:"_largePreview"},[e("div",{staticClass:"_closeLarge"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",on:{click:function(s){t.show_large=!1}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("FileShown",{key:t.file.$path,staticClass:"_fileLarge",attrs:{context:"chutier",file:t.file,can_edit:!0}})],1)])]:t._e(),(t.is_selected,t._e())],2)},H=[],F=c(T,L,H,!1,null,"5f4ba5cc");const _=F.exports,M={props:{selected_items:Array},components:{KeywordsFieldEditor:v,KeywordsField:g,ChutierItem:_},i18n:{messages:{fr:{destination_corpus:"Corpus de destination",create_document:"Nouveau document"},en:{destination_corpus:"Destination corpus",create_document:"New document"}}},data(){return{current_step:0,steps:[{label:this.$t("title")},{label:this.$t("keywords")},{label:this.$t("team")},{label:this.$t("review")}],stack_title:"",stack_description:"",stack_tags:[],stack_authors:[],status:"idle",destination_folders:[],selected_destination_folder_path:null}},created(){this.connected_as.$path&&this.stack_authors.push(this.connected_as.$path)},async mounted(){await this.listDestinationFolders()},beforeDestroy(){},watch:{},computed:{modal_name(){return this.$t("create_document")+" ("+(this.current_step+1)+"/"+this.steps.length+")"}},methods:{backStep(){this.current_step>0?this.current_step--:this.$emit("close")},async listDestinationFolders(){const a=await this.$api.getFolders({path:"folders"}).catch(t=>{this.fetch_spaces_error=t.response});a.length>0?(this.destination_folders=a,this.selected_destination_folder_path=a[0].$path):this.destination_folders=[]},nextStep(){this.current_step++},async publishMediastack(){this.status="publishing";const a=this.selected_destination_folder_path+"/stacks";let t={$status:"public",requested_slug:"stack",$admins:this.stack_authors};const e=await this.$api.createFolder({path:a,additional_meta:t}),s=a+"/"+e;let i=[];for(const o of this.selected_items){const r=await this.$api.copyFile({path:o.$path,path_to_destination_folder:s,new_meta:{}});i.push(r),await this.$api.deleteItem({path:o.$path})}let n={stack_files_metas:i};i.length>=1&&(n.$preview=i[0]),await this.$api.updateMeta({path:s,new_meta:n}),await new Promise(o=>setTimeout(o,250)),this.status="completed"}}};var B=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{size:"",title:t.modal_name},on:{close:function(s){return t.$emit("close")}},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div",[t.status==="idle"?e("button",{staticClass:"u-button u-button_white",on:{click:t.backStep}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1):t._e()]),t.current_step<t.steps.length-1?e("button",{staticClass:"u-button u-button_primary u-button_pill",on:{click:t.nextStep}},[t._v(" "+t._s(t.$t("next"))+" "),e("b-icon",{attrs:{icon:"arrow-right"}})],1):t.current_step===t.steps.length-1&&t.status==="idle"?e("button",{staticClass:"u-button u-button_primary",attrs:{disabled:!t.selected_destination_folder_path},on:{click:t.publishMediastack}},[t._v(" "+t._s(t.$t("publish"))+" ")]):t.status==="publishing"?e("span",[t._v(" "+t._s(t.$t("publishing"))+" ")]):t.status==="completed"?e("span",[t._v(" "+t._s(t.$t("completed"))+" ")]):t._e()]},proxy:!0}])},[e("div",{staticClass:"_createNewMediastackModal"},[e("portal-target",{attrs:{name:"largemedia",multiple:""}}),e("div",{staticClass:"_content"},[e("div",{staticClass:"_breadcrumb"},t._l(t.steps,function(s,i){return e("button",{key:s.label,staticClass:"step",class:t.current_step===i?"active":t.current_step>i?"completed":"",attrs:{type:"button"},on:{click:function(n){t.current_step=i}}},[i>0?e("div",{staticClass:"step-line"}):t._e(),e("div",{staticClass:"step-circle"},[t.current_step>=i?e("div",{staticClass:"step-label"},[t._v(" "+t._s(s.label)+" ")]):t._e()])])}),0),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{key:t.current_step,staticClass:"_form"},[t._e(),e("div",{staticClass:"u-spacingBottom _form-review-items"},t._l(t.selected_items,function(s){return e("ChutierItem",{key:s.$path,attrs:{file:s,is_selected:!0}})}),1),t.current_step===0?[e("div",{staticClass:"_form-title"},[e("div",{staticClass:"u-spacingBottom"},[e("h1",[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{attrs:{content:t.stack_title,required:!0,autofocus:!0,can_edit:!0},on:{"update:content":function(s){t.stack_title=s},onEnter:t.nextStep}})],1)]),e("div",{staticClass:"u-spacingBottom _description"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("TextInput",{attrs:{content:t.stack_description,input_type:"editor",can_edit:!0},on:{"update:content":function(s){t.stack_description=s},onEnter:t.nextStep}})],1)])]:t._e(),t.current_step===1?[e("div",{staticClass:"u-spacingBottom _form-tags"},[e("KeywordsFieldEditor",{attrs:{keywords:t.stack_tags},on:{"update:keywords":function(s){t.stack_tags=s}}})],1)]:t._e(),t.current_step===2?[e("div",{staticClass:"u-spacingBottom _form-team"},[e("AuthorField",{attrs:{label:t.$t("admins"),field:"$admins",instructions:t.$t("media_editing_instructions"),authors_paths:t.stack_authors,can_edit:!0},on:{save:s=>{t.stack_authors=s}}})],1)]:t._e(),t.current_step===3?[e("div",{staticClass:"_form-review"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title")}}),e("h2",[t._v(" "+t._s(t.stack_title||t.$t("none"))+" ")])],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("div",{domProps:{innerHTML:t._s(t.stack_description||t.$t("none_f"))}})],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("keywords")}}),t.stack_tags.length>0?e("div",[e("KeywordsField",{attrs:{keywords:t.stack_tags,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("destination_corpus")}}),e("div",[e("select",{directives:[{name:"model",rawName:"v-model",value:t.selected_destination_folder_path,expression:"selected_destination_folder_path"}],on:{change:function(s){var i=Array.prototype.filter.call(s.target.options,function(n){return n.selected}).map(function(n){var o="_value"in n?n._value:n.value;return o});t.selected_destination_folder_path=s.target.multiple?i:i[0]}}},t._l(t.destination_folders,function(s){return e("option",{key:s.$path,domProps:{value:s.$path}},[t._v(" "+t._s(s.title||t.getFilename(s.$path))+" ")])}),0)])],1)])]:t._e()],2)])],1)],1)])},A=[],V=c(M,B,A,!1,null,"15def168");const Z=V.exports,q={props:{shared_folder_path:String},components:{ImportFileZone:u,DocumentsCreator:I,EmbedPicker:p,ChutierItem:_,AdminLumaSettings:f,LangModal:d,CreateNewMediastackModal:Z},provide(){return{$sharedFolderPath:()=>this.shared_folder_path}},i18n:{messages:{fr:{imported_docs:"Les médias importés apparaissent ici. Seul vous pouvez les voir et les modifier. Sélectionnez-en un ou plusieurs pour créer un document partagé.",add_to_existing_document:"Ajouter à un document existant",create_new_document:"Créer un nouveau document"},en:{imported_docs:"Imported medias will appear here. Only you can see and edit them. Select one or more to create a shared document.",add_to_existing_document:"Add to existing document",create_new_document:"Create a new document"}}},data(){return{chutier:void 0,show_admin_settings:!1,is_dragover:!1,files_to_import:[],id:`image_select_${(Math.random().toString(36)+"00000000000000000").slice(2,5)}`,last_clicked:void 0,selected_items_slugs:[],show_mediastack_modal:!1,max_items_selected:15,show_link_picker:!1,show_qr_code_modal:!1,show_lang_modal:!1,show_confirm_remove_menu:!1,show_existing_mediastack_modal:!1,show_new_mediastack_modal:!1}},created(){},mounted(){this.listChutier()},beforeDestroy(){},watch:{selected_items_slugs(){this.show_confirm_remove_menu&&(this.show_confirm_remove_menu=!1),this.selected_items_slugs.length>this.max_items_selected&&(this.selected_items_slugs=this.selected_items_slugs.slice(0,this.max_items_selected),this.$alertify.delay(4e3).error(this.$t("too_many_items_selected")),setTimeout(()=>{this.$alertify.delay(4e3).error(this.$t("max_items_is")+" "+this.max_items_selected)},500))},chutier_items(){const a=this.selected_items_slugs.filter(t=>this.chutier_items.some(e=>e.$path===t));JSON.stringify(this.selected_items_slugs)!==JSON.stringify(a)&&(this.selected_items_slugs=a)}},computed:{author_path(){return this.connected_as.$path},author_stacks_path(){return this.author_path+"/stacks"},current_lang_code(){return this.$i18n.availableLocales,this.$i18n.locale},url_to_page(){return this.$route.path,window.location.href},selected_items(){return this.selected_items_slugs.map(a=>this.chutier_items.find(t=>t.$path===a)||!1)},all_items_selected(){return this.selected_items.length===this.chutier_items.length},chutier_items(){if(!this.chutier||!this.chutier.$files)return[];let a=JSON.parse(JSON.stringify(this.chutier.$files));return a=a.filter(t=>t.is_stack!==!0&&t.$media_filename).sort((t,e)=>{const s=i=>new Date(i.date_created_corrected||i.$date_created||i.$date_uploaded);return+s(e)-+s(t)}),a},chutier_items_grouped(){return this.groupFilesBy(this.chutier_items,["date_created_corrected","$date_created","$date_uploaded"],"day")}},methods:{async listChutier(){this.chutier=await this.$api.getFolder({path:this.author_path}).catch(a=>{this.fetch_project_error=a.response,this.is_loading=!1})},toggleSelect(a){this.selected_items_slugs.includes(a)?this.selected_items_slugs=this.selected_items_slugs.filter(t=>t!==a):this.selected_items_slugs.push(a)},async createNote(){const t="note-"+ +new Date+".txt",e=await this.$api.uploadText({path:this.author_path,filename:t,content:"",additional_meta:{title:"Sans titre"}});setTimeout(()=>{this.$eventHub.$emit("chutierItem.editText",e)},100)},async createEmbed(a){const e="url-"+ +new Date+".txt",s=await this.$api.uploadText({path:this.author_path,filename:e,content:a,additional_meta:{title:"Titre du lien",$type:"url"}});this.show_link_picker=!1,setTimeout(()=>{this.$eventHub.$emit("chutierItem.editText",s)},100)},async mediaJustImported(a){},onDragover(a){a.preventDefault()},onDragEnter(a){a.preventDefault(),this.is_dragover=!0},onDragLeave(a){a.preventDefault(),this.is_dragover=!1},onDrop(a){var t;this.is_dragover=!1,((t=a.dataTransfer.files)==null?void 0:t.length)>0&&(this.files_to_import=Array.from(a.dataTransfer.files))},selectAll(){this.selected_items_slugs=this.chutier_items.map(a=>a.$path)},deselectAll(){this.selected_items_slugs=[]},selectRange(a){this.selected_items_slugs=this.selected_items_slugs.concat(a),this.selected_items_slugs=[...new Set(this.selected_items_slugs)]},deselectRange(a){this.selected_items_slugs=this.selected_items_slugs.filter(t=>!a.includes(t))},rangeIsSelected(a){return this.selected_items_slugs.length===0?!1:!a.find(t=>this.selected_items_slugs.includes(t)===!1)},async removeItemsInSelection(){for(const a of this.selected_items_slugs)await this.$api.deleteItem({path:a});this.show_confirm_remove_menu=!1}}};var O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_myChutier",on:{click:function(s){t.last_clicked=!1}}},[e("portal-target",{attrs:{name:"largemedia",multiple:""}}),e("div",{staticClass:"_importFiles",on:{click:function(s){if(s.target!==s.currentTarget)return null;t.selected_items_slugs=[]}}},[e("div",{staticClass:"_importFiles--content"},[e("div",{staticClass:"_topRow"},[t.connected_as?e("AuthorTag",{attrs:{path:t.connected_as.$path,show_image_only:!0},on:{click:function(s){return t.$eventHub.$emit("showAuthorModal")}}}):e("button",{staticClass:"_authorBtn",attrs:{type:"button"},on:{click:function(s){return t.$eventHub.$emit("showAuthorModal")}}},[t._v(" "+t._s(t.$t("login"))+" ")]),e("div",{staticClass:"_separator"}),e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(s){t.show_qr_code_modal=!0}}},[e("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[e("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[e("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),e("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),e("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),e("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),e("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])])]),t.show_qr_code_modal?e("QRModal",{attrs:{url_to_access:t.url_to_page},on:{close:function(s){t.show_qr_code_modal=!1}}}):t._e(),e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(s){return t.$eventHub.$emit("app.show_welcome_modal")}}},[e("b-icon",{attrs:{icon:"question-square"}})],1),e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(s){t.show_lang_modal=!t.show_lang_modal}}},[t._v(" "+t._s(t.current_lang_code)+" ")]),t.show_lang_modal?e("LangModal",{on:{close:function(s){t.show_lang_modal=!1}}}):t._e(),t.is_instance_admin?e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(s){t.show_admin_settings=!t.show_admin_settings}}},[e("b-icon",{attrs:{icon:"gear","aria-label":t.$t("admin_settings")}})],1):t._e(),t.show_admin_settings?e("AdminLumaSettings",{on:{close:function(s){t.show_admin_settings=!1}}}):t._e()],1),t.connected_as?[e("div",{staticClass:"_importButton"},[e("ImportFileZone",{attrs:{multiple:!0,files_to_import:t.files_to_import},on:{"update:files_to_import":function(s){t.files_to_import=s}}}),t.files_to_import.length>0?e("UploadFiles",{attrs:{files_to_import:t.files_to_import,path:t.author_path,allow_caption_edition:!0},on:{importedMedias:function(s){return t.mediaJustImported(s)},close:function(s){t.files_to_import=[]}}}):t._e(),e("div",{staticClass:"_importBtns"},[e("button",{staticClass:"u-button u-button_outline _qrBtn",attrs:{type:"button"},on:{click:t.createNote}},[e("b-icon",{attrs:{icon:"file-text"}}),t._v("   note ")],1),e("button",{staticClass:"u-button u-button_outline _qrBtn",attrs:{type:"button"},on:{click:function(s){t.show_link_picker=!0}}},[e("b-icon",{attrs:{icon:"link-45deg"}}),t._v("   url ")],1),t.show_link_picker?e("EmbedPicker",{on:{embed:t.createEmbed,close:function(s){t.show_link_picker=!1}}}):t._e()],1)],1)]:t._e()],2)]),e("div",{staticClass:"_filesList"},[e("div",{staticClass:"_middleContent"},[e("div",{staticClass:"u-instructions u-spacingBottom"},[e("b-icon",{attrs:{icon:"info-circle"}}),t._v(" "+t._s(t.$t("imported_docs"))+" ")],1),t.chutier_items&&t.chutier_items.length>0?[e("label",{staticClass:"_item--label",class:{"is--fullySelected":t.all_items_selected},attrs:{for:""},on:{click:function(s){t.all_items_selected?t.deselectAll():t.selectAll()}}},[t.chutier_items.length>0?e("button",{staticClass:"u-buttonLink u-selectBtn",attrs:{type:"button"}},[e("b-icon",{attrs:{icon:t.all_items_selected?"dash-square-dotted":"plus-square-dotted"}})],1):t._e(),t._v(" "+t._s(t.$t("items_to_share"))+" • "+t._s(t.chutier_items.length)+" ")])]:t._e(),e("div",{staticClass:"_items",on:{click:function(s){if(s.target!==s.currentTarget)return null;t.selected_items_slugs=[]}}},t._l(t.chutier_items_grouped,function(s){return e("div",{key:s.label,staticClass:"_item",on:{click:function(i){if(i.target!==i.currentTarget)return null;t.selected_items_slugs=[]}}},[e("div",{staticClass:"_item--label",class:{"is--fullySelected":t.rangeIsSelected(s.files.map(i=>i.$path))},on:{click:function(i){t.rangeIsSelected(s.files.map(n=>n.$path))?t.deselectRange(s.files.map(n=>n.$path)):t.selectRange(s.files.map(n=>n.$path))}}},[t.rangeIsSelected(s.files.map(i=>i.$path))?e("button",{staticClass:"u-buttonLink u-selectBtn",attrs:{type:"button"}},[e("b-icon",{attrs:{icon:"dash-square-dotted"}})],1):e("button",{staticClass:"u-buttonLink u-selectBtn",attrs:{type:"button"}},[e("b-icon",{attrs:{icon:"plus-square-dotted"}})],1),t._v(" "+t._s(s.label)+" ")]),e("transition-group",{staticClass:"_items--list",attrs:{tag:"div",name:"listComplete"}},t._l(s.files,function(i){return e("ChutierItem",{key:i.$path,attrs:{file:i,is_clicked:t.last_clicked===i.$path,is_selected:t.selected_items_slugs.includes(i.$path),draggable:!1},on:{toggleSelect:function(n){return t.toggleSelect(i.$path)},unclicked:function(n){t.last_clicked=!1},click:function(n){n.stopPropagation(),t.last_clicked=i.$path}}})}),1)],1)}),0)],2),e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.selected_items.length>0?e("div",{key:"selection",staticClass:"_selectionBar"},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{key:t.selected_items.length},[t.selected_items.length===1?[t._v(" "+t._s(t.$t("selected_item"))+" ")]:[t._v(" "+t._s(t.$t("selected_items"))+" ")],t._v(" "+t._s(t.selected_items.length)+" ")],2)]),e("div",{staticClass:"u-sameRow _dbleBtns"},[e("button",{staticClass:"u-button",attrs:{type:"button",disabled:""},on:{click:function(s){t.show_existing_mediastack_modal=!0}}},[e("b-icon",{attrs:{icon:"plus-square-dotted"}}),t._v(" "+t._s(t.$t("add_to_existing_document"))+" ")],1),e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(s){t.show_new_mediastack_modal=!0}}},[e("b-icon",{attrs:{icon:"plus-square-dotted"}}),t._v(" "+t._s(t.$t("create_new_document"))+" ")],1)]),e("div",{staticClass:"u-sameRow _selectionBar-btns"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.deselectAll}},[e("b-icon",{attrs:{icon:"dash-square-dotted"}}),t._v(" "+t._s(t.$t("deselect_all"))+" ")],1),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){t.show_confirm_remove_menu=!0}}},[e("b-icon",{attrs:{icon:"trash"}}),t._v(" "+t._s(t.$t("remove_select"))+" ")],1)])],1):t._e()]),e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.show_confirm_remove_menu?e("div",{key:"remove",staticClass:"_removeMenu"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){t.show_confirm_remove_menu=!1}}},[t._v(" "+t._s(t.$t("cancel"))+" ")]),e("button",{staticClass:"u-button u-button_red",attrs:{type:"button",autofocus:""},on:{click:t.removeItemsInSelection}},[t._v(" "+t._s(t.$t("confirm_removal"))+" ")])]):t._e()])],1),t.show_new_mediastack_modal?e("CreateNewMediastackModal",{attrs:{selected_items:t.selected_items,shared_folder_path:t.shared_folder_path},on:{close:function(s){t.show_new_mediastack_modal=!1}}}):t._e()],1)},P=[],R=c(q,O,P,!1,null,"6b17dece");const U=R.exports;export{U as default};
