import{S as o}from"./SingleKeyword-BLR2qpR_.js";import{n}from"../build.js";const a={props:{keywords:Array},components:{SingleKeyword:o},data(){return{user_suggestion:"",suggestion_from_category:!1,categories:[],path:"categories"}},i18n:{messages:{fr:{validate_with_shift_enter:"Validez la première suggestion avec SHIFT+ENTRÉE, ou créez un nouveau mot-clé avec ENTRÉE.",create_new_keyword_enter:"Créez un nouveau mot-clé avec ENTRÉE."},en:{validate_with_shift_enter:"Add first suggestion with SHIFT+ENTER, or create a new keyword with ENTER.",create_new_keyword_enter:"Create a new keyword with ENTER."}}},async created(){this.categories=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},async mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{all_categories(){return this.categories.map(s=>s.title)},all_keywords(){return this.categories.reduce((s,e)=>(e.title&&e.list_of_suggestions&&e.list_of_suggestions.map(r=>{s.push(e.title+"/"+r)}),s),[])},categories_with_keywords(){return this.all_categories.filter(s=>this.matchingKeywordsWithCategory(s).length>0)},suggested_keywords(){return this.matchingKeywordsWithCategory(this.suggestion_from_category)}},methods:{matchingKeywordsWithCategory(s){return this.all_keywords.filter(e=>{const r=e.includes("/")?e.split("/").at(0):!1,t=e.includes("/")?e.split("/").at(1):e;return this.keywords.includes(e)||s&&s!==r||!s&&this.user_suggestion.length===0?!1:this.twoStringsMatch(t,this.user_suggestion)})},toggleCategory(s){this.suggestion_from_category===s?this.suggestion_from_category=!1:this.suggestion_from_category=s},getCatColor(s){const e=window.app_infos.custom_suggested_categories.find(r=>r.title===s);if(e!=null&&e.tag_color)return`--cat-color: ${e.tag_color}`},newKeyword(){this.user_suggestion.length>0&&this.addKeyword(this.user_suggestion)},submitFirstSuggestion(){if(this.suggested_keywords.length===0)return!1;const s=this.suggested_keywords.at(0);this.addKeyword(s)},keywordKey(s){return s.category+"/"+s.name},addKeyword(s){let e=this.keywords.slice();e.push(s),e.sort((r,t)=>t),this.$emit("update:keywords",e),this.user_suggestion="",this.$refs.keywordField.focus()}}};var d=function(){var e=this,r=e._self._c;return r("div",{staticClass:"_keywordsFieldEditor"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.user_suggestion,expression:"user_suggestion"}],ref:"keywordField",attrs:{type:"text",required:"",placeholder:e.$t("keyword_materials_etc")},domProps:{value:e.user_suggestion},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:(t.preventDefault(),e.$emit("cancelEdit"))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.newKeyword.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||!t.shiftKey||t.ctrlKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.submitFirstSuggestion.apply(null,arguments))}],input:function(t){t.target.composing||(e.user_suggestion=t.target.value)}}}),r("div",{staticClass:"u-instructions"},[r("small",[e.suggested_keywords.length>0?[e._v(" "+e._s(e.$t("validate_with_shift_enter"))+" ")]:e.user_suggestion.length>0?[e._v(e._s(e.$t("create_new_keyword_enter")))]:e._e()],2)]),r("div",{staticClass:"_catSug"},[e.suggestion_from_category?r("div",[r("button",{staticClass:"u-button _category",style:e.getCatColor(e.suggestion_from_category),attrs:{type:"button"},on:{click:function(t){return e.toggleCategory(e.suggestion_from_category)}}},[e._v(" "+e._s(e.suggestion_from_category)+" ("+e._s(e.matchingKeywordsWithCategory(e.suggestion_from_category).length)+")   "),r("b-icon",{attrs:{icon:"x-circle"}})],1)]):r("div",{staticClass:"_categories"},e._l(e.categories_with_keywords,function(t){return r("button",{key:t,staticClass:"u-button _category",style:e.getCatColor(t),attrs:{type:"button"},on:{click:function(i){return e.toggleCategory(t)}}},[e._v(" "+e._s(t)+" ("+e._s(e.matchingKeywordsWithCategory(t).length)+") ")])}),0),e.suggested_keywords.length>0?r("div",{staticClass:"_suggestions"},[r("div",{staticClass:"u-keywords"},e._l(e.suggested_keywords,function(t,i){return r("SingleKeyword",{key:t,class:{"is--first":i===0},attrs:{keyword:t,can_add:!0},on:{add:function(h){return e.addKeyword(t)}}})}),1)]):e._e()])])},l=[],u=n(a,d,l,!1,null,"b4960b50");const _=u.exports,c={props:{field_name:String,label:String,path:String,keywords:{type:Array,default:()=>[]},can_edit:Boolean},components:{KeywordsFieldEditor:_,SingleKeyword:o},data(){return{new_keywords:this.keywords||[],new_keywords_stringified:"",edit_mode:this.can_edit&&!this.path&&!this.field_name,is_saving:!1,is_copied:!1}},created(){},mounted(){},beforeDestroy(){},watch:{new_keywords:{immediate:!0,handler(s){this.$emit("update:keywords",s),this.new_keywords_stringified=s.join(", ")},deep:!0},new_keywords_stringified:{immediate:!0,handler(s){s?this.new_keywords=s.split(", ").map(e=>e.trim()):this.new_keywords=[]}}},computed:{},methods:{enableEditMode(){this.edit_mode=!0},async updateKeywords(){this.is_saving=!0,await new Promise(s=>setTimeout(s,50));try{const s={[this.field_name]:this.new_keywords};await this.$api.updateMeta({path:this.path,new_meta:s}),this.edit_mode=!1,this.is_saving=!1}catch{this.is_saving=!1}},copyToClipboard(){this.is_copied=!1;var s=this.$refs.urlToCopy;s.select(),s.setSelectionRange(0,99999),navigator.clipboard.writeText(s.value),this.is_copied=!0},cancel(){this.new_keywords=this.keywords||[],this.edit_mode=!1},removeKeyword(s){this.new_keywords=this.new_keywords.filter(e=>e!==s)}}};var g=function(){var e=this,r=e._self._c;return r("div",{staticClass:"_keywordsField"},[e.label?r("DLabel",{staticClass:"_label",attrs:{str:e.label}}):e._e(),e.keywords.length>0?r("div",{staticClass:"u-keywords"},e._l(e.keywords,function(t){return r("SingleKeyword",{key:t,attrs:{keyword:t}})}),1):e._e(),e.can_edit?r("EditBtn",{on:{click:e.enableEditMode}}):e._e(),e.edit_mode?r("BaseModal2",{attrs:{title:e.label},on:{close:function(t){e.edit_mode=!1}}},[e.new_keywords.length>0?r("div",{staticClass:"u-keywords"},e._l(e.new_keywords,function(t){return r("SingleKeyword",{key:t,attrs:{keyword:t,can_remove:!0},on:{remove:function(i){return e.removeKeyword(t)}}})}),1):e._e(),r("hr"),r("KeywordsFieldEditor",{attrs:{keywords:e.new_keywords},on:{"update:keywords":function(t){e.new_keywords=t}}}),r("hr"),r("div",{},[r("DLabel",{attrs:{str:e.$t("advanced_options")}}),r("div",{staticClass:"u-sameRow"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.new_keywords_stringified,expression:"new_keywords_stringified"}],ref:"urlToCopy",attrs:{type:"text",size:"small"},domProps:{value:e.new_keywords_stringified},on:{input:function(t){t.target.composing||(e.new_keywords_stringified=t.target.value)}}}),r("button",{staticClass:"u-button u-button_icon u-suffix _clipboardBtn",attrs:{type:"button"},on:{click:e.copyToClipboard}},[e.is_copied?r("b-icon",{attrs:{icon:"clipboard-check"}}):r("b-icon",{attrs:{icon:"clipboard"}})],1)])],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("SaveCancelButtons",{staticClass:"_scb",on:{save:e.updateKeywords,cancel:e.cancel}})],1)],1):e._e()],1)},y=[],w=n(c,g,y,!1,null,"da9817da");const p=w.exports;export{p as K};
