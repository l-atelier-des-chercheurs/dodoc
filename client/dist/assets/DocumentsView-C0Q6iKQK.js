import{T as r}from"./TwoColumnLayout-BryFv1nx.js";import{n as a,S as l}from"../build.js";const c={props:{modal_name:String,path:String,default_folder_status:{type:String,default:"public"},selected_template:{type:String,default:"story_with_sections"}},components:{},data(){return{new_folder_title:"",new_folder_is_private:!1,is_creating_folder:!1,allow_save:!1,error_msg:""}},created(){},mounted(){},i18n:{messages:{fr:{agora:"Agora"},en:{agora:"Agora"}}},beforeDestroy(){},watch:{},computed:{},methods:{async createFolder(){this.is_creating_folder=!0;const i=this.setDefaultContentAdmins();this.new_folder_title=this.cleanUpString(this.new_folder_title);let t={title:this.new_folder_title,template:this.selected_template,requested_slug:this.new_folder_title,$status:this.new_folder_is_private===!0?"private":this.default_folder_status,$admins:i};this.new_folder_template==="agora"&&(t.autoscroll=!0);try{const e=await this.$api.createFolder({path:this.path,additional_meta:t});setTimeout(()=>{this.$emit("openNew",e)},50)}catch({code:e}){e==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):e==="token_not_allowed_must_be_contributors"?this.$alertify.delay(4e3).error(this.$t("action_not_allowed")):this.$alertify.delay(4e3).error(e),this.is_creating_folder=!1}}}};var _=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.modal_name},on:{close:function(n){return t.$emit("close")}}},[e("form",{staticClass:"input-validation-required",on:{submit:function(n){return n.preventDefault(),t.createFolder.apply(null,arguments)}}},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_folder_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(n){t.new_folder_title=n},toggleValidity:n=>t.allow_save=n,onEnter:t.createFolder}}),e("div",{staticClass:"u-spacingBottom"}),e("div",{},[e("ToggleInput",{attrs:{content:t.new_folder_is_private,label:t.$t("private"),options:{true:t.$t("private_status_explanations"),false:t.$t("public_status_explanations")}},on:{"update:content":function(n){t.new_folder_is_private=n}}})],1),e("br"),e("div",{staticClass:"u-sameRow",attrs:{slot:"footer"},slot:"footer"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(n){return t.$emit("close")}}},[t._v(" "+t._s(t.$t("cancel"))+" ")]),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{slot:"footer",type:"submit",loading:t.is_creating_folder},slot:"footer"},[t._v(" "+t._s(t.$t("create_and_open"))+" ")])]),t.error_msg?[e("br"),e("br"),e("div",{staticClass:"u-errorMsg",domProps:{textContent:t._s(t.error_msg)}})]:t._e()],2)])},u=[],p=a(c,_,u,!1,null,"8f4b0718");const d=p.exports,h={props:{field_name:String,label:String,content:{type:Array,default:()=>[]},path:String,folders:Array,can_edit:Boolean,direction:{default:"horizontal",type:String}},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{list_of_pins_metas(){return this.content.length===0?[]:this.content.filter(i=>this.folders.some(t=>this.getFilename(t.$path)===i))},pinned_folders(){return this.list_of_pins_metas.reduce((i,t)=>{const e=this.folders.find(n=>this.getFilename(n.$path)===t);return e&&i.push(e),i},[])},non_pinned_folders(){return this.folders.filter(i=>!this.list_of_pins_metas.includes(this.getFilename(i.$path)))}},methods:{async addSpaceToPins(i){let t=this.list_of_pins_metas.slice();t.push(this.getFilename(i)),this.updateList({pins_metas:t})},movePin(i,t){let e=this.list_of_pins_metas.slice();e.move(i,i+t),this.updateList({pins_metas:e})},positionInPinned(i){if(this.pinned_folders.length===1)return"alone";const t=this.pinned_folders.findIndex(e=>e.$path===i);return t===0?"first":t===this.pinned_folders.length-1?"last":"none"},removeFromPins(i){let t=this.list_of_pins_metas.slice();t=t.filter(e=>e!==this.getFilename(i)),this.updateList({pins_metas:t})},async updateList({pins_metas:i}){await this.$api.updateMeta({path:this.path,new_meta:{[this.field_name]:i}})}}};var f=function(){var t=this,e=t._self._c;return e("div",[t.pinned_folders.length>0||t.can_edit?e("div",{staticClass:"_pinned"},[e("div",{},[e("DLabel",{attrs:{str:t.label}}),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.pinned_folders.length===0&&t.can_edit?e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("click_to_pin"))+" ")]):e("transition-group",{staticClass:"_list _list_pinned",class:{"is--mobileView":t.$root.is_mobile_view,"is--grid":t.direction==="horizontal"},attrs:{tag:"section",name:"listComplete",appear:""}},t._l(t.pinned_folders,function(n,s){return e("div",{key:n.$path,staticClass:"_item"},[t._t("default",null,{item:n}),t.can_edit?e("div",{staticClass:"_pinSpace"},[e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button",disabled:["alone","first"].includes(t.positionInPinned(n.$path))},on:{click:function(o){return t.movePin(s,-1)}}},[e("b-icon",{attrs:{icon:"arrow-left-circle-fill",rotate:t.direction==="vertical"?"90":"","aria-label":t.$t("move_left")}})],1),e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(o){return t.removeFromPins(n.$path)}}},[e("b-icon",{attrs:{icon:"pin-fill","aria-label":t.$t("unpin")}})],1),e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button",disabled:["alone","last"].includes(t.positionInPinned(n.$path))},on:{click:function(o){return t.movePin(s,1)}}},[e("b-icon",{attrs:{icon:"arrow-right-circle-fill",rotate:t.direction==="vertical"?"90":"","aria-label":t.$t("move_right")}})],1)]):e("div",{staticClass:"_pinSpace _pinSpace_indicator"},[e("b-icon",{attrs:{icon:"pin-fill","aria-label":t.$t("pinned")}})],1)],2)}),0)],1)],1)]):t._e(),e("transition-group",{staticClass:"_nonpinned _list",class:{"is--mobileView":t.$root.is_mobile_view,"is--grid":t.direction==="horizontal"},attrs:{tag:"section",name:"listComplete",appear:""}},t._l(t.non_pinned_folders,function(n){return e("div",{key:n.$path,staticClass:"_item"},[t._t("default",null,{item:n}),t.can_edit?e("div",{staticClass:"_pinSpace"},[e("button",{staticClass:"u-button u-button_icon u-button_small",attrs:{type:"button"},on:{click:function(s){return t.addSpaceToPins(n.$path)}}},[e("b-icon",{attrs:{icon:"pin","aria-label":t.$t("pin")}})],1)]):t._e()],2)}),0)],1)},m=[],b=a(h,f,m,!1,null,"9921cb25");const g=b.exports,v={name:"PublicationPreview",components:{},props:{publication:{type:Object,required:!0}},i18n:{messages:{fr:{story:"Rapport",story_with_sections:"Rapport",agora:"Écran",edition:"Booklet",cartography:"Cartographie",page_by_page:"Page par page"},en:{story:"Report",story_with_sections:"Report",agora:"Screen",edition:"Booklet",cartography:"Cartography",page_by_page:"Page by page"}}},methods:{getURLToFolder(i){return`/publish/${i.split("/").at(-1)}`},getTemplateLabel(i){const t=i.template||"story_with_sections";return this.$t(t)}}};var $=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"_publicationPreview",attrs:{to:t.getURLToFolder(t.publication.$path)}},[e("div",{staticClass:"_publicationPreview_content"},[e("div",{staticClass:"_publicationPreview_date"},[t._v(" "+t._s(t.formatDate(t.publication.$date_created))+" "),e("span",{staticClass:"_publicationPreview_type"},[t._v(" – "+t._s(t.getTemplateLabel(t.publication))+" ")])]),e("h3",{staticClass:"_publicationPreview_title"},[t._v(" "+t._s(t.publication.title)+" ")])]),Array.isArray(t.publication.$admins)?e("div",{staticClass:"u-listOfAvatars"},t._l(t.publication.$admins,function(n,s){return e("AuthorTag",{key:n+"_"+s,attrs:{path:n,show_image_only:!0}})}),1):t._e()])},w=[],y=a(v,$,w,!1,null,"8c928ec4");const C=y.exports,P={props:{},components:{TwoColumnLayout:r,SearchInput2:l,CreateCollection:d,PinnedNonpinnedFolder:g,PublicationPreview:C},data(){return{settings:void 0,is_loading:!0,show_create_collection:!1,collections:[],path:"publications",search_coll_name:"",show_publications_from:"all"}},i18n:{messages:{fr:{publications:"Publications",new_story:"Nouveau rapport",search_in_titles:"Rechercher dans les titres",publication_instr:"Les publications regroupent des médias dans l'espace partagé pour les partager.",agora:"Agora",all_publications:"Toutes les publications",my_publications:"Mes publications",new_agora:"Nouvel écran",new_booklet:"Nouveau livret"},en:{publications:"Publications",new_story:"New report",search_in_titles:"Search in titles",publication_instr:"Publications include multiple medias to be shared together.",agora:"Agora",all_publications:"All publications",my_publications:"My publications",new_agora:"New screen",new_booklet:"New booklet"}}},async created(){await this.loadSettings(),this.collections=await this.$api.getFolders({path:this.path}),this.is_loading=!1,this.$api.join({room:this.path})},mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.stack})},sorted_collections(){return this.collections.slice().filter(i=>this.canLoggedinSeeFolder({folder:i})).sort((i,t)=>i.$date_created.localeCompare(t.$date_created)).reverse()},filtered_collections(){return this.sorted_collections.filter(i=>!(this.search_coll_name&&!this.twoStringsSearch(i.title,this.search_coll_name)||this.show_publications_from==="me"&&!i.$admins.includes(this.connected_as.$path)))}},methods:{async loadSettings(){this.settings=await this.$api.getFolder({path:""}).catch(i=>i),this.$api.join({room:"."})},openNewCollection(i){this.show_create_collection=!1,this.$emit("open",i)},getURLToFolder(i){return`/publish/${i.split("/").at(-1)}`}}};var k=function(){var t=this,e=t._self._c;return e("TwoColumnLayout",{scopedSlots:t._u([{key:"sidebar",fn:function(){return[e("h3",{staticClass:"_dashboard--label"},[t._v(t._s(t.$t("publications")))]),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.$t("publication_instr"))+" ")]),e("hr"),e("div",{staticClass:"_createActions"},[e("h3",{staticClass:"_createActions_label",domProps:{textContent:t._s(t.$t("create_a_publication"))}}),e("button",{staticClass:"u-button u-button_outline _createAction",on:{click:function(n){t.show_create_collection="story_with_sections"}}},[e("b-icon",{attrs:{icon:"plus-circle"}}),e("span",{domProps:{textContent:t._s(t.$t("new_story"))}}),e("img",{attrs:{src:t.$root.publicPath+"picto_luma/story.svg",alt:"story"}})],1),e("button",{staticClass:"u-button u-button_outline _createAction",on:{click:function(n){t.show_create_collection="edition"}}},[e("b-icon",{attrs:{icon:"plus-circle"}}),e("span",{domProps:{textContent:t._s(t.$t("new_booklet"))}}),e("img",{attrs:{src:t.$root.publicPath+"picto_luma/edition.svg",alt:"booklet"}})],1),e("button",{staticClass:"u-button u-button_outline _createAction",on:{click:function(n){t.show_create_collection="agora"}}},[e("b-icon",{attrs:{icon:"plus-circle"}}),e("span",{domProps:{textContent:t._s(t.$t("new_agora"))}}),e("img",{attrs:{src:t.$root.publicPath+"picto_luma/agora.svg",alt:"agora"}})],1)]),t.show_create_collection?e("CreateCollection",{attrs:{modal_name:t.$t("create_a_publication"),path:"publications",default_folder_status:"private",selected_template:t.show_create_collection},on:{close:function(n){t.show_create_collection=!1},openNew:t.openNewCollection}}):t._e()]},proxy:!0},{key:"content",fn:function(){return[e("div",{staticClass:"_content"},[e("div",{staticClass:"u-spacingBottom _actions"},[t.connected_as?e("RadioSwitch",{staticClass:"_switch",attrs:{content:t.show_publications_from,options:[{label:t.$t("all_publications"),value:"all"},{label:t.$t("my_publications"),value:"me"}]},on:{"update:content":function(n){t.show_publications_from=n}}}):t._e(),e("div",{staticClass:"_searchinput"},[e("SearchInput2",{attrs:{search_placeholder:t.$t("search_in_titles")},model:{value:t.search_coll_name,callback:function(n){t.search_coll_name=n},expression:"search_coll_name"}})],1)],1),e("div",{staticClass:"u-spacingBottom"}),t.is_loading?t._e():e("PinnedNonpinnedFolder",{staticClass:"_pinnedPublications",attrs:{field_name:"publications_pinned",label:t.$t("publications_pinned"),content:t.settings.publications_pinned,path:"",folders:t.filtered_collections,can_edit:t.is_instance_admin},scopedSlots:t._u([{key:"default",fn:function(n){return[e("PublicationPreview",{attrs:{publication:n.item}})]}}],null,!1,568835922)})],1)]},proxy:!0}])})},S=[],F=a(P,k,S,!1,null,"0dff481d");const L=F.exports,x={props:{},components:{CollectionsList:L},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{openCollection(i){this.$router.push({path:"/publish/"+i})}}};var A=function(){var t=this,e=t._self._c;return e("CollectionsList",{on:{open:t.openCollection}})},R=[],T=a(x,A,R,!1,null,"79769389");const I=T.exports;export{I as default};
