import{n as s,_ as a}from"../build.js";const n={props:{opened_collection_slug:String,pane_infos:Object},components:{StorySectionTemplate:()=>a(()=>import("./StorySectionTemplate-Rg-vEs27.js"),[]),AgoraTemplate:()=>a(()=>import("./AgoraTemplate-ChEnLbWi.js"),[]),EditionTemplate:()=>a(()=>import("./EditionTemplate-CPRAyEu8.js"),[]),ExportPubliModal:()=>a(()=>import("./ExportPubliModal-BQJg-GXF.js"),[])},data(){return{is_loading:!0,collection:void 0,path:"publications/"+this.opened_collection_slug,fetch_coll_error_message:"",show_qr_code_modal:!1,show_export_pdf_modal:!1}},i18n:{messages:{fr:{make_public:"AccÃ¨s public (sans mot de passe ou compte)"},en:{make_public:"Allow access to everyone (without password or account)"}}},async created(){const o=await this.$api.getFolder({path:this.path}).catch(t=>{t.code==="folder_private"?this.fetch_coll_error_message=this.$t("coll_is_private"):this.fetch_coll_error_message=t.code,this.is_loading=!1});this.collection=o,this.is_loading=!1,this.$api.join({room:this.path}),this.$eventHub.$on("collection.addStack",this.addToStack)},mounted(){},beforeDestroy(){this.$api.leave({room:this.path}),this.$eventHub.$off("collection.addStack",this.addToStack)},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.collection})},share_url(){let o={};this.collection.template==="story_with_sections"&&(o={display:"section"}),this.collection.template==="agora"&&this.collection.autoscroll===!0&&(o={scroll:"auto"});const e=`/publications/${this.collection.$path.split("/").at(-1)}`,i=this.$router.resolve({path:e,query:o});return window.location.origin+i.href}},methods:{addToStack(){},async removeCollection(){await this.$api.deleteItem({path:this.collection.$path}),this.$emit("close")},toggleSettings(){this.$eventHub.$emit("publication.settings.toggle")}}};var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openedCollection"},[e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.is_loading?e("div",{key:"loader"},[e("div",{staticClass:"_spinner"},[e("LoaderSpinner")],1)]):t.fetch_coll_error_message?e("div",{key:"err",staticClass:"_error"},[e("a",{attrs:{href:"/publish"}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),e("div",{},[t._v(" "+t._s(t.fetch_coll_error_message)+" ")])]):e("div",{key:t.collection.$path,staticClass:"_coll"},[e("div",{staticClass:"_topbar"},[e("div",{staticClass:"u-sameRow"},[e("router-link",{staticClass:"u-button u-button_icon u-button_white",attrs:{to:"/publish",title:t.$t("back")}},[e("b-icon",{attrs:{icon:"arrow-left"}})],1),e("TitleField",{attrs:{field_name:"title",content:t.collection.title,path:t.collection.$path,tag:"h1",required:!0,can_edit:t.can_edit}})],1),e("AuthorField",{staticClass:"_admins",attrs:{label:t.$t("admins"),instructions:t.$t("media_editing_instructions"),field:"$admins",authors_paths:t.collection.$admins,path:t.collection.$path,can_edit:t.can_edit,show_image_only:!0}}),e("div",{staticClass:"_btnRow"},[e("div",[t.can_edit?e("StatusTag",{attrs:{status:t.collection.$status||"public",status_options:["public","private"],path:t.collection.$path,can_edit:t.can_edit}}):t._e()],1),e("div",[t.can_edit&&!["cartography"].includes(t.collection.template)?e("button",{staticClass:"u-buttonLink",attrs:{type:"button",caret:""},on:{click:t.toggleSettings}},[e("b-icon",{attrs:{slot:"prefix",icon:"gear","aria-label":t.$t("settings")},slot:"prefix"}),t._v(" "+t._s(t.$t("settings"))+" ")],1):t._e()]),t.can_edit?e("RemoveMenu",{attrs:{remove_text:t.$t("remove")},on:{remove:t.removeCollection}}):t._e(),t.can_edit?e("div",[e("button",{staticClass:"u-buttonLink _exportBtn",attrs:{type:"button"},on:{click:function(i){t.show_export_pdf_modal=!0}}},[e("b-icon",{attrs:{icon:"save2-fill"}}),t._v(" "+t._s(t.$t("export"))+" ")],1)]):t._e(),t.show_export_pdf_modal?e("ExportPubliModal",{attrs:{modal_title:t.$t("export_publi",{name:t.collection.title}),publication:t.collection,pane_infos:t.pane_infos},on:{close:function(i){t.show_export_pdf_modal=!1}}}):t._e(),e("div",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){t.show_qr_code_modal=!0}}},[e("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[e("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[e("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),e("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),e("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),e("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),e("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])]),t._v(" "+t._s(t.$t("direct_link"))+" ")]),t.show_qr_code_modal?e("QRModal",{attrs:{url_to_access:t.share_url},on:{close:function(i){t.show_qr_code_modal=!1}}},[e("ToggleField",{attrs:{label:t.$t("make_public"),field_name:"$public",content:t.collection.$public===!0,path:t.collection.$path,can_edit:t.can_edit}})],1):t._e()],1)],1)],1),e("div",{staticClass:"_cont",attrs:{"data-template":t.collection.template}},[!t.collection.template||t.collection.template==="story_with_sections"?e("StorySectionTemplate",{attrs:{publication:t.collection,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(i){return t.$emit("updatePane",i)}}}):t.collection.template==="agora"?e("AgoraTemplate",{attrs:{publication:t.collection,can_edit:t.can_edit}}):t.collection.template==="edition"?e("EditionTemplate",{attrs:{publication:t.collection,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(i){return t.$emit("updatePane",i)}}}):t._e()],1)])])],1)},c=[],r=s(n,l,c,!1,null,"fd46860c");const _=r.exports,d={props:{},components:{OpenedCollection:_},data(){return{opened_collection_slug:this.$route.params.document_slug}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{pane_infos(){var t,e;let o={};return(t=this.$route.query)!=null&&t.section&&(o.section=this.$route.query.section),(e=this.$route.query)!=null&&e.chapter&&(o.chapter=this.$route.query.chapter),o}},methods:{updatePane({key:o,value:t}){this.updatePageQuery({prop:o,val:t})},closeCollection(){this.$router.push({path:"/publish"})}}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_documentView"},[e("OpenedCollection",{attrs:{opened_collection_slug:t.opened_collection_slug,pane_infos:t.pane_infos},on:{updatePane:t.updatePane,close:t.closeCollection}})],1)},p=[],u=s(d,h,p,!1,null,"10e3975c");const m=u.exports;export{m as default};
