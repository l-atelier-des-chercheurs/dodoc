import{n as c,L as P,I as z,S as $,_ as p}from"../build.js";import{K as F}from"./KeywordsField-C74cRjHE.js";import{E as M}from"./EmbedPicker-B4yNP1w0.js";import w from"./AdminLumaSettings-BHDab7uc.js";import{S as D}from"./SingleKeyword-BLR2qpR_.js";var L=Object.defineProperty,T=Object.defineProperties,I=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,m=(s,t,e)=>t in s?L(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,H=(s,t)=>{for(var e in t||(t={}))k.call(t,e)&&m(s,e,t[e]);if(u)for(var e of u(t))b.call(t,e)&&m(s,e,t[e]);return s},O=(s,t)=>T(s,I(t)),R=(s,t)=>{var e={};for(var i in s)k.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&u)for(var i of u(s))t.indexOf(i)<0&&b.call(s,i)&&(e[i]=s[i]);return e};function y(s,t,e,i,a,n,o,r){var l=typeof s=="function"?s.options:s;t&&(l.render=t,l.staticRenderFns=e,l._compiled=!0);var _;if(a&&(_=a),_)if(l.functional){l._injectStyles=_;var d=l.render;l.render=function(x,f){return _.call(f),d(x,f)}}else{var h=l.beforeCreate;l.beforeCreate=h?[].concat(h,_):[_]}return{exports:s,options:l}}const B={name:"splitpanes",props:{horizontal:{type:Boolean},pushOtherPanes:{type:Boolean,default:!0},dblClickSplitter:{type:Boolean,default:!0},rtl:{type:Boolean,default:!1},firstSplitter:{type:Boolean}},provide(){return{requestUpdate:this.requestUpdate,onPaneAdd:this.onPaneAdd,onPaneRemove:this.onPaneRemove,onPaneClick:this.onPaneClick}},data:()=>({container:null,ready:!1,panes:[],touch:{mouseDown:!1,dragging:!1,activeSplitter:null},splitterTaps:{splitter:null,timeoutId:null}}),computed:{panesCount(){return this.panes.length},indexedPanes(){return this.panes.reduce((s,t)=>(s[t.id]=t)&&s,{})}},methods:{updatePaneComponents(){this.panes.forEach(s=>{s.update&&s.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[s.id].size}%`})})},bindEvents(){document.addEventListener("mousemove",this.onMouseMove,{passive:!1}),document.addEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.addEventListener("touchmove",this.onMouseMove,{passive:!1}),document.addEventListener("touchend",this.onMouseUp))},unbindEvents(){document.removeEventListener("mousemove",this.onMouseMove,{passive:!1}),document.removeEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.removeEventListener("touchmove",this.onMouseMove,{passive:!1}),document.removeEventListener("touchend",this.onMouseUp))},onMouseDown(s,t){this.bindEvents(),this.touch.mouseDown=!0,this.touch.activeSplitter=t},onMouseMove(s){this.touch.mouseDown&&(s.preventDefault(),this.touch.dragging=!0,this.calculatePanesSize(this.getCurrentMouseDrag(s)),this.$emit("resize",this.panes.map(t=>({min:t.min,max:t.max,size:t.size}))))},onMouseUp(){this.touch.dragging&&this.$emit("resized",this.panes.map(s=>({min:s.min,max:s.max,size:s.size}))),this.touch.mouseDown=!1,setTimeout(()=>{this.touch.dragging=!1,this.unbindEvents()},100)},onSplitterClick(s,t){"ontouchstart"in window&&(s.preventDefault(),this.dblClickSplitter&&(this.splitterTaps.splitter===t?(clearTimeout(this.splitterTaps.timeoutId),this.splitterTaps.timeoutId=null,this.onSplitterDblClick(s,t),this.splitterTaps.splitter=null):(this.splitterTaps.splitter=t,this.splitterTaps.timeoutId=setTimeout(()=>{this.splitterTaps.splitter=null},500)))),this.touch.dragging||this.$emit("splitter-click",this.panes[t])},onSplitterDblClick(s,t){let e=0;this.panes=this.panes.map((i,a)=>(i.size=a===t?i.max:i.min,a!==t&&(e+=i.min),i)),this.panes[t].size-=e,this.$emit("pane-maximize",this.panes[t])},onPaneClick(s,t){this.$emit("pane-click",this.indexedPanes[t])},getCurrentMouseDrag(s){const t=this.container.getBoundingClientRect(),{clientX:e,clientY:i}="ontouchstart"in window&&s.touches?s.touches[0]:s;return{x:e-t.left,y:i-t.top}},getCurrentDragPercentage(s){s=s[this.horizontal?"y":"x"];const t=this.container[this.horizontal?"clientHeight":"clientWidth"];return this.rtl&&!this.horizontal&&(s=t-s),s*100/t},calculatePanesSize(s){const t=this.touch.activeSplitter;let e={prevPanesSize:this.sumPrevPanesSize(t),nextPanesSize:this.sumNextPanesSize(t),prevReachedMinPanes:0,nextReachedMinPanes:0};const i=0+(this.pushOtherPanes?0:e.prevPanesSize),a=100-(this.pushOtherPanes?0:e.nextPanesSize),n=Math.max(Math.min(this.getCurrentDragPercentage(s),a),i);let o=[t,t+1],r=this.panes[o[0]]||null,l=this.panes[o[1]]||null;const _=r.max<100&&n>=r.max+e.prevPanesSize,d=l.max<100&&n<=100-(l.max+this.sumNextPanesSize(t+1));if(_||d){_?(r.size=r.max,l.size=Math.max(100-r.max-e.prevPanesSize-e.nextPanesSize,0)):(r.size=Math.max(100-l.max-e.prevPanesSize-this.sumNextPanesSize(t+1),0),l.size=l.max);return}if(this.pushOtherPanes){const h=this.doPushOtherPanes(e,n);if(!h)return;({sums:e,panesToResize:o}=h),r=this.panes[o[0]]||null,l=this.panes[o[1]]||null}r!==null&&(r.size=Math.min(Math.max(n-e.prevPanesSize-e.prevReachedMinPanes,r.min),r.max)),l!==null&&(l.size=Math.min(Math.max(100-n-e.nextPanesSize-e.nextReachedMinPanes,l.min),l.max))},doPushOtherPanes(s,t){const e=this.touch.activeSplitter,i=[e,e+1];return t<s.prevPanesSize+this.panes[i[0]].min&&(i[0]=this.findPrevExpandedPane(e).index,s.prevReachedMinPanes=0,i[0]<e&&this.panes.forEach((a,n)=>{n>i[0]&&n<=e&&(a.size=a.min,s.prevReachedMinPanes+=a.min)}),s.prevPanesSize=this.sumPrevPanesSize(i[0]),i[0]===void 0)?(s.prevReachedMinPanes=0,this.panes[0].size=this.panes[0].min,this.panes.forEach((a,n)=>{n>0&&n<=e&&(a.size=a.min,s.prevReachedMinPanes+=a.min)}),this.panes[i[1]].size=100-s.prevReachedMinPanes-this.panes[0].min-s.prevPanesSize-s.nextPanesSize,null):t>100-s.nextPanesSize-this.panes[i[1]].min&&(i[1]=this.findNextExpandedPane(e).index,s.nextReachedMinPanes=0,i[1]>e+1&&this.panes.forEach((a,n)=>{n>e&&n<i[1]&&(a.size=a.min,s.nextReachedMinPanes+=a.min)}),s.nextPanesSize=this.sumNextPanesSize(i[1]-1),i[1]===void 0)?(s.nextReachedMinPanes=0,this.panes[this.panesCount-1].size=this.panes[this.panesCount-1].min,this.panes.forEach((a,n)=>{n<this.panesCount-1&&n>=e+1&&(a.size=a.min,s.nextReachedMinPanes+=a.min)}),this.panes[i[0]].size=100-s.prevPanesSize-s.nextReachedMinPanes-this.panes[this.panesCount-1].min-s.nextPanesSize,null):{sums:s,panesToResize:i}},sumPrevPanesSize(s){return this.panes.reduce((t,e,i)=>t+(i<s?e.size:0),0)},sumNextPanesSize(s){return this.panes.reduce((t,e,i)=>t+(i>s+1?e.size:0),0)},findPrevExpandedPane(s){return[...this.panes].reverse().find(e=>e.index<s&&e.size>e.min)||{}},findNextExpandedPane(s){return this.panes.find(e=>e.index>s+1&&e.size>e.min)||{}},checkSplitpanesNodes(){Array.from(this.container.children).forEach(t=>{const e=t.classList.contains("splitpanes__pane"),i=t.classList.contains("splitpanes__splitter");if(!e&&!i){t.parentNode.removeChild(t),console.warn("Splitpanes: Only <pane> elements are allowed at the root of <splitpanes>. One of your DOM nodes was removed.");return}})},addSplitter(s,t,e=!1){const i=s-1,a=document.createElement("div");a.classList.add("splitpanes__splitter"),e||(a.onmousedown=n=>this.onMouseDown(n,i),typeof window<"u"&&"ontouchstart"in window&&(a.ontouchstart=n=>this.onMouseDown(n,i)),a.onclick=n=>this.onSplitterClick(n,i+1)),this.dblClickSplitter&&(a.ondblclick=n=>this.onSplitterDblClick(n,i+1)),t.parentNode.insertBefore(a,t)},removeSplitter(s){s.onmousedown=void 0,s.onclick=void 0,s.ondblclick=void 0,s.parentNode.removeChild(s)},redoSplitters(){const s=Array.from(this.container.children);s.forEach(e=>{e.className.includes("splitpanes__splitter")&&this.removeSplitter(e)});let t=0;s.forEach(e=>{e.className.includes("splitpanes__pane")&&(!t&&this.firstSplitter?this.addSplitter(t,e,!0):t&&this.addSplitter(t,e),t++)})},requestUpdate(s){var t=s,{target:e}=t,i=R(t,["target"]);const a=this.indexedPanes[e._uid];Object.entries(i).forEach(([n,o])=>a[n]=o)},onPaneAdd(s){let t=-1;Array.from(s.$el.parentNode.children).some(a=>(a.className.includes("splitpanes__pane")&&t++,a===s.$el));const e=parseFloat(s.minSize),i=parseFloat(s.maxSize);this.panes.splice(t,0,{id:s._uid,index:t,min:isNaN(e)?0:e,max:isNaN(i)?100:i,size:s.size===null?null:parseFloat(s.size),givenSize:s.size,update:s.update}),this.panes.forEach((a,n)=>a.index=n),this.ready&&this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({addedPane:this.panes[t]}),this.$emit("pane-add",{index:t,panes:this.panes.map(a=>({min:a.min,max:a.max,size:a.size}))})})},onPaneRemove(s){const t=this.panes.findIndex(i=>i.id===s._uid),e=this.panes.splice(t,1)[0];this.panes.forEach((i,a)=>i.index=a),this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({removedPane:O(H({},e),{index:t})}),this.$emit("pane-remove",{removed:e,panes:this.panes.map(i=>({min:i.min,max:i.max,size:i.size}))})})},resetPaneSizes(s={}){!s.addedPane&&!s.removedPane?this.initialPanesSizing():this.panes.some(t=>t.givenSize!==null||t.min||t.max<100)?this.equalizeAfterAddOrRemove(s):this.equalize(),this.ready&&this.$emit("resized",this.panes.map(t=>({min:t.min,max:t.max,size:t.size})))},equalize(){const s=100/this.panesCount;let t=0,e=[],i=[];this.panes.forEach(a=>{a.size=Math.max(Math.min(s,a.max),a.min),t-=a.size,a.size>=a.max&&e.push(a.id),a.size<=a.min&&i.push(a.id)}),t>.1&&this.readjustSizes(t,e,i)},initialPanesSizing(){100/this.panesCount;let s=100,t=[],e=[],i=0;this.panes.forEach(n=>{s-=n.size,n.size!==null&&i++,n.size>=n.max&&t.push(n.id),n.size<=n.min&&e.push(n.id)});let a=100;s>.1&&(this.panes.forEach(n=>{n.size===null&&(n.size=Math.max(Math.min(s/(this.panesCount-i),n.max),n.min)),a-=n.size}),a>.1&&this.readjustSizes(s,t,e))},equalizeAfterAddOrRemove({addedPane:s,removedPane:t}={}){let e=100/this.panesCount,i=0,a=[],n=[];s&&s.givenSize!==null&&(e=(100-s.givenSize)/(this.panesCount-1)),this.panes.forEach(o=>{i-=o.size,o.size>=o.max&&a.push(o.id),o.size<=o.min&&n.push(o.id)}),!(Math.abs(i)<.1)&&(this.panes.forEach(o=>{s&&s.givenSize!==null&&s.id===o.id||(o.size=Math.max(Math.min(e,o.max),o.min)),i-=o.size,o.size>=o.max&&a.push(o.id),o.size<=o.min&&n.push(o.id)}),i>.1&&this.readjustSizes(i,a,n))},readjustSizes(s,t,e){let i;s>0?i=s/(this.panesCount-t.length):i=s/(this.panesCount-e.length),this.panes.forEach((a,n)=>{if(s>0&&!t.includes(a.id)){const o=Math.max(Math.min(a.size+i,a.max),a.min),r=o-a.size;s-=r,a.size=o}else if(!e.includes(a.id)){const o=Math.max(Math.min(a.size+i,a.max),a.min),r=o-a.size;s-=r,a.size=o}a.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[a.id].size}%`})}),Math.abs(s)>.1&&this.$nextTick(()=>{this.ready&&console.warn("Splitpanes: Could not resize panes correctly due to their constraints.")})}},watch:{panes:{deep:!0,immediate:!1,handler(){this.updatePaneComponents()}},horizontal(){this.updatePaneComponents()},firstSplitter(){this.redoSplitters()},dblClickSplitter(s){[...this.container.querySelectorAll(".splitpanes__splitter")].forEach((e,i)=>{e.ondblclick=s?a=>this.onSplitterDblClick(a,i):void 0})}},beforeDestroy(){this.ready=!1},mounted(){this.container=this.$refs.container,this.checkSplitpanesNodes(),this.redoSplitters(),this.resetPaneSizes(),this.$emit("ready"),this.ready=!0},render(s){return s("div",{ref:"container",class:["splitpanes",`splitpanes--${this.horizontal?"horizontal":"vertical"}`,{"splitpanes--dragging":this.touch.dragging}]},this.$slots.default)}};let E,A;const v={};var q=y(B,E,A,!1,V);function V(s){for(let t in v)this[t]=v[t]}var N=function(){return q.exports}(),Z=function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"splitpanes__pane",style:s.style,on:{click:function(i){return s.onPaneClick(i,s._uid)}}},[s._t("default")],2)},j=[];const U={name:"pane",inject:["requestUpdate","onPaneAdd","onPaneRemove","onPaneClick"],props:{size:{type:[Number,String],default:null},minSize:{type:[Number,String],default:0},maxSize:{type:[Number,String],default:100}},data:()=>({style:{}}),mounted(){this.onPaneAdd(this)},beforeDestroy(){this.onPaneRemove(this)},methods:{update(s){this.style=s}},computed:{sizeNumber(){return this.size||this.size===0?parseFloat(this.size):null},minSizeNumber(){return parseFloat(this.minSize)},maxSizeNumber(){return parseFloat(this.maxSize)}},watch:{sizeNumber(s){this.requestUpdate({target:this,size:s})},minSizeNumber(s){this.requestUpdate({target:this,min:s})},maxSizeNumber(s){this.requestUpdate({target:this,max:s})}}},g={};var K=y(U,Z,j,!1,W);function W(s){for(let t in g)this[t]=g[t]}var J=function(){return K.exports}();const Q={props:{file:Object,context:String,position:String,can_edit:Boolean},components:{},data(){return{show_infos:!0,is_dragged:!1,edit_mode:!1,is_regenerating:!1}},i18n:{messages:{fr:{},en:{}}},created(){localStorage.getItem("show_infos")?this.show_infos=localStorage.getItem("show_infos")!=="false":this.show_infos=this.can_edit||this.file.caption||this.file.$credits},mounted(){this.$eventHub.$on("fileshown.showInfos",this.showInfos),this.$eventHub.$on("fileshown.hideInfos",this.hideInfos)},beforeDestroy(){this.$eventHub.$off("fileshown.showInfos",this.showInfos),this.$eventHub.$off("fileshown.hideInfos",this.hideInfos)},watch:{show_infos(){localStorage.setItem("show_infos",this.show_infos)}},computed:{optimization_possible(){return this.fileCanBeOptimized({path:this.file.$media_filename})},optimization_strongly_recommended(){return this.fileShouldBeOptimized({path:this.file.$media_filename})}},methods:{async regenerateThumbs(){this.is_regenerating=!0,await this.$api.regenerateThumbs({path:this.file.$path}),this.is_regenerating=!1},showInfos(){this.show_infos=!0},hideInfos(){this.show_infos=!1}}};var X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_fileShown"},[e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.file?e("div",{key:t.file.$path,staticClass:"_single",attrs:{"data-type":t.file.$type}},[t.file.$type==="text"?e("div",{staticClass:"_textEditor"},[e("CollaborativeEditor2",{attrs:{path:t.file.$path,content:t.file.$content,custom_formats:["bold","italic","underline","link"],can_edit:t.can_edit,edit_on_mounted:t.context==="chutier"}})],1):e("MediaContent",{attrs:{file:t.file,context:"full",resolution:1600,show_fs_button:!0,zoom_on_click:!1}}),t.position?e("div",{staticClass:"_navArrow"},[e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:t.position==="alone"||t.position==="first"},on:{click:function(i){return t.$eventHub.$emit("carousel.prev")}}},[e("b-icon",{attrs:{icon:"arrow-left-short"}})],1),e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:t.position==="alone"||t.position==="last"},on:{click:function(i){return t.$eventHub.$emit("carousel.next")}}},[e("b-icon",{attrs:{icon:"arrow-right-short"}})],1)]):t._e(),t.file.$thumbs==="no_preview"?e("button",{staticClass:"u-buttonLink _regenerateBtn",attrs:{type:"button"},on:{click:t.regenerateThumbs}},[t.is_regenerating?e("LoaderSpinner"):[e("b-icon",{attrs:{icon:"arrow-clockwise"}}),t._v(" "+t._s(t.$t("regenerate_thumbs"))+" ")]],2):t._e(),e("div",{staticClass:"_dragEditBtn"},[e("DragFile",{attrs:{file:t.file,is_dragged:t.is_dragged},on:{"update:is_dragged":function(i){t.is_dragged=i}}})],1)],1):t._e()]),e("div",{staticClass:"_unfoldBtn"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",attrs:{type:"button"},on:{click:function(i){t.show_infos=!t.show_infos}}},[t.show_infos?e("b-icon",{attrs:{icon:"chevron-down","aria-label":t.$t("close")}}):e("b-icon",{attrs:{icon:"chevron-up","aria-label":t.$t("open")}}),t.file.caption?e("b-icon",{attrs:{icon:"text-left","aria-label":t.$t("caption")}}):t._e(),t.file.$credits?e("b-icon",{attrs:{icon:"info-circle","aria-label":t.$t("credit/reference")}}):t._e()],1)]),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("div",{key:t.file.$path,staticClass:"_infos",attrs:{"data-hide":!t.show_infos}},[e("div",{staticClass:"_infos--content"},[t.optimization_strongly_recommended?e("div",{staticClass:"u-spacingBottom _optimizeNotice"},[e("div",{},[e("OptimizeMedia",{attrs:{media:t.file},on:{close:function(i){return t.$emit("close")}}})],1)]):t._e(),t.file.$type==="url"?e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{staticClass:"_label",attrs:{str:t.$t("link")}}),e("div",[e("a",{attrs:{href:t.file.$content,target:"_blank"}},[t._v(" "+t._s(t.file.$content)+" ")])])],1):t._e(),e("div",{staticClass:"u-spacingBottom"},[e("CollaborativeEditor2",{attrs:{label:t.$t("caption"),field_to_edit:"caption",content:t.file.caption,path:t.file.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,maxlength:1280,can_edit:t.can_edit}})],1),e("div",{},[e("CollaborativeEditor2",{attrs:{label:t.$t("credit/reference"),field_to_edit:"$credits",content:t.file.$credits,path:t.file.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,maxlength:1280,can_edit:t.can_edit}})],1),t.file.$location?[e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("latitude"))+" : "+t._s(t.file.$location.latitude)+" // "+t._s(t.$t("longitude"))+" : "+t._s(t.file.$location.longitude)+" ")])]:t._e()],2)])])],1)},G=[],Y=c(Q,X,G,!1,null,"bd5846ba");const C=Y.exports,tt={props:{files:Array,can_edit:Boolean},components:{FileShown:C},data(){return{active_file_index:0,is_dragged:!1}},i18n:{messages:{fr:{},en:{}}},created(){},mounted(){this.$eventHub.$on("carousel.next",this.nextFile),this.$eventHub.$on("carousel.prev",this.prevFile)},beforeDestroy(){this.$eventHub.$off("carousel.next",this.nextFile),this.$eventHub.$off("carousel.prev",this.prevFile)},watch:{active_file_index(){this.$nextTick(()=>{this.$el.querySelector("._preview[data-iscurrent]").scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}},computed:{enable_drag(){return typeof this.$eventHub._events["mediatile.drag.end"]<"u"},current_file_shown(){return this.active_file_index!==!1?this.files[this.active_file_index]:!1},file_shown_position(){return this.files.length===1?"alone":this.active_file_index===0?"first":this.active_file_index===this.files.length-1?"last":"inbetween"}},methods:{toggleFile(s){this.active_file_index===s?this.active_file_index=!1:this.active_file_index=s},openFile(s){this.active_file_index=s},prevFile(){this.active_file_index>0&&this.active_file_index--},nextFile(){this.active_file_index<this.files.length-1&&this.active_file_index++}}};var et=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackCarousel"},[!t.files||t.files.length===0?[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("nothing_to_show"))+" ")])]:t._e(),t.current_file_shown?e("FileShown",{key:t.current_file_shown.$path,staticClass:"_stackCarousel--fileshown",attrs:{file:t.current_file_shown,position:t.file_shown_position,can_edit:t.can_edit}}):t._e(),e("transition-group",{staticClass:"_list",attrs:{tag:"div",name:"listComplete"}},t._l(t.files,function(i,a){return e("div",{key:i.$path,staticClass:"_preview",attrs:{"data-iscurrent":t.current_file_shown.$path===i.$path},on:{click:function(n){return t.openFile(a)}}},[e("MediaContent",{attrs:{file:i,context:"preview",resolution:360}}),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.current_file_shown.$path===i.$path?e("div",{staticClass:"_btnRow"},[e("div",{staticClass:"_previewOverlay"}),e("select",{staticClass:"_changeOrderSelect",attrs:{size:"small"},domProps:{value:a+1},on:{change:function(n){return t.$emit("changeMediaOrder",a,+n.target.value-1)}}},t._l(new Array(t.files.length).fill(null),function(n,o){return e("option",{key:o+1,domProps:{textContent:t._s(o+1)}})}),0),e("RemoveMenu",{staticClass:"_removeBtn",attrs:{remove_text:t.$t("remove"),show_button_text:!1},on:{remove:function(n){return t.$emit("removeMediaFromStack",t.current_file_shown.$path)}}})],1):t._e()]),e("div",{staticClass:"_credits"},[i.caption?e("b-icon",{attrs:{icon:"text-left"}}):t._e(),i.$credits?e("b-icon",{attrs:{icon:"info-circle"}}):t._e()],1)],1)}),0)],2)},st=[],it=c(tt,et,st,!1,null,"01d1960c");const at=it.exports,nt={props:{stack_path:String,context:String,is_favorite:Boolean,can_be_added_to_fav:Boolean},components:{KeywordsField:F,StackCarousel:at},inject:{$sharedFolderPath:{default:!1}},data(){return{stack:void 0,fetch_stack_error:void 0,is_loading:!0,show_sidebar:localStorage.getItem("show_sidebar")!=="false",pane_width:void 0,ro:void 0}},i18n:{messages:{fr:{fill_title:"Veuillez remplir le champ Titre",fill_keywords:"Veuillez remplir le champ Mots-clés",files_missing:"Veuillez ajouter des médias à ce document",stack_not_public:"Ce document n'est pas public",error_loading_stack:"Erreur lors du chargement du document"},en:{fill_title:"Fill in the title field",fill_keywords:"Fill in the keywords field",files_missing:"Add medias to this document",stack_not_public:"This document is not public",error_loading_stack:"Error loading document"}}},async created(){var s;if(this.stack=await this.$api.getFolder({path:this.stack_path}).catch(t=>{this.is_loading=!1,t.code==="folder_private"?this.fetch_stack_error=this.$t("stack_not_public"):this.fetch_stack_error=this.$t("error_loading_stack")}),this.$api.join({room:this.stack.$path}),this.is_loading=!1,this.date_created_corrected=this.datetimeLocal(this.stack.date_created_corrected||this.stack.$date_created||this.stack.$date_uploaded),this.stack_files_in_order.length>0){const t=this.stack_files_in_order[0].$path;((s=this.stack.$preview)==null?void 0:s.$path)!==t&&await this.$api.updateMeta({path:this.stack.$path,new_meta:{$preview:this.getFilename(t)}})}},mounted(){this.updatePaneWidth(),this.ro=new ResizeObserver(this.updatePaneWidth),this.ro.observe(this.$el),window.addEventListener("keyup",this.handleKeyPress)},beforeDestroy(){this.ro.unobserve(this.$el),window.removeEventListener("keyup",this.handleKeyPress),this.stack&&this.$api.leave({room:this.stack.$path})},watch:{"stack.date_created_corrected"(){this.date_created_corrected=this.datetimeLocal(this.stack.date_created_corrected)},show_sidebar(){localStorage.setItem("show_sidebar",this.show_sidebar)}},computed:{can_edit(){return this.stack?this.canLoggedinEditFolder({folder:this.stack}):!1},stack_files_in_order(){return this.getStackFilesInOrder({stack:this.stack})},shared_folder_path(){return this.$sharedFolderPath?this.$sharedFolderPath():!1},share_button_is_enabled(){var s,t;return((s=this.stack.title)==null?void 0:s.length)>0&&((t=this.stack.keywords)==null?void 0:t.length)>0&&this.stack_files_in_order.length>0},dual_display(){return!!(this.show_sidebar&&this.pane_width>360*2)}},methods:{updatePaneWidth(){this.pane_width=this.$el.offsetWidth},async changeMediaOrder(s,t){var n,o;let e=this.stack_files_in_order.map(r=>this.getFilename(r.$path));function i(r,l,_){if(_>=r.length)for(var d=_-r.length+1;d--;)r.push(void 0);return r.splice(_,0,r.splice(l,1)[0]),r}i(e,s,t);let a={stack_files_metas:e};(!((n=this.stack.$preview)!=null&&n.$path)||this.getFilename((o=this.stack.$preview)==null?void 0:o.$path)!==e.at(0))&&(a.$preview=e.at(0)),await this.$api.updateMeta({path:this.stack.$path,new_meta:a})},async removeMediaFromStack(s){var e;await this.$api.copyFile({path:s,path_to_destination_folder:this.connected_as.$path,new_meta:{}}),await this.$api.deleteItem({path:s});let t=(e=this.stack)==null?void 0:e.stack_files_metas.slice();t=t.filter(i=>i!==this.getFilename(s)),await this.$api.updateMeta({path:this.stack.$path,new_meta:{stack_files_metas:t}})},async removeStack(){await this.$api.deleteItem({path:this.stack.$path}),this.$emit("close")},closeOnRemove({path:s}){s===this.stack.$path&&(this.$alertify.closeLogOnClick(!0).delay(4e3).log(this.$t("stack_was_removed")),this.$emit("close"))},async publishStack(){const s=this.shared_folder_path+"/stacks";await this.$api.copyFolder({path:this.stack.$path,path_to_destination_type:s,new_meta:{$status:"public"}}),await this.$api.deleteItem({path:this.stack.$path}),this.$emit("close")},handleKeyPress(s){if(s.key==="Escape")return this.$emit("close"),!1;s.key==="ArrowLeft"?this.$eventHub.$emit("carousel.prev"):s.key==="ArrowRight"?this.$eventHub.$emit("carousel.next"):s.key==="ArrowUp"?this.$eventHub.$emit("fileshown.showInfos"):s.key==="ArrowDown"&&this.$eventHub.$emit("fileshown.hideInfos")}}};var ot=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackDisplay",attrs:{"data-context":t.context}},[e("div",{staticClass:"_closeStack"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",on:{click:function(i){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("div",{staticClass:"_panes"},[t.is_loading?e("LoaderSpinner"):t.fetch_stack_error?e("div",[t._v(" "+t._s(t.fetch_stack_error)+" ")]):[e("div",{staticClass:"_showSidebar"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",attrs:{type:"button"},on:{click:function(i){i.stopPropagation(),t.show_sidebar=!0}}},[e("b-icon",{attrs:{icon:"list-ul","aria-label":t.$t("show")}})],1)]),e("transition",{attrs:{name:"slideleft",mode:"out-in"}},[t.show_sidebar?e("div",{staticClass:"_infos"},[e("div",{staticClass:"_allFields"},[e("div",{staticClass:"_titleRow"},[e("TitleField",{attrs:{label:t.stack.title?"":t.$t("title"),field_name:"title",content:t.stack.title,path:t.stack.$path,required:!0,tag:"h1",can_edit:t.can_edit}}),t.can_be_added_to_fav?e("button",{staticClass:"u-button u-button_icon _addToColl",attrs:{type:"button"},on:{click:function(i){return i.stopPropagation(),t.$emit("toggleFav")}}},[t.is_favorite?e("b-icon",{attrs:{icon:"star-fill","aria-label":t.$t("remove")}}):e("b-icon",{attrs:{icon:"star","aria-label":t.$t("add")}})],1):t._e()],1),e("hr"),e("div",[e("CollaborativeEditor2",{attrs:{label:t.$t("description"),field_to_edit:"description",content:t.stack.description,path:t.stack.$path,custom_formats:["bold","italic","link"],is_collaborative:!1,can_edit:t.can_edit}})],1),e("hr"),e("div",{},[e("KeywordsField",{attrs:{label:t.$t("keywords"),field_name:"keywords",keywords:t.stack.keywords,path:t.stack.$path,can_edit:t.can_edit}})],1),e("hr"),e("PositionPicker",{attrs:{field_name:"$location",label:t.$t("location"),content:t.stack.$location,path:t.stack.$path,can_edit:t.can_edit}}),e("hr"),e("div",{staticClass:"_dateFields"},[e("div",{},[e("DateField",{attrs:{label:t.$t("created"),field_name:"date_created_corrected",date:t.date_created_corrected,path:t.stack.$path,input_type:"datetime-local",can_edit:t.can_edit}}),t._v(" "+t._s(t.date_created_corrected)+" ")],1),e("div",{},[e("DateField",{attrs:{label:t.$t("date_modified"),field_name:"date_modified",date:t.stack.$date_modified,path:t.stack.$path,input_type:"datetime-local",can_edit:!1}})],1)]),e("hr"),e("div",{staticClass:"u-spacingBottom"},[e("AuthorField",{attrs:{label:t.$t("authors"),field:"$authors",instructions:t.$t("file_author_instructions"),authors_paths:t.stack.$authors,path:t.stack.$path,can_edit:t.can_edit,no_options:!0}})],1),e("div",{staticClass:"u-spacingBottom"},[e("AuthorField",{attrs:{label:t.$t("admins"),field:"$admins",instructions:t.$t("media_editing_instructions"),authors_paths:t.stack.$admins,path:t.stack.$path,can_edit:t.can_edit}})],1),e("hr"),t.can_edit?e("div",{staticClass:"u-sameRow"},[e("DownloadFolder",{attrs:{path:t.stack.$path}}),e("RemoveMenu",{attrs:{remove_text:t.$t("remove"),remove_expl:t.$t("remove_stack_instr")},on:{remove:t.removeStack}})],1):t._e(),t.is_instance_admin?e("div",{},[t.can_edit?e("StatusTag",{attrs:{status:t.stack.$status||"public",status_options:["public","private"],path:t.stack.$path,can_edit:t.can_edit}}):t._e()],1):t._e()],1),t.context==="chutier"?e("div",{staticClass:"_bottomBtns"},[e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("button",{key:t.share_button_is_enabled,staticClass:"u-button u-button_red _btn",attrs:{type:"button",disabled:!t.share_button_is_enabled},on:{click:t.publishStack}},[t._v(" "+t._s(t.$t("publish"))+"  "),e("b-icon",{staticStyle:{"font-size":"1rem"},attrs:{icon:"arrow-right-square",circle:""}})],1)]),e("div",{staticClass:"u-instructions"},[!t.stack.title||t.stack.title.length===0?e("div",[t._v(" "+t._s(t.$t("fill_title"))+" ")]):t._e(),!t.stack.keywords||t.stack.keywords.length===0?e("div",[t._v(" "+t._s(t.$t("fill_keywords"))+" ")]):t._e(),t.stack_files_in_order.length===0?e("div",[t._v(" "+t._s(t.$t("files_missing"))+" ")]):t._e()])],1):t._e(),e("button",{staticClass:"u-button u-button_icon u-button_transparent _hideSidebar",attrs:{type:"button"},on:{click:function(i){i.stopPropagation(),t.show_sidebar=!1}}},[e("b-icon",{attrs:{icon:"arrow-left","aria-label":t.$t("hide")}})],1)]):t._e()]),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.show_sidebar&&!t.dual_display?e("div",{staticClass:"_overlay",on:{click:function(i){t.show_sidebar=!1}}}):t._e()]),e("StackCarousel",{staticClass:"_topCarousel",attrs:{"data-dualdisplay":t.dual_display,files:t.stack_files_in_order,can_edit:t.can_edit},on:{removeMediaFromStack:t.removeMediaFromStack,changeMediaOrder:t.changeMediaOrder}})]],2)])},rt=[],lt=c(nt,ot,rt,!1,null,"3a3822da");const S=lt.exports,ct={props:{index:Number,author_stacks_path:String,selected_items:Array,mode:String,stack:Object},components:{StackDisplay:S},data(){return{is_draggedOn:!1,show_mediastack_modal:!1,is_adding_to_stack:!1}},created(){},async mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{dragEnter(s){var e;((e=s.dataTransfer)==null?void 0:e.types[0])==="text/plain"&&(this.is_draggedOn=!0)},dragOver(s){s.preventDefault()},dragLeave(){this.is_draggedOn=!1},async drop(s){var t;if(this.$alertify.delay(4e3).success("dropped item"),s.preventDefault(),this.is_draggedOn=!1,this.selected_items.length>0)await this.addSelectedToStack();else{const e=(t=s.dataTransfer)==null?void 0:t.getData("text/plain");if(e){const i=[JSON.parse(e)];await this.createOrAppendToStack(i)}}},async addSelectedToStack(){const s=this.selected_items.map(t=>t.$path);await this.createOrAppendToStack(s)},async openOrAddToStack(){this.selected_items.length>0?await this.addSelectedToStack():this.openStack()},openStack(){this.stack&&(this.show_mediastack_modal=!0)},async createOrAppendToStack(s){var i,a;this.is_adding_to_stack=!0;let t;if((i=this.stack)!=null&&i.$path)t=(a=this.stack)==null?void 0:a.$path;else{let n={requested_slug:"stack",stack_spot:this.index,$authors:[this.connected_as.$path],$admins:[this.connected_as.$path]};const o=await this.$api.createFolder({path:this.author_stacks_path,additional_meta:n}).catch(r=>{throw this.$alertify.delay(4e3).error(r),r});t=this.author_stacks_path+"/"+o}await new Promise(n=>setTimeout(n,250));let e=[];this.stack&&this.stack.stack_files_metas&&Array.isArray(this.stack.stack_files_metas)&&(e=this.stack.stack_files_metas.slice());for(const n of s){const o=await this.$api.copyFile({path:n,path_to_destination_folder:t,new_meta:{}});await this.$api.deleteItem({path:n}),e.push(o);let r={stack_files_metas:e};e.length===1&&(r.$preview=o),await this.$api.updateMeta({path:t,new_meta:r})}await new Promise(n=>setTimeout(n,300)),this.is_adding_to_stack=!1}}};var _t=function(){var t=this,e=t._self._c;return e("div",{},[e("div",{staticClass:"_documentSpot",class:{"is--draggedOn":t.is_draggedOn,"has--content":t.stack,"is--expectingDrag":t.mode==="add","is--expectingClick":t.selected_items&&t.selected_items.length>0},on:{dragenter:t.dragEnter,dragover:t.dragOver,dragleave:t.dragLeave,click:t.openOrAddToStack,drop:t.drop}},[e("div",{staticClass:"_topContent"},[t.stack?[t.stack.$preview?e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:t.stack.$preview}}):e("div",{staticClass:"_mediaPreview _noPreview"},[t._v(" "+t._s(t.$t("no_preview_to_show"))+" ")]),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.stack&&t.stack.stack_files_metas?e("div",{key:t.stack.stack_files_metas.length+"_"+t.mode,staticClass:"_count"},[t.mode==="add"?[t._v("+")]:t._e(),t._v(" "+t._s(t.stack.stack_files_metas.length)+" ")],2):t._e()])]:e("div",{staticClass:"_plus"},[t._v("+")]),e("transition",{attrs:{name:"slideupFade",mode:"out-in"}},[t.mode==="add"?e("div",{},[e("div",{key:t.mode,staticClass:"anim_backgroundPosition"})]):t._e()]),t.is_adding_to_stack?e("LoaderSpinner",{staticClass:"_loader"}):t._e()],2),t.stack&&t.stack.title?e("div",{staticClass:"_stackTitle"},[t._v(" "+t._s(t.stack.title)+" ")]):t._e()]),e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.show_mediastack_modal?e("StackDisplay",{staticClass:"_stackModal",attrs:{stack_path:t.stack.$path,context:"chutier"},on:{close:function(i){t.show_mediastack_modal=!1}}}):t._e()],1)],1)},dt=[],ht=c(ct,_t,dt,!1,null,"f827fdb2");const ut=ht.exports,pt={props:{author_stacks_path:String,selected_items:Array},components:{DocumentSpot:ut},data(){return{is_loading:!0,fetch_stack_err:void 0,all_stacks:[],is_expecting_drag:!1}},i18n:{messages:{fr:{}}},async created(){await this.listStacks(),this.$api.join({room:this.author_stacks_path}),this.is_loading=!1,this.$eventHub.$on("chutierItem.startDrag",this.startDragItem),this.$eventHub.$on("chutierItem.endDrag",this.endDragItem)},mounted(){},beforeDestroy(){this.$api.leave({room:this.author_stacks_path}),this.$eventHub.$off("chutierItem.startDrag",this.startDragItem),this.$eventHub.$off("chutierItem.endDrag",this.endDragItem)},watch:{},computed:{spot_mode(){var s;return this.is_expecting_drag||((s=this.selected_items)==null?void 0:s.length)>0?"add":"open"},sorted_stacks(){return this.all_stacks.slice().sort((s,t)=>+new Date(s.$date_created)-+new Date(t.$date_created))}},methods:{startDragItem(){this.is_expecting_drag=!0},endDragItem(){this.is_expecting_drag=!1},async listStacks(){const s=await this.$api.getFolders({path:this.author_stacks_path}).catch(t=>{this.fetch_stack_err=t.response,this.is_loading=!1});this.all_stacks=s}}};var ft=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_documentsCreator"},[e("transition-group",{attrs:{tag:"div",name:"projectsList"}},[t._l(t.sorted_stacks,function(i){return e("DocumentSpot",{key:i.$path,attrs:{selected_items:t.selected_items,author_stacks_path:t.author_stacks_path,mode:t.spot_mode,stack_path:i.$path,stack:i}})}),e("div",{key:"empty"},[e("transition",{attrs:{name:"slideupFade"}},[t.spot_mode==="add"?e("DocumentSpot",{attrs:{author_stacks_path:t.author_stacks_path,selected_items:t.selected_items,mode:"add"}}):t._e()],1)],1)],2)],1)},mt=[],vt=c(pt,ft,mt,!1,null,"ed2716f5");const gt=vt.exports,$t={props:{file:Object,is_selected:Boolean,is_clicked:Boolean,draggable:Boolean,context:{type:String,default:"list"}},components:{FileShown:C},data(){return{show_large:!1,is_mousedown:!1,is_dragged:!1,id:`select_chutier_item_${(Math.random().toString(36)+"00000000000000000").slice(2,5)}`,date_created_corrected:this.datetimeLocal(this.file.date_created_corrected||this.file.$date_created||this.file.$date_uploaded||new Date),description:this.file.description||"",keywords:this.file.keywords||[]}},created(){},mounted(){this.$eventHub.$on("chutierItem.editText",this.editText),this.$eventHub.$on("chutierItem.startDrag",this.itemDragged),this.$eventHub.$on("chutierItem.endDrag",this.itemStoppedDrag)},beforeDestroy(){this.$eventHub.$off("chutierItem.editText",this.editText),this.$eventHub.$off("chutierItem.startDrag",this.itemDragged),this.$eventHub.$off("chutierItem.endDrag",this.itemStoppedDrag)},watch:{},computed:{},methods:{cleanFilename(){return this.file.$media_filename.substring(0,this.file.$media_filename.lastIndexOf("."))},editText(s){this.getFilename(this.file.$path)===s&&(this.show_large=!0,this.$nextTick(()=>{}))},dragStart(s){this.is_dragged=!0,this.is_selected||this.$emit("toggleSelect"),this.$eventHub.$emit("chutierItem.startDrag"),s.dataTransfer.effectAllowed="move";var t=document.createElement("img");const e=this.makeURLFromThumbs({$thumbs:this.file.$thumbs,$type:this.file.$type,$path:this.getParent(this.file.$path),resolution:180});e&&(t.src=e,s.dataTransfer.setDragImage(t,0,0,50,50)),s.dataTransfer.setData("text/plain",JSON.stringify(this.file.$path))},dragEnd(){this.is_dragged=!1,this.$eventHub.$emit("chutierItem.endDrag")},itemDragged(){this.is_selected&&(this.is_dragged=!0)},itemStoppedDrag(){this.is_dragged=!1}}};var wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_chutierRow",class:{"is--clicked":t.is_clicked,"is--selected":t.is_selected,"is--dragged":t.is_dragged},attrs:{draggable:t.draggable},on:{dragstart:t.dragStart,dragend:t.dragEnd,click:function(i){return t.$emit("toggleSelect")}}},[e("div",{staticClass:"_chutierRow--rows"},[e("div",{staticClass:"_infos"},[e("div",{staticClass:"_chutierRow--openLarge",on:{click:function(i){i.stopPropagation(),t.show_large=!0}}},[e("MediaContent",{staticClass:"_chutierRow--preview",attrs:{file:t.file,context:"preview"}})],1),e("div",{staticClass:"_titleDateField"},[e("div",[e("div",{},[e("small",[t._v(" "+t._s(t.context==="stack"?t.formatDateTimeToPrecise(t.date_created_corrected):t.formatTime(t.date_created_corrected,{hour:"2-digit",minute:"2-digit"}))+" ")])]),t.file.caption?e("div",{domProps:{textContent:t._s(t.file.caption)}}):e("div",{domProps:{textContent:t._s(t.file.$media_filename)}})])]),e("button",{staticClass:"u-button_icon _dragBtn",attrs:{type:"button"}},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9.01864 7.20446C9.25889 7.20446 9.48929 7.29963 9.65918 7.46904C9.82906 7.63845 9.9245 7.86822 9.9245 8.1078V10.3644C9.9245 10.5241 9.98812 10.6773 10.1014 10.7902C10.2146 10.9031 10.3682 10.9666 10.5284 10.9666C10.6886 10.9666 10.8422 10.9031 10.9554 10.7902C11.0687 10.6773 11.1323 10.5241 11.1323 10.3644V7.82812C11.1323 7.25029 11.8264 7.14482 12.3513 7.25029C12.5131 7.28281 12.641 7.33835 12.7849 7.46904C12.8532 7.53111 12.944 7.73743 12.944 7.93858V10.3644C12.944 10.5241 13.0077 10.6773 13.1209 10.7902C13.2342 10.9031 13.3878 10.9666 13.5479 10.9666C13.7081 10.9666 13.8617 10.9031 13.975 10.7902C14.0882 10.6773 14.1518 10.5241 14.1518 10.3644V8.47938C14.1945 8.4749 14.2372 8.47089 14.2799 8.46733C14.6615 8.43843 14.9852 8.45529 15.135 8.51551C15.2775 8.57092 15.4974 8.76484 15.722 9.03343C15.8198 9.14906 15.9032 9.26228 15.9636 9.34538V10.9666C15.9636 11.1263 16.0272 11.2795 16.1405 11.3924C16.2537 11.5054 16.4073 11.5688 16.5675 11.5688C16.7276 11.5688 16.8813 11.5054 16.9945 11.3924C17.1078 11.2795 17.1714 11.1263 17.1714 10.9666V9.76212H17.5845C17.7533 9.76212 17.9202 9.7974 18.0745 9.86569C18.2288 9.93398 18.367 10.0338 18.4802 10.1586C18.5934 10.2834 18.6792 10.4306 18.7319 10.5905C18.7846 10.7504 18.8031 10.9195 18.7862 11.087L18.4589 14.3571C18.4166 14.7774 18.2862 15.184 18.076 15.5507L16.3911 18.492C16.3383 18.5842 16.262 18.6608 16.17 18.7141C16.0779 18.7674 15.9734 18.7955 15.8669 18.7955H8.15505C8.05559 18.7955 7.95769 18.7709 7.87004 18.7241C7.78239 18.6772 7.70769 18.6095 7.6526 18.5269L5.9218 15.9374C5.7611 15.6972 5.66045 15.4221 5.6283 15.1352L5.2116 11.3954C5.19476 11.2455 5.23493 11.0948 5.32417 10.973C5.4134 10.8512 5.54521 10.7673 5.69352 10.7377L6.90496 10.4968V11.5688C6.90496 11.7285 6.96859 11.8817 7.08184 11.9946C7.19509 12.1076 7.3487 12.171 7.50887 12.171C7.66903 12.171 7.82264 12.1076 7.93589 11.9946C8.04915 11.8817 8.11277 11.7285 8.11277 11.5688V8.1078C8.11277 7.86822 8.20821 7.63845 8.3781 7.46904C8.54798 7.29963 8.77839 7.20446 9.01864 7.20446ZM10.5284 6.75C10.132 6.35471 9.57922 6 9.01864 6C8.45805 6 7.92043 6.22207 7.52404 6.61736C7.12765 7.01265 6.90496 7.54878 6.90496 8.1078V9.2683L5.45558 9.55737C5.01132 9.64619 4.61656 9.89779 4.34915 10.2626C4.08175 10.6273 3.96111 11.0788 4.01103 11.5279L4.42773 15.2689C4.48132 15.7471 4.64906 16.2056 4.9169 16.6058L6.6477 19.1954C6.81312 19.4429 7.03726 19.6458 7.30021 19.7862C7.56317 19.9265 7.8568 20 8.15505 20H15.8669C16.1863 19.9999 16.4999 19.9156 16.7761 19.7557C17.0523 19.5958 17.2811 19.366 17.4395 19.0894L19.1244 16.1494C19.419 15.6354 19.6017 15.0654 19.6607 14.4764L19.988 11.2063C20.0216 10.8714 19.9844 10.5332 19.8789 10.2135C19.7734 9.89385 19.6019 9.59976 19.3755 9.35022C19.149 9.10068 18.8726 8.90123 18.5642 8.76472C18.2557 8.62821 17.9219 8.55768 17.5845 8.55767H16.8827C16.8073 8.45571 16.7288 8.35609 16.6472 8.25896C16.4165 7.98314 16.0312 7.57483 15.5843 7.39657C15.1447 7.22072 14.5625 7.23758 14.1857 7.26649L14.0262 7.28095C13.7453 6.56393 13.1227 6 12.0662 6C10.8923 6 10.5284 6.75 10.5284 6.75Z",fill:"#77758E"}})])])])]),t.show_large?[e("portal",{attrs:{to:"largemedia"}},[e("div",{staticClass:"_largePreview"},[e("div",{staticClass:"_closeLarge"},[e("button",{staticClass:"u-button u-button_icon u-button_transparent",on:{click:function(i){t.show_large=!1}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("FileShown",{key:t.file.$path,staticClass:"_fileLarge",attrs:{context:"chutier",file:t.file,can_edit:!0}})],1)])]:t._e(),(t.is_selected,t._e())],2)},kt=[],bt=c($t,wt,kt,!1,null,"bc155426");const yt=bt.exports,Ct={props:{shared_folder_path:String},components:{ImportFileZone:z,DocumentsCreator:gt,EmbedPicker:M,ChutierItem:yt,AdminLumaSettings:w,LangModal:P},provide(){return{$sharedFolderPath:()=>this.shared_folder_path}},i18n:{messages:{fr:{imported_docs:"Les médias importés apparaissent ici. Ils restent privés tant que vous ne les ajoutez pas à un document partagé."},en:{imported_docs:"Imported medias will appear here. They stay private until they are added to a shared document."}}},data(){return{chutier:void 0,show_admin_settings:!1,is_dragover:!1,files_to_import:[],id:`image_select_${(Math.random().toString(36)+"00000000000000000").slice(2,5)}`,last_clicked:void 0,selected_items_slugs:[],show_mediastack_modal:!1,max_items_selected:15,show_link_picker:!1,show_qr_code_modal:!1,show_lang_modal:!1,show_confirm_remove_menu:!1}},created(){},mounted(){this.listChutier()},beforeDestroy(){},watch:{selected_items_slugs(){this.show_confirm_remove_menu&&(this.show_confirm_remove_menu=!1),this.selected_items_slugs.length>this.max_items_selected&&(this.selected_items_slugs=this.selected_items_slugs.slice(0,this.max_items_selected),this.$alertify.delay(4e3).error(this.$t("too_many_items_selected")),setTimeout(()=>{this.$alertify.delay(4e3).error(this.$t("max_items_is")+" "+this.max_items_selected)},500))},chutier_items(){const s=this.selected_items_slugs.filter(t=>this.chutier_items.some(e=>e.$path===t));JSON.stringify(this.selected_items_slugs)!==JSON.stringify(s)&&(this.selected_items_slugs=s)}},computed:{author_path(){return this.connected_as.$path},author_stacks_path(){return this.author_path+"/stacks"},current_lang_code(){return this.$i18n.availableLocales,this.$i18n.locale},url_to_page(){return this.$route.path,window.location.href},selected_items(){return this.selected_items_slugs.map(s=>this.chutier_items.find(t=>t.$path===s)||!1)},all_items_selected(){return this.selected_items.length===this.chutier_items.length},chutier_items(){if(!this.chutier||!this.chutier.$files)return[];let s=JSON.parse(JSON.stringify(this.chutier.$files));return s=s.filter(t=>t.is_stack!==!0&&t.$media_filename).sort((t,e)=>{const i=a=>new Date(a.date_created_corrected||a.$date_created||a.$date_uploaded);return+i(e)-+i(t)}),s},chutier_items_grouped(){return this.groupFilesBy(this.chutier_items,["date_created_corrected","$date_created","$date_uploaded"],"day")}},methods:{async listChutier(){this.chutier=await this.$api.getFolder({path:this.author_path}).catch(s=>{this.fetch_project_error=s.response,this.is_loading=!1})},toggleSelect(s){this.selected_items_slugs.includes(s)?this.selected_items_slugs=this.selected_items_slugs.filter(t=>t!==s):this.selected_items_slugs.push(s)},async createNote(){const t="note-"+ +new Date+".txt",e=await this.$api.uploadText({path:this.author_path,filename:t,content:"",additional_meta:{title:"Sans titre"}});setTimeout(()=>{this.$eventHub.$emit("chutierItem.editText",e)},100)},async createEmbed(s){const e="url-"+ +new Date+".txt",i=await this.$api.uploadText({path:this.author_path,filename:e,content:s,additional_meta:{title:"Titre du lien",$type:"url"}});this.show_link_picker=!1,setTimeout(()=>{this.$eventHub.$emit("chutierItem.editText",i)},100)},async mediaJustImported(s){},onDragover(s){s.preventDefault()},onDragEnter(s){s.preventDefault(),this.is_dragover=!0},onDragLeave(s){s.preventDefault(),this.is_dragover=!1},onDrop(s){var t;this.is_dragover=!1,((t=s.dataTransfer.files)==null?void 0:t.length)>0&&(this.files_to_import=Array.from(s.dataTransfer.files))},selectAll(){this.selected_items_slugs=this.chutier_items.map(s=>s.$path)},deselectAll(){this.selected_items_slugs=[]},selectRange(s){this.selected_items_slugs=this.selected_items_slugs.concat(s),this.selected_items_slugs=[...new Set(this.selected_items_slugs)]},deselectRange(s){this.selected_items_slugs=this.selected_items_slugs.filter(t=>!s.includes(t))},rangeIsSelected(s){return this.selected_items_slugs.length===0?!1:!s.find(t=>this.selected_items_slugs.includes(t)===!1)},async removeItemsInSelection(){for(const s of this.selected_items_slugs)await this.$api.deleteItem({path:s});this.show_confirm_remove_menu=!1}}};var St=function(){var t=this,e=t._self._c;return t.chutier?e("div",{staticClass:"_myChutier",on:{click:function(i){t.last_clicked=!1}}},[e("portal-target",{attrs:{name:"largemedia",multiple:""}}),e("div",{staticClass:"_itemsList",on:{click:function(i){if(i.target!==i.currentTarget)return null;t.selected_items_slugs=[]}}},[e("div",{staticClass:"_topRow"},[t.connected_as?e("AuthorTag",{attrs:{path:t.connected_as.$path,show_image_only:!0},on:{click:function(i){return t.$eventHub.$emit("showAuthorModal")}}}):e("button",{staticClass:"_authorBtn",attrs:{type:"button"},on:{click:function(i){return t.$eventHub.$emit("showAuthorModal")}}},[t._v(" "+t._s(t.$t("login"))+" ")]),e("div",{staticClass:"_separator"}),e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(i){t.show_qr_code_modal=!0}}},[e("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[e("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[e("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),e("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),e("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),e("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),e("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])])]),t.show_qr_code_modal?e("QRModal",{attrs:{url_to_access:t.url_to_page},on:{close:function(i){t.show_qr_code_modal=!1}}}):t._e(),e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(i){return t.$eventHub.$emit("app.show_welcome_modal")}}},[e("b-icon",{attrs:{icon:"question-square"}})],1),e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(i){t.show_lang_modal=!t.show_lang_modal}}},[t._v(" "+t._s(t.current_lang_code)+" ")]),t.show_lang_modal?e("LangModal",{on:{close:function(i){t.show_lang_modal=!1}}}):t._e(),t.is_instance_admin?e("button",{staticClass:"u-button u-button_icon _qrBtn",attrs:{type:"button"},on:{click:function(i){t.show_admin_settings=!t.show_admin_settings}}},[e("b-icon",{attrs:{icon:"gear","aria-label":t.$t("admin_settings")}})],1):t._e(),t.show_admin_settings?e("AdminLumaSettings",{on:{close:function(i){t.show_admin_settings=!1}}}):t._e()],1),t.connected_as?[e("div",{staticClass:"_importButton"},[e("ImportFileZone",{attrs:{multiple:!0,files_to_import:t.files_to_import},on:{"update:files_to_import":function(i){t.files_to_import=i}}}),t.files_to_import.length>0?e("UploadFiles",{attrs:{files_to_import:t.files_to_import,path:t.author_path},on:{importedMedias:function(i){return t.mediaJustImported(i)},close:function(i){t.files_to_import=[]}}}):t._e(),e("div",{staticClass:"_importBtns"},[e("button",{staticClass:"u-button u-button_outline _qrBtn",attrs:{type:"button"},on:{click:t.createNote}},[e("b-icon",{attrs:{icon:"file-text"}}),t._v("   note ")],1),e("button",{staticClass:"u-button u-button_outline _qrBtn",attrs:{type:"button"},on:{click:function(i){t.show_link_picker=!0}}},[e("b-icon",{attrs:{icon:"link-45deg"}}),t._v("   url ")],1),t.show_link_picker?e("EmbedPicker",{on:{embed:t.createEmbed,close:function(i){t.show_link_picker=!1}}}):t._e()],1)],1),e("div",{staticClass:"_middleContent"},[e("div",{staticClass:"u-instructions u-spacingBottom"},[e("b-icon",{attrs:{icon:"info-circle"}}),t._v(" "+t._s(t.$t("imported_docs"))+" ")],1),t.chutier_items&&t.chutier_items.length>0?[e("label",{staticClass:"_item--label",class:{"is--fullySelected":t.all_items_selected},attrs:{for:""},on:{click:function(i){t.all_items_selected?t.deselectAll():t.selectAll()}}},[t.chutier_items.length>0?e("button",{staticClass:"u-buttonLink u-selectBtn",attrs:{type:"button"}},[e("b-icon",{attrs:{icon:t.all_items_selected?"dash-square-dotted":"plus-square-dotted"}})],1):t._e(),t._v(" "+t._s(t.$t("items_to_share"))+" • "+t._s(t.chutier_items.length)+" ")])]:t._e()],2),e("div",{staticClass:"_items",on:{click:function(i){if(i.target!==i.currentTarget)return null;t.selected_items_slugs=[]}}},t._l(t.chutier_items_grouped,function(i){return e("div",{key:i.label,staticClass:"_item",on:{click:function(a){if(a.target!==a.currentTarget)return null;t.selected_items_slugs=[]}}},[e("div",{staticClass:"_item--label",class:{"is--fullySelected":t.rangeIsSelected(i.files.map(a=>a.$path))},on:{click:function(a){t.rangeIsSelected(i.files.map(n=>n.$path))?t.deselectRange(i.files.map(n=>n.$path)):t.selectRange(i.files.map(n=>n.$path))}}},[t.rangeIsSelected(i.files.map(a=>a.$path))?e("button",{staticClass:"u-buttonLink u-selectBtn",attrs:{type:"button"}},[e("b-icon",{attrs:{icon:"dash-square-dotted"}})],1):e("button",{staticClass:"u-buttonLink u-selectBtn",attrs:{type:"button"}},[e("b-icon",{attrs:{icon:"plus-square-dotted"}})],1),t._v(" "+t._s(i.label)+" ")]),e("transition-group",{attrs:{tag:"div",name:"listComplete"}},t._l(i.files,function(a){return e("ChutierItem",{key:a.$path,attrs:{file:a,is_clicked:t.last_clicked===a.$path,is_selected:t.selected_items_slugs.includes(a.$path),draggable:!0},on:{toggleSelect:function(n){return t.toggleSelect(a.$path)},unclicked:function(n){t.last_clicked=!1},click:function(n){n.stopPropagation(),t.last_clicked=a.$path}}})}),1)],1)}),0)]:t._e()],2),t.connected_as?[e("DocumentsCreator",{staticClass:"_documentsCreator",attrs:{author_stacks_path:t.author_stacks_path,selected_items:t.selected_items}})]:t._e(),e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.selected_items.length>0?e("div",{key:"selection",staticClass:"_selectionBar"},[e("transition",{attrs:{name:"slideupFade",mode:"out-in"}},[e("div",{key:t.selected_items.length},[t.selected_items.length===1?[t._v(" "+t._s(t.$t("selected_item"))+" ")]:[t._v(" "+t._s(t.$t("selected_items"))+" ")],t._v(" "+t._s(t.selected_items.length)+" ")],2)]),e("div",{staticClass:"u-sameRow _dbleBtns"},[e("button",{staticClass:"u-button u-button_black",attrs:{type:"button"},on:{click:t.deselectAll}},[e("b-icon",{attrs:{name:"dash-square-dotted"}}),t._v(" "+t._s(t.$t("deselect_all"))+" ")],1),e("button",{staticClass:"u-button u-button_black",attrs:{type:"button"},on:{click:function(i){t.show_confirm_remove_menu=!0}}},[e("b-icon",{attrs:{icon:"trash"}}),t._v(" "+t._s(t.$t("remove_select"))+" ")],1)])],1):t._e()]),e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.show_confirm_remove_menu?e("div",{key:"remove",staticClass:"_removeMenu"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){t.show_confirm_remove_menu=!1}}},[t._v(" "+t._s(t.$t("cancel"))+" ")]),e("button",{staticClass:"u-button u-button_red",attrs:{type:"button",autofocus:""},on:{click:t.removeItemsInSelection}},[t._v(" "+t._s(t.$t("confirm_removal"))+" ")])]):t._e()])],2):t._e()},xt=[],Pt=c(Ct,St,xt,!1,null,"0d34fe56");const zt=Pt.exports,Ft={props:{shared_files:Array,group_mode:String,sort_order:String,search_str:String,filetype_filter:String,author_path_filter:String,available_keywords:Array,keywords_filter:Array,fav_filter:Boolean,view_mode:String},components:{SingleKeyword:D,SearchInput2:$},data(){return{show_filter_sort_pane:!1,all_authors:[],show_all_keywords:!1,kw_search:"",group_options:[{key:"day",label:this.$t("day")},{key:"month",label:this.$t("month")},{key:"year",label:this.$t("year")}],type_of_media_to_display:"all",types_of_medias:[{key:"all",label:this.$t("all_medias_types")},{key:"image",label:this.$t("image")},{key:"video",label:this.$t("video")},{key:"audio",label:this.$t("audio")},{key:"text",label:this.$t("text")},{key:"pdf",label:this.$t("pdf")},{key:"stl",label:this.$t("stl")},{key:"other",label:this.$t("other")}]}},i18n:{messages:{fr:{search_fields:"Rechercher dans les champs titre et description des documents."},en:{search_fields:"Search in titles or descriptions of documents."}}},async created(){this.all_authors=await this.$api.getFolders({path:"authors"})},async mounted(){},beforeDestroy(){},watch:{},computed:{available_keywords_except_active(){return this.available_keywords.filter(t=>this.keywords_filter.includes(t.title)?!1:this.kw_search?this.twoStringsSearch(t.title,this.kw_search):!0)},collapsable_keywords(){return this.show_all_keywords?this.available_keywords_except_active:this.available_keywords_except_active.slice(0,10)},can_be_reset(){return this.group_mode!=="year"||this.sort_order!=="date_modified"||this.search_str!==""||this.author_path_filter!==""||this.filetype_filter!=="all"||this.keywords_filter.length>0}},methods:{resetFilters(){this.$emit("update:group_mode","year"),this.$emit("update:sort_order","date_modified"),this.$emit("update:search_str",""),this.$emit("update:author_path_filter",""),this.$emit("update:filetype_filter","all"),this.$emit("update:keywords_filter",[])},filterByKeyword(s){let t=this.keywords_filter.slice();this.keywords_filter.includes(s)?t=t.filter(e=>e!==s):t.push(s),this.$emit("update:keywords_filter",t)},removeFilter(s){this.$nextTick(()=>{this.filterByKeyword(s)})},addFilter(s){this.$nextTick(()=>{this.kw_search="",this.filterByKeyword(s)})}}};var Mt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_filterBar"},[e("div",{staticClass:"_topBtn"},[e("div",{},[e("button",{staticClass:"u-buttonLink",class:{"is--active":t.show_filter_sort_pane},attrs:{type:"button"},on:{click:function(i){t.show_filter_sort_pane=!t.show_filter_sort_pane}}},[e("b-icon",{attrs:{icon:"filter"}}),t._v(" "+t._s(t.$t("filters"))+" ")],1)]),e("div",{staticClass:"_searchField"},[e("SearchInput2",{attrs:{value:t.search_str,search_placeholder:t.$t("search_fields")},on:{input:function(i){return t.$emit("update:search_str",i)}}})],1),e("div",{staticClass:"u-sameRow"},[e("div",[e("button",{staticClass:"u-button u-button_icon u-button_transparent",class:{"is--active":t.fav_filter===!0},attrs:{type:"button"},on:{click:function(i){return t.$emit("update:fav_filter",!t.fav_filter)}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("button",{staticClass:"u-button u-button_icon",class:{"is--active":t.view_mode==="list"},attrs:{type:"button"},on:{click:function(i){return t.$emit("update:view_mode","list")}}},[e("b-icon",{attrs:{icon:"grid3x3"}})],1),e("button",{staticClass:"u-button u-button_icon",class:{"is--active":t.view_mode==="map"},attrs:{type:"button"},on:{click:function(i){return t.$emit("update:view_mode","map")}}},[e("b-icon",{attrs:{icon:"map-fill"}})],1)])]),e("transition",{attrs:{name:"pagechange"}},[t.show_filter_sort_pane?e("div",{staticClass:"_filterPane"},[e("div",{staticClass:"_filterPane--row"},[e("select",{staticClass:"_selectField",domProps:{value:t.sort_order},on:{change:function(i){return t.$emit("update:sort_order",i.target.value)}}},[e("option",{attrs:{value:"date_modified"},domProps:{textContent:t._s(t.$t("date_modified"))}}),e("option",{attrs:{value:"date_created"},domProps:{textContent:t._s(t.$t("date_created"))}})]),e("select",{staticClass:"_selectField",domProps:{value:t.group_mode},on:{change:function(i){return t.$emit("update:group_mode",i.target.value)}}},t._l(t.group_options,function(i){return e("option",{key:i.key,domProps:{value:i.key,textContent:t._s(i.label)}})}),0),e("select",{staticClass:"_selectField",domProps:{value:t.author_path_filter},on:{change:function(i){return t.$emit("update:author_path_filter",i.target.value)}}},[e("option",{attrs:{value:""},domProps:{textContent:t._s(t.$t("none"))}}),t._l(t.all_authors,function(i){return e("option",{key:i.$path,domProps:{value:i.$path,textContent:t._s(i.name)}})})],2),e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.can_be_reset?e("button",{staticClass:"u-buttonLink _resetFilters",attrs:{type:"button"},on:{click:t.resetFilters}},[t._v(" "+t._s(t.$t("reset"))+" ")]):t._e()])],1),e("div",{staticClass:"_filterPane--row"},[e("div",{staticClass:"_tag"},[e("DLabel",{attrs:{str:t.$t("filter_by_keyword")}}),e("div",{staticClass:"_searchKW"},[e("SearchInput2",{attrs:{search_placeholder:t.$t("search")},model:{value:t.kw_search,callback:function(i){t.kw_search=i},expression:"kw_search"}})],1),t.keywords_filter.length>0?e("div",{staticClass:"u-keywords _usedKw"},t._l(t.keywords_filter,function(i){return e("SingleKeyword",{key:i,attrs:{keyword:i,can_remove:!0},on:{remove:function(a){return t.removeFilter(i)}}})}),1):t._e(),e("div",{staticClass:"u-keywords"},[t._l(t.collapsable_keywords,function(i){return e("SingleKeyword",{key:i.title,attrs:{keyword:i.title,count:i.count,can_add:!0},on:{add:function(a){return t.addFilter(i.title)}}})}),t.available_keywords_except_active.length>10?e("button",{staticClass:"u-buttonLink",class:{"is--active":t.show_all_keywords},attrs:{type:"button"},on:{click:function(i){t.show_all_keywords=!t.show_all_keywords}}},[t._v(" "+t._s(t.$t("show_all_keywords"))+" ")]):t._e()],2)],1)])]):t._e()])],1)},Dt=[],Lt=c(Ft,Mt,Dt,!1,null,"2e40d8e3");const Tt=Lt.exports,It={props:{stack:Object,is_selected:Boolean,is_favorite:Boolean,can_be_added_to_fav:Boolean},components:{},data(){return{start_slide:!1,stack_files:void 0,index_of_slide_file_to_show:void 0}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{number_of_medias_in_stack(){var s;return((s=this.stack.stack_files_metas)==null?void 0:s.length)||0},slide_file_to_show(){return this.stack_files&&this.index_of_slide_file_to_show!==void 0?this.stack_files[this.index_of_slide_file_to_show]:!1}},methods:{openStack(){const s=this.getFilename(this.stack.$path);this.$emit("openStack",s)},async startSlide(s){this.start_slide=!0,setTimeout(async()=>{if(this.start_slide){const t=await this.loadFiles();this.stack_files=t,this.updateMousePos(s)}},200)},updateMousePos(s){if(!this.stack_files)return;const{pageX:t}=s,{x:e,width:i}=this.$el.getBoundingClientRect(),a=(t-e)/i;this.index_of_slide_file_to_show=Math.floor(a*this.number_of_medias_in_stack)},endSlide(){this.start_slide=!1,this.stack_files=void 0,this.index_of_slide_file_to_show=void 0},async loadFiles(){const s=await this.$api.getFolder({path:this.stack.$path});return this.getStackFilesInOrder({stack:s})}}};var Ht=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_stackPreview",on:{mouseenter:t.startSlide,mousemove:t.updateMousePos,mouseleave:t.endSlide}},[e("button",{staticClass:"_stackPreview--content",class:{"is--slider":t.start_slide,"is--selected":t.is_selected},attrs:{type:"button"},on:{click:t.openStack}},[e("div",{staticClass:"_preview"},[e("div",{key:"preview",staticClass:"_mainPreview",class:{"is--showingSlides":t.slide_file_to_show}},[t.stack.$preview?e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:t.stack.$preview}}):e("b-icon",{attrs:{icon:"eye-slash"}})],1),t._l(t.stack_files,function(i){var a;return e("div",{key:i.$path,staticClass:"_slide",class:{"is--shown":i.$path===((a=t.slide_file_to_show)==null?void 0:a.$path)}},[e("MediaContent",{staticClass:"_mediaPreview",attrs:{file:i}})],1)}),e("transition-group",{staticClass:"_count",attrs:{name:"projectsList"}},[t.index_of_slide_file_to_show!==void 0?[e("div",{key:"slide"},[t._v(" "+t._s(t.index_of_slide_file_to_show+1)+" ")]),e("div",{key:"slash"},[t._v("/")])]:t._e(),e("div",{key:"preview"},[t._v(" "+t._s(t.number_of_medias_in_stack)+" ")])],2)],2),e("div",{staticClass:"_title"},[t._v(" "+t._s(t.stack.title)+" ")])]),e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.can_be_added_to_fav&&(t.is_favorite||t.start_slide)?e("div",[e("button",{staticClass:"u-button u-button_icon u-button_transparent _addToFav",attrs:{type:"button","data-isfav":t.is_favorite},on:{click:function(i){return i.stopPropagation(),t.$emit("toggleFav")}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M7.38174 1.75501C7.59507 1.19234 8.40241 1.19234 8.61641 1.75501L9.99641 5.57767C10.0931 5.83101 10.3391 5.99967 10.6137 5.99967H14.0051C14.6317 5.99967 14.9051 6.77967 14.4124 7.16167L11.9991 9.33301C11.891 9.41611 11.812 9.53132 11.7734 9.66211C11.7348 9.7929 11.7387 9.93255 11.7844 10.061L12.6657 13.7963C12.8804 14.3963 12.1857 14.9117 11.6604 14.5423L8.38241 12.4623C8.27015 12.3834 8.13628 12.3411 7.99907 12.3411C7.86187 12.3411 7.728 12.3834 7.61574 12.4623L4.33774 14.5423C3.81307 14.9117 3.11774 14.3957 3.33241 13.7963L4.21374 10.061C4.25946 9.93255 4.26331 9.7929 4.22475 9.66211C4.18618 9.53132 4.10718 9.41611 3.99907 9.33301L1.58574 7.16167C1.09241 6.77967 1.36707 5.99967 1.99241 5.99967H5.38374C5.51727 6.00012 5.64778 5.96001 5.75802 5.88466C5.86825 5.8093 5.95301 5.70225 6.00107 5.57767L7.38107 1.75501H7.38174Z","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):t._e()])],1)},Ot=[],Rt=c(It,Ht,Ot,!1,null,"0785e8a6");const Bt=Rt.exports,Et={props:{shared_folder_path:String},components:{FilterBar:Tt,StackPreview:Bt,AdminLumaSettings:w,StackDisplay:S,MediaMap:()=>p(()=>import("./MediaMap-AaL8issn.js"),[])},data(){return{all_stacks:[],is_loading_folder:!0,show_admin_settings:!1,last_selected_stack_path:void 0,view_mode:"list",sort_order:localStorage.getItem("archive.sort_order")||"date_modified",search_str:"",filetype_filter:"all",author_path_filter:"",keywords_filter:[],group_mode:"year",fav_filter:!1}},i18n:{messages:{fr:{only_my_fav:"Que les favoris"},en:{only_my_fav:"Favourites"}}},async created(){},async mounted(){this.all_stacks=await this.$api.getFolders({path:this.stack_shared_folder_path}),this.$api.join({room:this.stack_shared_folder_path}),this.is_loading_folder=!1},beforeDestroy(){this.$api.leave({room:this.stack_shared_folder_path})},watch:{opened_stack(){this.opened_stack&&(this.last_selected_stack_path=this.opened_stack.$path)},sort_order(){localStorage.setItem("archive.sort_order",this.sort_order)}},computed:{stack_shared_folder_path(){return this.shared_folder_path+"/stacks"},can_be_added_to_fav(){var s;return this.connected_as&&((s=this.connected_as)==null?void 0:s.$path)!==void 0},sorted_stacks(){return this.all_stacks.slice().sort((s,t)=>+new Date(t.$date_modified)-+new Date(s.$date_modified))},filtered_stacks(){return this.sorted_stacks.filter(s=>{var t;return this.fav_filter&&!this.isFavorite(s.$path)||this.author_path_filter&&!((t=s.$authors)!=null&&t.includes(this.author_path_filter))||this.keywords_filter.length>0&&(!s.keywords||!Array.isArray(s.keywords)||this.keywords_filter.some(e=>!s.keywords.includes(e)))?!1:this.search_str?!!(s.title&&s.title.toLowerCase().includes(this.search_str.toLowerCase())||s.description&&s.description.toLowerCase().includes(this.search_str.toLowerCase())):!0})},grouped_stacks(){let s=["$date_modified"];return this.sort_order==="date_created"?s=["date_created_corrected","$date_created","$date_uploaded"]:this.sort_order==="date_modified"&&(s=["$date_modified"]),this.groupFilesBy(this.filtered_stacks,s,this.group_mode)},available_keywords(){return this.filtered_stacks.reduce((t,e)=>(e.keywords&&Array.isArray(e.keywords)&&e.keywords.map(i=>{const a=t.find(n=>n.title===i);a?a.count+=1:t.push({title:i,count:1})}),t),[]).sort((t,e)=>e.count-t.count)},opened_stack(){var s;return(s=this.$route.query)!=null&&s.stack?this.all_stacks.find(t=>this.getFilename(t.$path)===this.$route.query.stack):!1}},methods:{toggleMediaFocus(s){const t=this.getFilename(s);this.openStack(t)},openStack(s){let t=Object.assign({},this.$route.query)||{};t.stack=s,this.$router.push({query:t})},isFavorite(s){var t;return!((t=this.connected_as)!=null&&t.favorites)||this.connected_as.favorites.length===0?!1:this.connected_as.favorites.some(e=>e.stack_path===s)},async toggleFav(s){var e;let t=(e=this.connected_as)!=null&&e.favorites?this.connected_as.favorites.slice():[];this.isFavorite(s)?t=t.filter(i=>i.stack_path!==s):t.push({stack_path:s,added:+new Date}),await this.$api.updateMeta({path:this.connected_as.$path,new_meta:{favorites:t}})},closeStack(){let s=Object.assign({},this.$route.query)||{};delete s.stack,this.$router.push({query:s})}}};var At=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_sharedFolder"},[e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.opened_stack?e("StackDisplay",{key:t.opened_stack.$path,staticClass:"_stackModal",attrs:{stack_path:t.opened_stack.$path,context:"archive",can_be_added_to_fav:t.can_be_added_to_fav,is_favorite:t.isFavorite(t.opened_stack.$path)},on:{toggleFav:function(i){return t.toggleFav(t.opened_stack.$path)},prevMedia:function(i){return t.navMedia(-1)},nextMedia:function(i){return t.navMedia(1)},close:t.closeStack}}):t._e()],1),e("div",{staticClass:"_sharedFolder--content"},[e("transition",{attrs:{name:"fade_fast",mode:"out-in"}},[t.is_loading_folder?e("div",{staticClass:"_loader"},[e("LoaderSpinner")],1):e("div",[e("FilterBar",{attrs:{group_mode:t.group_mode,sort_order:t.sort_order,search_str:t.search_str,filetype_filter:t.filetype_filter,author_path_filter:t.author_path_filter,available_keywords:t.available_keywords,keywords_filter:t.keywords_filter,fav_filter:t.fav_filter,view_mode:t.view_mode},on:{"update:group_mode":function(i){t.group_mode=i},"update:sort_order":function(i){t.sort_order=i},"update:search_str":function(i){t.search_str=i},"update:filetype_filter":function(i){t.filetype_filter=i},"update:author_path_filter":function(i){t.author_path_filter=i},"update:keywords_filter":function(i){t.keywords_filter=i},"update:fav_filter":function(i){t.fav_filter=i},"update:view_mode":function(i){t.view_mode=i}}}),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e("transition-group",{key:t.sort_order+"-"+t.group_mode,attrs:{tag:"div",name:"projectsList",appear:""}},[t.grouped_stacks.length===0?e("div",{key:"nocontent",staticClass:"u-instructions _noContent"},[t._v(" "+t._s(t.$t("no_content"))+" ")]):[t.view_mode==="list"?t._l(t.grouped_stacks,function({label:i,files:a}){return e("div",{key:i,staticClass:"_dayFileSection"},[e("div",{staticClass:"_label"},[t._v(" "+t._s(i)+" ")]),e("transition-group",{staticClass:"_itemGrid",attrs:{tag:"div",name:"listComplete",appear:""}},t._l(a,function(n){return e("StackPreview",{key:n.$path,attrs:{stack:n,is_selected:n.$path===t.last_selected_stack_path,can_be_added_to_fav:t.can_be_added_to_fav,is_favorite:t.isFavorite(n.$path)},on:{toggleFav:function(o){return t.toggleFav(n.$path)},openStack:t.openStack}})}),1)],1)}):t.view_mode==="map"?e("div",{key:"mediaMap",staticClass:"_mediamapContainer"},[e("MediaMap",{attrs:{medias:t.filtered_stacks},on:{toggleMediaFocus:t.toggleMediaFocus}})],1):t._e()]],2)],1)],1)]),e("footer",{staticClass:"_footer"},[e("small",[e("a",{attrs:{href:"mailto:"+t.$root.app_infos.instance_meta.contactmail,target:"_blank"}},[t._v(" "+t._s(t.$t("help_contact"))+" ")]),e("br"),t._v(" "+t._s(t.$t("version"))+" "+t._s(t.$root.app_infos.version)+" "),t.is_instance_admin?e("button",{staticClass:"u-buttonLink _adminBtn",attrs:{type:"button"},on:{click:function(i){t.show_admin_settings=!0}}},[t._v(" "+t._s(t.$t("admin_settings"))+" ")]):t._e(),t.show_admin_settings?e("AdminLumaSettings",{on:{close:function(i){t.show_admin_settings=!1}}}):t._e()],1)])],1)],1)},qt=[],Vt=c(Et,At,qt,!1,null,"c2df2ba7");const Nt=Vt.exports,Zt={props:{modal_name:String,path:String,default_folder_status:{type:String,default:"public"}},components:{},data(){return{new_folder_title:"",new_folder_is_private:!1,new_folder_template:"story_with_sections",available_templates:[{value:"story_with_sections",label:this.$t("story_with_sections")},{value:"agora",label:this.$t("agora")}],is_creating_folder:!1,allow_save:!1,error_msg:""}},created(){},mounted(){},i18n:{messages:{fr:{agora:"Agora"},en:{agora:"Agora"}}},beforeDestroy(){},watch:{},computed:{},methods:{async createFolder(){this.is_creating_folder=!0;const s=this.setDefaultContentAdmins();this.new_folder_title=this.cleanUpString(this.new_folder_title);let t={title:this.new_folder_title,template:this.new_folder_template,requested_slug:this.new_folder_title,$status:this.new_folder_is_private===!0?"private":this.default_folder_status,$admins:s};this.new_folder_template==="agora"&&(t.autoscroll=!0);try{const e=await this.$api.createFolder({path:this.path,additional_meta:t});setTimeout(()=>{this.$emit("openNew",e)},50)}catch({code:e}){e==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):e==="token_not_allowed_must_be_contributors"?this.$alertify.delay(4e3).error(this.$t("action_not_allowed")):this.$alertify.delay(4e3).error(e),this.is_creating_folder=!1}}}};var jt=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.modal_name},on:{close:function(i){return t.$emit("close")}}},[e("form",{staticClass:"input-validation-required",on:{submit:function(i){return i.preventDefault(),t.createFolder.apply(null,arguments)}}},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_folder_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(i){t.new_folder_title=i},toggleValidity:i=>t.allow_save=i,onEnter:t.createFolder}}),e("br"),e("div",{},[e("ToggleInput",{attrs:{content:t.new_folder_is_private,label:t.$t("private"),options:{true:t.$t("private_status_explanations"),false:t.$t("public_status_explanations")}},on:{"update:content":function(i){t.new_folder_is_private=i}}})],1),e("br"),e("div",{},[e("DLabel",{attrs:{str:t.$t("template")}}),e("select",{directives:[{name:"model",rawName:"v-model",value:t.new_folder_template,expression:"new_folder_template"}],on:{change:function(i){var a=Array.prototype.filter.call(i.target.options,function(n){return n.selected}).map(function(n){var o="_value"in n?n._value:n.value;return o});t.new_folder_template=i.target.multiple?a:a[0]}}},t._l(t.available_templates,function(i){return e("option",{key:i.value,domProps:{value:i.value}},[t._v(" "+t._s(i.label)+" ")])}),0)],1),e("br"),e("div",{staticClass:"u-sameRow",attrs:{slot:"footer"},slot:"footer"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[t._v(" "+t._s(t.$t("cancel"))+" ")]),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{slot:"footer",type:"submit",loading:t.is_creating_folder},slot:"footer"},[t._v(" "+t._s(t.$t("create_and_open"))+" ")])]),t.error_msg?[e("br"),e("br"),e("div",{staticClass:"u-errorMsg",domProps:{textContent:t._s(t.error_msg)}})]:t._e()],2)])},Ut=[],Kt=c(Zt,jt,Ut,!1,null,"61e6051c");const Wt=Kt.exports,Jt={props:{},components:{SearchInput2:$,CreateCollection:Wt},data(){return{show_create_collection:!1,collections:[],path:"collections",search_coll_name:""}},i18n:{messages:{fr:{collections:"Collections",create_a_collection:"Créer une collection",search_in_titles:"Rechercher dans les titres",collection_instr:"Les collections regroupent des médias dans l’espace partagé pour les partager."},en:{collections:"Collections",create_a_collection:"Create a collection",search_in_titles:"Search in titles",collection_instr:"Collections group multiple medias"}}},async created(){this.collections=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.stack})},sorted_collections(){return this.collections.slice().filter(s=>this.canLoggedinSeeFolder({folder:s})).sort((s,t)=>s.title.localeCompare(t.title))},filtered_collections(){return this.sorted_collections.filter(s=>this.search_coll_name?this.twoStringsSearch(s.title,this.search_coll_name):!0)}},methods:{openNewCollection(s){this.show_create_collection=!1,this.$emit("open",s)}}};var Qt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_collectionsList"},[e("div",{staticClass:"u-spacingBottom u-instructions"},[t._v(" "+t._s(t.$t("collection_instr"))+" ")]),e("div",{staticClass:"u-spacingBottom"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(i){t.show_create_collection=!0}}},[e("b-icon",{attrs:{icon:"plus-circle"}}),t._v("  "+t._s(t.$t("create_a_collection"))+" ")],1),t.show_create_collection?e("CreateCollection",{attrs:{modal_name:t.$t("create_a_collection"),path:"collections",default_folder_status:"private"},on:{close:function(i){t.show_create_collection=!1},openNew:t.openNewCollection}}):t._e()],1),e("div",{staticClass:"u-spacingBottom"},[e("SearchInput2",{attrs:{search_placeholder:t.$t("search_in_titles")},model:{value:t.search_coll_name,callback:function(i){t.search_coll_name=i},expression:"search_coll_name"}})],1),e("table",{staticClass:"u-spacingBottom _list"},[e("transition-group",{attrs:{tag:"tbody",name:"projectsList",appear:""}},t._l(t.filtered_collections,function(i){return e("tr",{key:i.$path,on:{click:function(a){t.$emit("open",t.getFilename(i.$path))}}},[e("td",[e("strong",[t._v(t._s(i.title))]),t._v(" – "),e("i",[t._v(t._s(t.$t(i.template||"story_with_sections").toLowerCase()))])]),e("td",[e("div",{staticClass:"u-sameRow"},t._l(i.$admins,function(a,n){return e("AuthorTag",{key:a+"_"+n,attrs:{path:a,show_image_only:!0}})}),1)])])}),0)],1)])},Xt=[],Gt=c(Jt,Qt,Xt,!1,null,"b53ae7c3");const Yt=Gt.exports,te={props:{pane_infos:Object},components:{StorySectionTemplate:()=>p(()=>import("./StorySectionTemplate-BNmsIaij.js"),[]),AgoraTemplate:()=>p(()=>import("./AgoraTemplate-DXIs39f2.js"),[])},data(){return{is_loading:!0,collection:void 0,path:"collections/"+this.pane_infos.opened_collection_slug,fetch_coll_error_message:"",show_qr_code_modal:!1}},i18n:{messages:{fr:{make_public:"Accès public (sans mot de passe ou compte)"},en:{make_public:"Allow access to everyone (without password or account)"}}},async created(){const s=await this.$api.getFolder({path:this.path}).catch(t=>{t.code==="folder_private"?this.fetch_coll_error_message=this.$t("coll_is_private"):this.fetch_coll_error_message=t.code,this.is_loading=!1});this.collection=s,this.is_loading=!1,this.$api.join({room:this.path}),this.$eventHub.$on("collection.addStack",this.addToStack)},mounted(){},beforeDestroy(){this.$api.leave({room:this.path}),this.$eventHub.$off("collection.addStack",this.addToStack)},watch:{},computed:{can_edit(){return this.canLoggedinEditFolder({folder:this.collection})},share_url(){let s={};this.collection.template==="story_with_sections"&&(s={display:"section"}),this.collection.template==="agora"&&this.collection.autoscroll===!0&&(s={scroll:"auto"});const t=this.$router.resolve({path:this.createURLFromPath(this.collection.$path),query:s});return window.location.origin+t.href}},methods:{addToStack(){},async removeCollection(){await this.$api.deleteItem({path:this.collection.$path}),this.$emit("close")}}};var ee=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openedCollection"},[e("transition",{attrs:{name:"slideup",mode:"out-in"}},[t.is_loading?e("div",{key:"loader"},[e("div",{staticClass:"_spinner"},[e("LoaderSpinner")],1)]):t.fetch_coll_error_message?e("div",{key:"err",staticClass:"_error"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),e("div",{},[t._v(" "+t._s(t.fetch_coll_error_message)+" ")])]):e("div",{key:t.collection.$path},[e("div",{staticClass:"_titleBar"},[e("TitleField",{attrs:{field_name:"title",content:t.collection.title,path:t.collection.$path,tag:"h1",required:!0,can_edit:t.can_edit}})],1),e("div",{staticClass:"_topbar"},[e("div",{},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1)]),e("AuthorField",{staticClass:"_admins",attrs:{label:t.$t("admins"),instructions:t.$t("media_editing_instructions"),field:"$admins",authors_paths:t.collection.$admins,path:t.collection.$path,can_edit:t.can_edit,show_image_only:!0}}),t.can_edit?e("StatusTag",{attrs:{status:t.collection.$status||"public",status_options:["public","private"],path:t.collection.$path,can_edit:t.can_edit}}):t._e(),t.can_edit?e("DropDown",[t.can_edit?e("RemoveMenu",{attrs:{remove_text:t.$t("remove")},on:{remove:t.removeCollection}}):t._e(),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){t.show_qr_code_modal=!0}}},[e("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[e("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[e("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),e("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),e("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),e("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),e("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])]),t._v(" "+t._s(t.$t("direct_link"))+" ")])],1):t._e(),t.show_qr_code_modal?e("QRModal",{attrs:{url_to_access:t.share_url},on:{close:function(i){t.show_qr_code_modal=!1}}},[e("ToggleField",{attrs:{label:t.$t("make_public"),field_name:"$public",content:t.collection.$public===!0,path:t.collection.$path,can_edit:t.can_edit}})],1):t._e()],1),e("div",{staticClass:"_cont"},[!t.collection.template||t.collection.template==="story_with_sections"?e("StorySectionTemplate",{attrs:{publication:t.collection,pane_infos:t.pane_infos,can_edit:t.can_edit},on:{updatePane:function(i){return t.$emit("updatePane",i)}}}):t.collection.template==="agora"?e("AgoraTemplate",{attrs:{publication:t.collection,can_edit:t.can_edit}}):t._e()],1)])])],1)},se=[],ie=c(te,ee,se,!1,null,"3ae679d4");const ae=ie.exports,ne={props:{},components:{CollectionsList:Yt,OpenedCollection:ae},data(){return{}},i18n:{messages:{fr:{}}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{pane_infos(){var t,e;let s={};return(t=this.$route.query)!=null&&t.collection&&(s.opened_collection_slug=this.$route.query.collection),(e=this.$route.query)!=null&&e.section&&(s.section=this.$route.query.section),s}},methods:{openCollection(s){this.updateCollectionQuery(s)},closeCollection(){this.updateCollectionQuery(!1)},updatePane({key:s,value:t}){this.updatePageQuery({prop:s,val:t})},async updateCollectionQuery(s){this.updatePageQuery({prop:"collection",val:s})}}};var oe=function(){var i;var t=this,e=t._self._c;return e("div",{staticClass:"_collections"},[e("CollectionsList",{on:{open:t.openCollection}}),(i=t.pane_infos)!=null&&i.opened_collection_slug?e("OpenedCollection",{attrs:{pane_infos:t.pane_infos},on:{updatePane:t.updatePane,close:t.closeCollection}}):t._e()],1)},re=[],le=c(ne,oe,re,!1,null,"6dbbe7c4");const ce=le.exports,_e={props:{},components:{Splitpanes:N,Pane:J,MyChutier:zt,SharedFolder2:Nt,CollectionsPane:ce},data(){return{path:"folders",folders:void 0,shared_folder_path:void 0,possible_panes:[{key:"chutier",label:"CHUTIER",icon:"layout-sidebar-inset"},{key:"archive",label:"ARCHIVE",icon:"grid3x3-gap"},{key:"collection",label:"COLLECTION",icon:"layout-sidebar-inset-reverse"}],top_panes_width:{chutier:33,archive:33,collection:33},panes_width:{chutier:33,archive:33,collection:33},show_chutier:!0}},async created(){const s=this.loadPanesWidthFromStorage();if(s)this.panes_width=s;else if(this.$root.is_mobile_view)this.panes_width.chutier=100,this.panes_width.archive=0,this.panes_width.collection=0;else{const t=Math.min(400/this.$root.window.innerWidth*100,50);this.panes_width.chutier=t,this.panes_width.archive=100-t,this.panes_width.collection=0}await this.loadFolder()},async mounted(){},beforeDestroy(){},watch:{connected_as(){},show_chutier(){},panes_width:{handler(){Object.entries(this.panes_width).map(([s,t])=>this.top_panes_width[s]=t),this.savePanesWidthToStorage()},deep:!0}},computed:{min_toppane_width(){return 0}},methods:{async loadFolder(){await this.$api.getFolders({path:"authors"}),this.folders=await this.$api.getFolders({path:this.path}).catch(s=>{this.fetch_spaces_error=s.response}),this.folders.length===0?(await this.createFolder(),window.location.reload()):this.shared_folder_path=this.folders[0].$path},async createFolder(){try{return await this.$api.createFolder({path:this.path,additional_meta:{title:"default",$admins:"everyone"}})}catch{}},resizeTopPane(s){s.map((t,e)=>{const i=Number(t.size.toFixed(1));e===0&&(this.top_panes_width.chutier=i),e===1&&(this.top_panes_width.archive=i),e===2&&(this.top_panes_width.collection=i)})},resizedPane(s){s.map((t,e)=>{const i=Number(t.size.toFixed(1));e===0&&(this.panes_width.chutier=i),e===1&&(this.panes_width.archive=i),e===2&&(this.panes_width.collection=i)})},setTopbarWidth(s){return`
        --topPane-width: ${this.top_panes_width[s]}%;
      `},togglePane(s){this.panes_width[s]>0?this.panes_width[s]=0:this.panes_width[s]=25,this.distributePanes()},distributePanes(){const s=Object.values(this.panes_width).filter(t=>t>0).length;if(s===0)Object.keys(this.panes_width).map(t=>this.panes_width[t]=100/Object.keys(this.panes_width).length);else{const t=100/s;Object.entries(this.panes_width).map(([e,i])=>i>0?this.panes_width[e]=t:"")}},savePanesWidthToStorage(){localStorage.setItem("panes_width",JSON.stringify(this.panes_width))},loadPanesWidthFromStorage(){try{const s=localStorage.getItem("panes_width");if(s){const t=JSON.parse(s);return t.format&&delete t.format,t}}catch{}return!1}}};var de=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_lumaView"},[t.shared_folder_path?[e("div",{staticClass:"_topBarIndication"},t._l(t.possible_panes,function(i){return e("div",{key:i.key,staticClass:"_topBarIndication--item",style:t.setTopbarWidth(i.key),on:{click:function(a){return t.togglePane(i.key)}}},[e("span",{staticClass:"_topBarIndication--item--names"},[e("b-icon",{attrs:{icon:i.icon}}),t._v(" "+t._s(i.label)+" ")],1)])}),0),e("splitpanes",{staticClass:"_splitpanes",attrs:{"watch-slots":""},on:{resize:t.resizeTopPane,resized:t.resizedPane}},t._l(["chutier","archive","collection"],function(i){return e("pane",{key:i,attrs:{size:t.panes_width[i]}},[i==="chutier"?e("div",{staticClass:"_myContent"},[e("MyChutier",{directives:[{name:"show",rawName:"v-show",value:t.show_chutier,expression:"show_chutier"}],staticClass:"_myContent--chutier",attrs:{shared_folder_path:t.shared_folder_path},on:{close:function(a){t.show_chutier=!1}}})],1):i==="archive"?e("div",{staticClass:"_sharedContent"},[e("SharedFolder2",{attrs:{shared_folder_path:t.shared_folder_path}})],1):i==="collection"?e("CollectionsPane"):t._e()],1)}),1)]:e("LoaderSpinner")],2)},he=[],ue=c(_e,de,he,!1,null,"87bc386f");const we=ue.exports;export{we as default};
