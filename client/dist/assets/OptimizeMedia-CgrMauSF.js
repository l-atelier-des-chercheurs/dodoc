import{n as o}from"../build.js";const r={props:{media:Object,extract_selection:Boolean,selection_start:Number,selection_end:Number},components:{},data(){var i;return{current_time:0,is_playing_extract:!1,show_extract_selection:this.extract_selection,media_duration:((i=this.media.$infos)==null?void 0:i.duration)||void 0}},created(){},mounted(){this.$refs.plyr.player.on("timeupdate",i=>{this.timeUpdate(i)})},beforeDestroy(){},watch:{selection_start:function(i){this.$refs.plyr.player.currentTime=i,this.$refs.plyr.player.pause()},selection_end:function(i){this.$refs.plyr.player.currentTime=i,this.$refs.plyr.player.pause()},show_extract_selection:function(i){this.$emit("update:extract_selection",i)},current_time:function(i){this.is_playing_extract&&this.current_time>this.selection_end&&(this.is_playing_extract=!1,this.$refs.plyr.player.currentTime=this.selection_end,this.$refs.plyr.player.pause())}},computed:{media_full_path(){return this.makeMediaFilePath({$path:this.media.$path,$media_filename:this.media.$media_filename,with_timestamp:!0,$date_created:this.media.$date_created})},current_time_displayed(){return parseFloat(this.current_time.toFixed(1)).toLocaleString(this.$i18n.locale)}},methods:{setStartOrEnd({new_start:i,new_end:t}){let e=typeof i<"u"?i:this.selection_start,s=typeof t<"u"?t:this.selection_end;e=this.roundToDec(e,1),e=Math.max(0,e),this.$emit("update:selection_start",e),s=this.roundToDec(s,1),this.media_duration&&(s=Math.min(s,this.media_duration)),this.$emit("update:selection_end",s)},timeUpdate(i){this.current_time=this.roundToDec(i.detail.plyr.media.currentTime,1)},playExtract(){this.is_playing_extract=!0,this.$refs.plyr.player.currentTime=this.selection_start,this.$refs.plyr.player.play()},stopExtract(){this.is_playing_extract=!1,this.$refs.plyr.player.pause()}}};var d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_trimMedia"},[e("vue-plyr",{ref:"plyr"},[t.media.$type==="video"?e("video",{attrs:{src:t.media_full_path}}):t.media.$type==="audio"?e("audio",{attrs:{src:t.media_full_path}}):t._e()]),e("div",{staticClass:"u-spacingBottom"}),e("ToggledSection",{attrs:{label:t.$t("extract_range"),show_toggle:t.show_extract_selection},on:{"update:show_toggle":function(s){t.show_extract_selection=s}}},[e("div",{staticClass:"_currentTime"},[t._v(t._s(t.current_time_displayed)+" s")]),e("div",{staticClass:"_startEndBlock"},[e("div",{key:t.selection_start,staticClass:"_startEndBlock--b"},[e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button",disabled:t.current_time===t.selection_start},on:{click:function(s){return t.setStartOrEnd({new_start:t.current_time})}}},[e("b-icon",{attrs:{icon:"chevron-bar-left"}}),t._v(" "+t._s(t.$t("set_start"))+" ")],1),e("NumberInput",{attrs:{value:t.selection_start,suffix:t.$t("seconds"),size:"medium",min:0},on:{save:function(s){return t.setStartOrEnd({new_start:s})}}}),e("div",{staticClass:"u-sameRow"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button",disabled:t.selection_start===0},on:{click:function(s){return t.setStartOrEnd({new_start:0})}}},[e("b-icon",{attrs:{icon:"chevron-double-left"}})],1),e("button",{staticClass:"u-buttonLink",attrs:{type:"button",disabled:t.selection_start<=0},on:{click:function(s){return t.setStartOrEnd({new_start:t.selection_start-.1})}}},[t._v(" -0.1s ")]),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){return t.setStartOrEnd({new_start:t.selection_start+.1})}}},[t._v(" +0.1s ")])])],1),e("b-icon",{staticClass:"_arrowIcon",attrs:{icon:"arrow-right-circle-fill"}}),e("div",{staticClass:"_startEndBlock--b"},[e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button",disabled:t.current_time===t.selection_end},on:{click:function(s){return t.setStartOrEnd({new_end:t.current_time})}}},[t._v(" "+t._s(t.$t("set_end"))+" "),e("b-icon",{attrs:{icon:"chevron-bar-right"}})],1),e("NumberInput",{attrs:{value:t.selection_end,suffix:t.$t("seconds"),size:"medium",min:0},on:{save:function(s){return t.setStartOrEnd({new_end:s})}}}),e("div",{staticClass:"u-sameRow"},[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){return t.setStartOrEnd({new_end:t.selection_end-.1})}}},[t._v(" -0.1s ")]),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(s){return t.setStartOrEnd({new_end:t.selection_end+.1})}}},[t._v(" +0.1s ")]),e("button",{staticClass:"u-buttonLink",attrs:{type:"button",disabled:t.selection_end===t.media_duration||!t.media_duration},on:{click:function(s){return t.setStartOrEnd({new_end:t.media_duration})}}},[e("b-icon",{attrs:{icon:"chevron-double-right"}})],1)])],1)],1),e("div",{staticClass:"_playExtract"},[t.is_playing_extract?e("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:t.stopExtract}},[e("b-icon",{attrs:{icon:"stop-circle"}}),t._v(" "+t._s(t.$t("stop_extract"))+" ")],1):e("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:t.playExtract}},[e("b-icon",{attrs:{icon:"play-circle-fill"}}),t._v(" "+t._s(t.$t("play_extract"))+" ")],1)])])],1)},_=[],u=o(r,d,_,!1,null,"67d24cb7");const l=u.exports,c={props:{media_type:String,media_width:Number,media_height:Number,image_width:Number,image_height:Number,video_bitrate:[Number,String],audio_bitrate:[Number,String]},components:{},data(){return{image_quality_picked:void 0,audio_quality_picked:void 0,custom_resolution_width:this.media_width,custom_resolution_height:this.media_height,enable_image:!0,enable_audio:!0}},created(){},mounted(){this.updateImagePreset("source"),this.updateAudioQuality("source")},beforeDestroy(){},watch:{enable_image(i){i?this.updateImagePreset("source"):this.$emit("update:video_bitrate","no_video")},enable_audio(i){i?this.updateAudioQuality("source"):this.$emit("update:audio_bitrate","no_audio")},custom_resolution_width(i){this.$emit("update:image_width",i)},custom_resolution_height(i){this.$emit("update:image_height",i)}},computed:{image_quality_presets(){let i=[];return this.media_type==="video"&&(i.push({key:"source",text:this.$t("close_to_source"),width:this.media_width||void 0,height:this.media_height||void 0,bitrate:4e3}),i.push({key:"high",text:this.$t("high"),width:1920,height:1080,bitrate:4e3}),i.push({key:"medium",text:this.$t("medium"),width:1280,height:720,bitrate:2e3}),i.push({key:"rough",text:this.$t("rough"),width:640,height:360,bitrate:1e3}),i.push({key:"custom",text:"↓ "+this.$t("custom_f")})),this.media_type==="image"&&i.push({key:"source",text:this.$t("close_to_source"),width:this.media_width||void 0,height:this.media_height||void 0},{key:"high",text:this.$t("high"),width:1920},{key:"medium",text:this.$t("medium"),width:1280},{key:"custom",text:"↓ "+this.$t("custom_f")}),i.map(t=>this.makeInstructions(t))},audio_quality_options(){return[{key:"source",text:this.$t("very_high"),bitrate:256},{key:"high",text:this.$t("high"),bitrate:192},{key:"medium",text:this.$t("medium"),bitrate:128},{key:"custom",text:"↓ "+this.$t("custom_f")}].map(t=>this.makeInstructions(t))},media_ratio(){return this.media_height/this.media_width}},methods:{updateImagePreset(i){if(this.image_quality_picked=i,i==="custom"){this.$emit("update:image_width",this.custom_resolution_width),this.$emit("update:image_height",this.custom_resolution_height),this.$emit("update:video_bitrate",this.video_bitrate);return}const t=this.image_quality_presets.find(n=>n.key===i);if(!t)return;const{width:e,height:s,bitrate:a}=t;this.$emit("update:image_width",e),this.$emit("update:image_height",s),this.$emit("update:video_bitrate",a)},updateAudioQuality(i){if(this.audio_quality_picked=i,i==="custom"){this.$emit("update:audio_bitrate",this.audio_bitrate);return}const{bitrate:t}=this.audio_quality_options.find(e=>e.key===i);this.$emit("update:audio_bitrate",t)},makeInstructions(i){if(i.key!=="custom"){let t=[];i.width&&i.height?t.push(this.$t("resolution_w_h",{width:i.width,height:i.height})):i.width&&!i.height&&t.push(this.$t("resolution_on_largest_side",{resolution:i.width})),i.bitrate&&t.push(this.$t("bitrate_kbps",{bitrate:i.bitrate}).toLowerCase()),i.instructions=t.join(", ")}return i}}};var m=function(){var t=this,e=t._self._c;return e("div",[["image","video"].includes(t.media_type)?[e("ToggledSection",{attrs:{label:t.media_type==="video"?t.$t("enable_image"):void 0,show_toggle:t.enable_image,can_toggle:t.media_type==="video"},on:{"update:show_toggle":function(s){t.enable_image=s}}},[t.media_width||t.media_height?e("ResolutionDisplay",{attrs:{label:t.$t("current_resolution"),width:t.media_width,height:t.media_height}}):t._e(),e("DLabel",{attrs:{str:t.$t("image_quality")}}),e("div",{},[e("SelectField2",{attrs:{value:t.image_quality_picked,options:t.image_quality_presets,can_edit:!0,hide_validation:!0},on:{change:t.updateImagePreset}})],1),t.image_quality_picked==="custom"?e("div",[e("div",{staticClass:"u-spacingBottom"}),e("CustomResolutionInput",{attrs:{width:t.custom_resolution_width,height:t.custom_resolution_height,ratio:t.media_ratio,is_video:t.media_type==="video"},on:{"update:width":function(s){t.custom_resolution_width=s},"update:height":function(s){t.custom_resolution_height=s}}}),e("div",{staticClass:"u-spacingBottom"}),t.media_type==="video"&&t.video_bitrate!=="no_video"?e("NumberInput",{attrs:{label:t.$t("bitrate"),instructions:t.$t("bitrate_instructions"),value:t.video_bitrate,min:0,suffix:"kbps",size:"normal"},on:{"update:value":function(s){return t.$emit("update:video_bitrate",s)}}}):t._e()],1):t._e()],1),e("div",{staticClass:"u-spacingBottom"})]:t._e(),["video","audio"].includes(t.media_type)?e("div",{},[e("ToggledSection",{attrs:{label:t.media_type==="video"?t.$t("enable_sound"):void 0,show_toggle:t.enable_audio,can_toggle:t.media_type==="video"},on:{"update:show_toggle":function(s){t.enable_audio=s}}},[e("DLabel",{attrs:{str:t.$t("audio_quality")}}),e("SelectField2",{attrs:{value:t.audio_quality_picked,options:t.audio_quality_options,can_edit:!0,hide_validation:!0},on:{change:t.updateAudioQuality}}),t.audio_quality_picked==="custom"?e("NumberInput",{attrs:{label:t.$t("bitrate"),value:t.audio_bitrate,min:0,max:320,suffix:"kbps",size:"normal"},on:{"update:value":function(s){return t.$emit("update:audio_bitrate",s)}}}):t._e()],1)],1):t._e()],2)},h=[],p=o(c,m,h,!1,null,"516a2de2");const f=p.exports,g={props:{original_file:Object,optimized_file:Object},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var b=function(){var s,a;var t=this,e=t._self._c;return e("div",{staticClass:"_fileInfos"},[e("div",[e("DLabel",{attrs:{str:t.$t("size")}}),e("div",{staticClass:"_comp"},[e("span",[t.original_file.$infos&&t.original_file.$infos.size?[t._v(" "+t._s(t.formatBytes(t.original_file.$infos.size))+" ")]:[t._v(" ? ")]],2),e("b-icon",{attrs:{icon:"arrow-right-circle"}}),e("strong",[t.optimized_file.$infos&&t.optimized_file.$infos.size?[t._v(" "+t._s(t.formatBytes(t.optimized_file.$infos.size))+" ")]:[t._v(" ? ")]],2)],1)],1),t.optimized_file.$type==="image"||t.optimized_file.$type==="video"?e("div",[e("DLabel",{attrs:{str:t.$t("resolution")}}),e("div",{staticClass:"_comp"},[e("span",[t.original_file.$infos&&t.original_file.$infos.width&&t.original_file.$infos.height?[t._v(" "+t._s(t.original_file.$infos.width+" × "+t.original_file.$infos.height)+" ")]:[t._v(" ? ")]],2),e("b-icon",{attrs:{icon:"arrow-right-circle"}}),e("strong",[t.optimized_file.$infos&&t.optimized_file.$infos.width&&t.optimized_file.$infos.height?[t._v(" "+t._s(t.optimized_file.$infos.width+" × "+t.optimized_file.$infos.height)+" ")]:[t._v(" ? ")]],2)],1)],1):t._e(),(s=t.optimized_file.$infos)!=null&&s.duration?e("div",[e("DLabel",{attrs:{str:t.$t("duration")}}),e("div",{staticClass:"_comp"},[e("span",[(a=t.original_file.$infos)!=null&&a.duration?[t._v(" "+t._s(t.formatDurationToHoursMinutesSecondsDeciseconds(t.original_file.$infos.duration))+" ")]:[t._v(" ? ")]],2),e("b-icon",{attrs:{icon:"arrow-right-circle"}}),e("strong",[t._v(" "+t._s(t.formatDurationToHoursMinutesSecondsDeciseconds(t.optimized_file.$infos.duration))+" ")])],1)],1):t._e(),e("div",[e("DLabel",{attrs:{str:t.$t("filename")}}),e("div",{staticClass:"_comp"},[e("span",[t._v(" "+t._s(t.original_file.$media_filename)+" ")]),e("b-icon",{attrs:{icon:"arrow-right-circle"}}),e("strong",[t._v(" "+t._s(t.optimized_file.$media_filename)+" ")])],1)],1)])},$=[],v=o(g,b,$,!1,null,"7816136e");const y=v.exports,w={props:{media:Object,instructions:Object},components:{ShowOptimizedFileInfos:y},data(){return{is_optimizing:!1,optimized_file:void 0,task_progress:0,fail_message:void 0}},async created(){this.is_optimizing=!0,await this.startOptimization()},async mounted(){},beforeDestroy(){},watch:{},computed:{modal_size(){return this.is_optimizing?"small":"large"}},methods:{async startOptimization(){const i=await this.$api.optimizeFile({path:this.media.$path,instructions:this.instructions});this.$api.join({room:"task_"+i}),this.$alertify.delay(4e3).log(this.$t("optimization_started"));const t=({task_id:s,progress:a})=>{s===i&&(this.task_progress=a)};this.$eventHub.$on("task.status",t);const e=({task_id:s,event:a,message:n})=>{s===i&&(this.$eventHub.$off("task.ended",e),this.$api.leave({room:"task_"+i}),a==="completed"?this.optimized_file=n.file:a==="aborted"?this.fail_message=this.$t("optimization_aborted"):a==="failed"&&(this.fail_message=this.$t("optimization_failed")+" : "+n.info),this.is_optimizing=!1)};this.$eventHub.$on("task.ended",e)},async keepBoth(){this.$emit("close")},async replaceOriginal(){const i=JSON.parse(JSON.stringify(this.media)),t=JSON.parse(JSON.stringify(this.optimized_file));await this.$api.updateMeta({path:this.media.$path,new_meta:{$media_filename:t.$media_filename,$type:t.$type,$optimized:!0}}),await this.$api.updateMeta({path:i.$path,new_meta:{$media_filename:i.$media_filename}}),await this.$api.deleteItem({path:i.$path}),this.optimized_file=void 0,this.$emit("close")},removeAndCloseModal(){this.optimized_file&&this.$api.deleteItem({path:this.optimized_file.$path}),this.$emit("close")}}};var z=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{size:t.modal_size},on:{close:t.removeAndCloseModal}},[t.is_optimizing?[e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.$t("optimization_in_progress"))+" ")]),e("div",[e("div"),e("div",[e("AnimatedCounter",{attrs:{value:t.task_progress}})],1)])]:[t.fail_message?[e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.fail_message)+" ")])]:t._e(),t.optimized_file?[e("div",{staticClass:"_mediaPreview",attrs:{"data-type":t.optimized_file.$type}},[e("MediaContent",{attrs:{file:t.optimized_file,resolution:1600,context:"full",zoom_on_click:!0,show_fs_button:!0}})],1),e("div",{staticClass:"u-spacingBottom"}),e("ShowOptimizedFileInfos",{attrs:{original_file:t.media,optimized_file:t.optimized_file}})]:t._e(),e("template",{slot:"footer"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:t.removeAndCloseModal}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),t.optimized_file?[e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.keepBoth}},[e("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("save_as_new_media"))+" ")],1),e("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:t.replaceOriginal}},[e("b-icon",{attrs:{icon:"save2-fill"}}),t._v(" "+t._s(t.$t("replace_original"))+" ")],1),e("DownloadFile",{attrs:{file:t.optimized_file}})]:t._e()],2)]],2)},k=[],x=o(w,z,k,!1,null,"69b86f7a");const C=x.exports,O={props:{media:Object},components:{TrimMedia:l,VideoAudioImageQualityPicker:f,OptimizeMediaModal:C},data(){var i,t,e;return{show_optimization_modal:!1,extract_selection:!1,selection_start:0,selection_end:((i=this.media.$infos)==null?void 0:i.duration)||0,image_width:(t=this.media.$infos)==null?void 0:t.width,image_height:(e=this.media.$infos)==null?void 0:e.height,video_bitrate:4e3,audio_bitrate:256}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{label(){return["video","audio"].includes(this.media.$type)?this.$t("convert_shorten"):this.$t("optimize_resize")},instructions(){return["video","audio"].includes(this.media.$type)?this.$t("convert_shorten_instructions"):this.media.$type==="image"?this.$t("optimize_resize_instructions"):this.$t("convert_instructions")},optimization_strongly_recommended(){return this.fileShouldBeOptimized({filename:this.media.$media_filename})},modal_width(){if(this.extract_selection)return"large"},media_width(){var i;return(i=this.media.$infos)==null?void 0:i.width},media_height(){var i;return(i=this.media.$infos)==null?void 0:i.height},base_instructions(){let i="converted";this.media.$media_filename&&(i=this.getFilenameWithoutExt(this.media.$media_filename));const t={recipe:"optimize_media",suggested_file_name:i,image_width:this.image_width,image_height:this.image_height,video_bitrate:this.video_bitrate,audio_bitrate:this.audio_bitrate,base_media_path:this.makeMediaFilePath({$path:this.media.$path,$media_filename:this.media.$media_filename}),additional_meta:{$origin:"collect",$optimized:!0}};return this.extract_selection&&(t.trim_start=this.selection_start,t.trim_end=this.selection_end),t}},methods:{startOptimization(){this.show_optimization_modal=!0},closeModal(){this.$emit("close")}}};var S=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.label,size:t.modal_width},on:{close:t.closeModal}},[e("div",{staticClass:"_cont"},[t.media.$optimized===!0?e("div",{staticClass:"u-spacingBottom"},[t._v(" "+t._s(t.$t("already_optimized"))+" ")]):t._e(),t.optimization_strongly_recommended?e("div",{staticClass:"u-spacingBottom"},[t._v(" "+t._s(t.$t("convert_to_format"))+" ")]):t._e(),["video","audio"].includes(t.media.$type)?e("div",[e("TrimMedia",{attrs:{media:t.media,extract_selection:t.extract_selection,selection_start:t.selection_start,selection_end:t.selection_end},on:{"update:extract_selection":function(s){t.extract_selection=s},"update:selection_start":function(s){t.selection_start=s},"update:selection_end":function(s){t.selection_end=s}}}),e("div",{staticClass:"u-spacingBottom"})],1):t._e(),e("VideoAudioImageQualityPicker",{attrs:{media_type:t.media.$type,media_width:t.media_width,media_height:t.media_height,image_width:t.image_width,image_height:t.image_height,video_bitrate:t.video_bitrate,audio_bitrate:t.audio_bitrate},on:{"update:image_width":function(s){t.image_width=s},"update:image_height":function(s){t.image_height=s},"update:video_bitrate":function(s){t.video_bitrate=s},"update:audio_bitrate":function(s){t.audio_bitrate=s}}})],1),e("template",{slot:"footer"},[e("div"),e("div",[e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.startOptimization}},[e("b-icon",{attrs:{icon:"tools"}}),t._v(" "+t._s(t.$t("preview_new"))+" ")],1),e("div",{staticClass:"u-instructions _wontremove"},[t._v(" "+t._s(t.$t("wont_remove_original"))+" ")])])]),t.show_optimization_modal?e("OptimizeMediaModal",{attrs:{media:t.media,instructions:t.base_instructions},on:{close:function(s){t.show_optimization_modal=!1}}}):t._e()],2)},M=[],B=o(O,S,M,!1,null,"5dfb1bff");const I=B.exports;export{I as default};
