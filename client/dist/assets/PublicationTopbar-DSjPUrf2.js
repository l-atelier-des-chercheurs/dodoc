import{n as p,b as u}from"../build.js";const d={props:{path:String,source_title:String,publication:Object},components:{SpaceProjectPicker:u},data(){return{navigation_to_copy:!1,show_modal:!1,destination_project_path:void 0,remove_original:!1,new_title:this.$t("copy_of")+" "+this.source_title,is_copying:!1}},created(){},async mounted(){},beforeDestroy(){},watch:{show_modal(){this.show_modal&&(this.navigation_to_copy=void 0)}},computed:{project_medias_to_copy(){return this.publication.$files.reduce((i,t)=>(Object.prototype.hasOwnProperty.call(t,"source_medias")&&t.source_medias.map(e=>{const a=this.getSourceMedia({source_media:e,folder_path:this.publication.$path});i.includes(a.$path)||i.push(a.$path)}),i),[])}},methods:{async confirm(){this.is_copying=!0;const i=this.destination_project_path+"/publications",t=await this.$api.copyFolder({path:this.path,path_to_destination_type:i,new_meta:{title:this.new_title}}).catch(s=>{throw s==="unique_field_taken"?(this.$alertify.delay(4e3).error(this.$t("title_taken")),this.$refs.titleInput.$el.querySelector("input").select()):s==="not_allowed_to_copy_to_space"&&this.$alertify.delay(4e3).error(this.$t("not_allowed_to_copy_to_space")),this.is_copying=!1,"fail"}),e=await this.$api.getFolder({path:t});if(this.$alertify.closeLogOnClick(!0).delay(4e3).success("publication_copy_success"),this.getParent(this.path)!==this.destination_project_path+"/publications"){this.$alertify.closeLogOnClick(!0).delay(4e3).log("has_linked_media_to_copy");for(let s of this.project_medias_to_copy){const n=await this.$api.copyFile({path:s,path_to_destination_folder:this.destination_project_path,new_meta:{group:"imported_from_"+t}}).catch(r=>{this.$alertify.delay(4e3).error(r)}),c=this.getFilename(s);if(n!==c)for(let r of e.$files){if(!Object.prototype.hasOwnProperty.call(r,"source_medias")||!r.source_medias.some(_=>_.meta_filename_in_project&&_.meta_filename_in_project===c))continue;const l=r.source_medias.map(_=>(_.meta_filename_in_project===c&&(_.meta_filename_in_project=n),_));await this.$api.updateMeta({path:r.$path,new_meta:{source_medias:l}})}}this.$alertify.closeLogOnClick(!0).delay(4e3).success("linked media copied")}let a={};a.projectpanes=JSON.stringify([{type:"publish",size:100,folder:this.getFilename(e.$path)}]);const o={path:this.createURLFromPath(this.destination_project_path),query:a};this.remove_original?(this.is_copying=!1,await this.$api.deleteItem({path:this.path}),this.$emit("close")):(this.is_copying=!1,this.navigation_to_copy=this.$router.resolve(o).href)}}};var h=function(){var t=this,e=t._self._c;return e("div",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(a){t.show_modal=!0}}},[e("b-icon",{attrs:{icon:"file-plus"}}),t._v(" "+t._s(t.$t("duplicate_or_move"))+" ")],1),t.show_modal?e("BaseModal2",{attrs:{title:t.$t("duplicate_or_move")},on:{close:function(a){t.show_modal=!1}}},[t.navigation_to_copy?[e("a",{staticClass:"u-button u-button_bleumarine",attrs:{href:t.navigation_to_copy}},[t._v(" "+t._s(t.$t("open_copy"))+" ")])]:[e("div",{staticClass:"u-spacingBottom"},[e("div",{staticClass:"u-instructions"},[e("small",[t._v(" "+t._s(t.$t("dmp_instr"))+" ")])]),e("br"),e("SpaceProjectPicker",{staticClass:"u-spacingBottom",attrs:{path:t.path},on:{newProjectSelected:function(a){t.destination_project_path=a}}}),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title_of_copy")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_title,maxlength:40,required:!0},on:{"update:content":function(a){t.new_title=a}}})],1),e("div",{},[e("ToggleInput",{attrs:{content:t.remove_original,label:t.$t("remove_original"),options:{true:t.$t("remove_original_after_copy"),false:t.$t("keep_original_after_copy")}},on:{"update:content":function(a){t.remove_original=a}}})],1)],1),e("template",{slot:"footer"},[t.is_copying?e("LoaderSpinner"):[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(a){t.show_modal=!1}}},[e("b-icon",{attrs:{icon:"x-circle"}}),t._v(" "+t._s(t.$t("cancel"))+" ")],1),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button",autofocus:"",disabled:!t.destination_project_path},on:{click:t.confirm}},[t.remove_original?[t._v(" "+t._s(t.$t("move"))+" ")]:[t._v(" "+t._s(t.$t("duplicate"))+" ")]],2)]],2)]],2):t._e()],1)},f=[],m=p(d,h,f,!1,null,"dacd200e");const b=m.exports,v={props:{file:Object},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var g=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"u-metaField"},[e("DLabel",{attrs:{str:t.$t("filename")}}),e("div",{staticClass:"u-filename"},[t._v(t._s(t.file.$media_filename))])],1),t.file.$infos.hasOwnProperty("size")?e("SizeDisplay",{attrs:{size:t.file.$infos.size}}):t._e(),t.file.$infos.hasOwnProperty("width")||t.file.$infos.hasOwnProperty("height")?e("ResolutionDisplay",{attrs:{width:t.file.$infos.width,height:t.file.$infos.height}}):t._e(),t.file.$infos.hasOwnProperty("duration")?e("DurationDisplay",{attrs:{title:t.$t("duration"),duration:t.file.$infos.duration}}):t._e()],1)},$=[],y=p(v,g,$,!1,null,"6acd4e9c");const w=y.exports,x={props:{publication_path:String,instructions:Object},components:{ShowExportedFileInfos:w},data(){return{is_exporting:!1,created_doc:void 0,task_progress:0,fail_message:void 0}},created(){},async mounted(){await this.startExport()},beforeDestroy(){},watch:{},computed:{export_href(){return this.created_doc?this.makeMediaFileURL({$path:this.created_doc.$path,$media_filename:this.created_doc.$media_filename}):!1}},methods:{async startExport(){const i=await this.$api.exportFolder({path:this.publication_path,instructions:this.instructions});this.$api.join({room:"task_"+i}),this.$alertify.delay(4e3).log(this.$t("compilation_started")),this.is_exporting=!0;const t=({task_id:a,progress:o})=>{a===i&&(this.task_progress=o)};this.$eventHub.$on("task.status",t);const e=({task_id:a,message:o})=>{a===i&&(this.$eventHub.$off("task.ended",e),this.$api.leave({room:"task_"+i}),o.event==="completed"?this.created_doc=o.file:o.event==="aborted"?this.fail_message=this.$t("failed_to_export"):o.event==="failed"&&(this.fail_message=this.$t("failed_to_export")+" : "+o.info),this.is_exporting=!1)};this.$eventHub.$on("task.ended",e)},async saveToProject(){this.$eventHub.$emit("pane.animate","collect"),this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("media_was_saved_to_project")),this.$emit("close")},removeAndCloseModal(){this.created_doc&&this.$api.deleteItem({path:this.created_doc.$path}),this.$emit("close")}}};var k=function(){var t=this,e=t._self._c;return e("BaseModal2",{on:{close:t.removeAndCloseModal}},[t.is_exporting?[e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.$t("export_in_progress"))+" ")]),e("div",[e("div"),e("div",[e("AnimatedCounter",{attrs:{value:t.task_progress}})],1)])]:[t.fail_message?[e("div",{staticClass:"u-instructions u-spacingBottom"},[t._v(" "+t._s(t.fail_message)+" ")])]:t._e(),t.created_doc?[t.instructions.recipe==="webpage"?e("div",{staticClass:"u-instructions",domProps:{innerHTML:t._s(t.$t("webpage_export_instructions"))}}):e("MediaContent",{staticClass:"_preview",attrs:{file:t.created_doc,resolution:1600,context:"full"}}),e("div",{staticClass:"u-spacingBottom"}),e("ShowExportedFileInfos",{attrs:{file:t.created_doc}}),e("a",{staticClass:"u-buttonLink",attrs:{disabled:!t.export_href,download:t.created_doc.$media_filename,href:t.export_href,target:"_blank"}},[t._v(" "+t._s(t.$t("download"))+" ")])]:t._e(),e("template",{slot:"footer"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:t.removeAndCloseModal}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),e("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:t.saveToProject}},[e("span",{staticClass:"u-icon",domProps:{innerHTML:t._s(t.dodoc_icon_collect)}}),t._v(" "+t._s(t.$t("save_to_project"))+" ")])])]],2)},C=[],P=p(x,k,C,!1,null,"2ff66e14");const j=P.exports,M={props:{modal_title:String,publication:Object,pane_infos:Object},components:{ExportItemAndSaveOrDownload:j},data(){return{task_instructions:!1,page_to_export_as_image:1,pdf_pages_to_export_mode:"all",specific_pdf_page_or_spread_to_export:"",page_width:this.publication.page_width||210,page_height:this.publication.page_height||297,export_mode:"pdf",export_options:[{key:"pdf",label:this.$t("pdf")},{key:"png",label:this.$t("image")},{key:"webpage",label:this.$t("webpage")}]}},created(){this.publication_ratio=this.page_height/this.page_width,this.page_to_export_as_image=this.current_page_number||1},mounted(){},beforeDestroy(){},watch:{},computed:{page_count(){return this.publication.pages.length},is_spread(){return this.publication.page_spreads===!0},export_mode_icon(){if(this.export_mode==="pdf")return"file-pdf";if(this.export_mode==="png")return"file-earmark-image";if(this.export_mode==="webpage")return"window"},current_page_number(){var i;return(i=this.pane_infos)!=null&&i.page_id&&this.publication.pages?this.publication.pages.findIndex(e=>e.id===this.pane_infos.page_id)+1:!1},total_number_of_pages(){return this.publication.pages?this.publication.pages.length:!1},total_number_of_spreads(){return this.total_number_of_pages?Math.floor(this.total_number_of_pages/2)+1:!1},current_spread_number(){var i;if((i=this.pane_infos)!=null&&i.page_id&&this.publication.page_spreads){const t=this.publication.pages.findIndex(e=>e.id===this.pane_infos.page_id);return Math.floor((t+1)/2)+1}return!1},custom_resolution_unit(){return this.publication.layout_mode==="print"||this.publication.template==="edition"?"mm":"px"},url_to_print_from(){const i=this.$router.resolve({path:this.createURLFromPath(this.publication.$path)});return window.location.origin+i.href},current_info(){let i=this.$t("current_f")+" (";return i+=this.is_spread?this.$t("spread").toLowerCase():this.$t("page").toLowerCase(),i+=" "+(this.is_spread?this.current_spread_number:this.current_page_number)+")",i}},methods:{makePageNumber(i){return this.current_page_number===i?`• ${i}`:i},async exportPublication(i){var a;const t={};t.$origin="publish",t.$credits=this.$t("created_by_publication",{publication_title:this.publication.title}),(a=this.connected_as)!=null&&a.$path&&(t.$authors=[this.connected_as.$path]);let e={recipe:i,page_width:this.page_width,page_height:this.page_height,layout_mode:this.publication.layout_mode||"print",suggested_file_name:this.publication.title,additional_meta:t};i==="webpage"&&(e.layout_mode="screen"),this.publication.template==="page_by_page"&&this.export_mode==="png"&&(e.page=this.page_to_export_as_image),this.export_mode==="pdf"&&(this.pdf_pages_to_export_mode==="current"?e.page=this.is_spread?this.current_spread_number:this.current_page_number:this.pdf_pages_to_export_mode==="custom"&&(e.page=this.specific_pdf_page_or_spread_to_export)),this.is_spread&&(e.page_width*=2),this.task_instructions=e}}};var H=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.modal_title},on:{close:function(a){return t.$emit("close")}}},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("document_type")}}),e("RadioCheckboxInput",{attrs:{value:t.export_mode,options:t.export_options,can_edit:!0},on:{"update:value":function(a){t.export_mode=a}}})],1),t.export_mode==="pdf"&&["page_by_page","edition"].includes(t.publication.template)?[e("DLabel",{attrs:{str:t.is_spread?t.$t("spreads_to_export"):t.$t("pages_to_export")}}),e("div",{staticClass:"u-inputGroup"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.pdf_pages_to_export_mode,expression:"pdf_pages_to_export_mode"}],on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,function(s){return s.selected}).map(function(s){var n="_value"in s?s._value:s.value;return n});t.pdf_pages_to_export_mode=a.target.multiple?o:o[0]}}},[e("option",{attrs:{value:"all"}},[t._v(" "+t._s(t.is_spread?t.$t("all_spreads"):t.$t("all_pages"))+" ")]),!t.is_spread&&t.current_page_number!==!1||t.is_spread&&t.current_spread_number!==!1?e("option",{attrs:{value:"current"}},[t._v(" "+t._s(t.current_info)+" ")]):t._e(),e("option",{attrs:{value:"custom"}},[t._v(t._s(t.$t("custom")))])]),t.pdf_pages_to_export_mode==="custom"?e("input",{directives:[{name:"model",rawName:"v-model",value:t.specific_pdf_page_or_spread_to_export,expression:"specific_pdf_page_or_spread_to_export"}],attrs:{size:"large",type:"text",placeholder:t.is_spread?t.$t("spread_number_or_interval"):t.$t("page_number_or_interval")},domProps:{value:t.specific_pdf_page_or_spread_to_export},on:{input:function(a){a.target.composing||(t.specific_pdf_page_or_spread_to_export=a.target.value)}}}):t._e()]),t.pdf_pages_to_export_mode==="custom"&&t.total_number_of_pages?e("div",{staticClass:"u-instructions"},[t.is_spread?[t._v(" "+t._s(t.$t("total_number_of_spreads_in_publication",{total:t.total_number_of_spreads}))+" ")]:[t._v(" "+t._s(t.$t("total_number_of_pages_in_publication",{total:t.total_number_of_pages}))+" ")]],2):t._e()]:t._e(),t.export_mode==="png"?[t.publication.template==="page_by_page"?[e("div",{staticClass:"u-spacingBottom"}),e("div",{},[e("DLabel",{attrs:{str:t.$t("page_to_export")}}),e("select",{directives:[{name:"model",rawName:"v-model",value:t.page_to_export_as_image,expression:"page_to_export_as_image"}],on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,function(s){return s.selected}).map(function(s){var n="_value"in s?s._value:s.value;return n});t.page_to_export_as_image=a.target.multiple?o:o[0]}}},t._l(new Array(t.page_count),function(a,o){return e("option",{key:o+1,domProps:{value:o+1,textContent:t._s(t.makePageNumber(o+1))}})}),0)],1)]:t._e()]:t._e(),e("template",{slot:"footer"},[e("div"),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(a){return t.exportPublication(t.export_mode)}}},[e("b-icon",{attrs:{icon:t.export_mode_icon}}),t._v(" "+t._s(t.$t("create"))+" ")],1)]),t.task_instructions?e("ExportItemAndSaveOrDownload",{attrs:{publication_path:t.publication.$path,instructions:t.task_instructions},on:{close:function(a){t.task_instructions=!1}}}):t._e()],2)},L=[],S=p(M,H,L,!1,null,"51e44dce");const D=S.exports,F={props:{publication:Object,pane_infos:Object,no_back_button:Boolean,can_edit:Boolean},components:{DuplicatePublication:b,ExportPubliModal:D},data(){return{show_export_pdf_modal:!1,show_qr_code_modal:!1,is_exporting:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{share_url(){let i={};this.publication.template==="page_by_page"?i={display:"slides"}:this.publication.template==="story_with_sections"?i={display:"section"}:this.publication.template==="cartography"&&(i={display:"section"});const t=this.$router.resolve({path:this.createURLFromPath(this.publication.$path),query:i});return window.location.origin+t.href}},methods:{async removePublication(){this.fetch_status="pending",this.fetch_error=null;try{const i=await this.$api.deleteItem({path:this.publication.$path});this.response=i.data,this.fetch_status="success"}catch(i){this.fetch_status="error",this.fetch_error=i.response.data}},async setCorrectPermForAdmins(){await this.$api.updateMeta({path:this.publication.$path,new_meta:{$admins:"parent_contributors"}})},openSettings(){this.$eventHub.$emit("publication.settings.toggle")},closeSettings(){this.$eventHub.$emit("publication.settings.close")}}};var O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_topbar"},[t.no_back_button!==!0?e("button",{staticClass:"u-button u-button_icon _backPubli",attrs:{type:"button"},on:{click:function(a){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"arrow-left-circle","aria-label":t.$t("back_to_publications")}})],1):t._e(),e("div",{staticClass:"_publiTitle"},[e("TitleField",{attrs:{label:t.$t("title"),show_label:!1,field_name:"title",tag:"h3",maxlength:40,required:!0,content:t.publication.title,path:t.publication.$path,can_edit:t.can_edit}})],1),e("div",{staticClass:"_buttonRow"},[t.can_edit&&t.publication.$admins!=="parent_contributors"?e("div",{},[e("small",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.setCorrectPermForAdmins}},[t._v(" set perm to parent ")]),t._v(" "+t._s(t.publication.$admins)+" ")])]):t._e(),t.can_edit?e("StatusTag",{attrs:{status:t.publication.$status||"public",status_options:["public","private"],path:t.publication.$path,can_edit:t.can_edit}}):t._e(),t.can_edit&&!["cartography"].includes(t.publication.template)?e("button",{staticClass:"u-button u-button_transparent",attrs:{type:"button",caret:""},on:{click:t.openSettings}},[e("b-icon",{attrs:{slot:"prefix",icon:"gear","aria-label":t.$t("settings")},slot:"prefix"}),t._v(" "+t._s(t.$t("settings"))+" ")],1):t._e(),t.can_edit?e("DropDown",{on:{show:t.closeSettings}},[e("DuplicatePublication",{attrs:{path:t.publication.$path,source_title:t.publication.title,publication:t.publication},on:{close:function(a){return t.$emit("close")}}}),e("RemoveMenu",{attrs:{modal_title:t.$t("remove_publication",{name:t.publication.title})},on:{remove:t.removePublication}})],1):t._e(),e("DropDown",{attrs:{right:!0},on:{show:t.closeSettings}},[e("template",{slot:"trigger"},[e("b-icon",{attrs:{icon:"box-arrow-up-right"}}),t._v(" "+t._s(t.$t("share"))+" ")],1),t.can_edit?e("div",[e("button",{staticClass:"u-buttonLink _exportBtn",attrs:{type:"button"},on:{click:function(a){t.show_export_pdf_modal=!0}}},[e("b-icon",{attrs:{icon:"save2-fill"}}),t._v(" "+t._s(t.$t("export"))+" ")],1)]):t._e(),t.show_export_pdf_modal?e("ExportPubliModal",{attrs:{modal_title:t.$t("export_publi",{name:t.publication.title}),publication:t.publication,pane_infos:t.pane_infos},on:{close:function(a){t.show_export_pdf_modal=!1}}}):t._e(),e("div",[e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(a){t.show_qr_code_modal=!0}}},[e("div",{staticClass:"icon",attrs:{part:"base","aria-hidden":"true"}},[e("svg",{staticClass:"bi bi-qr-code",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[e("path",{attrs:{d:"M2 2h2v2H2V2Z"}}),e("path",{attrs:{d:"M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"}}),e("path",{attrs:{d:"M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"}}),e("path",{attrs:{d:"M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"}}),e("path",{attrs:{d:"M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"}})])]),t._v(" "+t._s(t.$t("direct_link"))+" ")])]),t.show_qr_code_modal?e("QRModal",{attrs:{url_to_access:t.share_url},on:{close:function(a){t.show_qr_code_modal=!1}}},[e("ToggleField",{attrs:{label:t.$t("make_publication_public"),field_name:"$public",content:t.publication.$public===!0,path:t.publication.$path,can_edit:t.can_edit}})],1):t._e()],2)],1)])},Z=[],V=p(F,O,Z,!1,null,"a20b0f93");const I=V.exports;export{I as P,w as S};
