import{M as r}from"./ModuleCreator-Dml_oHF2.js";import{n}from"../build.js";import{E as d}from"./ExportSaveMakeModal2-BfrtYTmN.js";import"./MediaPicker-BkCMiT_E.js";import"./PublicationTopbar-WR8htxPc.js";const u={props:{makemodule:Object,index:Number,module_position:String,default_image_duration:Number},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{first_media(){return this.firstMedia(this.makemodule)},first_media_duration(){return this.displayDuration({media:this.first_media})}},methods:{toggleTransition(i){this.makemodule[i]==="fade"?this.updateMakemodule({[i]:"none"}):this.updateMakemodule({[i]:"fade"})},async updateMakemodule(i){await this.$api.updateMeta({path:this.makemodule.$path,new_meta:i})},async removeModule(){await this.$api.deleteItem({path:this.makemodule.$path}).catch(i=>{throw this.$alertify.delay(4e3).error(i),i}),this.$emit("remove")}}};var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_montageModule"},[e("div",{staticClass:"_line"}),e("div",{staticClass:"_index"},[e("div",{staticClass:"_btns"},[e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:t.module_position==="alone"||t.module_position==="first"},on:{click:function(a){return t.$emit("moveUp")}}},[e("b-icon",{attrs:{icon:"chevron-up"}})],1),e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:t.module_position==="alone"||t.module_position==="last"},on:{click:function(a){return t.$emit("moveDown")}}},[e("b-icon",{attrs:{icon:"chevron-down"}})],1)]),e("span",{staticClass:"_num"},[t._v(" "+t._s(t.index)+" ")])]),e("div",{staticClass:"_preview"},[e("div",{staticClass:"_topRow"},[e("div",{staticClass:"u-label"},[t.first_media?[t._v(" "+t._s(t.$t(t.first_media.$type))+" "),t.first_media_duration?[t._v("/ "+t._s(t.first_media_duration))]:t._e()]:t._e(),e("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.removeModule}},[e("b-icon",{attrs:{icon:"trash"}})],1)],2),e("div",{},[e("span",{staticClass:"u-switch u-switch-xs"},[e("input",{staticClass:"switch",attrs:{id:"transition_in_"+t.makemodule.$path,type:"checkbox"},domProps:{checked:t.makemodule.transition_in==="fade"},on:{change:function(a){return t.toggleTransition("transition_in")}}}),e("label",{staticClass:"u-label",attrs:{for:"transition_in_"+t.makemodule.$path}},[t._v(t._s(t.$t("transition_fade")))])])])]),t.first_media?[t.first_media.$type!=="text"?e("MediaContent",{attrs:{file:t.first_media,resolution:1600,context:"full",show_fs_button:!0}}):e("CollaborativeEditor2",{ref:"textBloc",attrs:{path:t.first_media.$path,content:t.first_media.$content,line_selected:!1,can_edit:!0},on:{lineClicked:function(a){return t.$emit("lineClicked",a)},contentIsEdited:function(a){return t.$emit("contentIsEdited",a)},contentIsNotEdited:function(a){return t.$emit("contentIsNotEdited",a)}}}),t.first_media.$type==="image"?e("div",{staticClass:"_imageDurationPicker"},[e("NumberInput",{attrs:{value:t.makemodule.image_duration||t.default_image_duration,suffix:t.$t("seconds"),size:"medium",min:0,max:3600},on:{save:function(a){return t.updateMakemodule({image_duration:a})}}})],1):t._e(),t.module_position==="last"?e("div",{staticClass:"_transitionPicker"},[e("span",{staticClass:"u-switch u-switch-xs"},[e("input",{staticClass:"switch",attrs:{id:"transition_out_"+t.makemodule.$path,type:"checkbox"},domProps:{checked:t.makemodule.transition_out==="fade"},on:{change:function(a){return t.toggleTransition("transition_out")}}}),e("label",{staticClass:"u-label",attrs:{for:"transition_out_"+t.makemodule.$path}},[t._v(t._s(t.$t("transition_fade")))])])]):t._e()]:t._e()],2)])},c=[],_=n(u,l,c,!1,null,"8d6e3e96");const m=_.exports,p={props:{make:Object},components:{ModuleCreator:r,MontageModule:m,ExportSaveMakeModal2:d},data(){return{show_render_modal:!1,default_image_duration:2}},async created(){(!this.sections||this.sections.length===0)&&await this.createSection2({publication:this.make,additional_meta:{section_title:"montage"}})},mounted(){},beforeDestroy(){},watch:{},computed:{export_name(){return"video_montage.mp4"},export_is_available(){return this.section_modules_list.length>0},montage(){return this.section_modules_list.reduce((i,t)=>{const e=this.firstMedia(t);if(e){let a={path:this.makeMediaFilePath({$path:e.$path,$media_filename:e.$media_filename}),type:e.$type,transition_in:t.transition_in,transition_out:t.transition_out};e.$type==="image"&&(a.image_duration=t.image_duration||this.default_image_duration),i.push(a)}return i},[])},sections(){return this.getSectionsWithProps({publication:this.make,group:"sections_list"})},first_section(){return this.sections.at(0)},first_media(){if(this.section_modules_list.length>0){const i=this.section_modules_list.at(0);return this.firstMedia(i)}},first_media_ratio(){var i,t;return((t=(i=this.first_media)==null?void 0:i.$infos)==null?void 0:t.ratio)||void 0},section_modules_list(){return this.getModulesForSection({publication:this.make,section:this.first_section}).map(({_module:i})=>i)},base_instructions(){return{recipe:this.make.type,suggested_file_name:this.make.type,montage:this.montage}}},methods:{async addModules({meta_filenames:i}){await this.insertModuleMetaFilenamesToList2({publication:this.make,section:this.first_section,meta_filenames:i})},async insertModules({meta_filenames:i,index:t}){await this.insertModuleMetaFilenamesToList2({publication:this.make,section:this.first_section,index:t,meta_filenames:i})},async moveModuleTo({path:i,new_position:t}){await this.moveModuleTo2({publication:this.make,section:this.first_section,meta_filename:this.getFilename(i),new_position:t})},async duplicatePublicationMedia({source_module_path:i,copy_meta_filename:t}){const e=this.getFilename(i);await this.duplicatePublicationMedia2({publication:this.make,section:this.first_section,source_meta_filename:e,copy_meta_filename:t})},async removeModule(i){await this.removeModule2({publication:this.make,section:this.first_section,path:i})}}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_montageModules"},[e("transition-group",{staticClass:"_listOfModules",attrs:{tag:"div",name:"StoryModules",appear:"",duration:700}},[t._l(t.section_modules_list,function(a,s){return[e("div",{key:"mc_"+s,staticClass:"_spacer"},[e("ModuleCreator",{attrs:{publication_path:t.make.$path,types_available:["capture","import"],pick_from_types:["image","video"],available_modes:["photo","video"],context:"montage"},on:{addModules:({meta_filenames:o})=>t.insertModules({meta_filenames:o,index:s})}})],1),e("div",{key:a.$path},[e("MontageModule",{attrs:{index:s+1,makemodule:a,module_position:t.section_modules_list.length===1?"alone":s===0?"first":s===t.section_modules_list.length-1?"last":"inbetween",default_image_duration:t.default_image_duration},on:{moveUp:function(o){return t.moveModuleTo({path:a.$path,new_position:s-1})},moveDown:function(o){return t.moveModuleTo({path:a.$path,new_position:s+1})},remove:function(o){return t.removeModule(a.$path)}}})],1)]})],2),e("div",{staticClass:"_lastModule"},[e("ModuleCreator",{attrs:{publication_path:t.make.$path,start_collapsed:!1,types_available:["capture","import"],pick_from_types:["image","video"],available_modes:["photo","video"],context:"montage"},on:{addModules:t.addModules}})],1),e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.export_is_available?e("div",{staticClass:"_bottomRow"},[e("div",{staticClass:"_equationIcon"},[e("b-icon",{attrs:{icon:"chevron-double-down"}})],1),e("div",{},[e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(a){t.show_render_modal=!0}}},[e("b-icon",{attrs:{icon:"check"}}),t._v(" "+t._s(t.$t("create"))+" ")],1)])]):t._e()]),t.show_render_modal?e("ExportSaveMakeModal2",{attrs:{base_instructions:t.base_instructions,make_path:t.make.$path,reference_media:t.first_media,default_resolution_preset:"high"},on:{close:function(a){t.show_render_modal=!1}}}):t._e()],1)},f=[],v=n(p,h,f,!1,null,"02a9825d");const C=v.exports;export{C as default};
