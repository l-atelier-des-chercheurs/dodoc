import{M as _}from"./MediaPicker-DRPJy0gZ.js";import{E as r}from"./EmbedPicker-CQwq9A1Z.js";import{n as p,I as d}from"../build.js";const u={props:{publication_path:String,pre_addtl_meta:Object,post_addtl_meta:Object,select_mode:String,pick_from_types:[String,Array],available_modes:Array,show_labels:{type:Boolean,default:!0},context:String,types_available:{type:Array,default:()=>["capture","import","write","embed","table","shapes"]},start_collapsed:{type:Boolean,default:!0},enable_clipboard_paste:{type:Boolean,default:!1}},components:{MediaPicker:_,EmbedPicker:r,ImportFileZone:d},data(){return{show_capture_modal:!1,show_module_selector:!1,show_media_picker:!1,show_file_picker:!1,show_link_picker:!1,files_to_import:[],shapes:[{type:"ellipsis",icon:"circle-fill",addtl_meta:{background_color:"#1d327f"}},{type:"rectangle",icon:"square-fill",addtl_meta:{background_color:"#ffbe32"}},{type:"line",icon:"dash-lg",addtl_meta:{outline_width:1,outline_color:"#000000"}},{type:"arrow",icon:"arrow-right-square",addtl_meta:{outline_width:1,outline_color:"#000000"}}],is_saving:!1}},created(){},mounted(){},beforeDestroy(){},watch:{show_module_selector(){}},computed:{project_path(){return this.$root.publication_include_mode==="link"?this.getParent(this.getParent(this.publication_path)):this.publication_path}},methods:{pickMedias(o){const t=o.map(e=>e.$path);this.createMosaic({path_to_source_media_metas:t})},async mediaDropped({$path:o}){this.createMosaic({path_to_source_media_metas:[o]})},async mediaJustImported(o){const t=o.map(e=>this.project_path+"/"+e);this.createMosaic({path_to_source_media_metas:t})},async createMosaic({meta_filename:o,path_to_source_media_metas:t}){let e=[];if(o)e.push({meta_filename:o});else if(t)for(const a of t){const i=this.$root.publication_include_mode,l=await this.prepareMediaForPublication({path_to_source_media_meta:a,publication_path:this.publication_path,import_mode:i});e.push(l)}this.context==="page_by_page"&&(e=e.map(a=>(a.objectFit="contain",a))),["page_by_page","montage"].includes(this.context)?await this.createMultipleModules({module_type:"mosaic",source_medias:e}):await this.createModule({module_type:"mosaic",source_medias:e}),this.show_media_picker=!1},async createEmbed(o){const t="url-"+ +new Date+".txt",{meta_filename:e}=await this.$api.uploadText({path:this.publication_path,filename:t,content:o,additional_meta:{$type:"url"}});this.createMosaic({meta_filename:e}),this.show_link_picker=!1},async createFiles({path_to_source_media_metas:o}){let t=[];o.map(e=>{const a=this.getFilename(e);t.push({meta_filename_in_project:a})}),await this.createModule({module_type:"files",source_medias:t}),this.show_file_picker=!1},async createCustomModule({module_type:o,addtl_meta:t}){await this.createModule({module_type:o,addtl_meta:t})},async createText(){const o="text-"+ +new Date+".txt",{meta_filename:t}=await this.$api.uploadText({path:this.publication_path,filename:o,content:""}),e=[{meta_filename:t}],a=this.context==="page_by_page"?"text":"mosaic";await this.createModule({module_type:a,source_medias:e})},async createTable(){const o="table-"+ +new Date+".json",{meta_filename:t}=await this.$api.uploadText({path:this.publication_path,filename:o,content:JSON.stringify([[{content:""},{content:""}],[{content:""},{content:""}]],null,4),additional_meta:{$type:"table"}});this.createMosaic({meta_filename:t}),this.show_link_picker=!1},async createModule({module_type:o,source_medias:t=[],addtl_meta:e={}}){if(t.length>0){const i=this.getSourceMedia({source_media:t[0],folder_path:this.publication_path});i!=null&&i.$location&&(e.location=i.$location)}const a=await this.createMetaForModule({module_type:o,source_medias:t,addtl_meta:e});return this.$emit("addModules",{meta_filenames:[a]}),this.show_module_selector=!1,a},async createMultipleModules({module_type:o,source_medias:t=[]}){var a,i;let e=[];for(const l of t){const s=this.getSourceMedia({source_media:l,folder_path:this.publication_path});let n={};["page_by_page","montage"].includes(this.context)&&(a=s==null?void 0:s.$infos)!=null&&a.ratio&&(i=this.pre_addtl_meta)!=null&&i.width&&(n.height=this.pre_addtl_meta.width*s.$infos.ratio),s!=null&&s.$location&&(n.location=s.$location);const c=await this.createMetaForModule({module_type:o,source_medias:[l],addtl_meta:n});e.push(c)}this.show_module_selector=!1,this.$emit("addModules",{meta_filenames:e})},async createMetaForModule({module_type:o,source_medias:t,addtl_meta:e}){let a={module_type:o,source_medias:t,requested_slug:"module"};this.pre_addtl_meta&&Object.assign(a,this.pre_addtl_meta),e&&Object.assign(a,e),this.post_addtl_meta&&Object.assign(a,this.post_addtl_meta);const{meta_filename:i}=await this.$api.uploadFile({path:this.publication_path,additional_meta:a}).catch(l=>{throw this.$alertify.delay(4e3).error(l),l});return i}}};var m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_moduleCreator",class:{"is--collapsed":!t.show_module_selector}},[e("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.show_module_selector||!t.start_collapsed?e("div",{staticClass:"_typePicker"},[t.types_available.includes("capture")?e("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:function(a){t.show_capture_modal=!0}}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"record-circle-fill"}}),t.show_labels?[t._v(t._s(t.$t("capture")))]:t._e()],2):t._e(),t.types_available.includes("import")?e("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:function(a){t.show_media_picker=!0}}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"image"}}),t.show_labels?[t._v(t._s(t.$t("import")))]:t._e()],2):t._e(),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication_path,select_mode:t.select_mode,pick_from_types:t.pick_from_types},on:{pickMedias:t.pickMedias,close:function(a){t.show_media_picker=!1}}}):t._e(),t.types_available.includes("write")?e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.createText}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"fonts"}}),t.show_labels?[t._v(t._s(t.$t("write")))]:t._e()],2):t._e(),t.types_available.includes("embed")?e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(a){t.show_link_picker=!0}}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"link"}}),t.show_labels?[t._v(t._s(t.$t("embed")))]:t._e()],2):t._e(),t.show_link_picker?e("EmbedPicker",{on:{embed:t.createEmbed,close:function(a){t.show_link_picker=!1}}}):t._e(),t.types_available.includes("table")?e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.createTable}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"table"}}),t.show_labels?[t._v(t._s(t.$t("table")))]:t._e()],2):t._e(),t.types_available.includes("shapes")?t._l(t.shapes,function(a){return e("button",{key:a.type,staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(i){return t.createCustomModule({module_type:a.type,addtl_meta:a.addtl_meta})}}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:a.icon}}),t.show_labels?[t._v(t._s(t.$t(a.type)))]:t._e()],2)}):t._e(),t.start_collapsed?e("EditBtn",{key:"addmodule",attrs:{btn_type:"close",is_unfolded:!1},on:{click:function(a){t.show_module_selector=!1}}}):t._e()],2):t.start_collapsed&&!t.show_module_selector?e("EditBtn",{key:"addmodule",staticClass:"_addBtn",attrs:{btn_type:"add",is_unfolded:!1},on:{click:function(a){t.show_module_selector=!0}}}):t._e()],1),e("DropZone",{staticClass:"_dropZone",on:{mediaDropped:t.mediaDropped}}),t.enable_clipboard_paste?[e("ImportFileZone",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{multiple:!0,files_to_import:t.files_to_import},on:{"update:files_to_import":function(a){t.files_to_import=a}}}),t.files_to_import.length>0?e("UploadFiles",{attrs:{files_to_import:t.files_to_import,path:t.project_path,allow_caption_edition:!0},on:{importedMedias:function(a){return t.mediaJustImported(a)},close:function(a){t.files_to_import=[]}}}):t._e()]:t._e()],2)},h=[],f=p(u,m,h,!1,null,"17bd2f3b");const k=f.exports;export{k as M};
