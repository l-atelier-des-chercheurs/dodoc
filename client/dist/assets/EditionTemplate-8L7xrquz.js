import{s as v,p as y}from"./SingleBaseMediaPicker-CyBi96TR.js";import{M as m}from"./MediaPicker-BkCMiT_E.js";import{n as l}from"../build.js";import{M as $,m as b,H as w,d,V as g}from"./ViewContent-jOum4Tnp.js";/* empty css               */import{P as C}from"./PublicationSettings-DIeHMtor.js";import{W as k}from"./WidthHeightField-B_EX3ZVn.js";import"./infinite-viewer.esm-ZcF8ddEx.js";const x={props:{publication:{type:Object,required:!0},can_edit:Boolean},components:{MediaPicker:m},data(){return{show_cover_picker:!1,cover_layout_mode_options:[{key:"",text:this.$t("normal")},{key:"full_page",text:this.$t("full_page")},{key:"text_top_image_down",text:this.$t("text_top_image_down")},{key:"image_top_text_down",text:this.$t("image_top_text_down")}]}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{cover_media(){var s;return(s=this.publication.$files)==null?void 0:s.find(t=>t.cover_type==="front")},cover_image_media(){var e,i;const s=(i=(e=this.cover_media)==null?void 0:e.source_medias)==null?void 0:i[0];if(!s)return!1;const t=this.getSourceMedia({source_media:s,folder_path:this.publication.$path});return t||!1}},methods:{async createCover(){await this.$api.uploadText({path:this.publication.$path,filename:"frontcover.txt",content:this.$t("title"),additional_meta:{cover_type:"front"}})},async removeCover(){this.$api.deleteItem({path:this.cover_media.$path})},async pickCover(s){const t=s[0],e=await this.prepareMediaForPublication({path_to_source_media_meta:t.$path,publication_path:this.publication.$path});this.$api.updateMeta({path:this.cover_media.$path,new_meta:{source_medias:[e]}})}}};var S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_cover"},[t.cover_media?t._e():e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("cover")}}),e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:t.createCover}},[t._v(" "+t._s(t.$t("create"))+" ")])],1),t.cover_media?[e("div",{staticClass:"u-spacingBottom"},[e("CollaborativeEditor3",{attrs:{label:t.$t("title"),content:t.cover_media.$content,path:t.cover_media.$path,custom_formats:[],save_format:"raw",can_edit:t.can_edit}})],1),e("div",{staticClass:"_cover--pickCover"},[t.cover_image_media?[e("div",{staticClass:"_cover--pickCover--img"},[e("MediaContent",{attrs:{file:t.cover_image_media,resolution:1600}}),e("button",{staticClass:"u-button u-button_bleuvert u-button_small _changeCoverBtn",attrs:{type:"button"},on:{click:function(i){t.show_cover_picker=!0}}},[t._v(" "+t._s(t.$t("change"))+" ")])],1)]:[e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(i){t.show_cover_picker=!0}}},[t._v(" "+t._s(t.$t("pick_cover"))+" ")])],t.show_cover_picker?e("MediaPicker",{attrs:{publication_path:t.publication.$path,select_mode:"single",pick_from_types:["image"]},on:{pickMedias:t.pickCover,close:function(i){t.show_cover_picker=!1}}}):t._e()],2),e("div",{staticClass:"u-spacingBottom"}),e("DLabel",{attrs:{str:t.$t("text_image_layout")}}),e("SelectField2",{attrs:{field_name:"cover_layout_mode",value:t.cover_media.cover_layout_mode,path:t.cover_media.$path,hide_validation:!0,can_edit:t.can_edit,options:t.cover_layout_mode_options}}),e("RemoveMenu",{on:{remove:t.removeCover}})]:t._e()],2)},M=[],F=l(x,S,M,!1,null,"360b196f");const P=F.exports,B={props:{section:{type:Object,required:!0},index:Number,number_of_sections:Number,can_edit:Boolean},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{gallery_medias(){var s;return this.section.section_type!=="gallery"||!this.section.source_medias?[]:(s=this.section.source_medias)==null?void 0:s.map(t=>this.getSourceMedia({source_media:t,folder_path:this.getParent(this.section.$path)}))}},methods:{previewContent(s){var e;const t=(e=s._main_text)==null?void 0:e.$content;return t?t.substring(0,100)+"...":!1}}};var j=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-card2 _chapterPreview"},[t.can_edit?e("div",{staticClass:"_selects"},[e("select",{staticClass:"_selects--order",attrs:{size:"small"},domProps:{value:t.index},on:{change:function(i){return t.$emit("moveSection",{old_position:t.index,new_position:+i.target.value})}}},t._l(t.number_of_sections,function(i){return e("option",{key:i-1,domProps:{value:i-1,textContent:t._s(i)}})}),0),e("div",{staticClass:"_selects--starts_on_page"},[e("SelectField2",{attrs:{field_name:"section_starts_on_page",value:t.section.section_starts_on_page||"",path:t.section.$path,size:"small",hide_validation:!0,can_edit:t.can_edit,options:[{key:"",text:t.$t("in_flow")},{key:"page",text:t.$t("next_page")},{key:"left",text:t.$t("next_left_page")},{key:"right",text:t.$t("next_right_page")}]}})],1)]):t._e(),e("h2",{staticClass:"_item--title"},[t.section.section_title?[t._v(" "+t._s(t.section.section_title)+" ")]:[e("i",[t._v(t._s(t.$t("untitled")))])]],2),e("div",{staticClass:"_item--type"},[t._v(t._s(t.$t("type"))+" : "+t._s(t.section.section_type))]),e("div",{staticClass:"_item--content"},[t.section.section_type==="text"&&t.previewContent(t.section)?e("div",{staticClass:"_item--content--text"},[e("CollaborativeEditor3",{attrs:{content:t.previewContent(t.section)}})],1):t.section.section_type==="gallery"&&t.gallery_medias.length>0?e("div",{staticClass:"_item--content--gallery"},t._l(t.gallery_medias,function(i){return e("div",{key:i.meta_filename_in_project},[e("MediaContent",{attrs:{file:i}})],1)}),0):e("div",{staticClass:"u-instructions"},[t._v(t._s(t.$t("no_content")))])]),e("button",{staticClass:"_openButton",attrs:{type:"button",title:t.$t("open")},on:{click:function(i){return t.$emit("open")}}})])},T=[],E=l(B,j,T,!1,null,"dbc7df32");const O=E.exports,I={props:{publication:Object,sections:Array,opened_section_meta_filename:String,can_edit:Boolean},components:{ChapterPreview:O,SetCover:P},data(){return{}},created(){},mounted(){this.can_edit&&this.sections.length===0&&this.createSection({type:"text"})},beforeDestroy(){},watch:{opened_section_meta_filename(){}},computed:{is_associated_to_map(){return this.$getMapOptions},new_section_index(){let s=this.sections.length+1;const t=i=>" "+i;let e=t(s);for(;this.sections.some(i=>i.section_title.endsWith(e));)s++,e=t(s);return e},opened_section(){return this.sections.find(s=>this.getFilename(s.$path)===this.opened_section_meta_filename)}},methods:{openSection(s){this.$emit("toggleSection",this.getFilename(s))},async createSection({type:s="text"}={}){let t={section_starts_on_page:"right"};if(s==="text"){const e=this.new_section_title+" text.txt",{meta_filename:i}=await this.$api.uploadText({path:this.publication.$path,filename:e,content:"",additional_meta:{content_type:"markdown"}});t.section_title=this.$t("section")+" "+this.new_section_index,t.section_type="text",t.main_text_meta=i}else s==="gallery"&&(t.section_title=this.$t("gallery")+" "+this.new_section_index,t.section_type="gallery");await this.createSection2({publication:this.publication,additional_meta:t})},async moveSection({old_position:s,new_position:t}){let e=this.sections.map(a=>({meta_filename:this.getFilename(a.$path)}));function i(a,n,o){if(o>=a.length)for(var r=o-a.length+1;r--;)a.push(void 0);return a.splice(o,0,a.splice(n,1)[0]),a}return i(e,s,t),await this.$api.updateMeta({path:this.publication.$path,new_meta:{sections_list:e}})}}};var D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_chaptersSummary"},[e("div",{staticClass:"_content"},[e("transition-group",{key:"allpages",staticClass:"_allChapters",attrs:{tag:"div",name:"listComplete",appear:""}},[e("SetCover",{key:"cover",attrs:{publication:t.publication,can_edit:t.can_edit}}),t._l(t.sections,function(i,a){return e("ChapterPreview",{key:i.$path,attrs:{section:i,index:a,number_of_sections:t.sections.length,can_edit:t.can_edit},on:{open:function(n){return t.openSection(i.$path)},moveSection:t.moveSection,remove:function(n){return t.$emit("removeChapter",i)}}})}),e("div",{key:"'add'",staticClass:"_addSection"},[t.can_edit?e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(i){return t.createSection({type:"text"})}}},[e("b-icon",{attrs:{icon:"plus-lg"}}),t._v(" "+t._s(t.$t("text"))+" ")],1):t._e(),t.can_edit?e("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:function(i){return t.createSection({type:"gallery"})}}},[e("b-icon",{attrs:{icon:"plus-lg"}}),t._v(" "+t._s(t.$t("gallery"))+" ")],1):t._e()])],2)],1)])},R=[],L=l(I,D,R,!1,null,"deff03bf");const V=L.exports,W={name:"PickMediaForMarkdown",components:{MediaPicker:m},props:{publication_path:String},data(){return{show_media_picker:!1,medias_were_picked:!1,isCopied:!1,pick_medias_text:""}},methods:{pickMedias(s){this.medias_were_picked=!0,this.pick_medias_text=this.makeStringFromMedias(s)},makeStringFromMedias(s){let t=[];return s.map(e=>{let i="(";const a=e.$path.split("/").pop();let n;if(e.$type==="image")n="image";else if(e.$type==="video")n="video";else if(e.$type==="audio")n="audio";else throw new Error("Unknown media type");if(i+=`${n}: ${a}`,e.caption){const o=this.turnHtmlToMarkdown(e.caption);i+=` caption: ${o}`}i+=")",t.push(i)}),t.join(`
`)},turnHtmlToMarkdown(s){const t=document.createElement("div");t.innerHTML=s;let e="";const i=t.querySelectorAll("p");return i.forEach((a,n)=>{let o=a.textContent;a.querySelectorAll("a").forEach(c=>{const _=c.textContent,p=c.getAttribute("href");if(p){const u=`[${_}](${p})`;o=o.replace(_,u)}}),e+=o+(n<i.length-1?`
`:"")}),e},copyToClipboard(){this.isCopied=!1;var s=this.$refs.urlToCopy;s.select(),s.setSelectionRange(0,99999),navigator.clipboard.writeText(s.value),this.isCopied=!0},closePickModal(){this.medias_were_picked=!1,this.isCopied=!1,this.$emit("close")}}};var H=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pick-media-for-markdown"},[e("BaseModal2",{attrs:{title:t.$t("add_media")},on:{close:t.closePickModal}},[t.pick_medias_text?t._e():e("div",{staticClass:"u-spacingBottom"},[t._v(" "+t._s(t.$t("from_project"))+" "),e("b-icon",{attrs:{icon:"arrow-right"}}),t._v("  "),e("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:function(i){t.show_media_picker=!0}}},[e("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"image"}}),t._v(" "+t._s(t.$t("import"))+" ")],1)],1),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication_path,select_mode:"multiple",pick_from_types:["image","video","audio"]},on:{pickMedias:t.pickMedias,close:function(i){t.show_media_picker=!1}}}):t._e(),t.pick_medias_text?e("div",{staticClass:"u-spacingBottom u-inputGroup"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.pick_medias_text,expression:"pick_medias_text"}],ref:"urlToCopy",staticClass:"_textField",domProps:{value:t.pick_medias_text},on:{input:function(i){i.target.composing||(t.pick_medias_text=i.target.value)}}}),t._v(" "),e("button",{staticClass:"u-button u-button_icon u-suffix _clipboardBtn",attrs:{type:"button"},on:{click:t.copyToClipboard}},[t.isCopied?e("b-icon",{attrs:{icon:"clipboard-check"}}):e("b-icon",{attrs:{icon:"clipboard"}})],1)]):e("div",{staticClass:"u-spacingBottom"},[e("hr"),t._v(" "+t._s(t.$t("multisupport_embed_img_instr"))+" "),e("ul",[e("li",[e("code",[t._v("(image: https://www.example.com/url-vers-l-image.jpeg) ")])]),e("li",[e("code",[t._v("(video: https://www.example.com/url-vers-la-video.mp4) ")])]),e("li",[e("code",[t._v("(audio: https://www.example.com/url-vers-la-musique.mp3) ")])]),e("li",[e("code",[t._v("(embed: https://peertube.fr/w/wB6M6CHdfpWXpozVnqjbde) ")])]),e("li",[e("code",[t._v("(embed: https://www.youtube.com/watch?v=Bn6zdyCAwJs) ")])]),e("li",[e("code",[t._v("(embed: https://scratch.mit.edu/projects/1061783643) ")])])])]),e("div",{staticClass:"u-spacingBottom"},[t._v(" "+t._s(t.$t("attributes_for_embeds"))+" "),e("ul",[e("li",[e("code",[t._v("caption: Ma légende")])]),e("li",[e("code",[t._v("class: nomDeLaClasse")])])])]),e("div",[t._v(" "+t._s(t.$t("for_example"))+" "),e("div",[e("code",[t._v("(embed: https://peertube.fr/w/wB6M6CHdfpWXpozVnqjbde caption: Voici une vidéo de PeerTube class: maClass)")])])]),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("copy_paste_to_include_media"))+" ")])],1)],1)},q=[],A=l(W,H,q,!1,null,"d8977bdf");const G=A.exports,z={props:{chapter:Object,prev_section:Object,next_section:Object,publication_path:String,can_edit:Boolean},components:{PickMediaForMarkdown:G,MediaPicker:m},data(){return{show_media_picker:!1}},created(){},mounted(){},beforeDestroy(){},watch:{main_text_content:{handler(s){s&&this.listAllEmbeddedMedias(s)},deep:!0}},computed:{content_type(){var s;return((s=this.chapter._main_text)==null?void 0:s.content_type)||"html"},custom_formats(){if(this.content_type==="markdown")return[]},save_format(){return this.content_type==="html"?"html":this.content_type==="markdown"?"raw":"html"},main_text_content(){var s;return(s=this.chapter._main_text)==null?void 0:s.$content},gallery_medias(){const s=[];if(this.chapter.section_type!=="gallery"||!this.chapter.source_medias)return[];for(const t of this.chapter.source_medias){const e=this.getParent(this.chapter.$path),i=this.getSourceMedia({source_media:t,folder_path:e});i&&s.push(i)}return s}},methods:{listAllEmbeddedMedias(s){let t=[];const e=new $;e.use(b,{getMediaSrc:n=>{const o=this.getParent(this.chapter.$path);return this.getSourceMedia({source_media:{meta_filename_in_project:n},folder_path:o})},vue_instance:this});const i=e.renderer.rules.image||function(n,o,r,c,_){return _.renderToken(n,o,r)};e.renderer.rules.image=(n,o,r,c,_)=>{const p=n[o],u=p.attrIndex("src");if(u>=0){const h=p.attrs[u][1],f=this.getParent(this.chapter.$path);this.getSourceMedia({source_media:{meta_filename_in_project:h},folder_path:f})&&t.push({meta_filename_in_project:h})}return i(n,o,r,c,_)};const a=e.renderer.rules.csc;e.renderer.rules.csc=(n,o)=>{const r=n[o];if(r.tag==="image"&&r.content){const c=r.content,_=this.getParent(this.chapter.$path);this.getSourceMedia({source_media:{meta_filename_in_project:c},folder_path:_})&&t.push({meta_filename_in_project:c})}return a?a(n,o):""},e.render(s),t=t.filter((n,o,r)=>o===r.findIndex(c=>c.meta_filename_in_project===n.meta_filename_in_project)),JSON.stringify(t)!==JSON.stringify(this.chapter.source_medias)&&this.$api.updateMeta({path:this.chapter.$path,new_meta:{source_medias:t}})},closePickModal(){this.show_media_picker=!1},async pickMediasForGallery(s){const t=[];for(const a of s){const n=await this.prepareMediaForPublication({path_to_source_media_meta:a.$path,publication_path:this.publication_path});t.push(n)}const i=[...this.chapter.source_medias||[],...t];this.$api.updateMeta({path:this.chapter.$path,new_meta:{source_medias:i}})},removeMedia(s){const t=this.chapter.source_medias.filter(e=>e.meta_filename_in_project!==this.getFilename(s.$path));this.$api.updateMeta({path:this.chapter.$path,new_meta:{source_medias:t}})}}};var N=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openChapter"},[e("div",{staticClass:"_close_button"},[e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("div",{staticClass:"_openChapter--content"},[e("div",{staticClass:"_topButtons"},[e("TitleField",{attrs:{field_name:"section_title",content:t.chapter.section_title,maxlength:40,tag:"h1",path:t.chapter.$path,can_edit:t.can_edit}}),e("DropDown",{attrs:{right:!0,show_label:!1}},[e("RemoveMenu",{on:{remove:function(i){return t.$emit("remove")}}})],1)],1),e("div",{staticClass:"_content--type"},[t._v(" "+t._s(t.$t("type"))+" : "+t._s(t.chapter.section_type)+" ")]),e("div",{staticClass:"_content"},[t.chapter.section_type==="text"?[t.chapter._main_text?[e("DLabel",{attrs:{str:t.$t("content")}}),e("CollaborativeEditor3",{attrs:{content:t.main_text_content,path:t.chapter._main_text.$path,custom_formats:t.custom_formats,save_format:t.save_format,content_type:"markdown",can_edit:t.can_edit,mode:"always_active"},scopedSlots:t._u([{key:"custom_buttons",fn:function(){return[e("button",{staticClass:"u-button u-button_bleumarine _customBtn",attrs:{type:"button"},on:{click:function(i){t.show_media_picker=!t.show_media_picker}}},[t._v(" "+t._s(t.$t("import_medias"))+" ")])]},proxy:!0}],null,!1,2050969443)}),t.show_media_picker?e("PickMediaForMarkdown",{attrs:{publication_path:t.publication_path},on:{close:t.closePickModal}}):t._e()]:[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("no_content"))+" ")])]]:t._e(),t.chapter.section_type==="gallery"?[e("transition-group",{staticClass:"_gallery",attrs:{tag:"div",name:"StoryModules",appear:""}},[t._l(t.gallery_medias,function(i){return e("div",{key:i.$path,staticClass:"_gallery--item"},[e("MediaContent",{attrs:{file:i,context:"full"}}),e("div",{staticClass:"_remove_media"},[e("RemoveMenu",{attrs:{show_button_text:!1},on:{remove:function(a){return t.removeMedia(i)}}})],1)],1)}),e("div",{key:"add_medias",staticClass:"_add_medias"},[e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(i){t.show_media_picker=!0}}},[t._v(" "+t._s(t.$t("add_medias"))+" ")])])],2),t.show_media_picker?e("MediaPicker",{attrs:{publication_path:t.publication_path,select_mode:"multiple",pick_from_types:["image","video","audio"]},on:{pickMedias:t.pickMediasForGallery,close:function(i){t.show_media_picker=!1}}}):t._e()]:t._e()],2),e("div",{staticClass:"_navBtns"},[e("div",{staticClass:"_navBtns--content"},[t.prev_section?e("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:function(i){return t.$emit("prev")}}},[e("b-icon",{attrs:{icon:"arrow-left-square"}}),e("span",[t._v(" "+t._s(t.prev_section.section_title)+" ")])],1):t._e(),t.next_section?e("button",{staticClass:"u-linkList",attrs:{type:"button"},on:{click:function(i){return t.$emit("next")}}},[e("span",[t._v(" "+t._s(t.next_section.section_title)+" ")]),e("b-icon",{attrs:{icon:"arrow-right-square"}})],1):t._e()])])])])},J=[],X=l(z,N,J,!1,null,"d14e763b");const U=X.exports,K={props:{style_file:Object,default_styles:String,show_source_html:Boolean},components:{},data(){return{show_reset_modal:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{pretty_default_styles(){return w.highlight(this.default_styles,{language:"css"}).value}},methods:{async resetCustom(){this.$refs.styleEditor.restoreVersion(this.default_styles),this.show_reset_modal=!1}}};var Q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_openedStyleFile"},[e("TitleField",{attrs:{label:t.$t("name"),field_name:"css_title",tag:"h2",content:t.style_file.css_title,path:t.style_file.$path,maxlength:40,can_edit:!0}}),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"_topBtns"},[e("ToggleInput",{attrs:{content:t.show_source_html,label:t.$t("show_source_html")},on:{"update:content":function(i){return t.$emit("update:show_source_html",i)}}}),e("button",{key:"resetCustom",staticClass:"u-buttonLink u-buttonLink_red",attrs:{type:"button"},on:{click:function(i){t.show_reset_modal=!0}}},[t._v(" "+t._s(t.$t("back_to_default_styles"))+" ")]),t.show_reset_modal?e("BaseModal2",{attrs:{title:t.$t("back_to_default_styles")},on:{close:function(i){t.show_reset_modal=!1},save:t.resetCustom}},[e("div",{staticClass:"_code"},[e("pre",{domProps:{innerHTML:t._s(t.pretty_default_styles)}})]),e("template",{slot:"footer"},[e("SaveCancelButtons",{attrs:{cancel_text:t.$t("cancel"),save_text:t.$t("reset")},on:{save:t.resetCustom,cancel:function(i){t.show_reset_modal=!1}}})],1)],2):t._e()],1),e("CollaborativeEditor3",{key:t.style_file.$path,ref:"styleEditor",attrs:{content:t.style_file.$content,path:t.style_file.$path,custom_formats:[],save_format:"raw",mode:"always_active",can_edit:!0}}),e("div",{staticClass:"u-spacingBottom"})],1)},Y=[],Z=l(K,Q,Y,!1,null,"0a141a08");const tt=Z.exports,et={props:{publication:Object,opened_style_file_meta:String,show_source_html:Boolean},components:{OpenedGraphicStyles:tt},data(){return{default_styles:d,show_create_css_modal:!1,new_css_title:""}},created(){var s;((s=this.style_files)==null?void 0:s.length)>0&&this.openStyleFile(this.style_files[0].$path)},mounted(){},beforeDestroy(){this.$emit("update:show_source_html",!1)},watch:{},computed:{style_files(){var s;return(s=this.publication.$files)==null?void 0:s.filter(t=>t.is_css_styles===!0).sort((t,e)=>{const i=t.css_title||this.getFilename(t.$path),a=e.css_title||this.getFilename(e.$path);if(i<a)return-1;if(i>a)return 1})},opened_style_file(){return this.style_files.find(s=>this.getFilename(s.$path)===this.opened_style_file_meta)}},methods:{async createCustomStylesheet(){const s=this.new_css_title+".css",{meta_filename:t}=await this.$api.uploadText({path:this.publication.$path,filename:s,content:d,additional_meta:{$type:"text",css_title:this.new_css_title,is_css_styles:!0}});this.new_css_title="",this.show_create_css_modal=!1,this.$emit("setStyleFile",t)},async resetCustom(){this.$refs.styleEditor.restoreVersion(d)},openStyleFile(s){this.$emit("setStyleFile",this.getFilename(s))}}};var it=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_editGraphicStyles"},[e("div",{staticClass:"_close_button"},[e("button",{staticClass:"u-button u-button_icon",attrs:{type:"button"},on:{click:function(i){return t.$emit("close")}}},[e("b-icon",{attrs:{icon:"x-lg",label:t.$t("close")}})],1)]),e("div",{staticClass:"_topTabs"},[t._l(t.style_files,function(i){var a;return e("button",{key:i.$path,staticClass:"u-button",class:{"is--active":((a=t.opened_style_file)==null?void 0:a.$path)===i.$path},attrs:{type:"button"},on:{click:function(n){return t.openStyleFile(i.$path)}}},[t._v(" "+t._s(i.css_title||t.getFilename(i.$path))+" ")])}),e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(i){t.show_create_css_modal=!0}}},[t._v(" "+t._s(t.$t("create_custom_stylesheet"))+" ")]),t.show_create_css_modal?e("BaseModal2",{attrs:{title:t.$t("create_custom_stylesheet")},on:{close:function(i){t.show_create_css_modal=!1},save:t.createCustomStylesheet},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div"),e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.createCustomStylesheet}},[t._v(" "+t._s(t.$t("create_and_open"))+" ")])]},proxy:!0}],null,!1,479890664)},[e("DLabel",{attrs:{str:t.$t("name")}}),e("TextInput",{ref:"titleInput",attrs:{content:t.new_css_title,maxlength:40,required:!0,autofocus:!0},on:{"update:content":function(i){t.new_css_title=i},toggleValidity:i=>t.allow_save=i,onEnter:t.createCustomStylesheet}})],1):t._e()],2),e("div",{staticClass:"_openedStyleFile"},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.opened_style_file?e("OpenedGraphicStyles",{key:t.opened_style_file.$path,attrs:{style_file:t.opened_style_file,default_styles:t.default_styles,show_source_html:t.show_source_html},on:{"update:show_source_html":function(i){return t.$emit("update:show_source_html",i)}}}):t._e()],1)],1)])},st=[],at=l(et,it,st,!1,null,"a798c17c");const nt=at.exports,ot={props:{publication:Object,pane_infos:Object,can_edit:Boolean},components:{Splitpanes:v,Pane:y,ChaptersSummary:V,OpenChapter:U,ViewContent:g,EditGraphicStyles:nt,PublicationSettings:C,WidthHeightField:k},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{show_edit_pane:!0,show_preview_pane:!0,show_source_html:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{view_mode(){var s;return((s=this.pane_infos)==null?void 0:s.view_mode)||"book"},all_chapters(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"}).map(s=>(s.main_text_meta&&(s._main_text=this.publication.$files.find(t=>t.$path.endsWith("/"+s.main_text_meta))),s.section_type||(s.section_type="text"),s))},opened_section_meta_filename(){return this.pane_infos.chapter},opened_chapter(){return this.opened_section_meta_filename?this.all_chapters.find(s=>s.$path.endsWith(this.opened_section_meta_filename)):!1},prev_section(){if(!this.opened_chapter)return!1;const s=this.all_chapters.findIndex(t=>t.$path.endsWith(this.opened_section_meta_filename));return this.all_chapters[s-1]},next_section(){if(!this.opened_chapter)return!1;const s=this.all_chapters.findIndex(t=>t.$path.endsWith(this.opened_section_meta_filename));return this.all_chapters[s+1]},open_graphic_styles(){var s;return((s=this.pane_infos)==null?void 0:s.edit_graphics)===!0},opened_style_file_meta(){var s;return(s=this.pane_infos)==null?void 0:s.style},meta_filenames_already_present(){let s=[],t=[];return this.all_chapters.forEach(e=>{Array.isArray(e.source_medias)&&e.source_medias.forEach(i=>{this.getFilename(e.$path)===this.opened_section_meta_filename?s.push(i.meta_filename_in_project):t.push(i.meta_filename_in_project)})}),[{label:this.$t("in_this_section"),medias:s,color:"var(--c-orange)"},{label:this.$t("in_another_section"),medias:t,color:"var(--c-bleuvert)"}]}},methods:{openChapter(s){const e=this.all_chapters.findIndex(i=>i.$path.endsWith(this.opened_section_meta_filename))+s;e>=0&&e<=this.all_chapters.length-1&&this.$emit("updatePane",{key:"chapter",value:this.all_chapters[e].$path})},async removeChapter(s){s._main_text&&await this.$api.deleteItem({path:s._main_text.$path}),await this.$api.deleteItem({path:s.$path})}}};var rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_editionTemplate"},[t.can_edit?e("splitpanes",{staticClass:"_splitpanes"},[t.show_edit_pane?e("pane",[e("div",{staticClass:"_chapterSummary"},[e("div",{staticClass:"_showPreviewBtn"},[e("ToggleInput",{attrs:{content:t.show_preview_pane,label:t.$t("show_preview")+" ➵"},on:{"update:content":function(i){t.show_preview_pane=i}}})],1),e("ChaptersSummary",{attrs:{publication:t.publication,sections:t.all_chapters,opened_section_meta_filename:t.opened_section_meta_filename,can_edit:t.can_edit},on:{removeChapter:t.removeChapter,toggleSection:function(i){return t.$emit("updatePane",{key:"chapter",value:i})}}})],1),e("div",{staticClass:"_editGraphics"},[e("button",{staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(i){return t.$emit("updatePane",{key:"edit_graphics",value:!0})}}},[t._v(" "+t._s(t.$t("graphic_styles"))+" ")])]),e("transition",{attrs:{name:"scaleInFade_fast",mode:"in-out"}},[t.open_graphic_styles?e("EditGraphicStyles",{key:"edit_graphics",attrs:{publication:t.publication,opened_style_file_meta:t.opened_style_file_meta,show_source_html:t.show_source_html},on:{"update:show_source_html":function(i){t.show_source_html=i},close:function(i){return t.$emit("updatePane",{key:"edit_graphics",value:!1})},setStyleFile:function(i){return t.$emit("updatePane",{key:"style",value:i})}}}):t.opened_chapter?e("OpenChapter",{key:t.opened_chapter.$path,attrs:{chapter:t.opened_chapter,prev_section:t.prev_section,next_section:t.next_section,can_edit:t.can_edit,publication_path:t.publication.$path},on:{remove:function(i){return t.removeChapter(t.opened_chapter)},close:function(i){return t.$emit("updatePane",{key:"chapter",value:!1})},prev:function(i){return t.openChapter(-1)},next:function(i){return t.openChapter(1)}}}):t._e()],1)],1):t._e(),t.show_preview_pane?e("pane",[e("div",{staticClass:"_viewer"},[e("ViewContent",{attrs:{publication:t.publication,opened_chapter_meta_filename:t.opened_section_meta_filename,view_mode:t.view_mode,opened_style_file_meta:t.opened_style_file_meta,show_source_html:t.show_source_html,can_edit:t.can_edit},on:{"update:show_source_html":function(i){t.show_source_html=i},openChapter:function(i){return t.$emit("updatePane",{key:"chapter",value:i})},changeView:function(i){return t.$emit("updatePane",{key:"view_mode",value:i})},setStyleFile:function(i){return t.$emit("updatePane",{key:"style",value:i})}}})],1)]):t._e()],1):t._e(),t.can_edit?e("PublicationSettings",[e("WidthHeightField",{attrs:{publication:t.publication,force_layout_mode:"print"}})],1):e("ViewContent",{attrs:{publication:t.publication,opened_chapter_meta_filename:t.opened_section_meta_filename,view_mode:t.view_mode,opened_style_file_meta:t.opened_style_file_meta,viewer_type:"div",can_edit:!1},on:{openChapter:function(i){return t.$emit("updatePane",{key:"chapter",value:i})},changeView:function(i){return t.$emit("updatePane",{key:"view_mode",value:i})},setStyleFile:function(i){return t.$emit("updatePane",{key:"style",value:i})}}})],1)},ct=[],_t=l(ot,rt,ct,!1,null,"3648855e");const $t=_t.exports;export{$t as default};
