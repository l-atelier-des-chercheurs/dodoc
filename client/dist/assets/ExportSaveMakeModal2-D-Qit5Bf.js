import{S as h}from"./PublicationTopbar-ClzGLCPm.js";import{n as l}from"../build.js";const p={props:{base_instructions:Object,make_path:String,reference_media:Object,possible_formats:Array,allow_disable_audio:Boolean,default_resolution_preset:{type:String,default:"source"}},components:{ShowExportedFileInfos:h},data(){return{is_exporting:!1,created_video:!1,resolution_preset_picked:this.default_resolution_preset,progress_percent:0,output_format:"mp4",custom_resolution_width:1920,custom_resolution_height:1080,custom_bitrate:4e3,keep_audio_track:!0}},created(){},mounted(){this.reference_media&&(this.custom_resolution_width=this.ref_infos.width,this.custom_resolution_height=this.ref_infos.height)},beforeDestroy(){},watch:{},computed:{export_href(){return this.created_video?this.makeMediaFileURL({$path:this.created_video.$path,$media_filename:this.created_video.$media_filename}):""},export_name(){return this.created_video?this.created_video.$media_filename:""},ref_infos(){if(!this.reference_media)return{};let{width:i,height:t,ratio:e}=this.reference_media.$infos;return i&&(i=Math.ceil(i/2)*2),t&&(t=Math.ceil(t/2)*2),{width:i,height:t,ratio:e}},presets(){const i=[];return i.push({key:"source",text:this.$t("close_to_source"),width:this.ref_infos.width,height:this.ref_infos.height,bitrate:4e3}),i.push({key:"high",text:this.$t("high"),width:1920,height:1080,bitrate:4e3}),i.push({key:"medium",text:this.$t("medium"),width:1280,height:720,bitrate:2e3}),i.push({key:"rough",text:this.$t("rough"),width:640,height:360,bitrate:1e3}),i.push({key:"custom",text:"â†“ "+this.$t("custom_f")}),i.map(t=>(t.key!=="custom"&&(t.instructions=this.$t("resolution_w_h",{width:t.width,height:t.height})+", "+this.$t("bitrate_kbps",{bitrate:t.bitrate}).toLowerCase()),t))}},methods:{async renderVideo(){var c;this.progress_percent=0,this.is_exporting=!0,this.created_video=!1;let i=Object.assign({},this.base_instructions);const t={};t.$origin="make",(c=this.connected_as)!=null&&c.$path&&(t.$authors=[this.connected_as.$path]);let e=1920,s=1080,n=4e3;if(this.resolution_preset_picked==="custom")e=this.custom_resolution_width,s=this.custom_resolution_height,n=this.custom_bitrate;else{const r=this.presets.find(o=>o.key===this.resolution_preset_picked);e=r.width,s=r.height,n=r.bitrate}this.possible_formats&&(i.output_format=this.output_format),this.allow_disable_audio&&(i.keep_audio_track=this.keep_audio_track);const a=await this.$api.exportFolder({path:this.make_path,instructions:{...i,output_width:e,output_height:s,video_bitrate:n,additional_meta:t}});this.$api.join({room:"task_"+a});const d=({task_id:r,progress:o})=>{r===a&&(this.progress_percent=o)};this.$eventHub.$on("task.status",d);const _=({task_id:r,message:o})=>{r===a&&(this.$eventHub.$off("task.ended",_),this.$api.leave({room:"task_"+a}),o.event==="completed"?(this.created_video=o.file,this.$nextTick(()=>{const u=this.$el.querySelector("video");u&&(u.volume=1)})):o.event==="aborted"||o.event==="failed"&&o.info,this.progress_percent=100,this.is_exporting=!1)};this.$eventHub.$on("task.ended",_)},cancelExport(){this.created_video&&this.$api.deleteItem({path:this.created_video.$path}),this.created_video=!1},removeAndCloseModal(){this.created_video&&this.$api.deleteItem({path:this.created_video.$path}),this.$emit("close")},async saveToProject(){this.$eventHub.$emit("pane.animate","collect"),this.$alertify.closeLogOnClick(!0).delay(4e3).success(this.$t("media_was_saved_to_project")),this.$emit("close")}}};var f=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{title:t.$t("make")},on:{close:t.removeAndCloseModal}},[e("div",{staticClass:"_cont"},[t.created_video?[e("div",{staticClass:"_preview"},[e("MediaContent",{attrs:{file:t.created_video,resolution:1600,show_fs_button:!0,context:"full"}}),e("div",{staticClass:"u-spacingBottom"}),e("ShowExportedFileInfos",{attrs:{file:t.created_video}})],1)]:[t.possible_formats?e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("format")}}),e("SelectField2",{attrs:{value:t.output_format,options:t.possible_formats,can_edit:!0,hide_validation:!0},on:{change:function(s){t.output_format=s}}})],1):t._e(),e("div",[e("DLabel",{attrs:{str:t.$t("quality")}}),e("div",{},[e("SelectField2",{attrs:{value:t.resolution_preset_picked,options:t.presets,can_edit:!0,hide_validation:!0},on:{change:function(s){t.resolution_preset_picked=s}}})],1),t.resolution_preset_picked==="custom"?e("div",[e("div",{staticClass:"u-spacingBottom"}),e("CustomResolutionInput",{attrs:{width:t.custom_resolution_width,height:t.custom_resolution_height,ratio:t.ref_infos.ratio,is_video:!0},on:{"update:width":function(s){t.custom_resolution_width=s},"update:height":function(s){t.custom_resolution_height=s}}}),e("div",{staticClass:"u-spacingBottom"}),e("NumberInput",{attrs:{label:t.$t("bitrate"),instructions:t.$t("bitrate_instructions"),value:t.custom_bitrate,min:0,suffix:"kbps",size:"normal"},on:{"update:value":function(s){t.custom_bitrate=s}}})],1):t._e()],1),t.allow_disable_audio?e("div",[e("div",{staticClass:"u-spacingBottom"}),e("ToggleInput",{attrs:{content:t.keep_audio_track,label:t.$t("keep_audio_track")},on:{"update:content":function(s){t.keep_audio_track=s}}})],1):t._e()]],2),e("template",{slot:"footer"},[!t.created_video&&!t.is_exporting?[e("div"),e("div",[e("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.renderVideo}},[e("b-icon",{attrs:{icon:"tools"}}),t._v(" "+t._s(t.$t("preview_new"))+" ")],1),e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("wont_remove_original").toLowerCase())+" ")])])]:t.is_exporting?[e("div",{key:"loader",staticClass:"_spinner"},[e("AnimatedCounter",{attrs:{value:t.progress_percent}})],1)]:e("div",{staticClass:"_bottomBtns"},[e("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:t.cancelExport}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),e("div",{staticClass:"_rightRow"},[e("a",{staticClass:"u-buttonLink",attrs:{disabled:!t.export_href,download:t.export_name,href:t.export_href,target:"_blank"}},[t._v(" "+t._s(t.$t("download"))+" ")]),e("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:t.saveToProject}},[e("span",{staticClass:"u-icon",domProps:{innerHTML:t._s(t.dodoc_icon_collect)}}),t._v(" "+t._s(t.$t("save_to_project"))+" ")])])])],2)],2)},m=[],v=l(p,f,m,!1,null,"2e742efd");const $=v.exports;export{$ as E};
