(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[408],{82566:function(e,t,s){"use strict";s.d(t,{Z:function(){return p}});var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"_keywordsField"},[e.label?s("DLabel",{staticClass:"_label",attrs:{str:e.label}}):e._e(),e.keywords.length>0?s("div",{staticClass:"u-keywords"},e._l(e.keywords,(function(e){return s("SingleKeyword",{key:e,attrs:{keyword:e}})})),1):e._e(),e.can_edit?s("EditBtn",{on:{click:e.enableEditMode}}):e._e(),e.edit_mode?s("BaseModal2",{attrs:{title:e.label},on:{close:function(t){e.edit_mode=!1}}},[e.new_keywords.length>0?s("div",{staticClass:"u-keywords"},e._l(e.new_keywords,(function(t){return s("SingleKeyword",{key:t,attrs:{keyword:t,can_remove:!0},on:{remove:function(s){return e.removeKeyword(t)}}})})),1):e._e(),s("hr"),s("KeywordsFieldEditor",{attrs:{keywords:e.new_keywords},on:{"update:keywords":function(t){e.new_keywords=t}}}),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("SaveCancelButtons",{staticClass:"_scb",on:{save:e.updateKeywords,cancel:e.cancel}})],1)],1):e._e()],1)},a=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"_keywordsFieldEditor"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.user_suggestion,expression:"user_suggestion"}],ref:"keywordField",attrs:{type:"text",required:"",placeholder:e.$t("keyword_materials_etc")},domProps:{value:e.user_suggestion},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:(t.preventDefault(),e.$emit("cancelEdit"))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.newKeyword.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.shiftKey?t.ctrlKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.submitFirstSuggestion.apply(null,arguments)):null}],input:function(t){t.target.composing||(e.user_suggestion=t.target.value)}}}),s("div",{staticClass:"u-instructions"},[s("small",[e.suggested_keywords.length>0?[e._v(" "+e._s(e.$t("validate_with_shift_enter"))+" ")]:e.user_suggestion.length>0?[e._v(e._s(e.$t("create_new_keyword_enter")))]:e._e()],2)]),s("div",{staticClass:"_catSug"},[e.suggestion_from_category?s("div",[s("button",{staticClass:"u-button _category",style:e.getCatColor(e.suggestion_from_category),attrs:{type:"button"},on:{click:function(t){return e.toggleCategory(e.suggestion_from_category)}}},[e._v(" "+e._s(e.suggestion_from_category)+" ("+e._s(e.matchingKeywordsWithCategory(e.suggestion_from_category).length)+")   "),s("b-icon",{attrs:{icon:"x-circle"}})],1)]):s("div",{staticClass:"_categories"},e._l(e.categories_with_keywords,(function(t){return s("button",{key:t,staticClass:"u-button _category",style:e.getCatColor(t),attrs:{type:"button"},on:{click:function(s){return e.toggleCategory(t)}}},[e._v(" "+e._s(t)+" ("+e._s(e.matchingKeywordsWithCategory(t).length)+") ")])})),0),e.suggested_keywords.length>0?s("div",{staticClass:"_suggestions"},[s("div",{staticClass:"u-keywords"},e._l(e.suggested_keywords,(function(t,o){return s("SingleKeyword",{key:t,class:{"is--first":0===o},attrs:{keyword:t,can_add:!0},on:{add:function(s){return e.addKeyword(t)}}})})),1)]):e._e()])])},r=[],n=(s(70560),s(76801),s(92176),s(7961),s(1895)),d={props:{keywords:Array},components:{SingleKeyword:n.Z},data(){return{user_suggestion:"",suggestion_from_category:!1,categories:[],path:"categories"}},i18n:{messages:{fr:{validate_with_shift_enter:"Validez la première suggestion avec SHIFT+ENTRÉE, ou créez un nouveau mot-clé avec ENTRÉE.",create_new_keyword_enter:"Créez un nouveau mot-clé avec ENTRÉE."},en:{validate_with_shift_enter:"Add first suggestion with SHIFT+ENTER, or create a new keyword with ENTER.",create_new_keyword_enter:"Create a new keyword with ENTER."}}},async created(){this.categories=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},async mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{all_categories(){return this.categories.map((e=>e.title))},all_keywords(){return this.categories.reduce(((e,t)=>(t.title&&t.list_of_suggestions&&t.list_of_suggestions.map((s=>{e.push(t.title+"/"+s)})),e)),[])},categories_with_keywords(){return this.all_categories.filter((e=>this.matchingKeywordsWithCategory(e).length>0))},suggested_keywords(){return this.matchingKeywordsWithCategory(this.suggestion_from_category)}},methods:{matchingKeywordsWithCategory(e){return this.all_keywords.filter((t=>{const s=!!t.includes("/")&&t.split("/").at(0),o=t.includes("/")?t.split("/").at(1):t;return!this.keywords.includes(t)&&((!e||e===s)&&(!(!e&&0===this.user_suggestion.length)&&this.twoStringsMatch(o,this.user_suggestion)))}))},toggleCategory(e){this.suggestion_from_category===e?this.suggestion_from_category=!1:this.suggestion_from_category=e},getCatColor(e){const t=window.app_infos.custom_suggested_categories.find((t=>t.title===e));if(t?.tag_color)return`--cat-color: ${t.tag_color}`},newKeyword(){this.user_suggestion.length>0&&this.addKeyword(this.user_suggestion)},submitFirstSuggestion(){if(0===this.suggested_keywords.length)return!1;const e=this.suggested_keywords.at(0);this.addKeyword(e)},keywordKey(e){return e.category+"/"+e.name},addKeyword(e){let t=this.keywords.slice();t.push(e),t.sort(((e,t)=>t)),this.$emit("update:keywords",t),this.user_suggestion="",this.$refs.keywordField.focus()}}},c=d,l=(s(78631),s(1001)),u=(0,l.Z)(c,i,r,!1,null,"bf8392da",null),_=u.exports,g={props:{field_name:String,label:String,path:String,keywords:{type:Array,default:()=>[]},can_edit:Boolean},components:{KeywordsFieldEditor:_,SingleKeyword:n.Z},data(){return{new_keywords:this.keywords||[],edit_mode:this.can_edit&&!this.path&&!this.field_name,is_saving:!1}},created(){},mounted(){},beforeDestroy(){},watch:{new_keywords(){this.$emit("update:keywords",this.new_keywords)}},computed:{},methods:{enableEditMode(){this.edit_mode=!0},async updateKeywords(){this.is_saving=!0,await new Promise((e=>setTimeout(e,50)));try{const e={[this.field_name]:this.new_keywords};await this.$api.updateMeta({path:this.path,new_meta:e}),this.edit_mode=!1,this.is_saving=!1}catch(e){this.is_saving=!1}},cancel(){this.new_keywords=this.keywords||[],this.edit_mode=!1},removeKeyword(e){this.new_keywords=this.new_keywords.filter((t=>t!==e))}}},h=g,y=(0,l.Z)(h,o,a,!1,null,"81aef24e",null),p=y.exports},1895:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"_singleKeyword",class:{"is--clickable":e.can_add},style:e.kw_styles},[s("div",{},[e.category?s("div",{staticClass:"_category"},[e._v(" "+e._s(e.category.toUpperCase())+" ")]):e._e(),s("div",{staticClass:"_name"},[e._v(" "+e._s(e.name)+" ")])]),e.count?s("div",{staticClass:"_count"},[e._v(" "+e._s(e.count)+" ")]):e._e(),e.can_remove?s("b-icon",{staticClass:"_white",attrs:{icon:"dash-circle"},on:{click:function(t){return e.$emit("remove")}}}):e._e(),e.can_add?s("button",{staticClass:"_addBtn",attrs:{type:"button"},on:{click:function(t){return e.$emit("add")}}}):e._e()],1)},a=[],i=(s(76801),s(92176),s(7961),{props:{keyword:String,count:Number,cat_color:String,can_remove:Boolean,can_add:Boolean},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{category(){return!!this.keyword.includes("/")&&this.keyword.split("/").at(0)},name(){return this.keyword.includes("/")?this.keyword.split("/").at(1):this.keyword},kw_styles(){let e=!1;if(this.cat_color)e=this.cat_color;else{const t=window.app_infos.custom_suggested_categories.find((e=>e.title===this.category));e=t?.tag_color}return e?`--cat-color: ${e}`:""}},methods:{}}),r=i,n=(s(38985),s(1001)),d=(0,n.Z)(r,o,a,!1,null,"f2ad472e",null),c=d.exports},18408:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"_agoraExport"},[s("div",{ref:"agoraView",staticClass:"_agoraExport--items",on:{scroll:e.onScroll}},e._l(e.section_modules_list,(function(t){return s("div",{key:t.$path,staticClass:"_item"},[e.getFirstSourceMedia(t.source_medias)?[s("MediaContent",{attrs:{file:e.getFirstSourceMedia(t.source_medias),resolution:1600,context:"full",show_fs_button:!1}})]:[s("div",[e._v("Erreur au chargement du média")])]],2)})),0),s("transition",{attrs:{name:"slideup"}},[e.currently_shown_module&&e.currently_shown_module.keywords?s("div",{key:e.currently_shown_module.$path,staticClass:"_agoraExport--bottom"},[s("KeywordsField",{attrs:{field_name:"keywords",keywords:e.currently_shown_module.keywords,can_edit:!1}})],1):e._e()])],1)},a=[],i=s(82566),r={props:{publication:Object},components:{KeywordsField:i.Z},data(){return{scroll_y:0,scroll_height:void 0}},created(){},mounted(){this.$nextTick((()=>{this.onResize()})),window.addEventListener("resize",this.onResize)},beforeDestroy(){window.removeEventListener("resize",this.onResize)},watch:{},computed:{first_section(){const e=this.getSectionsWithProps({publication:this.publication,group:"sections_list"});return e[0]},section_modules_list(){return this.getModulesForSection({publication:this.publication,section:this.first_section}).map((({_module:e})=>e))},currently_shown_module_index(){return Math.ceil(this.scroll_y/this.scroll_height-.1)},currently_shown_module(){return this.section_modules_list[this.currently_shown_module_index]}},methods:{onResize(){this.$refs.agoraView&&(this.scroll_height=this.$refs.agoraView.offsetHeight)},getFirstSourceMedia(e){const t=e[0];return!!t&&this.getSourceMedia({source_media:{meta_filename:t.meta_filename},folder_path:this.publication.$path})},onScroll(e){this.scroll_y=e.target.scrollTop}}},n=r,d=(s(84698),s(1001)),c=(0,d.Z)(n,o,a,!1,null,"1a51b8d1",null),l=c.exports},45223:function(e,t,s){"use strict";s.r(t);var o=s(8081),a=s.n(o),i=s(23645),r=s.n(i),n=r()(a());n.push([e.id,"._keywordsFieldEditor[data-v-bf8392da]{margin-top:calc(var(--spacing)/4)}._suggestions[data-v-bf8392da]{margin-top:calc(var(--spacing)/2);padding-top:calc(var(--spacing)/2)}._suggestions ._keyword[data-v-bf8392da]{cursor:pointer}._catSug[data-v-bf8392da]{padding:calc(var(--spacing)/2) 0}._categories[data-v-bf8392da]{display:flex;flex-flow:row wrap;padding:0;gap:calc(var(--spacing)/4)}._category[data-v-bf8392da]{padding:calc(var(--spacing)/4) calc(var(--spacing)/2);border-radius:4px;font-weight:600;background:var(--cat-color)}",""]),t["default"]=n},11666:function(e,t,s){"use strict";s.r(t);var o=s(8081),a=s.n(o),i=s(23645),r=s.n(i),n=r()(a());n.push([e.id,"._singleKeyword[data-v-f2ad472e]{position:relative;padding:calc(var(--spacing)/4) calc(var(--spacing)/2);border-radius:4px;line-height:1.2;display:flex;flex-flow:row nowrap;align-items:center;gap:calc(var(--spacing)/1);background-color:var(--cat-color,#fff);color:#000;transition:all .1s cubic-bezier(.19,1,.22,1)}._singleKeyword.is--clickable[data-v-f2ad472e]:hover{opacity:.7}._category[data-v-f2ad472e]{font-size:80%}._name[data-v-f2ad472e]{font-size:110%}._addBtn[data-v-f2ad472e]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;background:transparent}._count[data-v-f2ad472e]{border:1px solid currentColor;border-radius:10px;min-width:14px;height:14px;font-size:8px;display:flex;justify-content:center;align-items:center;font-weight:600}",""]),t["default"]=n},64315:function(e,t,s){"use strict";s.r(t);var o=s(8081),a=s.n(o),i=s(23645),r=s.n(i),n=r()(a());n.push([e.id,"._agoraExport[data-v-1a51b8d1]{display:flex;height:100vh}._agoraExport--items[data-v-1a51b8d1]{flex:1 1 auto;overflow-y:auto}._agoraExport--bottom[data-v-1a51b8d1]{position:absolute;padding:calc(var(--spacing)/1);padding-top:calc(var(--spacing)*2);-webkit-mask-image:linear-gradient(to top,#fff 0,#fff calc(100% - var(--spacing)*2),transparent 100%);mask-image:linear-gradient(to top,#fff 0,#fff calc(100% - var(--spacing)*2),transparent 100%);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);bottom:0;width:100%}._agoraExport--bottom[data-v-1a51b8d1]  .u-keywords{font-size:1.1rem}._item[data-v-1a51b8d1]{position:sticky;top:0;width:100%;height:100%;padding:10px;padding-bottom:calc(var(--spacing)*2);overflow:hidden}._item[data-v-1a51b8d1]  ._mediaContent{width:100%;height:100%}._item[data-v-1a51b8d1]  ._mediaContent img{width:100%;height:100%}._item[data-v-1a51b8d1]  ._mediaContent ._iframeStylePreview,._item[data-v-1a51b8d1]  ._mediaContent ._mediaContent--iframe,._item[data-v-1a51b8d1]  ._mediaContent ._mediaContent--image,._item[data-v-1a51b8d1]  ._mediaContent .plyr--video,._item[data-v-1a51b8d1]  ._mediaContent .plyr__poster{position:absolute;height:100%;width:100%;-o-object-fit:contain;object-fit:contain;background-size:contain}",""]),t["default"]=n},78631:function(e,t,s){var o=s(45223);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=s(31982).Z;a("9a1ab002",o,!0,{sourceMap:!1,shadowMode:!1})},38985:function(e,t,s){var o=s(11666);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=s(31982).Z;a("354422cf",o,!0,{sourceMap:!1,shadowMode:!1})},84698:function(e,t,s){var o=s(64315);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=s(31982).Z;a("7424b920",o,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=408.js.map