(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[570],{48733:function(t,e,o){"use strict";o.d(e,{Z:function(){return p}});var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"_keywordsField"},[t.label?o("DLabel",{staticClass:"_label",attrs:{str:t.label}}):t._e(),t.keywords.length>0?o("div",{staticClass:"u-keywords"},t._l(t.keywords,(function(t){return o("SingleKeyword",{key:t,attrs:{keyword:t}})})),1):t._e(),t.can_edit?o("EditBtn",{on:{click:t.enableEditMode}}):t._e(),t.edit_mode?o("BaseModal2",{attrs:{title:t.label},on:{close:function(e){t.edit_mode=!1}}},[t.new_keywords.length>0?o("div",{staticClass:"u-keywords"},t._l(t.new_keywords,(function(e){return o("SingleKeyword",{key:e,attrs:{keyword:e,can_remove:!0},on:{remove:function(o){return t.removeKeyword(e)}}})})),1):t._e(),o("hr"),o("KeywordsFieldEditor",{attrs:{keywords:t.new_keywords},on:{"update:keywords":function(e){t.new_keywords=e}}}),o("hr"),o("div",{},[o("DLabel",{attrs:{str:t.$t("advanced_options")}}),o("div",{staticClass:"u-sameRow"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.new_keywords_stringified,expression:"new_keywords_stringified"}],ref:"urlToCopy",attrs:{type:"text",size:"small"},domProps:{value:t.new_keywords_stringified},on:{input:function(e){e.target.composing||(t.new_keywords_stringified=e.target.value)}}}),o("button",{staticClass:"u-button u-button_icon u-suffix _clipboardBtn",attrs:{type:"button"},on:{click:t.copyToClipboard}},[t.is_copied?o("b-icon",{attrs:{icon:"clipboard-check"}}):o("b-icon",{attrs:{icon:"clipboard"}})],1)])],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("SaveCancelButtons",{staticClass:"_scb",on:{save:t.updateKeywords,cancel:t.cancel}})],1)],1):t._e()],1)},i=[],a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"_keywordsFieldEditor"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.user_suggestion,expression:"user_suggestion"}],ref:"keywordField",attrs:{type:"text",required:"",placeholder:t.$t("keyword_materials_etc")},domProps:{value:t.user_suggestion},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:(e.preventDefault(),t.$emit("cancelEdit"))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:(e.preventDefault(),t.newKeyword.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.shiftKey?e.ctrlKey||e.altKey||e.metaKey?null:(e.preventDefault(),t.submitFirstSuggestion.apply(null,arguments)):null}],input:function(e){e.target.composing||(t.user_suggestion=e.target.value)}}}),o("div",{staticClass:"u-instructions"},[o("small",[t.suggested_keywords.length>0?[t._v(" "+t._s(t.$t("validate_with_shift_enter"))+" ")]:t.user_suggestion.length>0?[t._v(t._s(t.$t("create_new_keyword_enter")))]:t._e()],2)]),o("div",{staticClass:"_catSug"},[t.suggestion_from_category?o("div",[o("button",{staticClass:"u-button _category",style:t.getCatColor(t.suggestion_from_category),attrs:{type:"button"},on:{click:function(e){return t.toggleCategory(t.suggestion_from_category)}}},[t._v(" "+t._s(t.suggestion_from_category)+" ("+t._s(t.matchingKeywordsWithCategory(t.suggestion_from_category).length)+")   "),o("b-icon",{attrs:{icon:"x-circle"}})],1)]):o("div",{staticClass:"_categories"},t._l(t.categories_with_keywords,(function(e){return o("button",{key:e,staticClass:"u-button _category",style:t.getCatColor(e),attrs:{type:"button"},on:{click:function(o){return t.toggleCategory(e)}}},[t._v(" "+t._s(e)+" ("+t._s(t.matchingKeywordsWithCategory(e).length)+") ")])})),0),t.suggested_keywords.length>0?o("div",{staticClass:"_suggestions"},[o("div",{staticClass:"u-keywords"},t._l(t.suggested_keywords,(function(e,s){return o("SingleKeyword",{key:e,class:{"is--first":0===s},attrs:{keyword:e,can_add:!0},on:{add:function(o){return t.addKeyword(e)}}})})),1)]):t._e()])])},r=[],n=(o(70560),o(76801),o(92176),o(7961),o(1895)),d={props:{keywords:Array},components:{SingleKeyword:n.Z},data(){return{user_suggestion:"",suggestion_from_category:!1,categories:[],path:"categories"}},i18n:{messages:{fr:{validate_with_shift_enter:"Validez la première suggestion avec SHIFT+ENTRÉE, ou créez un nouveau mot-clé avec ENTRÉE.",create_new_keyword_enter:"Créez un nouveau mot-clé avec ENTRÉE."},en:{validate_with_shift_enter:"Add first suggestion with SHIFT+ENTER, or create a new keyword with ENTER.",create_new_keyword_enter:"Create a new keyword with ENTER."}}},async created(){this.categories=await this.$api.getFolders({path:this.path}),this.$api.join({room:this.path})},async mounted(){},beforeDestroy(){this.$api.leave({room:this.path})},watch:{},computed:{all_categories(){return this.categories.map((t=>t.title))},all_keywords(){return this.categories.reduce(((t,e)=>(e.title&&e.list_of_suggestions&&e.list_of_suggestions.map((o=>{t.push(e.title+"/"+o)})),t)),[])},categories_with_keywords(){return this.all_categories.filter((t=>this.matchingKeywordsWithCategory(t).length>0))},suggested_keywords(){return this.matchingKeywordsWithCategory(this.suggestion_from_category)}},methods:{matchingKeywordsWithCategory(t){return this.all_keywords.filter((e=>{const o=!!e.includes("/")&&e.split("/").at(0),s=e.includes("/")?e.split("/").at(1):e;return!this.keywords.includes(e)&&((!t||t===o)&&(!(!t&&0===this.user_suggestion.length)&&this.twoStringsMatch(s,this.user_suggestion)))}))},toggleCategory(t){this.suggestion_from_category===t?this.suggestion_from_category=!1:this.suggestion_from_category=t},getCatColor(t){const e=window.app_infos.custom_suggested_categories.find((e=>e.title===t));if(e?.tag_color)return`--cat-color: ${e.tag_color}`},newKeyword(){this.user_suggestion.length>0&&this.addKeyword(this.user_suggestion)},submitFirstSuggestion(){if(0===this.suggested_keywords.length)return!1;const t=this.suggested_keywords.at(0);this.addKeyword(t)},keywordKey(t){return t.category+"/"+t.name},addKeyword(t){let e=this.keywords.slice();e.push(t),e.sort(((t,e)=>e)),this.$emit("update:keywords",e),this.user_suggestion="",this.$refs.keywordField.focus()}}},l=d,c=(o(78631),o(1001)),u=(0,c.Z)(l,a,r,!1,null,"bf8392da",null),_=u.exports,h={props:{field_name:String,label:String,path:String,keywords:{type:Array,default:()=>[]},can_edit:Boolean},components:{KeywordsFieldEditor:_,SingleKeyword:n.Z},data(){return{new_keywords:this.keywords||[],new_keywords_stringified:"",edit_mode:this.can_edit&&!this.path&&!this.field_name,is_saving:!1,is_copied:!1}},created(){},mounted(){},beforeDestroy(){},watch:{new_keywords:{immediate:!0,handler(t){this.$emit("update:keywords",t),this.new_keywords_stringified=t.join(", ")},deep:!0},new_keywords_stringified:{immediate:!0,handler(t){this.new_keywords=t?t.split(", ").map((t=>t.trim())):[]}}},computed:{},methods:{enableEditMode(){this.edit_mode=!0},async updateKeywords(){this.is_saving=!0,await new Promise((t=>setTimeout(t,50)));try{const t={[this.field_name]:this.new_keywords};await this.$api.updateMeta({path:this.path,new_meta:t}),this.edit_mode=!1,this.is_saving=!1}catch(t){this.is_saving=!1}},copyToClipboard(){this.is_copied=!1;var t=this.$refs.urlToCopy;t.select(),t.setSelectionRange(0,99999),navigator.clipboard.writeText(t.value),this.is_copied=!0},cancel(){this.new_keywords=this.keywords||[],this.edit_mode=!1},removeKeyword(t){this.new_keywords=this.new_keywords.filter((e=>e!==t))}}},g=h,w=(0,c.Z)(g,s,i,!1,null,"6cb6a657",null),p=w.exports},1895:function(t,e,o){"use strict";o.d(e,{Z:function(){return l}});var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"_singleKeyword",class:{"is--clickable":t.can_add},style:t.kw_styles},[o("div",{},[t.category?o("div",{staticClass:"_category"},[t._v(" "+t._s(t.category.toUpperCase())+" ")]):t._e(),o("div",{staticClass:"_name"},[t._v(" "+t._s(t.name)+" ")])]),t.count?o("div",{staticClass:"_count"},[t._v(" "+t._s(t.count)+" ")]):t._e(),t.can_remove?o("b-icon",{staticClass:"_white",attrs:{icon:"dash-circle"},on:{click:function(e){return t.$emit("remove")}}}):t._e(),t.can_add?o("button",{staticClass:"_addBtn",attrs:{type:"button"},on:{click:function(e){return t.$emit("add")}}}):t._e()],1)},i=[],a=(o(76801),o(92176),o(7961),{props:{keyword:String,count:Number,cat_color:String,can_remove:Boolean,can_add:Boolean},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{category(){return!!this.keyword.includes("/")&&this.keyword.split("/").at(0)},name(){return this.keyword.includes("/")?this.keyword.split("/").at(1):this.keyword},kw_styles(){let t=!1;if(this.cat_color)t=this.cat_color;else{const e=window.app_infos.custom_suggested_categories.find((t=>t.title===this.category));t=e?.tag_color}return t?`--cat-color: ${t}`:""}},methods:{}}),r=a,n=(o(38985),o(1001)),d=(0,n.Z)(r,s,i,!1,null,"f2ad472e",null),l=d.exports},48570:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return u}});var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"_agoraExport",attrs:{"data-autoscroll":!0===t.is_autoscroll}},[o("div",{ref:"agoraView",staticClass:"_agoraExport--items",on:{scroll:t.onScroll}},[o("div",{staticClass:"_item"},[o("div",{staticClass:"_item--content _firstEmptySlide"},[o("transition",{attrs:{name:"fade",mode:"out-in"}},[-1===t.currently_shown_module_index&&!1===t.is_autoscroll?o("button",{staticClass:"u-button u-button_icon",on:{click:function(e){t.slide_to_show=0}}},[o("b-icon",{attrs:{icon:"arrow-down"}})],1):t._e()])],1)]),t._l(t.section_modules_list,(function(e,s){return o("div",{key:e.$path,staticClass:"_item",attrs:{"data-modulepath":e.$path,"data-iscurrent":s===t.currently_shown_module_index,"data-stickied":s<t.currently_shown_module_index}},[o("transition",{attrs:{name:"fade",mode:"out-in"}},[s>t.currently_shown_module_index-t.number_of_modules_to_keep_visible_at_once?o("div",{staticClass:"_item--content",style:t.slideRandomLayout(s,t.getFirstSourceMedia(e.source_medias))},[t.getFirstSourceMedia(e.source_medias)?[o("MediaContent",{attrs:{file:t.getFirstSourceMedia(e.source_medias),resolution:1600,context:"full",show_fs_button:!1}})]:[o("div",[t._v("Erreur au chargement du média")])]],2):t._e()])],1)}))],2),o("transition",{attrs:{name:"showkeywords",mode:"out-in"}},[t.currently_shown_module&&t.currently_shown_module.keywords?o("div",{key:t.currently_shown_module.$path,staticClass:"_agoraExport--bottom"},[o("div",{staticClass:"_keywords"},[o("KeywordsField",{attrs:{field_name:"keywords",keywords:t.currently_shown_module.keywords,can_edit:!1}})],1)]):t._e()]),o("div",{staticClass:"_scrollIndicator",style:{"--scroll-progress":t.scroll_y/t.scroll_height}})],1)},i=[],a=o(48733);function r(t,e=0,o=2e3,s="easeOutSine"){var i=t.scrollTop||document.documentElement.scrollTop,a=0,r=Math.max(.1,Math.min(Math.abs(i-e)/o,1.6)),n={easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInOutQuint:function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)}};function d(){a+=1/60;var o=a/r,l=n[s](o);o<1?(window.requestAnimationFrame(d),t.scrollTop=i+(e-i)*l):t.scrollTop=e}d()}var n={props:{publication:Object},components:{KeywordsField:a.Z},data(){return{scroll_y:0,scroll_height:void 0,window_width:void 0,window_height:void 0,number_of_modules_to_keep_visible_at_once:8,restart_autoscroll_on_end:!0,number_of_different_layouts:10,left_right_margin:40,top_margin:40,bottom_margin:140,slide_to_show:-1,random_layouts_options:[],all_layouts:[{w:70},{w:64},{w:60},{w:80},{w:100}]}},created(){this.all_layouts=this.all_layouts.map((t=>({...t,rnd:Math.random()}))),this.random_layouts_options=this.fillWithRandoms({items:100,number_of_different_layouts:this.all_layouts.length})},mounted(){this.$nextTick((()=>{this.onResize()})),window.addEventListener("resize",this.onResize),!0===this.is_autoscroll&&setTimeout((()=>{this.startAutomaticScroll()}),1e3),history.scrollRestoration?history.scrollRestoration="manual":window.onbeforeunload=function(){window.scrollTo(0,0)}},beforeDestroy(){window.removeEventListener("resize",this.onResize)},watch:{slide_to_show(){r(this.$refs.agoraView,(this.slide_to_show+1)*window.innerHeight,400)}},computed:{first_section(){const t=this.getSectionsWithProps({publication:this.publication,group:"sections_list"});return t[0]},is_autoscroll(){return"auto"===this.$route.query?.scroll},section_modules_list(){return this.getModulesForSection({publication:this.publication,section:this.first_section}).map((({_module:t})=>t))},currently_shown_module_index(){return Math.floor(this.scroll_y/this.window_height-.1)},currently_shown_module(){return this.section_modules_list[this.currently_shown_module_index]}},methods:{onResize(){this.window_width=window.innerWidth,this.window_height=window.innerHeight,this.scroll_height=this.window_height*this.section_modules_list.length,this.onScroll()},fillWithRandoms({items:t,number_of_different_layouts:e}){let o=[];while(o.length<t){const t=new Array(e).fill(1).map(((t,e)=>e)).map((t=>({value:t,sort:Math.random()}))).sort(((t,e)=>t.sort-e.sort)).map((({value:t})=>t));o=o.concat(t)}return o},slideRandomLayout(t,e){if(!e)return;const o=this.random_layouts_options[t%this.random_layouts_options.length],s=this.all_layouts[o],i=e.$infos?.ratio||1,a=this.window_width-2*this.left_right_margin,r=this.window_height-this.bottom_margin-this.top_margin;let n=s.w/100*a,d=n*i;d>r&&(d=r,n=d/i);const l=Math.round((r-d)*s.rnd)+this.top_margin,c=Math.round((a-n)*s.rnd)+this.left_right_margin;return{"--ratio":i,"--rnd":s.rnd,width:n+"px",height:d+"px",marginTop:l+"px",marginLeft:c+"px"}},getFirstSourceMedia(t){const e=t[0];return!!e&&this.getSourceMedia({source_media:{meta_filename:e.meta_filename},folder_path:this.publication.$path})},updateCurrentSlide(t){const e=t*window.innerHeight;r(this.$refs.agoraView,e,2e3)},onScroll(t){this.scroll_y=this.$refs.agoraView.scrollTop},async startAutomaticScroll(){console.log("showing slide number",this.slide_to_show),this.slide_to_show+=1;const t=1e3;await new Promise((e=>setTimeout(e,t))),this.stopAllVideos(),this.autoPlayVideo(this.slide_to_show);const e=1e3*this.section_modules_list[this.slide_to_show]?.duration||5e3;console.log("will show slide for",e,"ms"),await new Promise((t=>setTimeout(t,e))),this.slide_to_show<this.section_modules_list.length?this.startAutomaticScroll():(console.log("Last slide"),this.restart_autoscroll_on_end&&(this.slide_to_show=-1,await new Promise((e=>setTimeout(e,t))),this.startAutomaticScroll()))},autoPlayVideo(t){const e=this.section_modules_list[t]?.$path;if(!e)return;const o=this.$el.querySelector(`[data-modulepath="${e}"]`),s=o.querySelector("video");if(s){s.muted=!0;const t=o.querySelector("[data-plyr='play']");t&&t.click()}},stopAllVideos(){this.$el.querySelectorAll("video").forEach((t=>{t.pause(),t.currentTime=0}))}}},d=n,l=(o(8317),o(1001)),c=(0,l.Z)(d,s,i,!1,null,"3319475c",null),u=c.exports},45223:function(t,e,o){"use strict";o.r(e);var s=o(8081),i=o.n(s),a=o(23645),r=o.n(a),n=r()(i());n.push([t.id,"._keywordsFieldEditor[data-v-bf8392da]{margin-top:calc(var(--spacing)/4)}._suggestions[data-v-bf8392da]{margin-top:calc(var(--spacing)/2);padding-top:calc(var(--spacing)/2)}._suggestions ._keyword[data-v-bf8392da]{cursor:pointer}._catSug[data-v-bf8392da]{padding:calc(var(--spacing)/2) 0}._categories[data-v-bf8392da]{display:flex;flex-flow:row wrap;padding:0;gap:calc(var(--spacing)/4)}._category[data-v-bf8392da]{padding:calc(var(--spacing)/4) calc(var(--spacing)/2);border-radius:4px;font-weight:600;background:var(--cat-color)}",""]),e["default"]=n},11666:function(t,e,o){"use strict";o.r(e);var s=o(8081),i=o.n(s),a=o(23645),r=o.n(a),n=r()(i());n.push([t.id,"._singleKeyword[data-v-f2ad472e]{position:relative;padding:calc(var(--spacing)/4) calc(var(--spacing)/2);border-radius:4px;line-height:1.2;display:flex;flex-flow:row nowrap;align-items:center;gap:calc(var(--spacing)/1);background-color:var(--cat-color,#fff);color:#000;transition:all .1s cubic-bezier(.19,1,.22,1)}._singleKeyword.is--clickable[data-v-f2ad472e]:hover{opacity:.7}._category[data-v-f2ad472e]{font-size:80%}._name[data-v-f2ad472e]{font-size:110%}._addBtn[data-v-f2ad472e]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;background:transparent}._count[data-v-f2ad472e]{border:1px solid currentColor;border-radius:10px;min-width:14px;height:14px;font-size:8px;display:flex;justify-content:center;align-items:center;font-weight:600}",""]),e["default"]=n},69683:function(t,e,o){"use strict";o.r(e);var s=o(8081),i=o.n(s),a=o(23645),r=o.n(a),n=r()(i());n.push([t.id,'._agoraExport[data-v-3319475c]:not([data-autoscroll=true]){scroll-snap-type:y mandatory}._agoraExport[data-autoscroll=true] ._agoraExport--items[data-v-3319475c]{overflow-y:hidden}._agoraExport[data-autoscroll=true] ._agoraExport--items[data-v-3319475c]  [data-plyr=play]{opacity:0}._agoraExport--items[data-v-3319475c]{height:100vh;height:100dvh;overflow-y:auto}._agoraExport--bottom[data-v-3319475c]{position:absolute;background-color:hsla(0,0%,100%,.3);pointer-events:none;bottom:0;width:100%;overflow:hidden;display:flex;flex-flow:column nowrap;gap:calc(var(--spacing)/2)}._agoraExport--bottom ._keywords[data-v-3319475c]{padding:calc(var(--spacing)/2);padding:1vmin 3vmin 3vmin 3vmin}._agoraExport--bottom[data-v-3319475c]  .u-keywords{font-size:2vw;gap:.5vw}._item[data-v-3319475c]{position:sticky;top:0;scroll-snap-align:center;width:100%;height:100%;pointer-events:none;overflow:hidden;transition:all .6s ease-in-out}._item[data-stickied=true][data-v-3319475c]{background-color:hsla(0,0%,100%,.2)}._item[data-v-3319475c]  ._mediaContent{width:100%;height:100%}._item[data-v-3319475c]  ._mediaContent .plyr--video,._item[data-v-3319475c]  ._mediaContent .plyr__poster{width:100%;height:auto;filter:drop-shadow(0 0 10px rgba(0,0,0,.55))}._item[data-v-3319475c]  ._mediaContent ._iframeStylePreview,._item[data-v-3319475c]  ._mediaContent ._mediaContent--iframe,._item[data-v-3319475c]  ._mediaContent ._mediaContent--image{position:absolute;height:100%;width:100%;-o-object-fit:contain;object-fit:contain;background-size:contain;filter:drop-shadow(0 0 10px rgba(0,0,0,.55))}._item--content[data-v-3319475c]{width:100%;height:100%;pointer-events:auto;overflow:visible}._item--content._firstEmptySlide[data-v-3319475c]{display:flex;align-items:flex-end;justify-content:center;padding:calc(var(--spacing)/1)}.showkeywords-enter[data-v-3319475c],.showkeywords-enter-active[data-v-3319475c],.showkeywords-leave-active[data-v-3319475c],.showkeywords-leave-to[data-v-3319475c]{transition:all 1s cubic-bezier(.19,1,.22,1)}.showkeywords-enter[data-v-3319475c],.showkeywords-leave-to[data-v-3319475c]{opacity:0}._progressBar[data-v-3319475c]{width:100%;height:15px;display:flex;align-items:center;justify-content:space-around}._progressBar>button[data-v-3319475c]{width:20px;height:20px;padding:5px;background:transparent;display:block;pointer-events:none}._progressBar>button[data-v-3319475c]:before{content:"";display:block;width:5px;height:5px;border-radius:50%;background:transparent;transition:all .3s ease-in-out}._progressBar>button[data-alreadyshown=true][data-v-3319475c]:before{background:#000}._scrollIndicator[data-v-3319475c]{position:absolute;z-index:1000;top:0;right:0;width:max(1vw,10px);height:100%;pointer-events:none;background-color:#fff;padding:3px}._scrollIndicator[data-v-3319475c]:before{content:"";display:block;width:100%;height:calc(var(--scroll-progress)*100%);background:var(--h-500)}',""]),e["default"]=n},78631:function(t,e,o){var s=o(45223);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);var i=o(31982).Z;i("9a1ab002",s,!0,{sourceMap:!1,shadowMode:!1})},38985:function(t,e,o){var s=o(11666);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);var i=o(31982).Z;i("354422cf",s,!0,{sourceMap:!1,shadowMode:!1})},8317:function(t,e,o){var s=o(69683);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);var i=o(31982).Z;i("5c9b9ae6",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=570.js.map