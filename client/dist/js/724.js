(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[724],{89326:function(t,e,a){"use strict";a.d(e,{Z:function(){return r}});var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"_mediaPicker"})},o=[],s={props:{publication_path:String,select_mode:{type:String,default:"multiple"}},components:{},data(){return{}},async created(){},beforeDestroy(){},watch:{},computed:{},methods:{}},n=s,l=(a(5281),a(1001)),c=(0,l.Z)(n,i,o,!1,null,"4464807a",null),r=c.exports},62829:function(t,e,a){"use strict";a.d(e,{Z:function(){return u}});var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"_moduleCreator",class:{"is--collapsed":!t.show_module_selector}},[a("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.show_module_selector||!t.start_collapsed?a("div",{staticClass:"_typePicker"},[t.types_available.includes("capture")?a("button",{staticClass:"u-button u-button_red",attrs:{type:"button"},on:{click:function(e){t.show_capture_modal=!0}}},[a("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"record-circle-fill"}}),t.show_labels?[t._v(t._s(t.$t("capture")))]:t._e()],2):t._e(),t.types_available.includes("import")?a("button",{staticClass:"u-button u-button_orange",attrs:{type:"button"},on:{click:function(e){t.show_media_picker=!0}}},[a("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"image"}}),t.show_labels?[t._v(t._s(t.$t("import")))]:t._e()],2):t._e(),t.show_media_picker?a("MediaPicker",{attrs:{publication_path:t.publication_path,select_mode:t.select_mode},on:{addMedias:t.createMosaic,close:function(e){t.show_media_picker=!1}}}):t._e(),t.types_available.includes("write")?a("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:t.createText}},[a("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"fonts"}}),t.show_labels?[t._v(t._s(t.$t("write")))]:t._e()],2):t._e(),t.types_available.includes("embed")?a("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(e){t.show_link_picker=!0}}},[a("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:"link"}}),t.show_labels?[t._v(t._s(t.$t("embed")))]:t._e()],2):t._e(),t.show_link_picker?a("LinkPicker",{on:{embed:t.createEmbed,close:function(e){t.show_link_picker=!1}}}):t._e(),t.types_available.includes("shapes")?t._l(t.shapes,(function(e){return a("button",{key:e.type,staticClass:"u-button u-button_bleumarine",attrs:{type:"button"},on:{click:function(a){return t.createCustomModule({module_type:e.type,addtl_meta:e.addtl_meta})}}},[a("b-icon",{staticStyle:{"font-size":"var(--icon-size)"},attrs:{icon:e.icon}}),t.show_labels?[t._v(t._s(t.$t(e.type)))]:t._e()],2)})):t._e(),t.start_collapsed?a("EditBtn",{key:"addmodule",attrs:{btn_type:"close",is_unfolded:!1},on:{click:function(e){t.show_module_selector=!1}}}):t._e()],2):t.start_collapsed&&!t.show_module_selector?a("EditBtn",{key:"addmodule",staticClass:"_addBtn",attrs:{btn_type:"add",is_unfolded:!1},on:{click:function(e){t.show_module_selector=!0}}}):t._e()],1),a("DropZone",{on:{mediaDropped:t.mediaDropped}})],1)},o=[],s=(a(70560),a(89326)),n=a(59636),l={props:{publication_path:String,pre_addtl_meta:Object,post_addtl_meta:Object,select_mode:String,show_labels:{type:Boolean,default:!0},context:String,types_available:{type:Array,default:()=>["capture","import","write","embed","shapes"]},start_collapsed:{type:Boolean,default:!0}},components:{MediaPicker:s.Z,LinkPicker:n.Z},data(){return{show_capture_modal:!1,show_module_selector:!1,show_media_picker:!1,show_file_picker:!1,show_link_picker:!1,shapes:[{type:"ellipsis",icon:"circle-fill",addtl_meta:{background_color:"#1d327f"}},{type:"rectangle",icon:"square-fill",addtl_meta:{background_color:"#ffbe32"}},{type:"line",icon:"dash-lg",addtl_meta:{outline_width:1,outline_color:"#000000"}},{type:"arrow",icon:"arrow-right-square",addtl_meta:{outline_width:1,outline_color:"#000000"}}],is_saving:!1}},created(){},mounted(){},beforeDestroy(){},watch:{show_module_selector(){}},computed:{project_path(){return"link"===this.$root.publication_include_mode?this.getParent(this.getParent(this.publication_path)):this.publication_path}},methods:{async mediaDropped({path_to_source_media_metas:t}){this.createMosaic({path_to_source_media_metas:t})},async createMosaic({meta_filename:t,path_to_source_media_metas:e}){let a=[];if(t)a.push({meta_filename:t});else if(e)for(const i of e){const t=this.$root.publication_include_mode,e=await this.prepareMediaForPublication({path_to_source_media_meta:i,publication_path:this.publication_path,import_mode:t});a.push(e)}"page_by_page"===this.context&&(a=a.map((t=>(t.objectFit="contain",t)))),"page_by_page"===this.context?await this.createMultipleModules({module_type:"mosaic",source_medias:a}):await this.createModule({module_type:"mosaic",source_medias:a}),this.show_media_picker=!1},async createEmbed(t){const e="url-"+ +new Date+".txt",a=await this.$api.uploadText({path:this.publication_path,filename:e,content:t,additional_meta:{$type:"url"}});this.createMosaic({meta_filename:a}),this.show_link_picker=!1},async createFiles({path_to_source_media_metas:t}){let e=[];t.map((t=>{const a=this.getFilename(t);e.push({meta_filename_in_project:a})})),await this.createModule({module_type:"files",source_medias:e}),this.show_file_picker=!1},async createCustomModule({module_type:t,addtl_meta:e}){await this.createModule({module_type:t,addtl_meta:e})},async createText(){const t="text-"+ +new Date+".txt",e=await this.$api.uploadText({path:this.publication_path,filename:t,content:""}),a=[{meta_filename:e}],i="page_by_page"===this.context?"text":"mosaic";await this.createModule({module_type:i,source_medias:a})},async createModule({module_type:t,source_medias:e=[],addtl_meta:a={}}){if(e.length>0){const t=this.getSourceMedia({source_media:e[0],folder_path:this.publication_path});t?.$location&&(a.location=t.$location)}const i=await this.createMetaForModule({module_type:t,source_medias:e,addtl_meta:a});return this.$emit("addModules",{meta_filenames:[i]}),this.show_module_selector=!1,i},async createMultipleModules({module_type:t,source_medias:e=[]}){let a=[];for(const i of e){const e=this.getSourceMedia({source_media:i,folder_path:this.publication_path});let o={};"page_by_page"===this.context&&e?.$infos?.ratio&&(o.width?o.height=o.width*e.$infos.ratio:o.height=this.$root.default_new_module_width*e.$infos.ratio),e?.$location&&(o.location=e.$location);const s=await this.createMetaForModule({module_type:t,source_medias:[i],addtl_meta:o});a.push(s)}this.show_module_selector=!1,this.$emit("addModules",{meta_filenames:a})},async createMetaForModule({module_type:t,source_medias:e,addtl_meta:a}){let i={module_type:t,source_medias:e,requested_slug:"module"};return this.pre_addtl_meta&&Object.assign(i,this.pre_addtl_meta),a&&Object.assign(i,a),this.post_addtl_meta&&Object.assign(i,this.post_addtl_meta),await this.$api.uploadFile({path:this.publication_path,additional_meta:i}).catch((t=>{throw this.$alertify.delay(4e3).error(t),t}))}}},c=l,r=(a(56507),a(1001)),d=(0,r.Z)(c,i,o,!1,null,"28bfa189",null),u=d.exports},52724:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return b}});var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"_montageModules"},[a("div",{staticClass:"u-spacingBottom"},[a("ToggleField",{attrs:{label:t.$t("autoscroll"),field_name:"autoscroll",content:!0===t.publication.autoscroll,path:t.publication.$path,can_edit:t.can_edit}})],1),a("div",{staticClass:"_titleBar"},[a("TitleField",{attrs:{field_name:"presentation",label:t.$t("presentation"),content:t.publication.presentation,path:t.publication.$path,required:!0,can_edit:t.can_edit,instructions:"ne sera pas affiché sur la page publique"}})],1),a("transition-group",{staticClass:"_listOfModules",attrs:{tag:"div",name:"StoryModules",appear:"",duration:700}},[t._l(t.section_modules_list,(function(e,i){return[a("div",{key:"mc_"+i,staticClass:"_spacer"},[a("ModuleCreator",{attrs:{publication_path:t.publication.$path,types_available:[]},on:{addModules:function(e){var a=e.meta_filenames;return t.insertModules({meta_filenames:a,index:i})}}})],1),a("AgoraModule",{key:e.$path,attrs:{index:i+1,agoramodule:e,module_position:1===t.section_modules_list.length?"alone":0===i?"first":i===t.section_modules_list.length-1?"last":"inbetween",can_edit:t.can_edit},on:{moveUp:function(a){return t.moveModuleTo({path:e.$path,new_position:i-1})},moveDown:function(a){return t.moveModuleTo({path:e.$path,new_position:i+1})},remove:function(a){return t.removeModule(e.$path)}}})]}))],2),a("div",{staticClass:"_lastModule"},[a("ModuleCreator",{attrs:{publication_path:t.publication.$path,start_collapsed:!1,types_available:[]},on:{addModules:t.addModules}})],1)],1)},o=[],s=(a(92176),a(7961),a(62829)),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"_montageModule"},[a("div",{staticClass:"_index"},[a("div",{staticClass:"_btns"},[a("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:"alone"===t.module_position||"first"===t.module_position},on:{click:function(e){return t.$emit("moveUp")}}},[a("b-icon",{attrs:{icon:"chevron-up"}})],1),a("button",{staticClass:"u-button u-button_icon",attrs:{type:"button",disabled:"alone"===t.module_position||"last"===t.module_position},on:{click:function(e){return t.$emit("moveDown")}}},[a("b-icon",{attrs:{icon:"chevron-down"}})],1)]),a("span",{staticClass:"_num"},[t._v(" "+t._s(t.index)+" ")])]),a("div",{staticClass:"_preview"},[a("div",{staticClass:"u-spacingBottom _topLine"},[a("div",{staticClass:"u-label"},[t.first_media?[t._v(" "+t._s(t.$t(t.first_media.$type))+" "),t.first_media_duration?[t._v("/ "+t._s(t.first_media_duration))]:t._e()]:t._e()],2),a("div",{},[a("NumberInput",{attrs:{label:t.$t("duration"),value:t.agoramodule.duration||5,min:0,suffix:"s"},on:{save:function(e){return t.updateAgoramodule({duration:e})}}})],1),a("div",[a("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:t.removeModule}},[t._v(" "+t._s(t.$t("remove"))+" "),a("b-icon",{attrs:{icon:"trash"}})],1)])]),a("div",{staticClass:"u-spacingBottom"},[a("KeywordsField",{attrs:{label:t.$t("keywords"),field_name:"keywords",keywords:t.agoramodule.keywords,path:t.agoramodule.$path,can_edit:t.can_edit}})],1),t.first_media?["text"!==t.first_media.$type?a("MediaContent",{attrs:{file:t.first_media,resolution:1600,context:"full",show_fs_button:!0}}):a("CollaborativeEditor2",{ref:"textBloc",attrs:{path:t.first_media.$path,content:t.first_media.$content,line_selected:!1,can_edit:t.can_edit},on:{lineClicked:function(e){return t.$emit("lineClicked",e)},contentIsEdited:function(e){return t.$emit("contentIsEdited",e)},contentIsNotEdited:function(e){return t.$emit("contentIsNotEdited",e)}}})]:t._e()],2)])},l=[],c=a(82566),r={props:{agoramodule:Object,index:Number,module_position:String,default_image_duration:Number,can_edit:Boolean},components:{KeywordsField:c.Z},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{first_media(){return this.firstMedia(this.agoramodule)},first_media_duration(){return this.displayDuration({media:this.first_media})}},methods:{async updateAgoramodule(t){await this.$api.updateMeta({path:this.agoramodule.$path,new_meta:t})},async removeModule(){await this.$api.deleteItem({path:this.agoramodule.$path}).catch((t=>{throw this.$alertify.delay(4e3).error(t),t})),this.$emit("remove")}}},d=r,u=(a(6734),a(1001)),_=(0,u.Z)(d,n,l,!1,null,"4dff8a85",null),p=_.exports,m={props:{publication:Object,can_edit:Boolean},components:{ModuleCreator:s.Z,AgoraModule:p},data(){return{}},i18n:{fr:{autoscroll:"Défilement automatique"},en:{autoscroll:"Scroll automatically"}},async created(){this.sections&&0!==this.sections.length||await this.createSection2({publication:this.publication,type:"section",group:"sections_list",title:"montage"})},mounted(){},beforeDestroy(){},watch:{},computed:{sections(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"})},first_section(){return this.sections.at(0)},section_modules_list(){return this.getModulesForSection({publication:this.publication,section:this.first_section}).map((({_module:t})=>t))}},methods:{async addModules({meta_filenames:t}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.first_section,meta_filenames:t})},async insertModules({meta_filenames:t,index:e}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.first_section,index:e,meta_filenames:t})},async moveModuleTo({path:t,new_position:e}){await this.moveModuleTo2({publication:this.publication,section:this.first_section,meta_filename:this.getFilename(t),new_position:e})},async duplicatePublicationMedia({source_module_path:t,copy_meta_filename:e}){const a=this.getFilename(t);await this.duplicatePublicationMedia2({publication:this.publication,section:this.first_section,source_meta_filename:a,copy_meta_filename:e})},async removeModule(t){await this.removeModule2({publication:this.publication,section:this.first_section,path:t})}}},f=m,h=(a(22551),(0,u.Z)(f,i,o,!1,null,"756e0b4a",null)),b=h.exports},59038:function(t,e,a){"use strict";a.r(e);var i=a(8081),o=a.n(i),s=a(23645),n=a.n(s),l=n()(o());l.push([t.id,"._mediaPicker[data-v-4464807a]{position:absolute}",""]),e["default"]=l},20520:function(t,e,a){"use strict";a.r(e);var i=a(8081),o=a.n(i),s=a(23645),n=a.n(s),l=n()(o());l.push([t.id,"._montageModule[data-v-4dff8a85]{position:relative;display:flex;flex-flow:row nowrap;align-items:flex-start;width:100%;margin:0 auto}._montageModule:last-child ._line[data-v-4dff8a85]{height:100%}._index[data-v-4dff8a85]{position:sticky;top:0;font-family:Fira Mono;text-transform:uppercase;line-height:1;font-weight:600;z-index:1;margin-top:-9px;display:flex;flex-flow:row nowrap;align-items:center}._index ._btns[data-v-4dff8a85]{display:flex;flex-flow:column nowrap}._index ._btns>.u-button[data-v-4dff8a85]{font-size:140%}._index ._num[data-v-4dff8a85]{font-size:5rem}._index>.u-button[data-v-4dff8a85]{font-size:50%}._lastModule[data-v-4dff8a85]{margin-top:calc(var(--spacing)*2)}._preview[data-v-4dff8a85]{flex:1 1 auto;padding:calc(var(--spacing)/2);border-radius:4px}._preview[data-v-4dff8a85]  ._mediaContent--image{max-width:none;width:100%}._imageDurationPicker[data-v-4dff8a85]{max-width:18ch;margin:calc(var(--spacing)/2) auto}._transitionPicker[data-v-4dff8a85]{text-align:center;margin:calc(var(--spacing)/2) auto}._topLine[data-v-4dff8a85]{display:flex;flex-flow:row wrap;align-items:center;justify-content:space-between}",""]),e["default"]=l},36645:function(t,e,a){"use strict";a.r(e);var i=a(8081),o=a.n(i),s=a(23645),n=a.n(s),l=n()(o());l.push([t.id,"._moduleCreator[data-v-28bfa189]{position:relative;display:flex;justify-content:flex-start;align-items:center;width:100%;pointer-events:none;gap:calc(var(--spacing)/4);padding:calc(var(--spacing)/2) 0;transition:all .5s cubic-bezier(.19,1,.22,1);--icon-size:1.2rem}._moduleCreator.is--collapsed[data-v-28bfa189]{padding:0}._moduleCreator>*[data-v-28bfa189]{pointer-events:auto}._typePicker[data-v-28bfa189]{display:flex;flex-flow:row wrap;justify-content:flex-start;align-items:center;gap:calc(var(--spacing)/4)}._dropNotice[data-v-28bfa189]{pointer-events:none}._showModuleSelector[data-v-28bfa189]{transition:all .4s cubic-bezier(.19,1,.22,1)}._addBtn[data-v-28bfa189]{margin-left:-24px}",""]),e["default"]=l},14060:function(t,e,a){"use strict";a.r(e);var i=a(8081),o=a.n(i),s=a(23645),n=a.n(s),l=n()(o());l.push([t.id,"._montageModules[data-v-756e0b4a]{padding:calc(var(--spacing)*1);max-width:680px;margin:0 auto;width:100%}._montageModules[data-v-756e0b4a]  ._moduleCreator{justify-content:center}._listOfModules[data-v-756e0b4a]{display:flex;flex-flow:column nowrap;justify-content:center}._lastModule[data-v-756e0b4a],._spacer[data-v-756e0b4a]{padding:calc(var(--spacing)*1)}._spacer[data-v-756e0b4a]{min-height:4rem;display:flex;align-items:center;justify-content:center;transition:all .2s linear}._spacer[data-v-756e0b4a]  ._moduleCreator{padding:calc(var(--spacing)/4);z-index:1;border-radius:0}._spacer[data-v-756e0b4a]  ._moduleCreator.is--collapsed{padding:0}._equationIcon[data-v-756e0b4a]{font-size:2em;line-height:1;margin:calc(var(--spacing)*2);color:#fff}._bottomRow[data-v-756e0b4a]{margin-top:calc(var(--spacing)*2);text-align:center}",""]),e["default"]=l},5281:function(t,e,a){var i=a(59038);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var o=a(31982).Z;o("f23f986c",i,!0,{sourceMap:!1,shadowMode:!1})},6734:function(t,e,a){var i=a(20520);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var o=a(31982).Z;o("5e0f7b0e",i,!0,{sourceMap:!1,shadowMode:!1})},56507:function(t,e,a){var i=a(36645);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var o=a(31982).Z;o("215e80fb",i,!0,{sourceMap:!1,shadowMode:!1})},22551:function(t,e,a){var i=a(14060);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var o=a(31982).Z;o("1be18880",i,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=724.js.map