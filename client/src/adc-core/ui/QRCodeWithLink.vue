<template>
  <div class="_QRCodeWithLink">
    <div class="_link">
      <a :href="url" target="_blank">{{ url }}</a>
    </div>
    <div class="_qr">
      <div class="_fsButton">
        <EditBtn :btn_type="'fullscreen'" @click="show_fullscreen = true" />
      </div>

      <qrcode ref="qrCode" :value="url" tag="canvas" :options="qr_options" />
      <FullscreenView v-if="show_fullscreen" @close="show_fullscreen = false">
        <qrcode ref="qrCode" :value="url" tag="canvas" :options="qr_options" />
      </FullscreenView>
    </div>
    <small>
      <a
        :download="'qr_code.png'"
        :href="canvas_dataurl"
        target="_blank"
        class="u-buttonLink"
      >
        {{ $t("download_this_qr_code") }}
      </a>
    </small>
  </div>
</template>
<script>
import qrcode from "@chenfengyuan/vue-qrcode";

export default {
  props: {
    url: String,
  },
  components: {
    qrcode,
  },
  data() {
    return {
      qr_options: {
        width: 1200,
        margin: 4,
      },
      canvas_dataurl: undefined,
      show_fullscreen: false,
    };
  },
  created() {},
  mounted() {
    this.$nextTick(() => {
      setTimeout(() => {
        if (this.$refs.qrCode)
          this.canvas_dataurl = this.$refs.qrCode.$el.toDataURL();
      }, 100);
    });
  },
  beforeDestroy() {},
  watch: {},
  computed: {},
  methods: {},
};
</script>
<style lang="scss" scoped>
._QRCodeWithLink {
  display: flex;
  flex-flow: column nowrap;
  justify-content: stretch;
  align-items: stretch;

  gap: calc(var(--spacing) / 2);

  padding: calc(var(--spacing) * 2);
  aspect-ratio: 21/29.7;

  align-items: center;
  justify-content: space-around;
  box-shadow: 0 2px 6px rgb(0 0 0 / 30%);
}

._link {
  display: block;
  width: 100%;
  text-align: center;
  word-break: break-word;

  // display: -webkit-box;
  // -webkit-box-orient: vertical;
  // -webkit-line-clamp: 1;
  // overflow: hidden;
}
._qr {
  position: relative;

  ._fsButton {
    position: absolute;
    bottom: 0;
    left: 0;
    margin: calc(var(--spacing) / 2);
  }

  canvas {
    display: block;
    // border: 2px solid var(--c-gris);
    width: 100% !important;
    height: auto !important;
    aspect-ratio: 1;
  }

  ::v-deep ._fsImg canvas {
    border: none !important;
    width: 100% !important;
    height: 100% !important;
    aspect-ratio: none;
  }
}
</style>
